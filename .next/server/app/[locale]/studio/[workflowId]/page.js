(()=>{var e={};e.id=856,e.ids=[856],e.modules={77039:(e,t,r)=>{var n={"./en.json":[54175,175],"./zh.json":[55606,606]};function i(e){if(!r.o(n,e))return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=n[e],i=t[0];return r.e(t[1]).then(()=>r.t(i,19))}i.keys=()=>Object.keys(n),i.id=77039,e.exports=i},47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},32081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},73292:e=>{"use strict";e.exports=require("fs/promises")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},72254:e=>{"use strict";e.exports=require("node:buffer")},87561:e=>{"use strict";e.exports=require("node:fs")},88849:e=>{"use strict";e.exports=require("node:http")},22286:e=>{"use strict";e.exports=require("node:https")},87503:e=>{"use strict";e.exports=require("node:net")},49411:e=>{"use strict";e.exports=require("node:path")},97742:e=>{"use strict";e.exports=require("node:process")},84492:e=>{"use strict";e.exports=require("node:stream")},76402:e=>{"use strict";e.exports=require("node:stream/promises")},72477:e=>{"use strict";e.exports=require("node:stream/web")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},65628:e=>{"use strict";e.exports=require("node:zlib")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},19037:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>u,routeModule:()=>h,tree:()=>c}),r(24943),r(55949),r(35866);var n=r(23191),i=r(88716),o=r(37922),s=r.n(o),a=r(95231),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);r.d(t,l);let c=["",{children:["[locale]",{children:["studio",{children:["[workflowId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,24943)),"/Users/yangtao/Desktop/InkAI/InkAI/src/app/[locale]/studio/[workflowId]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,55949)),"/Users/yangtao/Desktop/InkAI/InkAI/src/app/[locale]/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,32029)),"/Users/yangtao/Desktop/InkAI/InkAI/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],u=["/Users/yangtao/Desktop/InkAI/InkAI/src/app/[locale]/studio/[workflowId]/page.tsx"],d="/[locale]/studio/[workflowId]/page",p={require:r,loadChunk:()=>Promise.resolve()},h=new n.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/[locale]/studio/[workflowId]/page",pathname:"/[locale]/studio/[workflowId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},10669:(e,t,r)=>{let n={"10ee66149d7292c70664a2b6fcd7f7a70d2c3076":()=>Promise.resolve().then(r.bind(r,37258)).then(e=>e.transcribeAudioAction),"1d6c83ceea59af419a9339e920af96f843ae4931":()=>Promise.resolve().then(r.bind(r,37258)).then(e=>e.adaptScriptProfessionalAction),"339fcfd5065a4751c35774d5057596578758eddb":()=>Promise.resolve().then(r.bind(r,37258)).then(e=>e.generateVideoAction),"6e4f4bd43c5cc2f1c37851bff4349970904bddc6":()=>Promise.resolve().then(r.bind(r,37258)).then(e=>e.generateAudioAction),a78d6bd7ccacd86d81fd5dfaacb074eca54b8ecd:()=>Promise.resolve().then(r.bind(r,37258)).then(e=>e.expandVisualDescriptionAction),dccf7eab92aa7700d0bfbb18afb2b6f9bff04cb8:()=>Promise.resolve().then(r.bind(r,37258)).then(e=>e.createScriptFromTextAction),eb151d3fd857512271a65ce58cdee5f0c1e7b492:()=>Promise.resolve().then(r.bind(r,37258)).then(e=>e.planStoryboardAction),fce521ad3c90b3e771b86791ccd823b072aac3aa:()=>Promise.resolve().then(r.bind(r,37258)).then(e=>e.generateImageFromTextAction)};async function i(e,...t){return(await n[e]()).apply(null,t)}e.exports={"10ee66149d7292c70664a2b6fcd7f7a70d2c3076":i.bind(null,"10ee66149d7292c70664a2b6fcd7f7a70d2c3076"),"1d6c83ceea59af419a9339e920af96f843ae4931":i.bind(null,"1d6c83ceea59af419a9339e920af96f843ae4931"),"339fcfd5065a4751c35774d5057596578758eddb":i.bind(null,"339fcfd5065a4751c35774d5057596578758eddb"),"6e4f4bd43c5cc2f1c37851bff4349970904bddc6":i.bind(null,"6e4f4bd43c5cc2f1c37851bff4349970904bddc6"),a78d6bd7ccacd86d81fd5dfaacb074eca54b8ecd:i.bind(null,"a78d6bd7ccacd86d81fd5dfaacb074eca54b8ecd"),dccf7eab92aa7700d0bfbb18afb2b6f9bff04cb8:i.bind(null,"dccf7eab92aa7700d0bfbb18afb2b6f9bff04cb8"),eb151d3fd857512271a65ce58cdee5f0c1e7b492:i.bind(null,"eb151d3fd857512271a65ce58cdee5f0c1e7b492"),fce521ad3c90b3e771b86791ccd823b072aac3aa:i.bind(null,"fce521ad3c90b3e771b86791ccd823b072aac3aa")}},44382:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,12994,23)),Promise.resolve().then(r.t.bind(r,96114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,79671,23)),Promise.resolve().then(r.t.bind(r,41868,23)),Promise.resolve().then(r.t.bind(r,84759,23))},90219:(e,t,r)=>{Promise.resolve().then(r.bind(r,13170))},28707:(e,t,r)=>{Promise.resolve().then(r.bind(r,2998))},35303:()=>{},714:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,o=l(e),s=o[0],a=o[1],c=new i((s+a)*3/4-a),u=0,d=a>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===a&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===a&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(function(e,t,n){for(var i,o=[],s=t;s<n;s+=3)o.push(r[(i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}(e,s,s+16383>a?a:s+16383));return 1===i?o.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&o.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),o.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=o.length;s<a;++s)r[s]=o[s],n[o.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},28254:function(e,t,r){var n;!function(i){"use strict";var o,s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,l=Math.floor,c="[BigNumber Error] ",u=c+"Number primitive has more than 15 significant digits: ",d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13];function p(e){var t=0|e;return e>0||e===t?t:t-1}function h(e){for(var t,r,n=1,i=e.length,o=e[0]+"";n<i;){for(r=14-(t=e[n++]+"").length;r--;t="0"+t);o+=t}for(i=o.length;48===o.charCodeAt(--i););return o.slice(0,i+1||1)}function f(e,t){var r,n,i=e.c,o=t.c,s=e.s,a=t.s,l=e.e,c=t.e;if(!s||!a)return null;if(r=i&&!i[0],n=o&&!o[0],r||n)return r?n?0:-a:s;if(s!=a)return s;if(r=s<0,n=l==c,!i||!o)return n?0:!i^r?1:-1;if(!n)return l>c^r?1:-1;for(s=0,a=(l=i.length)<(c=o.length)?l:c;s<a;s++)if(i[s]!=o[s])return i[s]>o[s]^r?1:-1;return l==c?0:l>c^r?1:-1}function m(e,t,r,n){if(e<t||e>r||e!==l(e))throw Error(c+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function g(e){var t=e.c.length-1;return p(e.e/14)==t&&e.c[t]%2!=0}function y(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function v(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(n=e.length,++t>n){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}(o=function e(t){var r,n,i,o,b,_,E,w,x,S=L.prototype={constructor:L,toString:null,valueOf:null},T=new L(1),A=20,C=4,O=-7,I=21,N=-1e7,k=1e7,R=!1,P=1,j=0,M={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xa0",suffix:""},D="0123456789abcdefghijklmnopqrstuvwxyz",U=!0;function L(e,t){var r,n,i,o,a,c,d,p,h=this;if(!(h instanceof L))return new L(e,t);if(null==t){if(e&&!0===e._isBigNumber){h.s=e.s,!e.c||e.e>k?h.c=h.e=null:e.e<N?h.c=[h.e=0]:(h.e=e.e,h.c=e.c.slice());return}if((c="number"==typeof e)&&0*e==0){if(h.s=1/e<0?(e=-e,-1):1,e===~~e){for(o=0,a=e;a>=10;a/=10,o++);o>k?h.c=h.e=null:(h.e=o,h.c=[e]);return}p=String(e)}else{if(!s.test(p=String(e)))return x(h,p,c);h.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(o=p.indexOf("."))>-1&&(p=p.replace(".","")),(a=p.search(/e/i))>0?(o<0&&(o=a),o+=+p.slice(a+1),p=p.substring(0,a)):o<0&&(o=p.length)}else{if(m(t,2,D.length,"Base"),10==t&&U)return B(h=new L(e),A+h.e+1,C);if(p=String(e),c="number"==typeof e){if(0*e!=0)return x(h,p,c,t);if(h.s=1/e<0?(p=p.slice(1),-1):1,L.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(u+e)}else h.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(r=D.slice(0,t),o=a=0,d=p.length;a<d;a++)if(0>r.indexOf(n=p.charAt(a))){if("."==n){if(a>o){o=d;continue}}else if(!i&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){i=!0,a=-1,o=0;continue}return x(h,String(e),c,t)}c=!1,(o=(p=w(p,t,10,h.s)).indexOf("."))>-1?p=p.replace(".",""):o=p.length}for(a=0;48===p.charCodeAt(a);a++);for(d=p.length;48===p.charCodeAt(--d););if(p=p.slice(a,++d)){if(d-=a,c&&L.DEBUG&&d>15&&(e>9007199254740991||e!==l(e)))throw Error(u+h.s*e);if((o=o-a-1)>k)h.c=h.e=null;else if(o<N)h.c=[h.e=0];else{if(h.e=o,h.c=[],a=(o+1)%14,o<0&&(a+=14),a<d){for(a&&h.c.push(+p.slice(0,a)),d-=14;a<d;)h.c.push(+p.slice(a,a+=14));a=14-(p=p.slice(a)).length}else a-=d;for(;a--;p+="0");h.c.push(+p)}}else h.c=[h.e=0]}function G(e,t,r,n){var i,o,s,a,l;if(null==r?r=C:m(r,0,8),!e.c)return e.toString();if(i=e.c[0],s=e.e,null==t)l=h(e.c),l=1==n||2==n&&(s<=O||s>=I)?y(l,s):v(l,s,"0");else if(o=(e=B(new L(e),t,r)).e,a=(l=h(e.c)).length,1==n||2==n&&(t<=o||o<=O)){for(;a<t;l+="0",a++);l=y(l,o)}else if(t-=s+(2===n&&o>s),l=v(l,o,"0"),o+1>a){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=o-a)>0)for(o+1==a&&(l+=".");t--;l+="0");return e.s<0&&i?"-"+l:l}function F(e,t){for(var r,n,i=1,o=new L(e[0]);i<e.length;i++)(n=new L(e[i])).s&&(r=f(o,n))!==t&&(0!==r||o.s!==t)||(o=n);return o}function q(e,t,r){for(var n=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,n++);return(r=n+14*r-1)>k?e.c=e.e=null:r<N?e.c=[e.e=0]:(e.e=r,e.c=t),e}function B(e,t,r,n){var i,o,s,c,u,p,h,f=e.c;if(f){e:{for(i=1,c=f[0];c>=10;c/=10,i++);if((o=t-i)<0)o+=14,s=t,h=l((u=f[p=0])/d[i-s-1]%10);else if((p=a((o+1)/14))>=f.length){if(n){for(;f.length<=p;f.push(0));u=h=0,i=1,o%=14,s=o-14+1}else break e}else{for(i=1,u=c=f[p];c>=10;c/=10,i++);o%=14,h=(s=o-14+i)<0?0:l(u/d[i-s-1]%10)}if(n=n||t<0||null!=f[p+1]||(s<0?u:u%d[i-s-1]),n=r<4?(h||n)&&(0==r||r==(e.s<0?3:2)):h>5||5==h&&(4==r||n||6==r&&(o>0?s>0?u/d[i-s]:0:f[p-1])%10&1||r==(e.s<0?8:7)),t<1||!f[0])return f.length=0,n?(t-=e.e+1,f[0]=d[(14-t%14)%14],e.e=-t||0):f[0]=e.e=0,e;if(0==o?(f.length=p,c=1,p--):(f.length=p+1,c=d[14-o],f[p]=s>0?l(u/d[i-s]%d[s])*c:0),n)for(;;){if(0==p){for(o=1,s=f[0];s>=10;s/=10,o++);for(s=f[0]+=c,c=1;s>=10;s/=10,c++);o!=c&&(e.e++,1e14==f[0]&&(f[0]=1));break}if(f[p]+=c,1e14!=f[p])break;f[p--]=0,c=1}for(o=f.length;0===f[--o];f.pop());}e.e>k?e.c=e.e=null:e.e<N&&(e.c=[e.e=0])}return e}function H(e){var t,r=e.e;return null===r?e.toString():(t=h(e.c),t=r<=O||r>=I?y(t,r):v(t,r,"0"),e.s<0?"-"+t:t)}return L.clone=e,L.ROUND_UP=0,L.ROUND_DOWN=1,L.ROUND_CEIL=2,L.ROUND_FLOOR=3,L.ROUND_HALF_UP=4,L.ROUND_HALF_DOWN=5,L.ROUND_HALF_EVEN=6,L.ROUND_HALF_CEIL=7,L.ROUND_HALF_FLOOR=8,L.EUCLID=9,L.config=L.set=function(e){var t,r;if(null!=e){if("object"==typeof e){if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(m(r=e[t],0,1e9,t),A=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(m(r=e[t],0,8,t),C=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(m(r[0],-1e9,0,t),m(r[1],0,1e9,t),O=r[0],I=r[1]):(m(r,-1e9,1e9,t),O=-(I=r<0?-r:r))),e.hasOwnProperty(t="RANGE")){if((r=e[t])&&r.pop)m(r[0],-1e9,-1,t),m(r[1],1,1e9,t),N=r[0],k=r[1];else if(m(r,-1e9,1e9,t),r)N=-(k=r<0?-r:r);else throw Error(c+t+" cannot be zero: "+r)}if(e.hasOwnProperty(t="CRYPTO")){if(!!(r=e[t])===r){if(r){if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))R=r;else throw R=!r,Error(c+"crypto unavailable")}else R=r}else throw Error(c+t+" not true or false: "+r)}if(e.hasOwnProperty(t="MODULO_MODE")&&(m(r=e[t],0,9,t),P=r),e.hasOwnProperty(t="POW_PRECISION")&&(m(r=e[t],0,1e9,t),j=r),e.hasOwnProperty(t="FORMAT")){if("object"==typeof(r=e[t]))M=r;else throw Error(c+t+" not an object: "+r)}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(c+t+" invalid: "+r);U="0123456789"==r.slice(0,10),D=r}}else throw Error(c+"Object expected: "+e)}return{DECIMAL_PLACES:A,ROUNDING_MODE:C,EXPONENTIAL_AT:[O,I],RANGE:[N,k],CRYPTO:R,MODULO_MODE:P,POW_PRECISION:j,FORMAT:M,ALPHABET:D}},L.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!L.DEBUG)return!0;var t,r,n=e.c,i=e.e,o=e.s;e:if("[object Array]"==({}).toString.call(n)){if((1===o||-1===o)&&i>=-1e9&&i<=1e9&&i===l(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break e}if((t=(i+1)%14)<1&&(t+=14),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=1e14||r!==l(r))break e;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(c+"Invalid BigNumber: "+e)},L.maximum=L.max=function(){return F(arguments,-1)},L.minimum=L.min=function(){return F(arguments,1)},L.random=(r=9007199254740992*Math.random()&2097151?function(){return l(9007199254740992*Math.random())}:function(){return(1073741824*Math.random()|0)*8388608+(8388608*Math.random()|0)},function(e){var t,n,i,o,s,u=0,p=[],h=new L(T);if(null==e?e=A:m(e,0,1e9),o=a(e/14),R){if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(s=131072*t[u]+(t[u+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[u]=n[0],t[u+1]=n[1]):(p.push(s%1e14),u+=2);u=o/2}else if(crypto.randomBytes){for(t=crypto.randomBytes(o*=7);u<o;)(s=(31&t[u])*281474976710656+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(p.push(s%1e14),u+=7);u=o/7}else throw R=!1,Error(c+"crypto unavailable")}if(!R)for(;u<o;)(s=r())<9e15&&(p[u++]=s%1e14);for(o=p[--u],e%=14,o&&e&&(s=d[14-e],p[u]=l(o/s)*s);0===p[u];p.pop(),u--);if(u<0)p=[i=0];else{for(i=-1;0===p[0];p.splice(0,1),i-=14);for(u=1,s=p[0];s>=10;s/=10,u++);u<14&&(i-=14-u)}return h.e=i,h.c=p,h}),L.sum=function(){for(var e=1,t=arguments,r=new L(t[0]);e<t.length;)r=r.plus(t[e++]);return r},w=function(){var e="0123456789";function t(e,t,r,n){for(var i,o,s=[0],a=0,l=e.length;a<l;){for(o=s.length;o--;s[o]*=t);for(s[0]+=n.indexOf(e.charAt(a++)),i=0;i<s.length;i++)s[i]>r-1&&(null==s[i+1]&&(s[i+1]=0),s[i+1]+=s[i]/r|0,s[i]%=r)}return s.reverse()}return function(r,n,i,o,s){var a,l,c,u,d,p,f,m,g=r.indexOf("."),y=A,b=C;for(g>=0&&(u=j,j=0,r=r.replace(".",""),p=(m=new L(n)).pow(r.length-g),j=u,m.c=t(v(h(p.c),p.e,"0"),10,i,e),m.e=m.c.length),c=u=(f=t(r,n,i,s?(a=D,e):(a=e,D))).length;0==f[--u];f.pop());if(!f[0])return a.charAt(0);if(g<0?--c:(p.c=f,p.e=c,p.s=o,f=(p=E(p,m,y,b,i)).c,d=p.r,c=p.e),g=f[l=c+y+1],u=i/2,d=d||l<0||null!=f[l+1],d=b<4?(null!=g||d)&&(0==b||b==(p.s<0?3:2)):g>u||g==u&&(4==b||d||6==b&&1&f[l-1]||b==(p.s<0?8:7)),l<1||!f[0])r=d?v(a.charAt(1),-y,a.charAt(0)):a.charAt(0);else{if(f.length=l,d)for(--i;++f[--l]>i;)f[l]=0,l||(++c,f=[1].concat(f));for(u=f.length;!f[--u];);for(g=0,r="";g<=u;r+=a.charAt(f[g++]));r=v(r,c,a.charAt(0))}return r}}(),E=function(){function e(e,t,r){var n,i,o,s,a=0,l=e.length,c=t%1e7,u=t/1e7|0;for(e=e.slice();l--;)n=u*(o=e[l]%1e7)+(s=e[l]/1e7|0)*c,a=((i=c*o+n%1e7*1e7+a)/r|0)+(n/1e7|0)+u*s,e[l]=i%r;return a&&(e=[a].concat(e)),e}function t(e,t,r,n){var i,o;if(r!=n)o=r>n?1:-1;else for(i=o=0;i<r;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,i,o,s,a){var c,u,d,h,f,m,g,y,v,b,_,E,w,x,S,T,A,C=n.s==i.s?1:-1,O=n.c,I=i.c;if(!O||!O[0]||!I||!I[0])return new L(n.s&&i.s&&(O?!I||O[0]!=I[0]:I)?O&&0==O[0]||!I?0*C:C/0:NaN);for(v=(y=new L(C)).c=[],C=o+(u=n.e-i.e)+1,a||(a=1e14,u=p(n.e/14)-p(i.e/14),C=C/14|0),d=0;I[d]==(O[d]||0);d++);if(I[d]>(O[d]||0)&&u--,C<0)v.push(1),h=!0;else{for(x=O.length,T=I.length,d=0,C+=2,(f=l(a/(I[0]+1)))>1&&(I=e(I,f,a),O=e(O,f,a),T=I.length,x=O.length),w=T,_=(b=O.slice(0,T)).length;_<T;b[_++]=0);A=[0].concat(A=I.slice()),S=I[0],I[1]>=a/2&&S++;do{if(f=0,(c=t(I,b,T,_))<0){if(E=b[0],T!=_&&(E=E*a+(b[1]||0)),(f=l(E/S))>1)for(f>=a&&(f=a-1),g=(m=e(I,f,a)).length,_=b.length;1==t(m,b,g,_);)f--,r(m,T<g?A:I,g,a),g=m.length,c=1;else 0==f&&(c=f=1),g=(m=I.slice()).length;if(g<_&&(m=[0].concat(m)),r(b,m,_,a),_=b.length,-1==c)for(;1>t(I,b,T,_);)f++,r(b,T<_?A:I,_,a),_=b.length}else 0===c&&(f++,b=[0]);v[d++]=f,b[0]?b[_++]=O[w]||0:(b=[O[w]],_=1)}while((w++<x||null!=b[0])&&C--);h=null!=b[0],v[0]||v.splice(0,1)}if(1e14==a){for(d=1,C=v[0];C>=10;C/=10,d++);B(y,o+(y.e=d+14*u-1)+1,s,h)}else y.e=u,y.r=+h;return y}}(),n=/^(-?)0([xbo])(?=\w[\w.]*$)/i,i=/^([^.]+)\.$/,o=/^\.([^.]+)$/,b=/^-?(Infinity|NaN)$/,_=/^\s*\+(?=[\w.])|^\s+|\s+$/g,x=function(e,t,r,s){var a,l=r?t:t.replace(_,"");if(b.test(l))e.s=isNaN(l)?null:l<0?-1:1;else{if(!r&&(l=l.replace(n,function(e,t,r){return a="x"==(r=r.toLowerCase())?16:"b"==r?2:8,s&&s!=a?e:t}),s&&(a=s,l=l.replace(i,"$1").replace(o,"0.$1")),t!=l))return new L(l,a);if(L.DEBUG)throw Error(c+"Not a"+(s?" base "+s:"")+" number: "+t);e.s=null}e.c=e.e=null},S.absoluteValue=S.abs=function(){var e=new L(this);return e.s<0&&(e.s=1),e},S.comparedTo=function(e,t){return f(this,new L(e,t))},S.decimalPlaces=S.dp=function(e,t){var r,n,i;if(null!=e)return m(e,0,1e9),null==t?t=C:m(t,0,8),B(new L(this),e+this.e+1,t);if(!(r=this.c))return null;if(n=((i=r.length-1)-p(this.e/14))*14,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},S.dividedBy=S.div=function(e,t){return E(this,new L(e,t),A,C)},S.dividedToIntegerBy=S.idiv=function(e,t){return E(this,new L(e,t),0,1)},S.exponentiatedBy=S.pow=function(e,t){var r,n,i,o,s,u,d,p,h,f=this;if((e=new L(e)).c&&!e.isInteger())throw Error(c+"Exponent not an integer: "+H(e));if(null!=t&&(t=new L(t)),u=e.e>14,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return h=new L(Math.pow(+H(f),u?e.s*(2-g(e)):+H(e))),t?h.mod(t):h;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new L(NaN);(n=!d&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(e.e>9&&(f.e>0||f.e<-1||(0==f.e?f.c[0]>1||u&&f.c[1]>=24e7:f.c[0]<8e13||u&&f.c[0]<=9999975e7)))return o=f.s<0&&g(e)?-0:0,f.e>-1&&(o=1/o),new L(d?1/o:o);j&&(o=a(j/14+2))}for(u?(r=new L(.5),d&&(e.s=1),p=g(e)):p=(i=Math.abs(+H(e)))%2,h=new L(T);;){if(p){if(!(h=h.times(f)).c)break;o?h.c.length>o&&(h.c.length=o):n&&(h=h.mod(t))}if(i){if(0===(i=l(i/2)))break;p=i%2}else if(B(e=e.times(r),e.e+1,1),e.e>14)p=g(e);else{if(0==(i=+H(e)))break;p=i%2}f=f.times(f),o?f.c&&f.c.length>o&&(f.c.length=o):n&&(f=f.mod(t))}return n?h:(d&&(h=T.div(h)),t?h.mod(t):o?B(h,j,C,s):h)},S.integerValue=function(e){var t=new L(this);return null==e?e=C:m(e,0,8),B(t,t.e+1,e)},S.isEqualTo=S.eq=function(e,t){return 0===f(this,new L(e,t))},S.isFinite=function(){return!!this.c},S.isGreaterThan=S.gt=function(e,t){return f(this,new L(e,t))>0},S.isGreaterThanOrEqualTo=S.gte=function(e,t){return 1===(t=f(this,new L(e,t)))||0===t},S.isInteger=function(){return!!this.c&&p(this.e/14)>this.c.length-2},S.isLessThan=S.lt=function(e,t){return 0>f(this,new L(e,t))},S.isLessThanOrEqualTo=S.lte=function(e,t){return -1===(t=f(this,new L(e,t)))||0===t},S.isNaN=function(){return!this.s},S.isNegative=function(){return this.s<0},S.isPositive=function(){return this.s>0},S.isZero=function(){return!!this.c&&0==this.c[0]},S.minus=function(e,t){var r,n,i,o,s=this.s;if(t=(e=new L(e,t)).s,!s||!t)return new L(NaN);if(s!=t)return e.s=-t,this.plus(e);var a=this.e/14,l=e.e/14,c=this.c,u=e.c;if(!a||!l){if(!c||!u)return c?(e.s=-t,e):new L(u?this:NaN);if(!c[0]||!u[0])return u[0]?(e.s=-t,e):new L(c[0]?this:3==C?-0:0)}if(a=p(a),l=p(l),c=c.slice(),s=a-l){for((o=s<0)?(s=-s,i=c):(l=a,i=u),i.reverse(),t=s;t--;i.push(0));i.reverse()}else for(n=(o=(s=c.length)<(t=u.length))?s:t,s=t=0;t<n;t++)if(c[t]!=u[t]){o=c[t]<u[t];break}if(o&&(i=c,c=u,u=i,e.s=-e.s),(t=(n=u.length)-(r=c.length))>0)for(;t--;c[r++]=0);for(t=1e14-1;n>s;){if(c[--n]<u[n]){for(r=n;r&&!c[--r];c[r]=t);--c[r],c[n]+=1e14}c[n]-=u[n]}for(;0==c[0];c.splice(0,1),--l);return c[0]?q(e,c,l):(e.s=3==C?-1:1,e.c=[e.e=0],e)},S.modulo=S.mod=function(e,t){var r,n;return(e=new L(e,t),this.c&&e.s&&(!e.c||e.c[0]))?e.c&&(!this.c||this.c[0])?(9==P?(n=e.s,e.s=1,r=E(this,e,0,3),e.s=n,r.s*=n):r=E(this,e,0,P),(e=this.minus(r.times(e))).c[0]||1!=P||(e.s=this.s),e):new L(this):new L(NaN)},S.multipliedBy=S.times=function(e,t){var r,n,i,o,s,a,l,c,u,d,h,f,m,g=this.c,y=(e=new L(e,t)).c;if(!g||!y||!g[0]||!y[0])return this.s&&e.s&&(!g||g[0]||y)&&(!y||y[0]||g)?(e.s*=this.s,g&&y?(e.c=[0],e.e=0):e.c=e.e=null):e.c=e.e=e.s=null,e;for(n=p(this.e/14)+p(e.e/14),e.s*=this.s,(l=g.length)<(d=y.length)&&(m=g,g=y,y=m,i=l,l=d,d=i),i=l+d,m=[];i--;m.push(0));for(i=d;--i>=0;){for(r=0,h=y[i]%1e7,f=y[i]/1e7|0,o=i+(s=l);o>i;)a=f*(c=g[--s]%1e7)+(u=g[s]/1e7|0)*h,r=((c=h*c+a%1e7*1e7+m[o]+r)/1e14|0)+(a/1e7|0)+f*u,m[o--]=c%1e14;m[o]=r}return r?++n:m.splice(0,1),q(e,m,n)},S.negated=function(){var e=new L(this);return e.s=-e.s||null,e},S.plus=function(e,t){var r,n=this.s;if(t=(e=new L(e,t)).s,!n||!t)return new L(NaN);if(n!=t)return e.s=-t,this.minus(e);var i=this.e/14,o=e.e/14,s=this.c,a=e.c;if(!i||!o){if(!s||!a)return new L(n/0);if(!s[0]||!a[0])return a[0]?e:new L(s[0]?this:0*n)}if(i=p(i),o=p(o),s=s.slice(),n=i-o){for(n>0?(o=i,r=a):(n=-n,r=s),r.reverse();n--;r.push(0));r.reverse()}for((n=s.length)-(t=a.length)<0&&(r=a,a=s,s=r,t=n),n=0;t;)n=(s[--t]=s[t]+a[t]+n)/1e14|0,s[t]=1e14===s[t]?0:s[t]%1e14;return n&&(s=[n].concat(s),++o),q(e,s,o)},S.precision=S.sd=function(e,t){var r,n,i;if(null!=e&&!!e!==e)return m(e,1,1e9),null==t?t=C:m(t,0,8),B(new L(this),e,t);if(!(r=this.c))return null;if(n=14*(i=r.length-1)+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return e&&this.e+1>n&&(n=this.e+1),n},S.shiftedBy=function(e){return m(e,-9007199254740991,9007199254740991),this.times("1e"+e)},S.squareRoot=S.sqrt=function(){var e,t,r,n,i,o=this.c,s=this.s,a=this.e,l=A+4,c=new L("0.5");if(1!==s||!o||!o[0])return new L(!s||s<0&&(!o||o[0])?NaN:o?this:1/0);if(0==(s=Math.sqrt(+H(this)))||s==1/0?(((t=h(o)).length+a)%2==0&&(t+="0"),s=Math.sqrt(+t),a=p((a+1)/2)-(a<0||a%2),r=new L(t=s==1/0?"5e"+a:(t=s.toExponential()).slice(0,t.indexOf("e")+1)+a)):r=new L(s+""),r.c[0]){for((s=(a=r.e)+l)<3&&(s=0);;)if(i=r,r=c.times(i.plus(E(this,i,l,1))),h(i.c).slice(0,s)===(t=h(r.c)).slice(0,s)){if(r.e<a&&--s,"9999"!=(t=t.slice(s-3,s+1))&&(n||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(B(r,r.e+A+2,1),e=!r.times(r).eq(this));break}if(!n&&(B(i,i.e+A+2,0),i.times(i).eq(this))){r=i;break}l+=4,s+=4,n=1}}return B(r,r.e+A+1,C,e)},S.toExponential=function(e,t){return null!=e&&(m(e,0,1e9),e++),G(this,e,t,1)},S.toFixed=function(e,t){return null!=e&&(m(e,0,1e9),e=e+this.e+1),G(this,e,t)},S.toFormat=function(e,t,r){var n;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=M;else if("object"!=typeof r)throw Error(c+"Argument not an object: "+r);if(n=this.toFixed(e,t),this.c){var i,o=n.split("."),s=+r.groupSize,a=+r.secondaryGroupSize,l=r.groupSeparator||"",u=o[0],d=o[1],p=this.s<0,h=p?u.slice(1):u,f=h.length;if(a&&(i=s,s=a,a=i,f-=i),s>0&&f>0){for(i=f%s||s,u=h.substr(0,i);i<f;i+=s)u+=l+h.substr(i,s);a>0&&(u+=l+h.slice(i)),p&&(u="-"+u)}n=d?u+(r.decimalSeparator||"")+((a=+r.fractionGroupSize)?d.replace(RegExp("\\d{"+a+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):d):u}return(r.prefix||"")+n+(r.suffix||"")},S.toFraction=function(e){var t,r,n,i,o,s,a,l,u,p,f,m,g=this.c;if(null!=e&&(!(a=new L(e)).isInteger()&&(a.c||1!==a.s)||a.lt(T)))throw Error(c+"Argument "+(a.isInteger()?"out of range: ":"not an integer: ")+H(a));if(!g)return new L(this);for(t=new L(T),u=r=new L(T),n=l=new L(T),m=h(g),o=t.e=m.length-this.e-1,t.c[0]=d[(s=o%14)<0?14+s:s],e=!e||a.comparedTo(t)>0?o>0?t:u:a,s=k,k=1/0,a=new L(m),l.c[0]=0;p=E(a,t,0,1),1!=(i=r.plus(p.times(n))).comparedTo(e);)r=n,n=i,u=l.plus(p.times(i=u)),l=i,t=a.minus(p.times(i=t)),a=i;return i=E(e.minus(r),n,0,1),l=l.plus(i.times(u)),r=r.plus(i.times(n)),l.s=u.s=this.s,o*=2,f=1>E(u,n,o,C).minus(this).abs().comparedTo(E(l,r,o,C).minus(this).abs())?[u,n]:[l,r],k=s,f},S.toNumber=function(){return+H(this)},S.toPrecision=function(e,t){return null!=e&&m(e,1,1e9),G(this,e,t,2)},S.toString=function(e){var t,r=this,n=r.s,i=r.e;return null===i?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=i<=O||i>=I?y(h(r.c),i):v(h(r.c),i,"0"):10===e&&U?t=v(h((r=B(new L(r),A+i+1,C)).c),r.e,"0"):(m(e,2,D.length,"Base"),t=w(v(h(r.c),i,"0"),10,e,n,!0)),n<0&&r.c[0]&&(t="-"+t)),t},S.valueOf=S.toJSON=function(){return H(this)},S._isBigNumber=!0,null!=t&&L.set(t),L}()).default=o.BigNumber=o,void 0!==(n=(function(){return o}).call(t,r,t,e))&&(e.exports=n)}(0)},29916:(e,t,r)=>{"use strict";var n=r(14300).Buffer,i=r(14300).SlowBuffer;function o(e,t){if(!n.isBuffer(e)||!n.isBuffer(t)||e.length!==t.length)return!1;for(var r=0,i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r}e.exports=o,o.install=function(){n.prototype.equal=i.prototype.equal=function(e){return o(this,e)}};var s=n.prototype.equal,a=i.prototype.equal;o.restore=function(){n.prototype.equal=s,i.prototype.equal=a}},3164:(e,t,r)=>{"use strict";var n=r(90892).Buffer,i=r(21887);function o(e){if(n.isBuffer(e))return e;if("string"==typeof e)return n.from(e,"base64");throw TypeError("ECDSA signature must be a Base64 string or a Buffer")}function s(e,t,r){for(var n=0;t+n<r&&0===e[t+n];)++n;return e[t+n]>=128&&--n,n}e.exports={derToJose:function(e,t){e=o(e);var r=i(t),s=r+1,a=e.length,l=0;if(48!==e[l++])throw Error('Could not find expected "seq"');var c=e[l++];if(129===c&&(c=e[l++]),a-l<c)throw Error('"seq" specified length of "'+c+'", only "'+(a-l)+'" remaining');if(2!==e[l++])throw Error('Could not find expected "int" for "r"');var u=e[l++];if(a-l-2<u)throw Error('"r" specified length of "'+u+'", only "'+(a-l-2)+'" available');if(s<u)throw Error('"r" specified length of "'+u+'", max of "'+s+'" is acceptable');var d=l;if(l+=u,2!==e[l++])throw Error('Could not find expected "int" for "s"');var p=e[l++];if(a-l!==p)throw Error('"s" specified length of "'+p+'", expected "'+(a-l)+'"');if(s<p)throw Error('"s" specified length of "'+p+'", max of "'+s+'" is acceptable');var h=l;if((l+=p)!==a)throw Error('Expected to consume entire buffer, but "'+(a-l)+'" bytes remain');var f=r-u,m=r-p,g=n.allocUnsafe(f+u+m+p);for(l=0;l<f;++l)g[l]=0;e.copy(g,l,d+Math.max(-f,0),d+u),l=r;for(var y=l;l<y+m;++l)g[l]=0;return e.copy(g,l,h+Math.max(-m,0),h+p),g=(g=g.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,t){e=o(e);var r=i(t),a=e.length;if(a!==2*r)throw TypeError('"'+t+'" signatures must be "'+2*r+'" bytes, saw "'+a+'"');var l=s(e,0,r),c=s(e,r,e.length),u=r-l,d=r-c,p=2+u+1+1+d,h=p<128,f=n.allocUnsafe((h?2:3)+p),m=0;return f[m++]=48,h?f[m++]=p:(f[m++]=129,f[m++]=255&p),f[m++]=2,f[m++]=u,l<0?(f[m++]=0,m+=e.copy(f,m,0,r)):m+=e.copy(f,m,l,r),f[m++]=2,f[m++]=d,c<0?(f[m++]=0,e.copy(f,m,r)):e.copy(f,m,r+c),f}}},21887:e=>{"use strict";function t(e){return(e/8|0)+(e%8==0?0:1)}var r={ES256:t(256),ES384:t(384),ES512:t(521)};e.exports=function(e){var t=r[e];if(t)return t;throw Error('Unknown algorithm "'+e+'"')}},71771:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===r.call(e)},s=function(e){if(!e||"[object Object]"!==r.call(e))return!1;var n,i=t.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&t.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!i&&!o)return!1;for(n in e);return void 0===n||t.call(e,n)},a=function(e,t){n&&"__proto__"===t.name?n(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},l=function(e,r){if("__proto__"===r){if(!t.call(e,r))return;if(i)return i(e,r).value}return e[r]};e.exports=function e(){var t,r,n,i,c,u,d=arguments[0],p=1,h=arguments.length,f=!1;for("boolean"==typeof d&&(f=d,d=arguments[1]||{},p=2),(null==d||"object"!=typeof d&&"function"!=typeof d)&&(d={});p<h;++p)if(t=arguments[p],null!=t)for(r in t)n=l(d,r),d!==(i=l(t,r))&&(f&&i&&(s(i)||(c=o(i)))?(c?(c=!1,u=n&&o(n)?n:[]):u=n&&s(n)?n:{},a(d,{name:r,newValue:e(f,u,i)})):void 0!==i&&a(d,{name:r,newValue:i}));return d}},41779:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosError=t.GAXIOS_ERROR_SYMBOL=void 0,t.defaultErrorRedactor=function e(t){let r="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function n(e){e&&e.forEach((t,n)=>{(/^authentication$/i.test(n)||/^authorization$/i.test(n)||/secret/i.test(n))&&e.set(n,r)})}function i(e,t){if("object"==typeof e&&null!==e&&"string"==typeof e[t]){let n=e[t];(/grant_type=/i.test(n)||/assertion=/i.test(n)||/secret/i.test(n))&&(e[t]=r)}}function o(e){e&&"object"==typeof e&&(e instanceof FormData||e instanceof URLSearchParams||"forEach"in e&&"set"in e?e.forEach((t,n)=>{(["grant_type","assertion"].includes(n)||/secret/.test(n))&&e.set(n,r)}):("grant_type"in e&&(e.grant_type=r),"assertion"in e&&(e.assertion=r),"client_secret"in e&&(e.client_secret=r)))}return t.config&&(n(t.config.headers),i(t.config,"data"),o(t.config.data),i(t.config,"body"),o(t.config.body),t.config.url.searchParams.has("token")&&t.config.url.searchParams.set("token",r),t.config.url.searchParams.has("client_secret")&&t.config.url.searchParams.set("client_secret",r)),t.response&&(e({config:t.response.config}),n(t.response.headers),t.response.bodyUsed&&(i(t.response,"data"),o(t.response.data))),t};let i=n(r(71771)),o=n(r(15506)).default.pkg;t.GAXIOS_ERROR_SYMBOL=Symbol.for(`${o.name}-gaxios-error`);class s extends Error{config;response;code;status;error;[t.GAXIOS_ERROR_SYMBOL]=o.version;static[Symbol.hasInstance](e){return!!e&&"object"==typeof e&&t.GAXIOS_ERROR_SYMBOL in e&&e[t.GAXIOS_ERROR_SYMBOL]===o.version||Function.prototype[Symbol.hasInstance].call(s,e)}constructor(e,t,r,n){if(super(e,{cause:n}),this.config=t,this.response=r,this.error=n instanceof Error?n:void 0,this.config=(0,i.default)(!0,{},t),this.response&&(this.response.config=(0,i.default)(!0,{},this.response.config)),this.response){try{this.response.data=function(e,t){switch(e){case"stream":default:return t;case"json":return JSON.parse(JSON.stringify(t));case"arraybuffer":return JSON.parse(Buffer.from(t).toString("utf8"));case"blob":return JSON.parse(t.text())}}(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}n instanceof DOMException?this.code=n.name:n&&"object"==typeof n&&"code"in n&&("string"==typeof n.code||"number"==typeof n.code)&&(this.code=n.code)}static extractAPIErrorFromResponse(e,t="The request failed"){let r=t;if("string"==typeof e.data&&(r=e.data),e.data&&"object"==typeof e.data&&"error"in e.data&&e.data.error&&!e.ok){if("string"==typeof e.data.error)return{message:e.data.error,code:e.status,status:e.statusText};if("object"==typeof e.data.error){r="message"in e.data.error&&"string"==typeof e.data.error.message?e.data.error.message:r;let t="status"in e.data.error&&"string"==typeof e.data.error.status?e.data.error.status:e.statusText,n="code"in e.data.error&&"number"==typeof e.data.error.code?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let i=[];for(let t of e.data.error.errors)"object"==typeof t&&"message"in t&&"string"==typeof t.message&&i.push(t.message);return Object.assign({message:i.join("\n")||r,code:n,status:t},e.data.error)}return Object.assign({message:r,code:n,status:t},e.data.error)}}return{message:r,code:e.status,status:e.statusText}}}t.GaxiosError=s},67622:function(e,t,r){"use strict";var n,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Gaxios=void 0;let o=i(r(71771)),s=r(95687),a=r(41779),l=r(41544),c=r(12781),u=r(24377),d=async()=>globalThis.crypto?.randomUUID()||(await Promise.resolve().then(r.t.bind(r,6113,23))).randomUUID();class p{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new u.GaxiosInterceptorManager,response:new u.GaxiosInterceptorManager}}fetch(...e){let t;let r=e[0],i=e[1],o=new Headers;return("string"==typeof r?t=new URL(r):r instanceof URL?t=r:r&&r.url&&(t=new URL(r.url)),r&&"object"==typeof r&&"headers"in r&&n.mergeHeaders(o,r.headers),i&&n.mergeHeaders(o,new Headers(i.headers)),"object"!=typeof r||r instanceof URL)?this.request({...i,headers:o,url:t}):this.request({...i,...r,headers:o,url:t})}async request(e={}){let t=await this.#e(e);return t=await this.#t(t),this.#r(this._request(t))}async _defaultAdapter(e){let t=e.fetchImplementation||this.defaults.fetchImplementation||await n.#n(),r={...e};delete r.data;let i=await t(e.url,r),o=await this.getResponseData(e,i);return Object.getOwnPropertyDescriptor(i,"data")?.configurable||Object.defineProperties(i,{data:{configurable:!0,writable:!0,enumerable:!0,value:o}}),Object.assign(i,{config:e,data:o})}async _request(e){try{let t;if(t=e.adapter?await e.adapter(e,this._defaultAdapter.bind(this)):await this._defaultAdapter(e),!e.validateStatus(t.status)){if("stream"===e.responseType){let e=[];for await(let r of t.data)e.push(r);t.data=e.toString()}let r=a.GaxiosError.extractAPIErrorFromResponse(t,`Request failed with status code ${t.status}`);throw new a.GaxiosError(r?.message,e,t,r)}return t}catch(i){let t;t=i instanceof a.GaxiosError?i:i instanceof Error?new a.GaxiosError(i.message,e,void 0,i):new a.GaxiosError("Unexpected Gaxios Error",e,void 0,i);let{shouldRetry:r,config:n}=await (0,l.getRetryConfig)(t);if(r&&n)return t.config.retryConfig.currentRetryAttempt=n.retryConfig.currentRetryAttempt,e.retryConfig=t.config?.retryConfig,this.#i(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(t),t}}async getResponseData(e,t){if(204===t.status)return"";if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(t.headers?.get("content-length")||""))throw new a.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":{let e=await t.text();try{return JSON.parse(e)}catch{return e}}case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}#o(e,t=[]){let r=new URL(e),n=[...t];for(let e of(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[])n.push(e.trim());for(let e of n)if(e instanceof RegExp){if(e.test(r.toString()))return!1}else if(e instanceof URL){if(e.origin===r.origin)return!1}else if(e.startsWith("*.")||e.startsWith(".")){let t=e.replace(/^\*\./,".");if(r.hostname.endsWith(t))return!1}else if(e===r.origin||e===r.hostname||e===r.href)return!1;return!0}async #t(e){let t=Promise.resolve(e);for(let e of this.interceptors.request.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #r(e){let t=Promise.resolve(e);for(let e of this.interceptors.response.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #e(e){let t=new Headers(this.defaults.headers);n.mergeHeaders(t,e.headers);let r=(0,o.default)(!0,{},this.defaults,e);if(!r.url)throw Error("URL is required.");if(r.baseURL&&(r.url=new URL(r.url,r.baseURL)),r.url=new URL(r.url),r.params){if(r.paramsSerializer){let e=r.paramsSerializer(r.params);e.startsWith("?")&&(e=e.slice(1));let t=r.url.toString().includes("?")?"&":"?";r.url=r.url+t+e}else{let e=r.url instanceof URL?r.url:new URL(r.url);for(let[t,n]of new URLSearchParams(r.params))e.searchParams.append(t,n);r.url=e}}"number"==typeof e.maxContentLength&&(r.size=e.maxContentLength),"number"==typeof e.maxRedirects&&(r.follow=e.maxRedirects);let i="string"==typeof r.data||r.data instanceof ArrayBuffer||r.data instanceof Blob||globalThis.File&&r.data instanceof File||r.data instanceof FormData||r.data instanceof c.Readable||r.data instanceof ReadableStream||r.data instanceof String||r.data instanceof URLSearchParams||ArrayBuffer.isView(r.data)||["Blob","File","FormData"].includes(r.data?.constructor?.name||"");if(r.multipart?.length){let e=await d();t.set("content-type",`multipart/related; boundary=${e}`),r.body=c.Readable.from(this.getMultipartRequest(r.multipart,e))}else i?r.body=r.data:"object"==typeof r.data?"application/x-www-form-urlencoded"===t.get("Content-Type")?r.body=r.paramsSerializer?r.paramsSerializer(r.data):new URLSearchParams(r.data):(t.has("content-type")||t.set("content-type","application/json"),r.body=JSON.stringify(r.data)):r.data&&(r.body=r.data);r.validateStatus=r.validateStatus||this.validateStatus,r.responseType=r.responseType||"unknown",t.has("accept")||"json"!==r.responseType||t.set("accept","application/json");let l=r.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(r.agent);else if(l&&this.#o(r.url,r.noProxy)){let e=await n.#s();this.agentCache.has(l)?r.agent=this.agentCache.get(l):(r.agent=new e(l,{cert:r.cert,key:r.key}),this.agentCache.set(l,r.agent))}else r.cert&&r.key&&(this.agentCache.has(r.key)?r.agent=this.agentCache.get(r.key):(r.agent=new s.Agent({cert:r.cert,key:r.key}),this.agentCache.set(r.key,r.agent)));return"function"!=typeof r.errorRedactor&&!1!==r.errorRedactor&&(r.errorRedactor=a.defaultErrorRedactor),!r.body||"duplex"in r||(r.duplex="half"),this.#i(r),Object.assign(r,{headers:t,url:r.url instanceof URL?r.url:new URL(r.url)})}#i(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(null===t)return e.text();if((t=t.toLowerCase()).includes("application/json")){let t=await e.text();try{t=JSON.parse(t)}catch{}return t}return t.match(/^text\//)?e.text():e.blob()}async *getMultipartRequest(e,t){let r=`--${t}--`;for(let r of e){let e=r.headers.get("Content-Type")||"application/octet-stream",n=`--${t}\r
Content-Type: ${e}\r
\r
`;yield n,"string"==typeof r.content?yield r.content:yield*r.content,yield"\r\n"}yield r}static #a;static #l;static async #s(){return this.#a||=(await r.e(322).then(r.t.bind(r,58322,23))).HttpsProxyAgent,this.#a}static async #n(){let e="undefined"!=typeof window&&!!window;return this.#l||=e?window.fetch:(await r.e(472).then(r.bind(r,84472))).default,this.#l}static mergeHeaders(e,...t){for(let r of(e=e instanceof Headers?e:new Headers(e),t))(r instanceof Headers?r:new Headers(r)).forEach((t,r)=>{"set-cookie"===r?e.append(r,t):e.set(r,t)});return e}}t.Gaxios=p,n=p},90206:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.instance=t.Gaxios=t.GaxiosError=void 0,t.request=a;let o=r(67622);Object.defineProperty(t,"Gaxios",{enumerable:!0,get:function(){return o.Gaxios}});var s=r(41779);async function a(e){return t.instance.request(e)}Object.defineProperty(t,"GaxiosError",{enumerable:!0,get:function(){return s.GaxiosError}}),i(r(24377),t),t.instance=new o.Gaxios},24377:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosInterceptorManager=void 0;class r extends Set{}t.GaxiosInterceptorManager=r},41544:(e,t)=>{"use strict";async function r(e){var t;let r=i(e);if(!e||!e.config||!r&&!e.config.retry)return{shouldRetry:!1};(r=r||{}).currentRetryAttempt=r.currentRetryAttempt||0,r.retry=void 0===r.retry||null===r.retry?3:r.retry,r.httpMethodsToRetry=r.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],r.noResponseRetries=void 0===r.noResponseRetries||null===r.noResponseRetries?2:r.noResponseRetries,r.retryDelayMultiplier=r.retryDelayMultiplier?r.retryDelayMultiplier:2,r.timeOfFirstRequest=r.timeOfFirstRequest?r.timeOfFirstRequest:Date.now(),r.totalTimeout=r.totalTimeout?r.totalTimeout:Number.MAX_SAFE_INTEGER,r.maxRetryDelay=r.maxRetryDelay?r.maxRetryDelay:Number.MAX_SAFE_INTEGER,r.statusCodesToRetry=r.statusCodesToRetry||[[100,199],[408,408],[429,429],[500,599]],e.config.retryConfig=r;let o=r.shouldRetry||n;if(!await o(e))return{shouldRetry:!1,config:e.config};let s=Math.min(((t=r).currentRetryAttempt?0:t.retryDelay??100)+(Math.pow(t.retryDelayMultiplier,t.currentRetryAttempt)-1)/2*1e3,t.totalTimeout-(Date.now()-t.timeOfFirstRequest),t.maxRetryDelay);e.config.retryConfig.currentRetryAttempt+=1;let a=r.retryBackoff?r.retryBackoff(e,s):new Promise(e=>{setTimeout(e,s)});return r.onRetryAttempt&&await r.onRetryAttempt(e),await a,{shouldRetry:!0,config:e.config}}function n(e){let t=i(e);if(e.config.signal?.aborted&&"TimeoutError"!==e.code||"AbortError"===e.code||!t||0===t.retry||!e.response&&(t.currentRetryAttempt||0)>=t.noResponseRetries||!t.httpMethodsToRetry||!t.httpMethodsToRetry.includes(e.config.method?.toUpperCase()||"GET"))return!1;if(e.response&&e.response.status){let r=!1;for(let[n,i]of t.statusCodesToRetry){let t=e.response.status;if(t>=n&&t<=i){r=!0;break}}if(!r)return!1}return t.currentRetryAttempt=t.currentRetryAttempt||0,!(t.currentRetryAttempt>=t.retry)}function i(e){if(e&&e.config&&e.config.retryConfig)return e.config.retryConfig}Object.defineProperty(t,"__esModule",{value:!0}),t.getRetryConfig=r},56621:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthClient=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=t.DEFAULT_UNIVERSE=void 0;let n=r(82361),i=r(90206),o=r(86538),s=r(15348),a=r(14574);t.DEFAULT_UNIVERSE="googleapis.com",t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=3e5;class l extends n.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=t.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();let r=(0,o.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=r.get("project_id")??null,this.quotaProjectId=r.get("quota_project_id"),this.credentials=r.get("credentials")??{},this.universeDomain=r.get("universe_domain")??t.DEFAULT_UNIVERSE,this.transporter=e.transporter??new i.Gaxios(e.transporterOptions),!1!==r.get("useAuthRequestParameters")&&(this.transporter.interceptors.request.add(l.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(l.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let t;let r=e[0],n=e[1],o=new Headers;return("string"==typeof r?t=new URL(r):r instanceof URL?t=r:r&&r.url&&(t=new URL(r.url)),r&&"object"==typeof r&&"headers"in r&&i.Gaxios.mergeHeaders(o,r.headers),n&&i.Gaxios.mergeHeaders(o,new Headers(n.headers)),"object"!=typeof r||r instanceof URL)?this.request({...n,headers:o,url:t}):this.request({...n,...r,headers:o,url:t})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,t){let r=t.get("x-goog-user-project"),n=t.get("authorization");return r&&e.set("x-goog-user-project",r),n&&e.set("authorization",n),e}static log=(0,s.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let t=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${t}`)}let t=e.headers.get("User-Agent");t?t.includes(`${a.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${t} ${a.USER_AGENT}`):e.headers.set("User-Agent",a.USER_AGENT);try{let t=e[l.RequestMethodNameSymbol],r=`${Math.floor(1e3*Math.random())}`;e[l.RequestLogIdSymbol]=r;let n={url:e.url,headers:e.headers};t?l.log.info("%s [%s] request %j",t,r,n):l.log.info("[%s] request %j",r,n)}catch(e){}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let t=e.config,r=t[l.RequestMethodNameSymbol],n=t[l.RequestLogIdSymbol];r?l.log.info("%s [%s] response %j",r,n,e.data):l.log.info("[%s] response %j",n,e.data)}catch(e){}return e},rejected:async e=>{try{let t=e.config,r=t[l.RequestMethodNameSymbol],n=t[l.RequestLogIdSymbol];r?l.log.info("%s [%s] error %j",r,n,e.response?.data):l.log.error("[%s] error %j",n,e.response?.data)}catch(e){}throw e}};static setMethodName(e,t){try{e[l.RequestMethodNameSymbol]=t}catch(e){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.AuthClient=l},63321:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsClient=void 0;let n=r(43676),i=r(83318),o=r(29038),s=r(86538),a=r(90206);class l extends i.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static #c="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);let t=(0,s.originalOrCamelOptions)(e),r=t.get("credential_source"),n=t.get("aws_security_credentials_supplier");if(!r&&!n)throw Error("A credential source or AWS security credentials supplier must be specified.");if(r&&n)throw Error("Only one of credential source or AWS security credentials supplier can be specified.");if(n)this.awsSecurityCredentialsSupplier=n,this.regionalCredVerificationUrl=l.#c,this.credentialSourceType="programmatic";else{let e=(0,s.originalOrCamelOptions)(r);this.environmentId=e.get("environment_id");let t=e.get("region_url"),n=e.get("url"),i=e.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new o.DefaultAwsSecurityCredentialsSupplier({regionUrl:t,securityCredentialsUrl:n,imdsV2SessionTokenUrl:i}),this.regionalCredVerificationUrl=e.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(e&&this.regionalCredVerificationUrl){if(1!==parseInt(e[2],10))throw Error(`aws version "${e[2]}" is not supported in the current build.`)}else throw Error('No valid AWS "credential_source" provided')}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new n.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...l.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[];return a.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((e,r)=>t.push({key:r,value:e})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}}t.AwsClient=l},43676:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsRequestSigner=void 0;let n=r(90206),i=r(10537),o="AWS4-HMAC-SHA256";class s{getCredentials;region;crypto;constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,i.createCrypto)()}async getRequestOptions(e){if(!e.url)throw RangeError('"url" is required in "amzOptions"');let t="object"==typeof e.data?JSON.stringify(e.data):e.data,r=e.url,i=e.method||"GET",o=e.body||t,s=e.headers,a=await this.getCredentials(),l=new URL(r);if("string"!=typeof o&&void 0!==o)throw TypeError(`'requestPayload' is expected to be a string if provided. Got: ${o}`);let u=await c({crypto:this.crypto,host:l.host,canonicalUri:l.pathname,canonicalQuerystring:l.search.slice(1),method:i,region:this.region,securityCredentials:a,requestPayload:o,additionalAmzHeaders:s}),d=n.Gaxios.mergeHeaders(u.amzDate?{"x-amz-date":u.amzDate}:{},{authorization:u.authorizationHeader,host:l.host},s||{});a.token&&n.Gaxios.mergeHeaders(d,{"x-amz-security-token":a.token});let p={url:r,method:i,headers:d};return void 0!==o&&(p.body=o),p}}async function a(e,t,r){return await e.signWithHmacSha256(t,r)}async function l(e,t,r,n,i){let o=await a(e,`AWS4${t}`,r),s=await a(e,o,n),l=await a(e,s,i);return await a(e,l,"aws4_request")}async function c(e){let t=n.Gaxios.mergeHeaders(e.additionalAmzHeaders),r=e.requestPayload||"",s=e.host.split(".")[0],c=new Date,u=c.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),d=c.toISOString().replace(/[-]/g,"").replace(/T.*/,"");e.securityCredentials.token&&t.set("x-amz-security-token",e.securityCredentials.token);let p=n.Gaxios.mergeHeaders({host:e.host},t.has("date")?{}:{"x-amz-date":u},t),h="",f=[...p.keys()].sort();f.forEach(e=>{h+=`${e}:${p.get(e)}
`});let m=f.join(";"),g=await e.crypto.sha256DigestHex(r),y=`${e.method.toUpperCase()}
${e.canonicalUri}
${e.canonicalQuerystring}
${h}
${m}
${g}`,v=`${d}/${e.region}/${s}/aws4_request`,b=`${o}
${u}
${v}
`+await e.crypto.sha256DigestHex(y),_=await l(e.crypto,e.securityCredentials.secretAccessKey,d,e.region,s),E=await a(e.crypto,_,b),w=`${o} Credential=${e.securityCredentials.accessKeyId}/${v}, SignedHeaders=${m}, Signature=${(0,i.fromArrayBufferToHex)(E)}`;return{amzDate:t.has("date")?void 0:u,authorizationHeader:w,canonicalQuerystring:e.canonicalQuerystring}}t.AwsRequestSigner=s},83318:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseExternalAccountClient=t.CLOUD_RESOURCE_MANAGER=t.EXTERNAL_ACCOUNT_TYPE=t.EXPIRATION_TIME_OFFSET=void 0;let n=r(90206),i=r(12781),o=r(56621),s=r(50984),a=r(86538),l=r(14574),c="https://www.googleapis.com/auth/cloud-platform";t.EXPIRATION_TIME_OFFSET=3e5,t.EXTERNAL_ACCOUNT_TYPE="external_account",t.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";class u extends o.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#u=null;constructor(e){super(e);let r=(0,a.originalOrCamelOptions)(e),n=r.get("type");if(n&&n!==t.EXTERNAL_ACCOUNT_TYPE)throw Error(`Expected "${t.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let i=r.get("client_id"),o=r.get("client_secret");this.tokenUrl=r.get("token_url")??"https://sts.{universeDomain}/v1/token".replace("{universeDomain}",this.universeDomain);let l=r.get("subject_token_type"),u=r.get("workforce_pool_user_project"),d=r.get("service_account_impersonation_url"),p=r.get("service_account_impersonation"),h=(0,a.originalOrCamelOptions)(p).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(r.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),i&&(this.clientAuth={confidentialClientType:"basic",clientId:i,clientSecret:o}),this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=r.get("scopes")||[c],this.cachedAccessToken=null,this.audience=r.get("audience"),this.subjectTokenType=l,this.workforcePoolUserProject=u;let f=RegExp("//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+");if(this.workforcePoolUserProject&&!this.audience.match(f))throw Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=d,this.serviceAccountImpersonationLifetime=h,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=3600),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let e=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return e?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),r={...u.RETRY_CONFIG,headers:t,url:`${this.cloudResourceManagerURL.toString()}${e}`};o.AuthClient.setMethodName(r,"getProjectId");let n=await this.transporter.request(r);return this.projectId=n.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let r;try{let t=await this.getRequestHeaders();e.headers=n.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),r=await this.transporter.request(e)}catch(n){let r=n.response;if(r){let n=r.status,o=r.config.data instanceof i.Readable;if(!t&&(401===n||403===n)&&!o&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw n}return r}async refreshAccessTokenAsync(){this.#u=this.#u||this.#d();try{return await this.#u}finally{this.#u=null}}async #d(){let e=await this.retrieveSubjectToken(),t={grantType:"urn:ietf:params:oauth:grant-type:token-exchange",audience:this.audience,requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[c]:this.getScopesArray()},r=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,n=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),i=await this.stsCredential.exchangeToken(t,n,r);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(i.access_token):i.expires_in?this.cachedAccessToken={access_token:i.access_token,expiry_date:new Date().getTime()+1e3*i.expires_in,res:i.res}:this.cachedAccessToken={access_token:i.access_token,res:i.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={...u.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};o.AuthClient.setMethodName(t,"getImpersonatedAccessToken");let r=await this.transporter.request(t),n=r.data;return{access_token:n.accessToken,expiry_date:new Date(n.expireTime).getTime(),res:r}}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}getScopesArray(){return"string"==typeof this.scopes?[this.scopes]:this.scopes||[c]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),t=void 0!==this.serviceAccountImpersonationUrl,r=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${l.pkg.version} google-byoid-sdk source/${r} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}}t.BaseExternalAccountClient=u},88332:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CertificateSubjectTokenSupplier=t.InvalidConfigurationError=t.CertificateSourceUnavailableError=t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;let n=r(86538),i=r(57147),o=r(6113),s=r(95687);t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";class a extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}}t.CertificateSourceUnavailableError=a;class l extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}}t.InvalidConfigurationError=l;class c{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new l("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new l("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new l("Cannot create mTLS Agent with missing certificate or key");return new s.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#p();let{certPath:e,keyPath:t}=await this.#h();return{cert:this.cert,key:this.key}=await this.#f(e,t),await this.#m(this.cert)}async #p(){let e=this.certificateConfigPath;if(e){if(await (0,n.isValidFile)(e))return e;throw new a(`Provided certificate config path is invalid: ${e}`)}let r=process.env[t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(r){if(await (0,n.isValidFile)(r))return r;throw new a(`Path from environment variable "${t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${r}`)}let i=(0,n.getWellKnownCertificateConfigFileLocation)();if(await (0,n.isValidFile)(i))return i;throw new a(`Could not find certificate configuration file. Searched override path, the "${t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${i}).`)}async #h(){let e;let t=this.certificateConfigPath;try{e=await i.promises.readFile(t,"utf8")}catch(e){throw new a(`Failed to read certificate config file at: ${t}`)}try{let r=JSON.parse(e),n=r?.cert_configs?.workload?.cert_path,i=r?.cert_configs?.workload?.key_path;if(!n||!i)throw new l(`Certificate config file (${t}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:n,keyPath:i}}catch(e){if(e instanceof l)throw e;throw new l(`Failed to parse certificate config from ${t}: ${e.message}`)}}async #f(e,t){let r,n;try{r=await i.promises.readFile(e),new o.X509Certificate(r)}catch(r){let t=r instanceof Error?r.message:String(r);throw new a(`Failed to read certificate file at ${e}: ${t}`)}try{n=await i.promises.readFile(t),(0,o.createPrivateKey)(n)}catch(r){let e=r instanceof Error?r.message:String(r);throw new a(`Failed to read private key file at ${t}: ${e}`)}return{cert:r,key:n}}async #m(e){let t=new o.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let e;let r=((await i.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((e,t)=>{try{return new o.X509Certificate(e)}catch(r){let e=r instanceof Error?r.message:String(r);throw new l(`Failed to parse certificate at index ${t} in trust chain file ${this.trustChainPath}: ${e}`)}}),n=r.findIndex(e=>t.raw.equals(e.raw));if(-1===n)e=[t,...r];else if(0===n)e=r;else throw new l(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${n}).`);return JSON.stringify(e.map(e=>e.raw.toString("base64")))}catch(t){if(t instanceof l)throw t;let e=t instanceof Error?t.message:String(t);throw new a(`Failed to process certificate chain from ${this.trustChainPath}: ${e}`)}}}t.CertificateSubjectTokenSupplier=c},10902:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Compute=void 0;let n=r(90206),i=r(80759),o=r(3490);class s extends o.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e;let t=`service-accounts/${this.serviceAccountEmail}/token`;try{let r={property:t};this.scopes.length>0&&(r.params={scopes:this.scopes.join(",")}),e=await i.instance(r)}catch(e){throw e instanceof n.GaxiosError&&(e.message=`Could not refresh access token: ${e.message}`,this.wrapError(e)),e}let r=e;return e&&e.expires_in&&(r.expiry_date=new Date().getTime()+1e3*e.expires_in,delete r.expires_in),this.emit("tokens",r),{tokens:r,res:null}}async fetchIdToken(e){let t;let r=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`;try{t=await i.instance({property:r})}catch(e){throw e instanceof Error&&(e.message=`Could not fetch ID token: ${e.message}`),e}return t}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,403===t.status?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:404===t.status&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}}t.Compute=s},29038:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultAwsSecurityCredentialsSupplier=void 0;let n=r(56621);class i{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#g)return this.#g;let t=new Headers;if(!this.#g&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#y(e.transporter)),!this.regionUrl)throw RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let r={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};n.AuthClient.setMethodName(r,"getAwsRegion");let i=await e.transporter.request(r);return i.data.substr(0,i.data.length-1)}async getAwsSecurityCredentials(e){if(this.#v)return this.#v;let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#y(e.transporter));let r=await this.#b(t,e.transporter),n=await this.#_(r,t,e.transporter);return{accessKeyId:n.AccessKeyId,secretAccessKey:n.SecretAccessKey,token:n.Token}}async #y(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return n.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data}async #b(e,t){if(!this.securityCredentialsUrl)throw Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let r={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return n.AuthClient.setMethodName(r,"#getAwsRoleName"),(await t.request(r)).data}async #_(e,t,r){let i={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return n.AuthClient.setMethodName(i,"#retrieveAwsSecurityCredentials"),(await r.request(i)).data}get #g(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get #v(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}}t.DefaultAwsSecurityCredentialsSupplier=i},63651:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownscopedClient=t.EXPIRATION_TIME_OFFSET=t.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;let n=r(90206),i=r(12781),o=r(56621),s=r(50984);t.MAX_ACCESS_BOUNDARY_RULES_COUNT=10,t.EXPIRATION_TIME_OFFSET=3e5;class a extends o.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,r={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof o.AuthClient?{}:e),e instanceof o.AuthClient?(this.authClient=e,this.credentialAccessBoundary=r):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),0===this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length)throw Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>t.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw Error(`The provided access boundary has more than ${t.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let e of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(0===e.availablePermissions.length)throw Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let r;try{let t=await this.getRequestHeaders();e.headers=n.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),r=await this.transporter.request(e)}catch(n){let r=n.response;if(r){let n=r.status,o=r.config.data instanceof i.Readable;if(!t&&(401===n||403===n)&&!o&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw n}return r}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,t=await this.stsCredential.exchangeToken({grantType:"urn:ietf:params:oauth:grant-type:token-exchange",requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:"urn:ietf:params:oauth:token-type:access_token"},void 0,this.credentialAccessBoundary),r=this.authClient.credentials?.expiry_date||null,n=t.expires_in?new Date().getTime()+1e3*t.expires_in:r;return this.cachedDownscopedAccessToken={access_token:t.access_token,expiry_date:n,res:t.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.DownscopedClient=a},71215:(e,t,r)=>{"use strict";var n;let i;Object.defineProperty(t,"__esModule",{value:!0}),t.GCPEnv=void 0,t.clear=function(){i=void 0},t.getEnv=s;let o=r(80759);async function s(){return i||(i=a())}async function a(){return n.NONE,process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME?n.APP_ENGINE:process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET?n.CLOUD_FUNCTIONS:await c()?await l()?n.KUBERNETES_ENGINE:process.env.K_CONFIGURATION?n.CLOUD_RUN:process.env.CLOUD_RUN_JOB?n.CLOUD_RUN_JOBS:n.COMPUTE_ENGINE:n.NONE}async function l(){try{return await o.instance("attributes/cluster-name"),!0}catch(e){return!1}}async function c(){return o.isAvailable()}!function(e){e.APP_ENGINE="APP_ENGINE",e.KUBERNETES_ENGINE="KUBERNETES_ENGINE",e.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",e.COMPUTE_ENGINE="COMPUTE_ENGINE",e.CLOUD_RUN="CLOUD_RUN",e.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",e.NONE="NONE"}(n||(t.GCPEnv=n={}))},9402:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidSubjectTokenError=t.InvalidMessageFieldError=t.InvalidCodeFieldError=t.InvalidTokenTypeFieldError=t.InvalidExpirationTimeFieldError=t.InvalidSuccessFieldError=t.InvalidVersionFieldError=t.ExecutableResponseError=t.ExecutableResponse=void 0;let r="urn:ietf:params:oauth:token-type:saml2",n="urn:ietf:params:oauth:token-type:id_token",i="urn:ietf:params:oauth:token-type:jwt";class o{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new a("Executable response must contain a 'version' field.");if(void 0===e.success)throw new l("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==r&&this.tokenType!==n&&this.tokenType!==i)throw new u(`Executable response must contain a 'token_type' field when successful and it must be one of ${n}, ${i}, or ${r}.`);if(this.tokenType===r){if(!e.saml_response)throw new h(`Executable response must contain a 'saml_response' field when token_type=${r}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new h(`Executable response must contain a 'id_token' field when token_type=${n} or ${i}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new d("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new p("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return void 0!==this.expirationTime&&this.expirationTime<Math.round(Date.now()/1e3)}}t.ExecutableResponse=o;class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableResponseError=s;class a extends s{}t.InvalidVersionFieldError=a;class l extends s{}t.InvalidSuccessFieldError=l;class c extends s{}t.InvalidExpirationTimeFieldError=c;class u extends s{}t.InvalidTokenTypeFieldError=u;class d extends s{}t.InvalidCodeFieldError=d;class p extends s{}t.InvalidMessageFieldError=p;class h extends s{}t.InvalidSubjectTokenError=h},83006:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountAuthorizedUserClient=t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;let n=r(56621),i=r(21673),o=r(90206),s=r(12781),a=r(83318);t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";class l extends i.OAuthClientAuthHandler{#E;constructor(e){super(e),this.#E=e.tokenRefreshEndpoint}async refreshToken(e,t){let r={...l.RETRY_CONFIG,url:this.#E,method:"POST",headers:t,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};n.AuthClient.setMethodName(r,"refreshToken"),this.applyClientAuthenticationOptions(r);try{let e=await this.transporter.request(r),t=e.data;return t.res=e,t}catch(e){if(e instanceof o.GaxiosError&&e.response)throw(0,i.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}class c extends n.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let t={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new l({tokenRefreshEndpoint:e.token_url??"https://sts.{universeDomain}/v1/oauthtoken".replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:t}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,"number"!=typeof e?.eagerRefreshThresholdMillis?this.eagerRefreshThresholdMillis=a.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let r;try{let t=await this.getRequestHeaders();e.headers=o.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),r=await this.transporter.request(e)}catch(n){let r=n.response;if(r){let n=r.status,i=r.config.data instanceof s.Readable;if(!t&&(401===n||403===n)&&!i&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw n}return r}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+1e3*e.expires_in,res:e.res},void 0!==e.refresh_token&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.ExternalAccountAuthorizedUserClient=c},9273:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountClient=void 0;let n=r(83318),i=r(49201),o=r(63321),s=r(84462);class a{constructor(){throw Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===n.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new o.AwsClient(e):e.credential_source?.executable?new s.PluggableAuthClient(e):new i.IdentityPoolClient(e):null}}t.ExternalAccountClient=a},42986:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSubjectTokenSupplier=void 0;let n=r(73837),i=r(57147),o=(0,n.promisify)(i.readFile??(()=>{})),s=(0,n.promisify)(i.realpath??(()=>{})),a=(0,n.promisify)(i.lstat??(()=>{}));class l{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e,t=this.filePath;try{if(t=await s(t),!(await a(t)).isFile())throw Error()}catch(e){throw e instanceof Error&&(e.message=`The file at ${t} does not exist, or it is not a file. ${e.message}`),e}let r=await o(t,{encoding:"utf8"});if("text"===this.formatType?e=r:"json"===this.formatType&&this.subjectTokenFieldName&&(e=JSON.parse(r)[this.subjectTokenFieldName]),!e)throw Error("Unable to parse the subject_token from the credential_source file");return e}}t.FileSubjectTokenSupplier=l},26614:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleAuth=t.GoogleAuthExceptionMessages=void 0;let n=r(32081),i=r(57147),o=r(90206),s=r(80759),a=r(22037),l=r(71017),c=r(10537),u=r(10902),d=r(60502),p=r(71215),h=r(21316),f=r(57065),m=r(32119),g=r(9273),y=r(83318),v=r(56621),b=r(83006),_=r(86538);t.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:"Unable to detect a Project Id in the current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_CREDENTIALS_FOUND:"Unable to find credentials in current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:"Unable to detect a Universe Domain in the current environment.\nTo learn more about Universe Domain retrieval, visit: \nhttps://cloud.google.com/compute/docs/metadata/predefined-metadata-keys"};class E{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#w=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw RangeError(t.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(!e)return this.getProjectIdAsync();this.getProjectIdAsync().then(t=>e(null,t),e)}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId())return this._cachedProjectId=e,e;throw Error(t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await s.universe("universe-domain"),e||=v.DEFAULT_UNIVERSE}catch(t){if(t&&t?.response?.status===404)e=v.DEFAULT_UNIVERSE;else throw t}return e}async getUniverseDomain(){let e=(0,_.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=v.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let r;if("function"==typeof e?t=e:r=e,!t)return this.getApplicationDefaultAsync(r);this.getApplicationDefaultAsync(r).then(e=>t(null,e.credential,e.projectId),t)}async getApplicationDefaultAsync(e={}){let r;if(this.cachedCredential)return await this.#x(this.cachedCredential,null);if((r=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e))||(r=await this._tryGetApplicationCredentialsFromWellKnownFile(e)))return r instanceof h.JWT?r.scopes=this.scopes:r instanceof y.BaseExternalAccountClient&&(r.scopes=this.getAnyScopes()),await this.#x(r);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#x(new u.Compute(e));throw Error(t.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async #x(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let r=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:r}}async _checkIsGCE(){return void 0===this.checkIsGCE&&(this.checkIsGCE=s.getGCPResidency()||await s.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||0===t.length)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(e){throw e instanceof Error&&(e.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${e.message}`),e}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let e=process.env.HOME;e&&(t=l.join(e,".config"))}return(t&&(t=l.join(t,"gcloud","application_default_credentials.json"),i.existsSync(t)||(t=null)),t)?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||0===e.length)throw Error("The file path is invalid.");try{if(e=i.realpathSync(e),!i.lstatSync(e).isFile())throw Error()}catch(t){throw t instanceof Error&&(t.message=`The file at ${e} does not exist, or it is not a file. ${t.message}`),t}let r=i.createReadStream(e);return this.fromStream(r,t)}fromImpersonatedJSON(e){if(!e)throw Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==m.IMPERSONATED_ACCOUNT_TYPE)throw Error(`The incoming JSON object does not have the "${m.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let r=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!r)throw RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let n=(this.scopes||e.scopes||this.defaultScopes)??[];return new m.Impersonated({...e,sourceClient:t,targetPrincipal:r,targetScopes:Array.isArray(n)?n:[n]})}fromJSON(e,t={}){let r;let n=(0,_.originalOrCamelOptions)(t).get("universe_domain");return e.type===f.USER_REFRESH_ACCOUNT_TYPE?(r=new f.UserRefreshClient(t)).fromJSON(e):e.type===m.IMPERSONATED_ACCOUNT_TYPE?r=this.fromImpersonatedJSON(e):e.type===y.EXTERNAL_ACCOUNT_TYPE?(r=g.ExternalAccountClient.fromJSON({...e,...t})).scopes=this.getAnyScopes():e.type===b.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?r=new b.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,r=new h.JWT(t),this.setGapicJWTValues(r),r.fromJSON(e)),n&&(r.universeDomain=n),r}_cacheClientFromJSON(e,t){let r=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=r,r}fromStream(e,t={},r){let n={};if("function"==typeof t?r=t:n=t,!r)return this.fromStreamAsync(e,n);this.fromStreamAsync(e,n).then(e=>r(null,e),r)}fromStreamAsync(e,t){return new Promise((r,n)=>{if(!e)throw Error("Must pass in a stream containing the Google auth settings.");let i=[];e.setEncoding("utf8").on("error",n).on("data",e=>i.push(e)).on("end",()=>{try{try{let e=JSON.parse(i.join("")),n=this._cacheClientFromJSON(e,t);return r(n)}catch(t){if(!this.keyFilename)throw t;let e=new h.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=e,this.setGapicJWTValues(e),r(e)}}catch(e){return n(e)}})})}fromAPIKey(e,t={}){return new h.JWT({...t,apiKey:e})}_isWindows(){let e=a.platform();return!!e&&e.length>=3&&"win"===e.substring(0,3).toLowerCase()}async getDefaultServiceProjectId(){return new Promise(e=>{(0,n.exec)("gcloud config config-helper --format json",(t,r)=>{if(!t&&r)try{let t=JSON.parse(r).configuration.properties.core.project;e(t);return}catch(e){}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let e=await this.getClient();if(e&&e.projectId)return e.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){if(!this.jsonContent||this.jsonContent.type!==y.EXTERNAL_ACCOUNT_TYPE)return null;let e=await this.getClient();return await e.getProjectId()}async getGCEProjectId(){try{return await s.project("project-id")}catch(e){return null}}getCredentials(e){if(!e)return this.getCredentialsAsync();this.getCredentialsAsync().then(t=>e(null,t),e)}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof m.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof y.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[e,t]=await Promise.all([s.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:e,universe_domain:t}}throw Error(t.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#w=this.#w||this.#S();try{return await this.#w}finally{this.#w=null}}async #S(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=l.resolve(this.keyFilename),t=i.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await this.#x(e);return t}{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new d.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){let e=await this.getClient();return(await e.getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,r=await this.getClient(),n=await r.getRequestHeaders(t);return e.headers=o.Gaxios.mergeHeaders(e.headers,n),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,p.getEnv)()}async sign(e,t){let r=await this.getClient(),n=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${n}/v1/projects/-/serviceAccounts/`,r instanceof m.Impersonated)return(await r.sign(e)).signedBlob;let i=(0,c.createCrypto)();if(r instanceof h.JWT&&r.key)return await i.sign(r.key,e);let o=await this.getCredentials();if(!o.client_email)throw Error("Cannot sign data without `client_email`.");return this.signBlob(i,o.client_email,e,t)}async signBlob(e,t,r,n){let i=new URL(n+`${t}:signBlob`);return(await this.request({method:"POST",url:i.href,data:{payload:e.encodeBase64StringUtf8(r)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}}t.GoogleAuth=E},39120:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IAMAuth=void 0;class r{selector;token;constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}}t.IAMAuth=r},49201:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityPoolClient=void 0;let n=r(83318),i=r(86538),o=r(42986),s=r(60132),a=r(88332),l=r(50984),c=r(90206);class u extends n.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);let t=(0,i.originalOrCamelOptions)(e),r=t.get("credential_source"),n=t.get("subject_token_supplier");if(!r&&!n)throw Error("A credential source or subject token supplier must be specified.");if(r&&n)throw Error("Only one of credential source or subject token supplier can be specified.");if(n)this.subjectTokenSupplier=n,this.credentialSourceType="programmatic";else{let e=(0,i.originalOrCamelOptions)(r),t=(0,i.originalOrCamelOptions)(e.get("format")),n=t.get("type")||"text",l=t.get("subject_token_field_name");if("json"!==n&&"text"!==n)throw Error(`Invalid credential_source format "${n}"`);if("json"===n&&!l)throw Error("Missing subject_token_field_name for JSON credential_source format");let c=e.get("file"),d=e.get("url"),p=e.get("certificate"),h=e.get("headers");if(c&&d||d&&p||c&&p)throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(c)this.credentialSourceType="file",this.subjectTokenSupplier=new o.FileSubjectTokenSupplier({filePath:c,formatType:n,subjectTokenFieldName:l});else if(d)this.credentialSourceType="url",this.subjectTokenSupplier=new s.UrlSubjectTokenSupplier({url:d,formatType:n,subjectTokenFieldName:l,headers:h,additionalGaxiosOptions:u.RETRY_CONFIG});else if(p){this.credentialSourceType="certificate";let e=new a.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:p.use_default_certificate_config,certificateConfigLocation:p.certificate_config_location,trustChainPath:p.trust_chain_path});this.subjectTokenSupplier=e}else throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof a.CertificateSubjectTokenSupplier){let e=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new l.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new c.Gaxios({agent:e})}),this.transporter=new c.Gaxios({...this.transporter.defaults||{},agent:e})}return e}}t.IdentityPoolClient=u},60502:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdTokenClient=void 0;let n=r(3490);class i extends n.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let e=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:e,expiry_date:this.getIdTokenExpiryDate(e)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return 1e3*JSON.parse(Buffer.from(t,"base64").toString("ascii")).exp}}t.IdTokenClient=i},32119:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Impersonated=t.IMPERSONATED_ACCOUNT_TYPE=void 0;let n=r(3490),i=r(90206),o=r(86538);t.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";class s extends n.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new n.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,(0,o.originalOrCamelOptions)(e).get("universe_domain")){if(this.sourceClient.universeDomain!==this.universeDomain)throw RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`)}else this.universeDomain=this.sourceClient.universeDomain;this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let t=`projects/-/serviceAccounts/${this.targetPrincipal}`,r=`${this.endpoint}/v1/${t}:signBlob`,n={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:r,data:n,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,t=`${this.endpoint}/v1/${e}:generateAccessToken`,r={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},n=await this.sourceClient.request({...s.RETRY_CONFIG,url:t,data:r,method:"POST"}),i=n.data;return this.credentials.access_token=i.accessToken,this.credentials.expiry_date=Date.parse(i.expireTime),{tokens:this.credentials,res:n}}catch(r){if(!(r instanceof Error))throw r;let e=0,t="";if(r instanceof i.GaxiosError&&(e=r?.response?.data?.error?.status,t=r?.response?.data?.error?.message),e&&t)throw r.message=`${e}: unable to impersonate: ${t}`,r;throw r.message=`unable to impersonate: ${r}`,r}}async fetchIdToken(e,t){await this.sourceClient.getAccessToken();let r=`projects/-/serviceAccounts/${this.targetPrincipal}`,n=`${this.endpoint}/v1/${r}:generateIdToken`,i={delegates:this.delegates,audience:e,includeEmail:t?.includeEmail??!0,useEmailAzp:t?.includeEmail??!0};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:n,data:i,method:"POST"})).data.token}}t.Impersonated=s},77951:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWTAccess=void 0;let n=r(8287),i=r(86538),o={alg:"RS256",typ:"JWT"};class s{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new i.LRUCache({capacity:500,maxAge:36e5});constructor(e,t,r,n){this.email=e,this.key=t,this.keyId=r,this.eagerRefreshThresholdMillis=n??3e5}getCachedKey(e,t){let r=e;if(t&&Array.isArray(t)&&t.length?r=e?`${e}_${t.join("_")}`:`${t.join("_")}`:"string"==typeof t&&(r=e?`${e}_${t}`:t),!r)throw Error("Scopes or url must be provided");return r}getRequestHeaders(e,t,r){let i;let a=this.getCachedKey(e,r),l=this.cache.get(a),c=Date.now();if(l&&l.expiration-c>this.eagerRefreshThresholdMillis)return new Headers(l.headers);let u=Math.floor(Date.now()/1e3),d=s.getExpirationTime(u);if(Array.isArray(r)&&(r=r.join(" ")),i=r?{iss:this.email,sub:this.email,scope:r,exp:d,iat:u}:{iss:this.email,sub:this.email,aud:e,exp:d,iat:u},t){for(let e in i)if(t[e])throw Error(`The '${e}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let p=this.keyId?{...o,kid:this.keyId}:o,h=Object.assign(i,t),f=n.sign({header:p,payload:h,secret:this.key}),m=new Headers({authorization:`Bearer ${f}`});return this.cache.set(a,{expiration:1e3*d,headers:m}),m}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,r)=>{e||r(Error("Must pass in a stream containing the service account auth settings."));let n="";e.setEncoding("utf8").on("data",e=>n+=e).on("error",r).on("end",()=>{try{let e=JSON.parse(n);this.fromJSON(e),t()}catch(e){r(e)}})})}}t.JWTAccess=s},21316:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWT=void 0;let n=r(1838),i=r(77951),o=r(3490),s=r(56621);class a extends o.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new a(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==s.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==s.DEFAULT_UNIVERSE)throw RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${s.DEFAULT_UNIVERSE}`);if(!this.apiKey&&t){if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:e}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${e.id_token}`}))}}{let t;this.access||(this.access=new i.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis)),this.hasUserScopes()?t=this.scopes:e||(t=this.defaultScopes);let r=this.useJWTAccessWithScope||this.universeDomain!==s.DEFAULT_UNIVERSE,n=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,r?t:void 0);return{headers:this.addSharedMetadataHeaders(n)}}}return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let t=new n.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return!!this.scopes&&this.scopes.length>0}hasAnyScopes(){return!!this.scopes&&this.scopes.length>0||!!this.defaultScopes&&this.defaultScopes.length>0}authorize(e){if(!e)return this.authorizeAsync();this.authorizeAsync().then(t=>e(null,t),e)}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),t={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",t),{res:null,tokens:t}}createGToken(){return this.gtoken||(this.gtoken=new n.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,r)=>{if(!e)throw Error("Must pass in a stream containing the service account auth settings.");let n="";e.setEncoding("utf8").on("error",r).on("data",e=>n+=e).on("end",()=>{try{let e=JSON.parse(n);this.fromJSON(e),t()}catch(e){r(e)}})})}fromAPIKey(e){if("string"!=typeof e)throw Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let e=this.createGToken(),t=await e.getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw Error("A key or a keyFile must be provided to getCredentials.")}}t.JWT=a},90434:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginTicket=void 0;class r{envelope;payload;constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}}t.LoginTicket=r},3490:(e,t,r)=>{"use strict";var n,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.OAuth2Client=t.ClientAuthentication=t.CertificateFormat=t.CodeChallengeMethod=void 0;let s=r(90206),a=r(63477),l=r(12781),c=r(3164),u=r(86538),d=r(10537),p=r(56621),h=r(90434);(function(e){e.Plain="plain",e.S256="S256"})(n||(t.CodeChallengeMethod=n={})),function(e){e.PEM="PEM",e.JWK="JWK"}(i||(t.CertificateFormat=i={})),function(e){e.ClientSecretPost="ClientSecretPost",e.ClientSecretBasic="ClientSecretBasic",e.None="None"}(o||(t.ClientAuthentication=o={}));class f extends p.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=i.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},t,r){super("object"==typeof e?e:{}),"object"!=typeof e&&(e={clientId:e,clientSecret:t,redirectUri:r}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||o.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+a.stringify(e)}generateCodeVerifier(){throw Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,d.createCrypto)(),t=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),r=(await e.sha256DigestBase64(t)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:t,codeChallenge:r}}getToken(e,t){let r="string"==typeof e?{code:e}:e;if(!t)return this.getTokenAsync(r);this.getTokenAsync(r).then(e=>t(null,e.tokens,e.res),e=>t(e,null,e.response))}async getTokenAsync(e){let t=this.endpoints.oauth2TokenUrl.toString(),r=new Headers,n={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===o.ClientSecretBasic){let e=Buffer.from(`${this._clientId}:${this._clientSecret}`);r.set("authorization",`Basic ${e.toString("base64")}`)}this.clientAuthentication===o.ClientSecretPost&&(n.client_secret=this._clientSecret);let i={...f.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,u.removeUndefinedValuesInObject)(n)),headers:r};p.AuthClient.setMethodName(i,"getTokenAsync");let s=await this.transporter.request(i),a=s.data;return s.data&&s.data.expires_in&&(a.expiry_date=new Date().getTime()+1e3*s.data.expires_in,delete a.expires_in),this.emit("tokens",a),{tokens:a,res:s}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(t=>(this.refreshTokenPromises.delete(e),t),t=>{throw this.refreshTokenPromises.delete(e),t});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){let t;if(!e)throw Error("No refresh token is set.");let r=this.endpoints.oauth2TokenUrl.toString(),n={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"};try{let e={...f.RETRY_CONFIG,method:"POST",url:r,data:new URLSearchParams((0,u.removeUndefinedValuesInObject)(n))};p.AuthClient.setMethodName(e,"refreshTokenNoCache"),t=await this.transporter.request(e)}catch(e){throw e instanceof s.GaxiosError&&"invalid_grant"===e.message&&e.response?.data&&/ReAuth/i.test(e.response.data.error_description)&&(e.message=JSON.stringify(e.response.data)),e}let i=t.data;return t.data&&t.data.expires_in&&(i.expiry_date=new Date().getTime()+1e3*t.data.expires_in,delete i.expires_in),this.emit("tokens",i),{tokens:i,res:t}}refreshAccessToken(e){if(!e)return this.refreshAccessTokenAsync();this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e)}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(!e)return this.getAccessTokenAsync();this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e)}async getAccessTokenAsync(){if(!(!this.credentials.access_token||this.isTokenExpiring()))return{token:this.credentials.access_token};{if(!this.credentials.refresh_token){if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token)return this.setCredentials(e),{token:this.credentials.access_token}}else throw Error("No refresh token or refresh handler callback is set.")}let e=await this.refreshAccessTokenAsync();if(!e.credentials||e.credentials&&!e.credentials.access_token)throw Error("Could not refresh access token.");return{token:e.credentials.access_token,res:e.res}}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let e=new Headers({authorization:t.token_type+" "+t.access_token});return{headers:this.addSharedMetadataHeaders(e)}}if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token){this.setCredentials(e);let t=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(t)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let r=null,n=null;try{n=(r=await this.refreshToken(t.refresh_token)).tokens}catch(e){throw e.response&&(403===e.response.status||404===e.response.status)&&(e.message=`Could not refresh access token: ${e.message}`),e}let i=this.credentials;i.token_type=i.token_type||"Bearer",n.refresh_token=i.refresh_token,this.credentials=n;let o=new Headers({authorization:i.token_type+" "+n.access_token});return{headers:this.addSharedMetadataHeaders(o),res:r.res}}static getRevokeTokenUrl(e){return new f().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let t=new URL(this.endpoints.oauth2RevokeUrl);return t.searchParams.append("token",e),t}revokeToken(e,t){let r={...f.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(p.AuthClient.setMethodName(r,"revokeToken"),!t)return this.transporter.request(r);this.transporter.request(r).then(e=>t(null,e),t)}revokeCredentials(e){if(!e)return this.revokeCredentialsAsync();this.revokeCredentialsAsync().then(t=>e(null,t),e)}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw Error("No access token to revoke.")}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){try{let t=await this.getRequestMetadataAsync();return e.headers=s.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(n){let r=n.response;if(r){let n=r.status,i=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),o=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,s=r.config.data instanceof l.Readable,a=401===n||403===n;if(!t&&a&&!s&&i)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&a&&!s&&o){let t=await this.processAndValidateRefreshHandler();return t?.access_token&&this.setCredentials(t),this.requestAsync(e,!0)}}throw n}}verifyIdToken(e,t){if(t&&"function"!=typeof t)throw Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(!t)return this.verifyIdTokenAsync(e);this.verifyIdTokenAsync(e).then(e=>t(null,e),t)}async verifyIdTokenAsync(e){if(!e.idToken)throw Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...f.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),r=Object.assign({expiry_date:new Date().getTime()+1e3*t.expires_in,scopes:t.scope.split(" ")},t);return delete r.expires_in,delete r.scope,r}getFederatedSignonCerts(e){if(!e)return this.getFederatedSignonCertsAsync();this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e)}async getFederatedSignonCertsAsync(){let e,t;let r=new Date().getTime(),n=(0,d.hasBrowserCrypto)()?i.JWK:i.PEM;if(this.certificateExpiry&&r<this.certificateExpiry.getTime()&&this.certificateCacheFormat===n)return{certs:this.certificateCache,format:n};switch(n){case i.PEM:t=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case i.JWK:t=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw Error(`Unsupported certificate format ${n}`)}try{let r={...f.RETRY_CONFIG,url:t};p.AuthClient.setMethodName(r,"getFederatedSignonCertsAsync"),e=await this.transporter.request(r)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}let o=e?.headers.get("cache-control"),s=-1;if(o){let e=/max-age=(?<maxAge>[0-9]+)/.exec(o)?.groups?.maxAge;e&&(s=1e3*Number(e))}let a={};switch(n){case i.PEM:a=e.data;break;case i.JWK:for(let t of e.data.keys)a[t.kid]=t;break;default:throw Error(`Unsupported certificate format ${n}`)}let l=new Date;return this.certificateExpiry=-1===s?null:new Date(l.getTime()+s),this.certificateCache=a,this.certificateCacheFormat=n,{certs:a,format:n,res:e}}getIapPublicKeys(e){if(!e)return this.getIapPublicKeysAsync();this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e)}async getIapPublicKeysAsync(){let e;let t=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let r={...f.RETRY_CONFIG,url:t};p.AuthClient.setMethodName(r,"getIapPublicKeysAsync"),e=await this.transporter.request(r)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,r,n,i){let o,s;let a=(0,d.createCrypto)();i||(i=f.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let l=e.split(".");if(3!==l.length)throw Error("Wrong number of segments in token: "+e);let u=l[0]+"."+l[1],p=l[2];try{o=JSON.parse(a.decodeBase64StringUtf8(l[0]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token envelope: ${l[0]}': ${e.message}`),e}if(!o)throw Error("Can't parse token envelope: "+l[0]);try{s=JSON.parse(a.decodeBase64StringUtf8(l[1]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token payload '${l[0]}`),e}if(!s)throw Error("Can't parse token payload: "+l[1]);if(!Object.prototype.hasOwnProperty.call(t,o.kid))throw Error("No pem found for envelope: "+JSON.stringify(o));let m=t[o.kid];if("ES256"===o.alg&&(p=c.joseToDer(p,"ES256").toString("base64")),!await a.verify(m,u,p))throw Error("Invalid token signature: "+e);if(!s.iat)throw Error("No issue time in token: "+JSON.stringify(s));if(!s.exp)throw Error("No expiration time in token: "+JSON.stringify(s));let g=Number(s.iat);if(isNaN(g))throw Error("iat field using invalid format");let y=Number(s.exp);if(isNaN(y))throw Error("exp field using invalid format");let v=new Date().getTime()/1e3;if(y>=v+i)throw Error("Expiration time too far in future: "+JSON.stringify(s));let b=g-f.CLOCK_SKEW_SECS_,_=y+f.CLOCK_SKEW_SECS_;if(v<b)throw Error("Token used too early, "+v+" < "+b+": "+JSON.stringify(s));if(v>_)throw Error("Token used too late, "+v+" > "+_+": "+JSON.stringify(s));if(n&&0>n.indexOf(s.iss))throw Error("Invalid issuer, expected one of ["+n+"], but got "+s.iss);if(null!=r){let e=s.aud;if(!(r.constructor===Array?r.indexOf(e)>-1:e===r))throw Error("Wrong recipient, payload audience != requiredAudience")}return new h.LoginTicket(o,s)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return!!e&&e<=new Date().getTime()+this.eagerRefreshThresholdMillis}}t.OAuth2Client=f},21673:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthClientAuthHandler=void 0,t.getErrorFromOAuthErrorResponse=function(e,t){let r=e.error,n=e.error_description,i=e.error_uri,o=`Error code ${r}`;void 0!==n&&(o+=`: ${n}`),void 0!==i&&(o+=` - ${i}`);let s=Error(o);if(t){let e=Object.keys(t);t.stack&&e.push("stack"),e.forEach(e=>{"message"!==e&&Object.defineProperty(s,e,{value:t[e],writable:!1,enumerable:!0})})}return s};let n=r(90206),i=r(10537),o=["PUT","POST","PATCH"];class s{#T=(0,i.createCrypto)();#A;transporter;constructor(e){e&&"clientId"in e?(this.#A=e,this.transporter=new n.Gaxios):(this.#A=e?.clientAuthentication,this.transporter=e?.transporter||new n.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=n.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){if(t)e.headers=n.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(this.#A?.confidentialClientType==="basic"){e.headers=n.Gaxios.mergeHeaders(e.headers);let t=this.#A.clientId,r=this.#A.clientSecret||"",i=this.#T.encodeBase64StringUtf8(`${t}:${r}`);n.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${i}`})}}injectAuthenticatedRequestBody(e){if(this.#A?.confidentialClientType==="request-body"){let t=(e.method||"GET").toUpperCase();if(!o.includes(t))throw Error(`${t} HTTP method does not support ${this.#A.confidentialClientType} client authentication`);let r=new Headers(e.headers).get("content-type");if(r?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let t=new URLSearchParams(e.data??"");t.append("client_id",this.#A.clientId),t.append("client_secret",this.#A.clientSecret||""),e.data=t}else if(r?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#A.clientId,client_secret:this.#A.clientSecret||""});else throw Error(`${r} content-types are not supported with ${this.#A.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.OAuthClientAuthHandler=s},26733:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PassThroughClient=void 0;let n=r(56621);class i extends n.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}}t.PassThroughClient=i},84462:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthClient=t.ExecutableError=void 0;let n=r(83318),i=r(9402),o=r(6895);var s=r(6895);Object.defineProperty(t,"ExecutableError",{enumerable:!0,get:function(){return s.ExecutableError}});class a extends n.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable||(this.command=e.credential_source.executable.command,!this.command))throw Error('No valid Pluggable Auth "credential_source" provided.');if(void 0===e.credential_source.executable.timeout_millis)this.timeoutMillis=3e4;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<5e3||this.timeoutMillis>12e4)throw Error("Timeout must be between 5000120000 milliseconds.");this.outputFile=e.credential_source.executable.output_file,this.handler=new o.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){let e;if("1"!==process.env.GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES)throw Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let r=this.getServiceAccountEmail();r&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",r),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>1)throw Error("Version of executable is not currently supported, maximum supported version is 1.");if(!e.success)throw new o.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new i.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw Error("Executable response is expired.");return e.subjectToken}}t.PluggableAuthClient=a},6895:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthHandler=t.ExecutableError=void 0;let n=r(9402),i=r(32081),o=r(57147);class s extends Error{code;constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableError=s;class a{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw Error("No command provided.");if(this.commandComponents=a.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,r)=>{let o=i.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),a="";o.stdout.on("data",e=>{a+=e}),o.stderr.on("data",e=>{a+=e});let l=setTimeout(()=>(o.removeAllListeners(),o.kill(),r(Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);o.on("close",e=>{if(clearTimeout(l),0!==e)return r(new s(a,e.toString()));try{let e=JSON.parse(a),r=new n.ExecutableResponse(e);return t(r)}catch(e){if(e instanceof n.ExecutableResponseError)return r(e);return r(new n.ExecutableResponseError(`The executable returned an invalid response: ${a}`))}})})}async retrieveCachedResponse(){let e;if(!this.outputFile||0===this.outputFile.length)return;try{e=await o.promises.realpath(this.outputFile)}catch{return}if(!(await o.promises.lstat(e)).isFile())return;let t=await o.promises.readFile(e,{encoding:"utf8"});if(""!==t)try{let e=JSON.parse(t);if(new n.ExecutableResponse(e).isValid())return new n.ExecutableResponse(e);return}catch(e){if(e instanceof n.ExecutableResponseError)throw e;throw new n.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw Error(`Provided command: "${e}" could not be parsed.`);for(let e=0;e<t.length;e++)'"'===t[e][0]&&'"'===t[e].slice(-1)&&(t[e]=t[e].slice(1,-1));return t}}t.PluggableAuthHandler=a},57065:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserRefreshClient=t.USER_REFRESH_ACCOUNT_TYPE=void 0;let n=r(3490),i=r(56621);t.USER_REFRESH_ACCOUNT_TYPE="authorized_user";class o extends n.OAuth2Client{_refreshToken;constructor(e,t,r,n,i){let o=e&&"object"==typeof e?e:{clientId:e,clientSecret:t,refreshToken:r,eagerRefreshThresholdMillis:n,forceRefreshOnFailure:i};super(o),this._refreshToken=o.refreshToken,this.credentials.refresh_token=o.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let t={...o.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return i.AuthClient.setMethodName(t,"fetchIdToken"),(await this.transporter.request(t)).data.id_token}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the user refresh token");if("authorized_user"!==e.type)throw Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}async fromStreamAsync(e){return new Promise((t,r)=>{if(!e)return r(Error("Must pass in a stream containing the user refresh token."));let n="";e.setEncoding("utf8").on("error",r).on("data",e=>n+=e).on("end",()=>{try{let e=JSON.parse(n);return this.fromJSON(e),t()}catch(e){return r(e)}})})}static fromJSON(e){let t=new o;return t.fromJSON(e),t}}t.UserRefreshClient=o},50984:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StsCredentials=void 0;let n=r(90206),i=r(56621),o=r(21673),s=r(86538);class a extends o.OAuthClientAuthHandler{#C;constructor(e={tokenExchangeEndpoint:""},t){("object"!=typeof e||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:t}),super(e),this.#C=e.tokenExchangeEndpoint}async exchangeToken(e,t,r){let l={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:r&&JSON.stringify(r)},c={...a.RETRY_CONFIG,url:this.#C.toString(),method:"POST",headers:t,data:new URLSearchParams((0,s.removeUndefinedValuesInObject)(l))};i.AuthClient.setMethodName(c,"exchangeToken"),this.applyClientAuthenticationOptions(c);try{let e=await this.transporter.request(c),t=e.data;return t.res=e,t}catch(e){if(e instanceof n.GaxiosError&&e.response)throw(0,o.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}t.StsCredentials=a},60132:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlSubjectTokenSupplier=void 0;let n=r(56621);class i{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t;let r={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};if(n.AuthClient.setMethodName(r,"getSubjectToken"),"text"===this.formatType?t=(await e.transporter.request(r)).data:"json"===this.formatType&&this.subjectTokenFieldName&&(t=(await e.transporter.request(r)).data[this.subjectTokenFieldName]),!t)throw Error("Unable to parse the subject_token from the credential_source URL");return t}}t.UrlSubjectTokenSupplier=i},13244:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserCrypto=void 0;let n=r(714),i=r(97277);class o{constructor(){if("undefined"==typeof window||void 0===window.crypto||void 0===window.crypto.subtle)throw Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return n.fromByteArray(new Uint8Array(r))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),n.fromByteArray(t)}static padBase64(e){for(;e.length%4!=0;)e+="=";return e}async verify(e,t,r){let i={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(t),a=n.toByteArray(o.padBase64(r)),l=await window.crypto.subtle.importKey("jwk",e,i,!0,["verify"]);return await window.crypto.subtle.verify(i,l,a,s)}async sign(e,t){let r={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},i=new TextEncoder().encode(t),o=await window.crypto.subtle.importKey("jwk",e,r,!0,["sign"]),s=await window.crypto.subtle.sign(r,o,i);return n.fromByteArray(new Uint8Array(s))}decodeBase64StringUtf8(e){let t=n.toByteArray(o.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return n.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return(0,i.fromArrayBufferToHex)(r)}async signWithHmacSha256(e,t){let r="string"==typeof e?e:String.fromCharCode(...new Uint16Array(e)),n=new TextEncoder,i=await window.crypto.subtle.importKey("raw",n.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",i,n.encode(t))}}t.BrowserCrypto=o},10537:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.createCrypto=function(){return a()?new o.BrowserCrypto:new s.NodeCrypto},t.hasBrowserCrypto=a;let o=r(13244),s=r(85455);function a(){return"undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle}i(r(97277),t)},85455:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeCrypto=void 0;let n=r(6113);class i{async sha256DigestBase64(e){return n.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return n.randomBytes(e).toString("base64")}async verify(e,t,r){let i=n.createVerify("RSA-SHA256");return i.update(t),i.end(),i.verify(e,r,"base64")}async sign(e,t){let r=n.createSign("RSA-SHA256");return r.update(t),r.end(),r.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return n.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){var r;let i="string"==typeof e?e:Buffer.from(e);return(r=n.createHmac("sha256",i).update(t).digest()).buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}}t.NodeCrypto=i},97277:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromArrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}},44401:(e,t,r)=>{"use strict";t.eE=void 0;let n=r(26614);Object.defineProperty(t,"eE",{enumerable:!0,get:function(){return n.GoogleAuth}}),r(80759),r(90206),r(56621),r(10902),r(71215),r(39120),r(60502),r(77951),r(21316),r(32119),r(3490),r(90434),r(57065),r(63321),r(43676),r(49201),r(9273),r(83318),r(63651),r(84462),r(83006),r(26733),new n.GoogleAuth},86538:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=void 0,t.snakeToCamel=a,t.originalOrCamelOptions=function(e){return{get:function(t){let r=e||{};return r[t]??r[a(t)]}}},t.removeUndefinedValuesInObject=function(e){return Object.entries(e).forEach(([t,r])=>{(void 0===r||"undefined"===r)&&delete e[t]}),e},t.isValidFile=c,t.getWellKnownCertificateConfigFileLocation=function(){let e=process.env.CLOUDSDK_CONFIG||(i.platform().startsWith("win")?o.join(process.env.APPDATA||"",s):o.join(process.env.HOME||"",".config",s));return o.join(e,"certificate_config.json")};let n=r(57147),i=r(22037),o=r(71017),s="gcloud";function a(e){return e.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}class l{capacity;#O=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#I(e,t){this.#O.delete(e),this.#O.set(e,{value:t,lastAccessed:Date.now()})}set(e,t){this.#I(e,t),this.#N()}get(e){let t=this.#O.get(e);if(t)return this.#I(e,t.value),this.#N(),t.value}#N(){let e=this.maxAge?Date.now()-this.maxAge:0,t=this.#O.entries().next();for(;!t.done&&(this.#O.size>this.capacity||t.value[1].lastAccessed<e);)this.#O.delete(t.value[0]),t=this.#O.entries().next()}}async function c(e){try{return(await n.promises.lstat(e)).isFile()}catch(e){return!1}}t.LRUCache=l},50762:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Colours=void 0;class r{static isEnabled(e){return e&&e.isTTY&&("function"!=typeof e.getColorDepth||e.getColorDepth()>2)}static refresh(){r.enabled=r.isEnabled(null==process?void 0:process.stderr),this.enabled?(r.reset="\x1b[0m",r.bright="\x1b[1m",r.dim="\x1b[2m",r.red="\x1b[31m",r.green="\x1b[32m",r.yellow="\x1b[33m",r.blue="\x1b[34m",r.magenta="\x1b[35m",r.cyan="\x1b[36m",r.white="\x1b[37m",r.grey="\x1b[90m"):(r.reset="",r.bright="",r.dim="",r.red="",r.green="",r.yellow="",r.blue="",r.magenta="",r.cyan="",r.white="",r.grey="")}}t.Colours=r,r.enabled=!1,r.reset="",r.bright="",r.dim="",r.red="",r.green="",r.yellow="",r.blue="",r.magenta="",r.cyan="",r.white="",r.grey="",r.refresh()},15348:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(27042),t)},27042:function(e,t,r){"use strict";let n;var i,o,s,a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||(i=function(e){return(i=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=i(e),n=0;n<r.length;n++)"default"!==r[n]&&a(t,e,r[n]);return l(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.env=t.DebugLogBackendBase=t.placeholder=t.AdhocDebugLogger=t.LogSeverity=void 0,t.getNodeBackend=y,t.getDebugBackend=function(e){return new v(e)},t.getStructuredBackend=function(e){return new b(e)},t.setBackend=function(e){n=e,_.clear()},t.log=E;let u=r(82361),d=c(r(77282)),p=c(r(73837)),h=r(50762);(o=s||(t.LogSeverity=s={})).DEFAULT="DEFAULT",o.DEBUG="DEBUG",o.INFO="INFO",o.WARNING="WARNING",o.ERROR="ERROR";class f extends u.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(e,t)=>this.on(e,t)}),this.func.debug=(...e)=>this.invokeSeverity(s.DEBUG,...e),this.func.info=(...e)=>this.invokeSeverity(s.INFO,...e),this.func.warn=(...e)=>this.invokeSeverity(s.WARNING,...e),this.func.error=(...e)=>this.invokeSeverity(s.ERROR,...e),this.func.sublog=e=>E(e,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch(e){}try{this.emit("log",e,t)}catch(e){}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}}t.AdhocDebugLogger=f,t.placeholder=new f("",()=>{}).func;class m{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let r=null!==(e=d.env[t.env.nodeEnables])&&void 0!==e?e:"*";"all"===r&&(r="*"),this.filters=r.split(",")}log(e,t,...r){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let n=this.cached.get(e);n||(n=this.makeLogger(e),this.cached.set(e,n)),n(t,...r)}catch(e){console.error(e)}}}t.DebugLogBackendBase=m;class g extends m{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...r)=>{var n;let i;let o=`${h.Colours.green}${e}${h.Colours.reset}`,a=`${h.Colours.yellow}${d.pid}${h.Colours.reset}`;switch(t.severity){case s.ERROR:i=`${h.Colours.red}${t.severity}${h.Colours.reset}`;break;case s.INFO:i=`${h.Colours.magenta}${t.severity}${h.Colours.reset}`;break;case s.WARNING:i=`${h.Colours.yellow}${t.severity}${h.Colours.reset}`;break;default:i=null!==(n=t.severity)&&void 0!==n?n:s.DEFAULT}let l=p.formatWithOptions({colors:h.Colours.enabled},...r),c=Object.assign({},t);delete c.severity;let u=Object.getOwnPropertyNames(c).length?JSON.stringify(c):"",f=u?`${h.Colours.grey}${u}${h.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",a,o,i,l,u?` ${f}`:"")}:()=>{}}setFilters(){let e=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=RegExp(`^${e}$`,"i")}}function y(){return new g}class v extends m{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(e,...r)=>{t(r[0],...r.slice(1))}}setFilters(){var e;let t=null!==(e=d.env.NODE_DEBUG)&&void 0!==e?e:"";d.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}}class b extends m{constructor(e){super(),this.upstream=null!=e?e:void 0}makeLogger(e){var t;let r=null===(t=this.upstream)||void 0===t?void 0:t.makeLogger(e);return(e,...t)=>{var n;let i=JSON.stringify(Object.assign({severity:null!==(n=e.severity)&&void 0!==n?n:s.INFO,message:p.format(...t)},e));r?r(e,i):console.log("%s",i)}}setFilters(){var e;null===(e=this.upstream)||void 0===e||e.setFilters()}}t.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};let _=new Map;function E(e,r){let i;if(!n&&!d.env[t.env.nodeEnables]||!e)return t.placeholder;r&&(e=`${r.instance.namespace}:${e}`);let o=_.get(e);if(o)return o.func;if(null===n)return t.placeholder;void 0===n&&(n=y());let s=new f(e,(t,...r)=>{if(i!==n){if(null===n)return;void 0===n&&(n=y()),i=n}null==n||n.log(e,t,...r)});return _.set(e,s),s.func}},99361:(e,t,r)=>{var n=r(82102).stringify,i=r(96712);e.exports=function(e){return{parse:i(e),stringify:n}},e.exports.parse=i(),e.exports.stringify=n},96712:(e,t,r)=>{var n=null;let i=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,o=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;e.exports=function(e){"use strict";var t={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(null!=e){if(!0===e.strict&&(t.strict=!0),!0===e.storeAsString&&(t.storeAsString=!0),t.alwaysParseAsBig=!0===e.alwaysParseAsBig&&e.alwaysParseAsBig,t.useNativeBigInt=!0===e.useNativeBigInt&&e.useNativeBigInt,void 0!==e.constructorAction){if("error"===e.constructorAction||"ignore"===e.constructorAction||"preserve"===e.constructorAction)t.constructorAction=e.constructorAction;else throw Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${e.constructorAction}`)}if(void 0!==e.protoAction){if("error"===e.protoAction||"ignore"===e.protoAction||"preserve"===e.protoAction)t.protoAction=e.protoAction;else throw Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${e.protoAction}`)}}var s,a,l,c,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},d=function(e){throw{name:"SyntaxError",message:e,at:s,text:l}},p=function(e){return e&&e!==a&&d("Expected '"+e+"' instead of '"+a+"'"),a=l.charAt(s),s+=1,a},h=function(){var e,i="";for("-"===a&&(i="-",p("-"));a>="0"&&a<="9";)i+=a,p();if("."===a)for(i+=".";p()&&a>="0"&&a<="9";)i+=a;if("e"===a||"E"===a)for(i+=a,p(),("-"===a||"+"===a)&&(i+=a,p());a>="0"&&a<="9";)i+=a,p();if(isFinite(e=+i))return(null==n&&(n=r(28254)),i.length>15)?t.storeAsString?i:t.useNativeBigInt?BigInt(i):new n(i):t.alwaysParseAsBig?t.useNativeBigInt?BigInt(e):new n(e):e;d("Bad number")},f=function(){var e,t,r,n="";if('"'===a)for(var i=s;p();){if('"'===a)return s-1>i&&(n+=l.substring(i,s-1)),p(),n;if("\\"===a){if(s-1>i&&(n+=l.substring(i,s-1)),p(),"u"===a){for(t=0,r=0;t<4&&isFinite(e=parseInt(p(),16));t+=1)r=16*r+e;n+=String.fromCharCode(r)}else if("string"==typeof u[a])n+=u[a];else break;i=s}}d("Bad string")},m=function(){for(;a&&a<=" ";)p()},g=function(){switch(a){case"t":return p("t"),p("r"),p("u"),p("e"),!0;case"f":return p("f"),p("a"),p("l"),p("s"),p("e"),!1;case"n":return p("n"),p("u"),p("l"),p("l"),null}d("Unexpected '"+a+"'")},y=function(){var e=[];if("["===a){if(p("["),m(),"]"===a)return p("]"),e;for(;a;){if(e.push(c()),m(),"]"===a)return p("]"),e;p(","),m()}}d("Bad array")},v=function(){var e,r=Object.create(null);if("{"===a){if(p("{"),m(),"}"===a)return p("}"),r;for(;a;){if(e=f(),m(),p(":"),!0===t.strict&&Object.hasOwnProperty.call(r,e)&&d('Duplicate key "'+e+'"'),!0===i.test(e)?"error"===t.protoAction?d("Object contains forbidden prototype property"):"ignore"===t.protoAction?c():r[e]=c():!0===o.test(e)?"error"===t.constructorAction?d("Object contains forbidden constructor property"):"ignore"===t.constructorAction?c():r[e]=c():r[e]=c(),m(),"}"===a)return p("}"),r;p(","),m()}}d("Bad object")};return c=function(){switch(m(),a){case"{":return v();case"[":return y();case'"':return f();case"-":return h();default:return a>="0"&&a<="9"?h():g()}},function(e,t){var r;return l=e+"",s=0,a=" ",r=c(),m(),a&&d("Syntax error"),"function"==typeof t?function e(r,n){var i,o=r[n];return o&&"object"==typeof o&&Object.keys(o).forEach(function(t){void 0!==(i=e(o,t))?o[t]=i:delete o[t]}),t.call(r,n,o)}({"":r},""):r}}},82102:(e,t,r)=>{var n=r(28254),i=e.exports;!function(){"use strict";var e,t,r,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function a(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof i.stringify&&(i.stringify=function(i,o,s){var l;if(e="",t="","number"==typeof s)for(l=0;l<s;l+=1)t+=" ";else"string"==typeof s&&(t=s);if(r=o,o&&"function"!=typeof o&&("object"!=typeof o||"number"!=typeof o.length))throw Error("JSON.stringify");return function i(o,s){var l,c,u,d,p,h=e,f=s[o],m=null!=f&&(f instanceof n||n.isBigNumber(f));switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(o)),"function"==typeof r&&(f=r.call(s,o,f)),typeof f){case"string":if(m)return f;return a(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":case"bigint":return String(f);case"object":if(!f)return"null";if(e+=t,p=[],"[object Array]"===Object.prototype.toString.apply(f)){for(l=0,d=f.length;l<d;l+=1)p[l]=i(l,f)||"null";return u=0===p.length?"[]":e?"[\n"+e+p.join(",\n"+e)+"\n"+h+"]":"["+p.join(",")+"]",e=h,u}if(r&&"object"==typeof r)for(l=0,d=r.length;l<d;l+=1)"string"==typeof r[l]&&(u=i(c=r[l],f))&&p.push(a(c)+(e?": ":":")+u);else Object.keys(f).forEach(function(t){var r=i(t,f);r&&p.push(a(t)+(e?": ":":")+r)});return u=0===p.length?"{}":e?"{\n"+e+p.join(",\n"+e)+"\n"+h+"}":"{"+p.join(",")+"}",e=h,u}}("",{"":i})})}()},95350:(e,t,r)=>{var n,i=r(90892).Buffer,o=r(6113),s=r(3164),a=r(73837),l="secret must be a string or buffer",c="key must be a string or a buffer",u="function"==typeof o.createPublicKey;function d(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!u||"object"!=typeof e||"string"!=typeof e.type||"string"!=typeof e.asymmetricKeyType||"function"!=typeof e.export))throw m(c)}function p(e){if(!i.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw m("key must be a string, a buffer or an object")}function h(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function f(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var r=0;r<t;++r)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function m(e){var t=[].slice.call(arguments,1);return TypeError(a.format.bind(a,e).apply(null,t))}function g(e){var t;return t=e,i.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function y(e){return function(t,r){(function(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!u||"object"!=typeof e||"secret"!==e.type||"function"!=typeof e.export))throw m(l)})(r),t=g(t);var n=o.createHmac("sha"+e,r);return h((n.update(t),n.digest("base64")))}}u&&(c+=" or a KeyObject",l+="or a KeyObject");var v="timingSafeEqual"in o?function(e,t){return e.byteLength===t.byteLength&&o.timingSafeEqual(e,t)}:function(e,t){return n||(n=r(29916)),n(e,t)};function b(e){return function(t,r,n){var o=y(e)(t,n);return v(i.from(r),i.from(o))}}function _(e){return function(t,r){p(r),t=g(t);var n=o.createSign("RSA-SHA"+e);return h((n.update(t),n.sign(r,"base64")))}}function E(e){return function(t,r,n){d(n),t=g(t),r=f(r);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify(n,r,"base64")}}function w(e){return function(t,r){p(r),t=g(t);var n=o.createSign("RSA-SHA"+e);return h((n.update(t),n.sign({key:r,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function x(e){return function(t,r,n){d(n),t=g(t),r=f(r);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify({key:n,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function S(e){var t=_(e);return function(){var r=t.apply(null,arguments);return s.derToJose(r,"ES"+e)}}function T(e){var t=E(e);return function(r,n,i){return t(r,n=s.joseToDer(n,"ES"+e).toString("base64"),i)}}function A(){return function(){return""}}function C(){return function(e,t){return""===t}}e.exports=function(e){var t=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!t)throw m('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var r=(t[1]||t[3]).toLowerCase(),n=t[2];return{sign:({hs:y,rs:_,ps:w,es:S,none:A})[r](n),verify:({hs:b,rs:E,ps:x,es:T,none:C})[r](n)}}},8287:(e,t,r)=>{var n=r(99505),i=r(55850);t.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],t.sign=n.sign,t.verify=i.verify,t.decode=i.decode,t.isValid=i.isValid,t.createSign=function(e){return new n(e)},t.createVerify=function(e){return new i(e)}},34630:(e,t,r)=>{var n=r(90892).Buffer,i=r(12781);function o(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=n.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=n.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick((function(){this.emit("end",e),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof e+")")}r(73837).inherits(o,i),o.prototype.write=function(e){this.buffer=n.concat([this.buffer,n.from(e)]),this.emit("data",e)},o.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1},e.exports=o},99505:(e,t,r)=>{var n=r(90892).Buffer,i=r(34630),o=r(95350),s=r(12781),a=r(60904),l=r(73837);function c(e,t){return n.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function u(e){var t,r,n,i=e.header,s=e.payload,u=e.secret||e.privateKey,d=e.encoding,p=o(i.alg),h=(t=(t=d)||"utf8",r=c(a(i),"binary"),n=c(a(s),t),l.format("%s.%s",r,n)),f=p.sign(h,u);return l.format("%s.%s",h,f)}function d(e){var t=e.secret;if(t=null==(t=null==t?e.privateKey:t)?e.key:t,!0===/^hs/i.test(e.header.alg)&&null==t)throw TypeError("secret must be a string or buffer or a KeyObject");var r=new i(t);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=r,this.payload=new i(e.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}l.inherits(d,s),d.prototype.sign=function(){try{var e=u({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},d.sign=u,e.exports=d},60904:(e,t,r)=>{var n=r(14300).Buffer;e.exports=function(e){return"string"==typeof e?e:"number"==typeof e||n.isBuffer(e)?e.toString():JSON.stringify(e)}},55850:(e,t,r)=>{var n=r(90892).Buffer,i=r(34630),o=r(95350),s=r(12781),a=r(60904),l=r(73837),c=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function u(e){var t=e.split(".",1)[0];return function(e){if("[object Object]"===Object.prototype.toString.call(e))return e;try{return JSON.parse(e)}catch(e){return}}(n.from(t,"base64").toString("binary"))}function d(e){return e.split(".")[2]}function p(e){return c.test(e)&&!!u(e)}function h(e,t,r){if(!t){var n=Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}var i=d(e=a(e)),s=e.split(".",2).join(".");return o(t).verify(s,i,r)}function f(e,t){if(t=t||{},!p(e=a(e)))return null;var r,i,o=u(e);if(!o)return null;var s=(r=r||"utf8",i=e.split(".")[1],n.from(i,"base64").toString(r));return("JWT"===o.typ||t.json)&&(s=JSON.parse(s,t.encoding)),{header:o,payload:s,signature:d(e)}}function m(e){var t=(e=e||{}).secret;if(t=null==(t=null==t?e.publicKey:t)?e.key:t,!0===/^hs/i.test(e.algorithm)&&null==t)throw TypeError("secret must be a string or buffer or a KeyObject");var r=new i(t);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=r,this.signature=new i(e.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}l.inherits(m,s),m.prototype.verify=function(){try{var e=h(this.signature.buffer,this.algorithm,this.key.buffer),t=f(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},m.decode=f,m.isValid=p,m.verify=h,e.exports=m},80851:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(17577),i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=(e,t)=>{let r=(0,n.forwardRef)(({color:r="currentColor",size:s=24,strokeWidth:a=2,absoluteStrokeWidth:l,className:c="",children:u,...d},p)=>(0,n.createElement)("svg",{ref:p,...i,width:s,height:s,stroke:r,strokeWidth:l?24*Number(a)/Number(s):a,className:["lucide",`lucide-${o(e)}`,c].join(" "),...d},[...t.map(([e,t])=>(0,n.createElement)(e,t)),...Array.isArray(u)?u:[u]]));return r.displayName=`${e}`,r}},48998:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(80851).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},53777:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(80851).Z)("LayoutTemplate",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]])},83855:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(80851).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},98091:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r(80851).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},46242:(e,t,r)=>{"use strict";Object.defineProperty(t,"$",{enumerable:!0,get:function(){return i}});let n=r(15424);function i(e){let{createServerReference:t}=r(56493);return t(e,n.callServer)}},90892:(e,t,r)=>{/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var n=r(14300),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},17878:(e,t,r)=>{"use strict";let{EMPTY_BUFFER:n}=r(39353),i=Buffer[Symbol.species];function o(e,t,r,n,i){for(let o=0;o<i;o++)r[n+o]=e[o]^t[3&o]}function s(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}if(e.exports={concat:function(e,t){if(0===e.length)return n;if(1===e.length)return e[0];let r=Buffer.allocUnsafe(t),o=0;for(let t=0;t<e.length;t++){let n=e[t];r.set(n,o),o+=n.length}return o<t?new i(r.buffer,r.byteOffset,o):r},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){let r;return(e.readOnly=!0,Buffer.isBuffer(t))?t:(t instanceof ArrayBuffer?r=new i(t):ArrayBuffer.isView(t)?r=new i(t.buffer,t.byteOffset,t.byteLength):(r=Buffer.from(t),e.readOnly=!1),r)},unmask:s},!process.env.WS_NO_BUFFER_UTIL)try{let t=r(58359);e.exports.mask=function(e,r,n,i,s){s<48?o(e,r,n,i,s):t.mask(e,r,n,i,s)},e.exports.unmask=function(e,r){e.length<32?s(e,r):t.unmask(e,r)}}catch(e){}},39353:e=>{"use strict";let t=["nodebuffer","arraybuffer","fragments"],r="undefined"!=typeof Blob;r&&t.push("blob"),e.exports={BINARY_TYPES:t,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:r,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},91368:(e,t,r)=>{"use strict";let{kForOnEventAttribute:n,kListener:i}=r(39353),o=Symbol("kCode"),s=Symbol("kData"),a=Symbol("kError"),l=Symbol("kMessage"),c=Symbol("kReason"),u=Symbol("kTarget"),d=Symbol("kType"),p=Symbol("kWasClean");class h{constructor(e){this[u]=null,this[d]=e}get target(){return this[u]}get type(){return this[d]}}Object.defineProperty(h.prototype,"target",{enumerable:!0}),Object.defineProperty(h.prototype,"type",{enumerable:!0});class f extends h{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[c]=void 0===t.reason?"":t.reason,this[p]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[c]}get wasClean(){return this[p]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class m extends h{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[l]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[l]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class g extends h{constructor(e,t={}){super(e),this[s]=void 0===t.data?null:t.data}get data(){return this[s]}}function y(e,t,r){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}Object.defineProperty(g.prototype,"data",{enumerable:!0}),e.exports={CloseEvent:f,ErrorEvent:m,Event:h,EventTarget:{addEventListener(e,t,r={}){let o;for(let o of this.listeners(e))if(!r[n]&&o[i]===t&&!o[n])return;if("message"===e)o=function(e,r){let n=new g("message",{data:r?e:e.toString()});n[u]=this,y(t,this,n)};else if("close"===e)o=function(e,r){let n=new f("close",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});n[u]=this,y(t,this,n)};else if("error"===e)o=function(e){let r=new m("error",{error:e,message:e.message});r[u]=this,y(t,this,r)};else{if("open"!==e)return;o=function(){let e=new h("open");e[u]=this,y(t,this,e)}}o[n]=!!r[n],o[i]=t,r.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(let r of this.listeners(e))if(r[i]===t&&!r[n]){this.removeListener(e,r);break}}},MessageEvent:g}},49964:(e,t,r)=>{"use strict";let{tokenChars:n}=r(94568);function i(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}e.exports={format:function(e){return Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>[t].concat(Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,r;let o=Object.create(null),s=Object.create(null),a=!1,l=!1,c=!1,u=-1,d=-1,p=-1,h=0;for(;h<e.length;h++)if(d=e.charCodeAt(h),void 0===t){if(-1===p&&1===n[d])-1===u&&(u=h);else if(0!==h&&(32===d||9===d))-1===p&&-1!==u&&(p=h);else if(59===d||44===d){if(-1===u)throw SyntaxError(`Unexpected character at index ${h}`);-1===p&&(p=h);let r=e.slice(u,p);44===d?(i(o,r,s),s=Object.create(null)):t=r,u=p=-1}else throw SyntaxError(`Unexpected character at index ${h}`)}else if(void 0===r){if(-1===p&&1===n[d])-1===u&&(u=h);else if(32===d||9===d)-1===p&&-1!==u&&(p=h);else if(59===d||44===d){if(-1===u)throw SyntaxError(`Unexpected character at index ${h}`);-1===p&&(p=h),i(s,e.slice(u,p),!0),44===d&&(i(o,t,s),s=Object.create(null),t=void 0),u=p=-1}else if(61===d&&-1!==u&&-1===p)r=e.slice(u,h),u=p=-1;else throw SyntaxError(`Unexpected character at index ${h}`)}else if(l){if(1!==n[d])throw SyntaxError(`Unexpected character at index ${h}`);-1===u?u=h:a||(a=!0),l=!1}else if(c){if(1===n[d])-1===u&&(u=h);else if(34===d&&-1!==u)c=!1,p=h;else if(92===d)l=!0;else throw SyntaxError(`Unexpected character at index ${h}`)}else if(34===d&&61===e.charCodeAt(h-1))c=!0;else if(-1===p&&1===n[d])-1===u&&(u=h);else if(-1!==u&&(32===d||9===d))-1===p&&(p=h);else if(59===d||44===d){if(-1===u)throw SyntaxError(`Unexpected character at index ${h}`);-1===p&&(p=h);let n=e.slice(u,p);a&&(n=n.replace(/\\/g,""),a=!1),i(s,r,n),44===d&&(i(o,t,s),s=Object.create(null),t=void 0),r=void 0,u=p=-1}else throw SyntaxError(`Unexpected character at index ${h}`);if(-1===u||c||32===d||9===d)throw SyntaxError("Unexpected end of input");-1===p&&(p=h);let f=e.slice(u,p);return void 0===t?i(o,f,s):(void 0===r?i(s,f,!0):a?i(s,r,f.replace(/\\/g,"")):i(s,r,f),i(o,t,s)),o}}},25936:e=>{"use strict";let t=Symbol("kDone"),r=Symbol("kRun");class n{constructor(e){this[t]=()=>{this.pending--,this[r]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[r]()}[r](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[t])}}}e.exports=n},97959:(e,t,r)=>{"use strict";let n;let i=r(59796),o=r(17878),s=r(25936),{kStatusCode:a}=r(39353),l=Buffer[Symbol.species],c=Buffer.from([0,0,255,255]),u=Symbol("permessage-deflate"),d=Symbol("total-length"),p=Symbol("callback"),h=Symbol("buffers"),f=Symbol("error");class m{constructor(e,t,r){this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,n||(n=new s(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[p];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!r)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:(!0===r.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let r=e[t];if(r.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==r)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=r})}),e}decompress(e,t,r){n.add(n=>{this._decompress(e,t,(e,t)=>{n(),r(e,t)})})}compress(e,t,r){n.add(n=>{this._compress(e,t,(e,t)=>{n(),r(e,t)})})}_decompress(e,t,r){let n=this._isServer?"client":"server";if(!this._inflate){let e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[u]=this,this._inflate[d]=0,this._inflate[h]=[],this._inflate.on("error",v),this._inflate.on("data",y)}this._inflate[p]=r,this._inflate.write(e),t&&this._inflate.write(c),this._inflate.flush(()=>{let e=this._inflate[f];if(e){this._inflate.close(),this._inflate=null,r(e);return}let i=o.concat(this._inflate[h],this._inflate[d]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[d]=0,this._inflate[h]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,i)})}_compress(e,t,r){let n=this._isServer?"server":"client";if(!this._deflate){let e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[d]=0,this._deflate[h]=[],this._deflate.on("data",g)}this._deflate[p]=r,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=o.concat(this._deflate[h],this._deflate[d]);t&&(e=new l(e.buffer,e.byteOffset,e.length-4)),this._deflate[p]=null,this._deflate[d]=0,this._deflate[h]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,e)})}}function g(e){this[h].push(e),this[d]+=e.length}function y(e){if(this[d]+=e.length,this[u]._maxPayload<1||this[d]<=this[u]._maxPayload){this[h].push(e);return}this[f]=RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][a]=1009,this.removeListener("data",y),this.reset()}function v(e){if(this[u]._inflate=null,this[f]){this[p](this[f]);return}e[a]=1007,this[p](e)}e.exports=m},83958:(e,t,r)=>{"use strict";let{Writable:n}=r(12781),i=r(97959),{BINARY_TYPES:o,EMPTY_BUFFER:s,kStatusCode:a,kWebSocket:l}=r(39353),{concat:c,toArrayBuffer:u,unmask:d}=r(17878),{isValidStatusCode:p,isValidUTF8:h}=r(94568),f=Buffer[Symbol.species];class m extends n{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[l]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=new f(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0){e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));return}let r=(64&t[0])==64;if(r&&!this._extensions[i.extensionName]){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(r){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(!this._fragmented){e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));return}this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented){e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));return}if(r){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength){e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"));return}}else{e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));return}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked){e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"));return}}else if(this._masked){e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));return}126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);if(r>2097151){e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"));return}this._payloadLength=4294967296*r+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));return}this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=s;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&d(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0){t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));return}this._fragments.push(r)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let n;n="nodebuffer"===this._binaryType?c(r,t):"arraybuffer"===this._binaryType?u(c(r,t)):"blob"===this._binaryType?new Blob(r):r,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!0),this._state=0,this.startLoop(e)}))}else{let n=c(r,t);if(!this._skipUTF8Validation&&!h(n)){e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));return}5===this._state||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,s),this.end();else{let r=e.readUInt16BE(0);if(!p(r)){t(this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));return}let n=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!h(n)){t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));return}this._loop=!1,this.emit("conclude",r,n),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,r,n,i){this._loop=!1,this._errored=!0;let o=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[a]=n,o}}e.exports=m},74036:(e,t,r)=>{"use strict";let n;let{Duplex:i}=r(12781),{randomFillSync:o}=r(6113),s=r(97959),{EMPTY_BUFFER:a,kWebSocket:l,NOOP:c}=r(39353),{isBlob:u,isValidStatusCode:d}=r(94568),{mask:p,toBuffer:h}=r(17878),f=Symbol("kByteLength"),m=Buffer.alloc(4),g=8192;class y{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=c,this[l]=void 0}static frame(e,t){let r,i;let s=!1,a=2,l=!1;t.mask&&(r=t.maskBuffer||m,t.generateMask?t.generateMask(r):(8192===g&&(void 0===n&&(n=Buffer.alloc(8192)),o(n,0,8192),g=0),r[0]=n[g++],r[1]=n[g++],r[2]=n[g++],r[3]=n[g++]),l=(r[0]|r[1]|r[2]|r[3])==0,a=6),"string"==typeof e?i=(!t.mask||l)&&void 0!==t[f]?t[f]:(e=Buffer.from(e)).length:(i=e.length,s=t.mask&&t.readOnly&&!l);let c=i;i>=65536?(a+=8,c=127):i>125&&(a+=2,c=126);let u=Buffer.allocUnsafe(s?i+a:a);return(u[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(u[0]|=64),u[1]=c,126===c?u.writeUInt16BE(i,2):127===c&&(u[2]=u[3]=0,u.writeUIntBE(i,4,6)),t.mask)?(u[1]|=128,u[a-4]=r[0],u[a-3]=r[1],u[a-2]=r[2],u[a-1]=r[3],l)?[u,e]:s?(p(e,r,u,a,i),[u]):(p(e,r,e,0,i),[u,e]):[u,e]}close(e,t,r,n){let i;if(void 0===e)i=a;else if("number"==typeof e&&d(e)){if(void 0!==t&&t.length){let r=Buffer.byteLength(t);if(r>123)throw RangeError("The message must not be greater than 123 bytes");(i=Buffer.allocUnsafe(2+r)).writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else(i=Buffer.allocUnsafe(2)).writeUInt16BE(e,0)}else throw TypeError("First argument must be a valid error code number");let o={[f]:i.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(y.frame(i,o),n)}ping(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):u(e)?(n=e.size,i=!1):(n=(e=h(e)).length,i=h.readOnly),n>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};u(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):0!==this._state?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(y.frame(e,o),r)}pong(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):u(e)?(n=e.size,i=!1):(n=(e=h(e)).length,i=h.readOnly),n>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};u(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):0!==this._state?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(y.frame(e,o),r)}send(e,t,r){let n,i;let o=this._extensions[s.extensionName],a=t.binary?2:1,l=t.compress;"string"==typeof e?(n=Buffer.byteLength(e),i=!1):u(e)?(n=e.size,i=!1):(n=(e=h(e)).length,i=h.readOnly),this._firstFragment?(this._firstFragment=!1,l&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=n>=o._threshold),this._compress=l):(l=!1,a=0),t.fin&&(this._firstFragment=!0);let c={[f]:n,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:i,rsv1:l};u(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,c,r]):this.getBlobData(e,this._compress,c,r):0!==this._state?this.enqueue([this.dispatch,e,this._compress,c,r]):this.dispatch(e,this._compress,c,r)}getBlobData(e,t,r,n){this._bufferedBytes+=r[f],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(v,this,e,n);return}this._bufferedBytes-=r[f];let i=h(e);t?this.dispatch(i,t,r,n):(this._state=0,this.sendFrame(y.frame(i,r),n),this.dequeue())}).catch(e=>{process.nextTick(b,this,e,n)})}dispatch(e,t,r,n){if(!t){this.sendFrame(y.frame(e,r),n);return}let i=this._extensions[s.extensionName];this._bufferedBytes+=r[f],this._state=1,i.compress(e,r.fin,(e,t)=>{if(this._socket.destroyed){v(this,Error("The socket was closed while data was being compressed"),n);return}this._bufferedBytes-=r[f],this._state=0,r.readOnly=!1,this.sendFrame(y.frame(t,r),n),this.dequeue()})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][f],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][f],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function v(e,t,r){"function"==typeof r&&r(t);for(let r=0;r<e._queue.length;r++){let n=e._queue[r],i=n[n.length-1];"function"==typeof i&&i(t)}}function b(e,t,r){v(e,t,r),e.onerror(t)}e.exports=y},42504:(e,t,r)=>{"use strict";r(46342);let{Duplex:n}=r(12781);function i(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function s(e){this.removeListener("error",s),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let r=!0,a=new n({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,r){let n=!r&&a._readableState.objectMode?t.toString():t;a.push(n)||e.pause()}),e.once("error",function(e){a.destroyed||(r=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,n){if(e.readyState===e.CLOSED){n(t),process.nextTick(i,a);return}let o=!1;e.once("error",function(e){o=!0,n(e)}),e.once("close",function(){o||n(t),process.nextTick(i,a)}),r&&e.terminate()},a._final=function(t){if(e.readyState===e.CONNECTING){e.once("open",function(){a._final(t)});return}null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,r,n){if(e.readyState===e.CONNECTING){e.once("open",function(){a._write(t,r,n)});return}e.send(t,n)},a.on("end",o),a.on("error",s),a}},62444:(e,t,r)=>{"use strict";let{tokenChars:n}=r(94568);e.exports={parse:function(e){let t=new Set,r=-1,i=-1,o=0;for(;o<e.length;o++){let s=e.charCodeAt(o);if(-1===i&&1===n[s])-1===r&&(r=o);else if(0!==o&&(32===s||9===s))-1===i&&-1!==r&&(i=o);else if(44===s){if(-1===r)throw SyntaxError(`Unexpected character at index ${o}`);-1===i&&(i=o);let n=e.slice(r,i);if(t.has(n))throw SyntaxError(`The "${n}" subprotocol is duplicated`);t.add(n),r=i=-1}else throw SyntaxError(`Unexpected character at index ${o}`)}if(-1===r||-1!==i)throw SyntaxError("Unexpected end of input");let s=e.slice(r,o);if(t.has(s))throw SyntaxError(`The "${s}" subprotocol is duplicated`);return t.add(s),t}}},94568:(e,t,r)=>{"use strict";let{isUtf8:n}=r(14300),{hasBlob:i}=r(39353);function o(e){let t=e.length,r=0;for(;r<t;)if((128&e[r])==0)r++;else if((224&e[r])==192){if(r+1===t||(192&e[r+1])!=128||(254&e[r])==192)return!1;r+=2}else if((240&e[r])==224){if(r+2>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||224===e[r]&&(224&e[r+1])==128||237===e[r]&&(224&e[r+1])==160)return!1;r+=3}else{if((248&e[r])!=240||r+3>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||(192&e[r+3])!=128||240===e[r]&&(240&e[r+1])==128||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}if(e.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:o,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},n)e.exports.isValidUTF8=function(e){return e.length<24?o(e):n(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=r(93739);e.exports.isValidUTF8=function(e){return e.length<32?o(e):t(e)}}catch(e){}},30359:(e,t,r)=>{"use strict";let n=r(82361),i=r(13685),{Duplex:o}=r(12781),{createHash:s}=r(6113),a=r(49964),l=r(97959),c=r(62444),u=r(46342),{CLOSE_TIMEOUT:d,GUID:p,kWebSocket:h}=r(39353),f=/^[+/0-9A-Za-z]{22}==$/;class m extends n{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:d,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:u,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{let r=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":r.length,"Content-Type":"text/plain"}),t.end(r)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let r of Object.keys(t))e.on(r,t[r]);return function(){for(let r of Object.keys(t))e.removeListener(r,t[r])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,r,n)=>{this.handleUpgrade(t,r,n,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(g,this);return}if(e&&this.once("close",e),1!==this._state){if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(g,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{g(this)})}}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,n){t.on("error",y);let i=e.headers["sec-websocket-key"],o=e.headers.upgrade,s=+e.headers["sec-websocket-version"];if("GET"!==e.method){b(this,e,t,405,"Invalid HTTP method");return}if(void 0===o||"websocket"!==o.toLowerCase()){b(this,e,t,400,"Invalid Upgrade header");return}if(void 0===i||!f.test(i)){b(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(13!==s&&8!==s){b(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){v(t,400);return}let u=e.headers["sec-websocket-protocol"],d=new Set;if(void 0!==u)try{d=c.parse(u)}catch(r){b(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let p=e.headers["sec-websocket-extensions"],h={};if(this.options.perMessageDeflate&&void 0!==p){let r=new l(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=a.parse(p);e[l.extensionName]&&(r.accept(e[l.extensionName]),h[l.extensionName]=r)}catch(r){b(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let o={origin:e.headers[`${8===s?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length){this.options.verifyClient(o,(o,s,a,l)=>{if(!o)return v(t,s||401,a,l);this.completeUpgrade(h,i,d,e,t,r,n)});return}if(!this.options.verifyClient(o))return v(t,401)}this.completeUpgrade(h,i,d,e,t,r,n)}completeUpgrade(e,t,r,n,i,o,c){if(!i.readable||!i.writable)return i.destroy();if(i[h])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return v(i,503);let u=s("sha1").update(t+p).digest("base64"),d=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${u}`],f=new this.options.WebSocket(null,void 0,this.options);if(r.size){let e=this.options.handleProtocols?this.options.handleProtocols(r,n):r.values().next().value;e&&(d.push(`Sec-WebSocket-Protocol: ${e}`),f._protocol=e)}if(e[l.extensionName]){let t=e[l.extensionName].params,r=a.format({[l.extensionName]:[t]});d.push(`Sec-WebSocket-Extensions: ${r}`),f._extensions=e}this.emit("headers",d,n),i.write(d.concat("\r\n").join("\r\n")),i.removeListener("error",y),f.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(g,this)})),c(f,n)}}function g(e){e._state=2,e.emit("close")}function y(){this.destroy()}function v(e,t,r,n){r=r||i.STATUS_CODES[t],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r
`+Object.keys(n).map(e=>`${e}: ${n[e]}`).join("\r\n")+"\r\n\r\n"+r)}function b(e,t,r,n,i,o){if(e.listenerCount("wsClientError")){let n=Error(i);Error.captureStackTrace(n,b),e.emit("wsClientError",n,r,t)}else v(r,n,i,o)}e.exports=m},46342:(e,t,r)=>{"use strict";let n=r(82361),i=r(95687),o=r(13685),s=r(41808),a=r(24404),{randomBytes:l,createHash:c}=r(6113),{Duplex:u,Readable:d}=r(12781),{URL:p}=r(57310),h=r(97959),f=r(83958),m=r(74036),{isBlob:g}=r(94568),{BINARY_TYPES:y,CLOSE_TIMEOUT:v,EMPTY_BUFFER:b,GUID:_,kForOnEventAttribute:E,kListener:w,kStatusCode:x,kWebSocket:S,NOOP:T}=r(39353),{EventTarget:{addEventListener:A,removeEventListener:C}}=r(91368),{format:O,parse:I}=r(49964),{toBuffer:N}=r(17878),k=Symbol("kAborted"),R=[8,13],P=["CONNECTING","OPEN","CLOSING","CLOSED"],j=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class M extends n{constructor(e,t,r){super(),this._binaryType=y[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=b,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=M.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(r=t,t=[]):t=[t]),function e(t,r,n,s){let a,u,d,f;let m={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:v,protocolVersion:R[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=m.autoPong,t._closeTimeout=m.closeTimeout,!R.includes(m.protocolVersion))throw RangeError(`Unsupported protocol version: ${m.protocolVersion} (supported versions: ${R.join(", ")})`);if(r instanceof p)a=r;else try{a=new p(r)}catch(e){throw SyntaxError(`Invalid URL: ${r}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),t._url=a.href;let g="wss:"===a.protocol,y="ws+unix:"===a.protocol;if("ws:"===a.protocol||g||y?y&&!a.pathname?u="The URL's pathname is empty":a.hash&&(u="The URL contains a fragment identifier"):u='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',u){let e=SyntaxError(u);if(0===t._redirects)throw e;D(t,e);return}let b=g?443:80,E=l(16).toString("base64"),w=g?i.request:o.request,x=new Set;if(m.createConnection=m.createConnection||(g?L:U),m.defaultPort=m.defaultPort||b,m.port=a.port||b,m.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,m.headers={...m.headers,"Sec-WebSocket-Version":m.protocolVersion,"Sec-WebSocket-Key":E,Connection:"Upgrade",Upgrade:"websocket"},m.path=a.pathname+a.search,m.timeout=m.handshakeTimeout,m.perMessageDeflate&&(d=new h(!0!==m.perMessageDeflate?m.perMessageDeflate:{},!1,m.maxPayload),m.headers["Sec-WebSocket-Extensions"]=O({[h.extensionName]:d.offer()})),n.length){for(let e of n){if("string"!=typeof e||!j.test(e)||x.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");x.add(e)}m.headers["Sec-WebSocket-Protocol"]=n.join(",")}if(m.origin&&(m.protocolVersion<13?m.headers["Sec-WebSocket-Origin"]=m.origin:m.headers.Origin=m.origin),(a.username||a.password)&&(m.auth=`${a.username}:${a.password}`),y){let e=m.path.split(":");m.socketPath=e[0],m.path=e[1]}if(m.followRedirects){if(0===t._redirects){t._originalIpc=y,t._originalSecure=g,t._originalHostOrSocketPath=y?m.socketPath:a.host;let e=s&&s.headers;if(s={...s,headers:{}},e)for(let[t,r]of Object.entries(e))s.headers[t.toLowerCase()]=r}else if(0===t.listenerCount("redirect")){let e=y?!!t._originalIpc&&m.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&a.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||g)||(delete m.headers.authorization,delete m.headers.cookie,e||delete m.headers.host,m.auth=void 0)}m.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(m.auth).toString("base64")),f=t._req=w(m),t._redirects&&t.emit("redirect",t.url,f)}else f=t._req=w(m);m.timeout&&f.on("timeout",()=>{G(t,f,"Opening handshake has timed out")}),f.on("error",e=>{null===f||f[k]||(f=t._req=null,D(t,e))}),f.on("response",i=>{let o=i.headers.location,a=i.statusCode;if(o&&m.followRedirects&&a>=300&&a<400){let i;if(++t._redirects>m.maxRedirects){G(t,f,"Maximum redirects exceeded");return}f.abort();try{i=new p(o,r)}catch(e){D(t,SyntaxError(`Invalid URL: ${o}`));return}e(t,i,n,s)}else t.emit("unexpected-response",f,i)||G(t,f,`Unexpected server response: ${i.statusCode}`)}),f.on("upgrade",(e,r,n)=>{let i;if(t.emit("upgrade",e),t.readyState!==M.CONNECTING)return;f=t._req=null;let o=e.headers.upgrade;if(void 0===o||"websocket"!==o.toLowerCase()){G(t,r,"Invalid Upgrade header");return}let s=c("sha1").update(E+_).digest("base64");if(e.headers["sec-websocket-accept"]!==s){G(t,r,"Invalid Sec-WebSocket-Accept header");return}let a=e.headers["sec-websocket-protocol"];if(void 0!==a?x.size?x.has(a)||(i="Server sent an invalid subprotocol"):i="Server sent a subprotocol but none was requested":x.size&&(i="Server sent no subprotocol"),i){G(t,r,i);return}a&&(t._protocol=a);let l=e.headers["sec-websocket-extensions"];if(void 0!==l){let e;if(!d){G(t,r,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}try{e=I(l)}catch(e){G(t,r,"Invalid Sec-WebSocket-Extensions header");return}let n=Object.keys(e);if(1!==n.length||n[0]!==h.extensionName){G(t,r,"Server indicated an extension that was not requested");return}try{d.accept(e[h.extensionName])}catch(e){G(t,r,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[h.extensionName]=d}t.setSocket(r,n,{allowSynchronousEvents:m.allowSynchronousEvents,generateMask:m.generateMask,maxPayload:m.maxPayload,skipUTF8Validation:m.skipUTF8Validation})}),m.finishRequest?m.finishRequest(f,t):f.end()}(this,e,t,r)):(this._autoPong=r.autoPong,this._closeTimeout=r.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){y.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let n=new f({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),i=new m(e,this._extensions,r.generateMask);this._receiver=n,this._sender=i,this._socket=e,n[S]=this,i[S]=this,e[S]=this,n.on("conclude",q),n.on("drain",B),n.on("error",H),n.on("message",$),n.on("ping",z),n.on("pong",J),i.onerror=K,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",X),e.on("data",Z),e.on("end",Q),e.on("error",ee),this._readyState=M.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=M.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[h.extensionName]&&this._extensions[h.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=M.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==M.CLOSED){if(this.readyState===M.CONNECTING){G(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===M.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=M.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Y(this)}}pause(){this.readyState!==M.CONNECTING&&this.readyState!==M.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN){F(this,e,r);return}void 0===t&&(t=!this._isServer),this._sender.ping(e||b,t,r)}pong(e,t,r){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN){F(this,e,r);return}void 0===t&&(t=!this._isServer),this._sender.pong(e||b,t,r)}resume(){this.readyState!==M.CONNECTING&&this.readyState!==M.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN){F(this,e,r);return}let n={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[h.extensionName]||(n.compress=!1),this._sender.send(e||b,n,r)}terminate(){if(this.readyState!==M.CLOSED){if(this.readyState===M.CONNECTING){G(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=M.CLOSING,this._socket.destroy())}}}function D(e,t){e._readyState=M.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function U(e){return e.path=e.socketPath,s.connect(e)}function L(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=s.isIP(e.host)?"":e.host),a.connect(e)}function G(e,t,r){e._readyState=M.CLOSING;let n=Error(r);Error.captureStackTrace(n,G),t.setHeader?(t[k]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(D,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function F(e,t,r){if(t){let r=g(t)?t.size:N(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${P[e.readyState]})`);process.nextTick(r,t)}}function q(e,t){let r=this[S];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[S]&&(r._socket.removeListener("data",Z),process.nextTick(W,r._socket),1005===e?r.close():r.close(e,t))}function B(){let e=this[S];e.isPaused||e._socket.resume()}function H(e){let t=this[S];void 0!==t._socket[S]&&(t._socket.removeListener("data",Z),process.nextTick(W,t._socket),t.close(e[x])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function V(){this[S].emitClose()}function $(e,t){this[S].emit("message",e,t)}function z(e){let t=this[S];t._autoPong&&t.pong(e,!this._isServer,T),t.emit("ping",e)}function J(e){this[S].emit("pong",e)}function W(e){e.resume()}function K(e){let t=this[S];t.readyState===M.CLOSED||(t.readyState===M.OPEN&&(t._readyState=M.CLOSING,Y(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function Y(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),e._closeTimeout)}function X(){let e=this[S];if(this.removeListener("close",X),this.removeListener("data",Z),this.removeListener("end",Q),e._readyState=M.CLOSING,!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&0!==this._readableState.length){let t=this.read(this._readableState.length);e._receiver.write(t)}e._receiver.end(),this[S]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",V),e._receiver.on("finish",V))}function Z(e){this[S]._receiver.write(e)||this.pause()}function Q(){let e=this[S];e._readyState=M.CLOSING,e._receiver.end(),this.end()}function ee(){let e=this[S];this.removeListener("error",ee),this.on("error",T),e&&(e._readyState=M.CLOSING,this.destroy())}Object.defineProperty(M,"CONNECTING",{enumerable:!0,value:P.indexOf("CONNECTING")}),Object.defineProperty(M.prototype,"CONNECTING",{enumerable:!0,value:P.indexOf("CONNECTING")}),Object.defineProperty(M,"OPEN",{enumerable:!0,value:P.indexOf("OPEN")}),Object.defineProperty(M.prototype,"OPEN",{enumerable:!0,value:P.indexOf("OPEN")}),Object.defineProperty(M,"CLOSING",{enumerable:!0,value:P.indexOf("CLOSING")}),Object.defineProperty(M.prototype,"CLOSING",{enumerable:!0,value:P.indexOf("CLOSING")}),Object.defineProperty(M,"CLOSED",{enumerable:!0,value:P.indexOf("CLOSED")}),Object.defineProperty(M.prototype,"CLOSED",{enumerable:!0,value:P.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(M.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(M.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[E])return t[w];return null},set(t){for(let t of this.listeners(e))if(t[E]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[E]:!0})}})}),M.prototype.addEventListener=A,M.prototype.removeEventListener=C,e.exports=M},2998:(e,t,r)=>{"use strict";r.d(t,{default:()=>tp});var n,i,o=r(10326),s=r(17577),a=r.n(s);(function(e){e.PROMPT_INPUT="PROMPT_INPUT",e.IMAGE_GENERATOR="IMAGE_GENERATOR",e.STORYBOARD_GENERATOR="STORYBOARD_GENERATOR",e.VIDEO_GENERATOR="VIDEO_GENERATOR",e.VIDEO_ANALYZER="VIDEO_ANALYZER",e.IMAGE_EDITOR="IMAGE_EDITOR",e.AUDIO_GENERATOR="AUDIO_GENERATOR",e.SCRIPT_MASTER="SCRIPT_MASTER"})(n||(n={})),function(e){e.IDLE="IDLE",e.WORKING="WORKING",e.SUCCESS="SUCCESS",e.ERROR="ERROR"}(i||(i={}));var l=r(80851);/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,l.Z)("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),u=(0,l.Z)("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),d=(0,l.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),p=(0,l.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),h=(0,l.Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),f=(0,l.Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),m=(0,l.Z)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),g=(0,l.Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),y=(0,l.Z)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),v=(0,l.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),b=(0,l.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),_=(0,l.Z)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]),E=(0,l.Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),w=(0,l.Z)("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]);var x=r(98091),S=r(53777);/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let T=(0,l.Z)("ScanFace",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["path",{d:"M9 9h.01",key:"1q5me6"}],["path",{d:"M15 9h.01",key:"x1ddxp"}]]),A=(0,l.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),C=(0,l.Z)("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),O=(0,l.Z)("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),I=(0,l.Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),N=(0,l.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var k=r(83855);/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let R=(0,l.Z)("Clapperboard",[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]]),P=(0,l.Z)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),j=(0,l.Z)("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]),M=(0,l.Z)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),D=(0,l.Z)("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),U=(0,l.Z)("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),L=(0,l.Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),G=(0,l.Z)("Scaling",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M14 15H9v-5",key:"pi4jk9"}],["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M21 3 9 15",key:"15kdhq"}]]);var F=r(48998);/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let q=(0,l.Z)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),B=e=>{switch(e){case n.IMAGE_GENERATOR:case n.STORYBOARD_GENERATOR:return[{id:"gemini-3-pro-image-preview",label:"Nano Banana Pro"},{id:"gemini-2.5-flash-image",label:"Nano Banana"}];case n.VIDEO_GENERATOR:return[{id:"veo-3.1-fast-generate-preview",label:"Veo 3.1 Fast"},{id:"veo-3.1-generate-preview",label:"Veo 3.1 High Quality"}];case n.SCRIPT_MASTER:case n.PROMPT_INPUT:case n.VIDEO_ANALYZER:case n.AUDIO_GENERATOR:default:return[{id:"gemini-3-pro-preview",label:"Gemini 3 Pro"},{id:"gemini-3-flash-preview",label:"Gemini 3"}]}},H=["4:3","9:16","16:9","21:9"],V=["9:16","16:9"],$=["720P","1080P","2K"],z=["720P","1080P","4K"],J=[5,10,15],W=[{id:"zoom_in",label:"",icon:c,prompt:"Slowly zoom in towards the subject."},{id:"zoom_out",label:"",icon:u,prompt:"Slowly zoom out from the subject."},{id:"pan_left",label:"",icon:d,prompt:"Pan the camera to the left."},{id:"pan_right",label:"",icon:p,prompt:"Pan the camera to the right."},{id:"tilt_up",label:"",icon:h,prompt:"Tilt the camera upwards."},{id:"tilt_down",label:"",icon:f,prompt:"Tilt the camera downwards."},{id:"orbital",label:"",icon:m,prompt:"360 degree orbital camera movement around the subject."},{id:"crane",label:"",icon:g,prompt:"Vertical crane shot moving upwards."}],K=(0,s.memo)(({node:e,onUpdate:t,onAction:a,onDelete:l,onExpand:u,onCrop:d,onNodeMouseDown:p,onPortMouseDown:h,onPortMouseUp:m,onNodeContextMenu:g,onResizeMouseDown:K,isSelected:Y,onSelect:X,onSaveCharacter:Z})=>{let Q=e.status===i.WORKING,ee=(0,s.useRef)(null),[et,er]=(0,s.useState)(!1),[en,ei]=(0,s.useState)(!1),[eo,es]=(0,s.useState)(e.data.prompt||""),[ea,el]=(0,s.useState)(!1),ec=(0,s.useCallback)(async()=>{if(eo.trim()&&!ea){el(!0);try{let{expandVisualDescription:n}=await Promise.resolve().then(r.bind(r,6737)),i=await n(eo,"gemini-3-flash-preview");es(i),t(e.id,{prompt:i})}catch(e){console.error("Prompt enhancement failed",e)}finally{el(!1)}}},[eo,ea,t,e.id]),eu=(0,s.useCallback)(t=>{let r=t.target;if(r?.closest('[data-node-control="true"]')){t.stopPropagation(),X?.(e.id);return}p(t,e.id)},[e.id,p,X]),[ed,ep]=(0,s.useState)(!1),[eh,ef]=(0,s.useState)(!1),[em,eg]=(0,s.useState)(!1),[ey,ev]=(0,s.useState)(!1),[eb,e_]=(0,s.useState)(!1),[eE,ew]=(0,s.useState)(!1),ex=ed||eh||em||ey||eb||eE,eS=(0,s.useRef)(null),eT=(0,s.useCallback)(e=>{e.stopPropagation()},[]);(0,s.useEffect)(()=>{es(e.data.prompt||"")},[e.data.prompt]);let eA=async(r,i="image")=>{let o=r.target.files;if(o&&0!==o.length){if("sourceScript"===i){let n=o[0],i=new FileReader;i.onload=r=>{let n=r.target?.result;t(e.id,{displayResult:n})},i.readAsText(n),r.target.value="";return}if(e.type===n.IMAGE_GENERATOR&&"I2I"===e.data.imageMode||e.type===n.VIDEO_GENERATOR&&"T2V"!==e.data.videoMode){let r=[...e.data.images||[]];for(let e=0;e<o.length;e++){let t=o[e],n=new FileReader,i=await new Promise(e=>{n.onload=t=>e(t.target?.result),n.readAsDataURL(t)});r.push(i)}t(e.id,{images:r.slice(0,5),image:r[0]})}else{let r=o[0],n=new FileReader;n.onload=r=>{let n=r.target?.result,i=new Image;i.onload=()=>{let r=i.naturalWidth/i.naturalHeight;t(e.id,{image:n,images:[n]},{width:420,height:Math.max(380,420/r)})},i.src=n},n.readAsDataURL(r)}r.target.value=""}},eC=r=>{r.preventDefault();let i=r.dataTransfer.getData("assetType"),o=r.dataTransfer.getData("assetSrc");if(o){if(e.type===n.IMAGE_GENERATOR){if("I2I"===e.data.imageMode){let r=e.data.images||[];r.includes(o)||t(e.id,{images:[...r,o].slice(0,5),image:o})}else t(e.id,{image:o,images:[o]})}else if(e.type===n.VIDEO_GENERATOR){if("image"===i){if("T2V"===(e.data.videoMode||"T2V"))t(e.id,{videoMode:"I2V",image:o,images:[o]});else if("FIRST_LAST_FRAME"===e.data.generationMode)t(e.id,{lastFrameImage:o});else{let r=e.data.images||[];t(e.id,{images:[...r,o].slice(0,3),image:o})}}else"video"===i&&t(e.id,{videoUri:o})}}},eO=t=>{let r;let i="png";if(e.type===n.VIDEO_GENERATOR?(r=e.data.videoUri,i="mp4"):(r=e.data.image,i="png"),!r)return;let o=document.createElement("a");o.href=r;let s=t?`_${t}`:"";o.download=`${e.title||"asset"}${s}.${i}`,document.body.appendChild(o),o.click(),document.body.removeChild(o),ew(!1)},eI=()=>{let r=e.data.scriptMode||"CREATE",n=e.data.remixedScript,i=e.data.displayResult;return(0,o.jsxs)("div",{className:"w-full h-full p-4 flex flex-col gap-3",children:[o.jsx("div",{className:"flex bg-black/40 p-1 rounded-xl border border-white/5 w-full shrink-0",children:[{id:"CREATE",label:"",icon:y},{id:"REMIX",label:"",icon:v},{id:"DESCRIBE",label:"",icon:b}].map(n=>(0,o.jsxs)("button",{onClick:r=>{r.stopPropagation(),t(e.id,{scriptMode:n.id})},className:`flex-1 flex flex-col items-center gap-1.5 py-2 rounded-lg transition-all ${r===n.id?"bg-[#3a3a3c] text-white shadow-xl ring-1 ring-white/10":"text-slate-500 hover:text-slate-300"}`,children:[o.jsx(n.icon,{size:14,className:r===n.id?"text-cyan-400":""}),o.jsx("span",{className:"text-[9px] font-bold",children:n.label})]},n.id))}),(0,o.jsxs)("div",{className:"flex flex-col gap-2 shrink-0",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between px-1",children:[o.jsx("span",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest opacity-60",children:"REMIX"===r?"":""}),o.jsx("div",{className:"flex items-center gap-2",children:(0,o.jsxs)("button",{onClick:e=>{e.stopPropagation(),eS.current?.click()},className:"flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 hover:bg-white/10 text-[9px] font-bold text-slate-400 transition-colors",children:[o.jsx(_,{size:10})," "]})})]}),o.jsx("textarea",{className:"flex-1 bg-black/40 rounded-xl text-[11px] text-slate-300 p-3 focus:outline-none resize-none border border-white/5 custom-scrollbar min-h-24",placeholder:"REMIX"===r?"...":"DESCRIBE"===r?"...":"...",value:i||"",onMouseDown:e=>e.stopPropagation(),onChange:r=>t(e.id,{displayResult:r.target.value})})]}),o.jsx("div",{className:`flex-1 min-h-0 bg-black/30 rounded-2xl border border-white/5 p-4 overflow-y-auto custom-scrollbar flex flex-col ${n||Q?"":"items-center justify-center"}`,onWheel:eT,children:Q?(0,o.jsxs)("div",{className:"flex flex-col items-center gap-4 m-auto text-center opacity-50",children:[o.jsx(E,{className:"animate-spin text-[#ffb400]",size:32}),o.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"..."})]}):n?o.jsx("div",{className:"w-full h-full text-xs text-slate-300 whitespace-pre-wrap leading-relaxed animate-in fade-in duration-500 select-text cursor-text",children:n}):(0,o.jsxs)("div",{className:"flex flex-col items-center gap-3 opacity-20 pointer-events-none text-center",children:[o.jsx(w,{size:48,strokeWidth:1}),o.jsx("span",{className:"text-[10px] font-bold tracking-widest",children:"..."})]})}),o.jsx("input",{type:"file",ref:eS,className:"hidden",accept:".txt,.doc,.docx",onChange:e=>eA(e,"sourceScript")})]})},eN=()=>{let r=e.data.cinematicVersion||"V1",n=!!e.data.image;return(0,o.jsxs)("div",{className:"w-full h-full p-4 flex flex-col gap-4",onDragOver:e=>e.preventDefault(),onDrop:eC,children:[o.jsx("div",{className:"flex items-center justify-center w-full py-2",children:o.jsx("div",{className:"flex gap-1 bg-black/40 p-1 rounded-full border border-white/5",children:["V1","V2","V3"].map(n=>(0,o.jsxs)("button",{onClick:r=>{r.stopPropagation(),t(e.id,{cinematicVersion:n})},className:`px-4 py-1 rounded-full text-[10px] font-black transition-all whitespace-nowrap ${r===n?"bg-cyan-500 text-black shadow-lg shadow-cyan-500/20":"text-slate-500 hover:text-slate-300"}`,children:[n," ","V1"===n?"":"V2"===n?"":""]},n))})}),n?(0,o.jsxs)("div",{className:"flex-1 w-full relative group/media overflow-hidden rounded-2xl border border-white/10 bg-black/20",children:[o.jsx("img",{src:e.data.image,className:"w-full h-full object-contain"}),o.jsx("button",{onClick:r=>{r.stopPropagation(),t(e.id,{image:void 0})},className:"absolute top-2 right-2 p-1.5 bg-black/60 rounded-full text-white/70 hover:text-red-400 opacity-0 group-hover/media:opacity-100 transition-opacity",children:o.jsx(x.Z,{size:12})})]}):(0,o.jsxs)("div",{className:"flex-1 w-full relative rounded-2xl border-2 border-dashed border-white/10 bg-white/5 flex flex-col items-center justify-center text-slate-500 gap-3 group/slot hover:border-white/20 transition-all cursor-pointer",onClick:e=>{e.stopPropagation(),eS.current?.click()},children:[o.jsx(S.Z,{size:48,strokeWidth:1,className:"opacity-50 group-hover/slot:opacity-80 transition-opacity"}),o.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] opacity-50",children:""})]}),o.jsx("input",{type:"file",ref:eS,className:"hidden",accept:"image/*",onChange:e=>eA(e)})]})},ek=()=>{let r=!!e.data.image&&e.status===i.SUCCESS,n=e.data.images||[],s=e.data.imageMode||"T2I";return r?(0,o.jsxs)("div",{className:"w-full h-full relative group/media overflow-hidden flex items-center justify-center bg-black",onDragOver:e=>e.preventDefault(),onDrop:eC,children:[o.jsx("img",{src:e.data.image,className:"w-full h-full object-contain cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/inkai-media",JSON.stringify({src:e.data.image,type:"image"})),t.dataTransfer.effectAllowed="copy"},onMouseDown:e=>e.stopPropagation()}),(0,o.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2 opacity-0 group-hover/media:opacity-100 transition-opacity",children:[Z&&o.jsx("button",{onClick:t=>{t.stopPropagation();let r=prompt("","");r&&Z(r,eo,e.data.image)},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-purple-400 shadow-xl",title:"",children:o.jsx(T,{size:14})}),(0,o.jsxs)("div",{className:"relative",children:[o.jsx("button",{onClick:e=>{e.stopPropagation(),ew(!eE)},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-cyan-400 shadow-xl",children:o.jsx(A,{size:14})}),eE&&o.jsx("div",{className:"absolute top-full right-0 mt-2 w-32 bg-[#1c1c1e] border border-white/10 rounded-xl p-1 shadow-2xl z-50 overflow-hidden animate-in zoom-in-95",children:$.map(e=>o.jsx("button",{onClick:t=>{t.stopPropagation(),eO(e)},className:"w-full text-left px-3 py-2 rounded-lg text-[10px] font-bold text-slate-400 hover:bg-white/5 hover:text-white transition-colors",children:e},e))})]}),o.jsx("button",{onClick:r=>{r.stopPropagation(),t(e.id,{image:void 0,images:void 0})},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-red-400 shadow-xl",children:o.jsx(x.Z,{size:14})})]})]}):(0,o.jsxs)("div",{className:"w-full h-full p-4 flex flex-col gap-4",onDragOver:e=>e.preventDefault(),onDrop:eC,children:[o.jsx("div",{className:"flex bg-black/40 p-1 rounded-xl border border-white/5 w-full shrink-0",children:[{id:"T2I",label:"",icon:C},{id:"I2I",label:"",icon:O}].map(r=>(0,o.jsxs)("button",{onClick:n=>{n.stopPropagation(),t(e.id,{imageMode:r.id,images:[],image:void 0})},className:`flex-1 flex flex-col items-center gap-1 py-1.5 rounded-lg transition-all ${s===r.id?"bg-[#3a3a3c] text-white shadow-xl ring-1 ring-white/10":"text-slate-500 hover:text-slate-300"}`,children:[o.jsx(r.icon,{size:13,className:s===r.id?"text-cyan-400":""}),o.jsx("span",{className:"text-[8px] font-black",children:r.label})]},r.id))}),o.jsx("div",{className:"flex-1 min-h-0 relative",children:"T2I"===s?(0,o.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center opacity-20 gap-3 border border-white/5 rounded-2xl bg-black/20",children:[o.jsx(I,{size:48,strokeWidth:1}),o.jsx("span",{className:"text-[10px] font-black tracking-[0.2em] uppercase",children:"Ready to Create"})]}):(0,o.jsxs)("div",{className:`w-full h-full relative rounded-xl border-2 border-dashed transition-all flex flex-col items-center justify-center group/slot overflow-hidden ${n.length>0?"border-cyan-500/30 bg-cyan-500/5":"border-white/10 bg-white/5 hover:border-white/20"}`,children:[n.length>0?(0,o.jsxs)("div",{className:"w-full h-full flex flex-col p-2 gap-2 overflow-hidden bg-black/20 relative",children:[o.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:o.jsx("img",{src:n[0],className:"max-w-full max-h-full object-contain cursor-grab active:cursor-grabbing",draggable:!0,onMouseDown:e=>e.stopPropagation(),onDragStart:e=>{e.dataTransfer.setData("application/inkai-media",JSON.stringify({src:n[0],type:"image"})),e.dataTransfer.effectAllowed="copy"}})}),"I2I"===s&&(0,o.jsxs)("div",{className:"flex gap-2 overflow-x-auto custom-scrollbar pb-1",children:[n.map((r,i)=>(0,o.jsxs)("div",{className:"w-12 h-12 rounded bg-black/40 border border-white/10 shrink-0 relative group/thumb",children:[o.jsx("img",{src:r,className:"w-full h-full object-cover rounded cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("application/inkai-media",JSON.stringify({src:r,type:"image"})),e.dataTransfer.effectAllowed="copy"},onMouseDown:e=>e.stopPropagation()}),o.jsx("button",{onClick:r=>{r.stopPropagation(),t(e.id,{images:n.filter((e,t)=>t!==i)})},className:"absolute -top-1 -right-1 p-0.5 bg-red-500 rounded-full text-white opacity-0 group-hover/thumb:opacity-100 transition-opacity",children:o.jsx(N,{size:8})})]},i)),o.jsx("button",{onClick:e=>{e.stopPropagation(),eS.current?.click()},className:"w-12 h-12 rounded border border-dashed border-white/20 flex items-center justify-center text-slate-500 hover:text-white transition-colors",children:o.jsx(k.Z,{size:16})})]}),o.jsx("button",{onClick:r=>{r.stopPropagation(),t(e.id,{image:void 0,images:void 0})},className:"absolute top-2 right-2 p-1.5 bg-black/60 rounded-full text-white/70 hover:text-red-400 opacity-0 group-hover/slot:opacity-100 transition-opacity",children:o.jsx(x.Z,{size:12})})]}):(0,o.jsxs)("div",{className:"flex flex-col items-center gap-3 text-slate-500 cursor-pointer p-10 text-center",onClick:e=>{e.stopPropagation(),eS.current?.click()},children:[o.jsx(O,{size:32,strokeWidth:1}),o.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest leading-relaxed",children:"I2I"===s?"":""})]}),o.jsx("input",{type:"file",ref:eS,className:"hidden",accept:"image/*",multiple:"I2I"===s,onChange:e=>eA(e)})]})})]})},eR=()=>{let r=e.data.videoMode||"T2V",n=e.data.generationMode||"DEFAULT",s=!!e.data.videoUri&&e.status===i.SUCCESS,a=e.data.images||[],l=e.data.lastFrameImage;return s?(0,o.jsxs)("div",{className:"w-full h-full relative group/media overflow-hidden",onDragOver:e=>e.preventDefault(),onDrop:eC,children:[o.jsx("video",{ref:ee,src:e.data.videoUri,className:"w-full h-full object-cover bg-zinc-900",loop:!0,muted:!1,onMouseEnter:()=>{ee.current&&(ee.current.muted=!1,ee.current.play().catch(()=>{}))},onMouseLeave:()=>{ee.current&&(ee.current.pause(),ee.current.currentTime=0,ee.current.muted=!0)}}),(0,o.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2 opacity-0 group-hover/media:opacity-100 transition-opacity",children:[o.jsx("button",{onClick:e=>{e.stopPropagation(),eO()},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-cyan-400 shadow-xl",title:"",children:o.jsx(A,{size:14})}),o.jsx("button",{onClick:r=>{r.stopPropagation(),t(e.id,{videoUri:void 0,videoMetadata:void 0})},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-red-400",children:o.jsx(x.Z,{size:14})})]})]}):(0,o.jsxs)("div",{className:"w-full h-full p-4 flex flex-col gap-3",onDragOver:e=>e.preventDefault(),onDrop:eC,children:[o.jsx("div",{className:"flex bg-black/40 p-1 rounded-xl border border-white/5 w-full shrink-0",children:[{id:"T2V",label:"",icon:R},{id:"I2V",label:"",icon:P},{id:"DIRECTOR",label:"",icon:j}].map(n=>(0,o.jsxs)("button",{onClick:r=>{r.stopPropagation(),t(e.id,{videoMode:n.id,images:[],image:void 0,generationMode:"DEFAULT"})},className:`flex-1 flex flex-col items-center gap-1 py-1.5 rounded-lg transition-all ${r===n.id?"bg-[#3a3a3c] text-white shadow-xl ring-1 ring-white/10":"text-slate-500 hover:text-slate-300"}`,children:[o.jsx(n.icon,{size:13,className:r===n.id?"text-purple-400":""}),o.jsx("span",{className:"text-[8px] font-black",children:n.label})]},n.id))}),"DIRECTOR"===r&&o.jsx("div",{className:"flex bg-black/40 p-0.5 rounded-lg border border-white/5 w-full overflow-x-auto custom-scrollbar shrink-0",children:[{id:"CONTINUE",label:"",icon:v},{id:"FIRST_LAST_FRAME",label:"",icon:M},{id:"CUT",label:"",icon:D},{id:"CHARACTER_REF",label:"",icon:T}].map(r=>(0,o.jsxs)("button",{onClick:n=>{n.stopPropagation(),t(e.id,{generationMode:r.id})},className:`flex-1 flex items-center justify-center gap-1.5 py-1 px-2 rounded transition-all whitespace-nowrap ${n===r.id?"bg-purple-500/20 text-purple-200":"text-slate-500 hover:text-slate-300"}`,children:[o.jsx(r.icon,{size:10}),o.jsx("span",{className:"text-[8px] font-bold",children:r.label})]},r.id))}),o.jsx("div",{className:"flex-1 min-h-0 relative",children:"T2V"===r?(0,o.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center opacity-20 gap-3 border border-white/5 rounded-2xl bg-black/20",children:[o.jsx(P,{size:48,strokeWidth:1}),o.jsx("span",{className:"text-[10px] font-black tracking-[0.2em] uppercase",children:"Cinema Ready"})]}):(0,o.jsxs)("div",{className:"flex-1 min-h-0 flex gap-2 h-full",children:[o.jsx("div",{className:`flex-1 relative rounded-xl border-2 border-dashed transition-all flex flex-col items-center justify-center group/slot overflow-hidden ${a.length>0?"border-purple-500/30 bg-purple-500/5":"border-white/10 bg-white/5 hover:border-white/20"}`,children:a.length>0?(0,o.jsxs)("div",{className:"w-full h-full flex flex-col p-2 gap-2 overflow-hidden bg-black/20 relative",children:[o.jsx("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:o.jsx("img",{src:a[0],className:"max-w-full max-h-full object-contain",onMouseDown:e=>e.stopPropagation()})}),(0,o.jsxs)("div",{className:"flex gap-2 overflow-x-auto custom-scrollbar pb-1",children:[a.map((r,n)=>(0,o.jsxs)("div",{className:"w-10 h-10 rounded bg-black/40 border border-white/10 shrink-0 relative group/thumb",children:[o.jsx("img",{src:r,className:"w-full h-full object-cover rounded",onMouseDown:e=>e.stopPropagation()}),o.jsx("button",{onClick:r=>{r.stopPropagation(),t(e.id,{images:a.filter((e,t)=>t!==n)})},className:"absolute -top-1 -right-1 p-0.5 bg-red-500 rounded-full text-white opacity-0 group-hover/thumb:opacity-100 transition-opacity",children:o.jsx(N,{size:8})})]},n)),a.length<3&&o.jsx("button",{onClick:e=>{e.stopPropagation(),eS.current?.click()},className:"w-10 h-10 rounded border border-dashed border-white/20 flex items-center justify-center text-slate-500 hover:text-white transition-colors",children:o.jsx(k.Z,{size:14})})]}),o.jsx("button",{onClick:r=>{r.stopPropagation(),t(e.id,{images:[],image:void 0})},className:"absolute top-2 right-2 p-1.5 bg-black/60 rounded-full text-white/70 hover:text-red-400 opacity-0 group-hover/slot:opacity-100 transition-opacity",children:o.jsx(x.Z,{size:12})})]}):(0,o.jsxs)("div",{className:"flex flex-col items-center gap-1 text-slate-500 cursor-pointer text-center px-4",onClick:e=>{e.stopPropagation(),eS.current?.click()},children:[o.jsx(O,{size:20}),o.jsx("span",{className:"text-[8px] font-black uppercase",children:"FIRST_LAST_FRAME"===n?"":" (1-3)"})]})}),"FIRST_LAST_FRAME"===n&&o.jsx("div",{className:`flex-1 relative rounded-xl border-2 border-dashed transition-all flex flex-col items-center justify-center group/slot2 overflow-hidden ${l?"border-cyan-500/30 bg-cyan-500/5":"border-white/10 bg-white/5 hover:border-white/20"}`,children:l?(0,o.jsxs)("div",{className:"relative w-full h-full group/vpreview2 flex items-center justify-center bg-black",children:[o.jsx("img",{src:l,className:"w-full h-full object-contain",onMouseDown:e=>e.stopPropagation()}),o.jsx("button",{onClick:r=>{r.stopPropagation(),t(e.id,{lastFrameImage:void 0})},className:"absolute top-2 right-2 p-1 bg-black/60 rounded-full text-white/50 hover:text-red-400 opacity-0 group-hover/vpreview2:opacity-100 transition-opacity",children:o.jsx(N,{size:10})}),o.jsx("div",{className:"absolute bottom-1 left-1 px-1 bg-black/60 rounded text-[8px] font-bold text-cyan-400 uppercase",children:"END"})]}):(0,o.jsxs)("div",{className:"flex flex-col items-center gap-1 text-slate-500 cursor-pointer",onClick:r=>{r.stopPropagation();let n=document.createElement("input");n.type="file",n.accept="image/*",n.onchange=async r=>{let n=r.target.files[0];if(n){let r=new FileReader;r.onload=r=>t(e.id,{lastFrameImage:r.target?.result}),r.readAsDataURL(n)}},n.click()},children:[o.jsx(O,{size:20}),o.jsx("span",{className:"text-[8px] font-black uppercase",children:""})]})})]})}),o.jsx("input",{type:"file",ref:eS,className:"hidden",accept:"image/*",multiple:"T2V"!==r,onChange:e=>eA(e)})]})},eP=B(e.type),ej=eP.find(t=>t.id===e.data.model)?.label||"",eM=e.data.aspectRatio||"16:9",eD=e.data.resolution||(e.type===n.IMAGE_GENERATOR||e.type===n.STORYBOARD_GENERATOR?"1080P":"720P"),eU=e.data.duration||5,eL=e.type===n.VIDEO_GENERATOR?V:H;return(0,o.jsxs)("div",{className:`absolute rounded-[28px] group ${Y||et||ex?"z-50 ring-2 ring-cyan-500/50 shadow-[0_0_60px_-10px_rgba(34,211,238,0.4)]":"z-10 ring-1 ring-white/10 hover:ring-white/20"}`,style:{left:e.x,top:e.y,width:e.width||420,height:e.height||380,background:Y?"rgba(28, 28, 30, 0.95)":"rgba(28, 28, 30, 0.75)",transition:"all 0.5s cubic-bezier(0.32, 0.72, 0, 1)",backdropFilter:"blur(32px)"},onMouseDown:eu,onContextMenu:t=>g(t,e.id),onMouseEnter:()=>er(!0),onMouseLeave:()=>{er(!1)},onWheel:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:`absolute -top-10 left-0 w-full flex items-center justify-between px-1 transition-all duration-300 ${Y||et||ex?"opacity-100 translate-y-0":"opacity-0 translate-y-2 pointer-events-none"}`,children:[o.jsx("div",{className:"flex items-center gap-1.5",children:o.jsx("button",{onClick:t=>{t.stopPropagation(),l(e.id)},className:"p-2 bg-red-500/10 rounded-lg text-red-400 hover:bg-red-500/20 transition-all border border-red-500/20",children:o.jsx(x.Z,{size:14})})}),(0,o.jsxs)("div",{className:"flex items-center gap-2 px-4 py-1.5 bg-black/60 border border-white/10 rounded-full backdrop-blur-xl shadow-lg",children:[o.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${Q?"bg-[#ffb400] animate-pulse shadow-[0_0_8px_#ffb400]":"bg-green-500"}`}),o.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-200",children:e.title})]})]}),o.jsx("div",{className:"absolute -left-3 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border border-white/20 bg-[#1c1c1e] flex items-center justify-center cursor-crosshair z-50 hover:scale-125 transition-transform",onMouseDown:t=>h(t,e.id),onMouseUp:t=>m(t,e.id),children:o.jsx(k.Z,{size:12,className:"text-white/50"})}),o.jsx("div",{className:"absolute -right-3 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border border-white/20 bg-[#1c1c1e] flex items-center justify-center cursor-crosshair z-50 hover:scale-125 transition-transform",onMouseDown:t=>h(t,e.id),onMouseUp:t=>m(t,e.id),children:o.jsx(k.Z,{size:12,className:"text-white/50"})}),o.jsx("div",{className:"w-full h-full rounded-[28px] overflow-hidden bg-zinc-950/50 shadow-inner",children:(()=>{if(e.type===n.VIDEO_GENERATOR)return eR();if(e.type===n.IMAGE_GENERATOR)return ek();if(e.type===n.STORYBOARD_GENERATOR)return eN();if(e.type===n.SCRIPT_MASTER)return eI();let t=e.data.displayResult||e.data.analysis;return o.jsx("div",{className:"w-full h-full p-4 flex flex-col",children:o.jsx("div",{className:"flex-1 bg-black/20 rounded-xl border border-white/5 p-3 overflow-y-auto custom-scrollbar text-xs text-slate-300 whitespace-pre-wrap select-text",onMouseDown:e=>e.stopPropagation(),onWheel:eT,children:Q?o.jsx(E,{className:"animate-spin text-cyan-500 m-auto",size:24}):t||"..."})})})()}),o.jsx("div",{className:`absolute top-[96%] left-1/2 -translate-x-1/2 w-[94%] pt-4 z-[9999] flex flex-col items-center transition-all duration-300 ${et||en||Y||ex?"opacity-100 translate-y-0 pointer-events-auto":"opacity-0 translate-y-[-10px] pointer-events-none"}`,onMouseDown:t=>{t.stopPropagation(),X?.(e.id)},onMouseEnter:()=>er(!0),"data-node-control":"true",children:(0,o.jsxs)("div",{className:"w-full rounded-[24px] p-2 flex flex-col gap-2 bg-[#2c2c2e]/95 backdrop-blur-2xl border border-white/10 shadow-2xl",children:[(0,o.jsxs)("div",{className:"relative",children:[o.jsx("textarea",{className:"w-full bg-black/30 rounded-[18px] text-[13px] text-slate-100 p-4 focus:outline-none resize-none min-h-[70px] custom-scrollbar font-medium border border-white/5 focus:border-cyan-500/20 transition-all pr-8",placeholder:e.type===n.SCRIPT_MASTER?"...":"...",value:eo,onMouseDown:e=>e.stopPropagation(),onChange:e=>es(e.target.value),onFocus:()=>ei(!0),onBlur:()=>ei(!1)}),o.jsx("button",{onClick:e=>{e.stopPropagation(),ec()},disabled:ea||!eo,className:`absolute right-2 bottom-2 p-1.5 rounded-lg transition-all ${ea?"bg-amber-500/20 text-amber-400":"bg-white/5 text-slate-400 hover:text-amber-400 hover:bg-amber-500/10"} disabled:opacity-30`,title:"AI  (Magic Enhance)",children:ea?o.jsx(E,{size:12,className:"animate-spin"}):o.jsx(U,{size:12})})]}),(0,o.jsxs)("div",{className:"flex items-center justify-between px-2 pb-1 relative",children:[(0,o.jsxs)("div",{className:"flex-1 min-w-0 flex items-center gap-1.5 overflow-visible py-0.5 flex-wrap",children:[(0,o.jsxs)("div",{className:"relative group/picker",children:[(0,o.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ef(!1),eg(!1),ev(!1),ep(e=>!e)},className:`px-3 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1.5 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ${ed?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"}`,children:[ej,o.jsx(f,{size:10,className:`opacity-50 transition-transform ${ed?"rotate-180":""}`})]}),ed&&o.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-48 bg-[#18181b] border border-white/10 rounded-xl p-1.5 shadow-2xl z-[10001] flex flex-col gap-0.5",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:eP.length>0?eP.map(r=>(0,o.jsxs)("button",{type:"button",onMouseDown:n=>{n.preventDefault(),n.stopPropagation(),t(e.id,{model:r.id}),ep(!1)},className:`w-full text-left px-3 py-2.5 rounded-lg text-[11px] font-bold transition-all flex items-center justify-between z-[10003] ${e.data.model===r.id?"bg-cyan-500 text-black":"text-slate-300 hover:bg-white/10 hover:text-white"}`,children:[r.label,e.data.model===r.id&&o.jsx(L,{size:12})]},r.id)):o.jsx("div",{className:"p-2 text-[10px] text-slate-500 text-center",children:""})})]}),(e.type===n.IMAGE_GENERATOR||e.type===n.VIDEO_GENERATOR||e.type===n.STORYBOARD_GENERATOR)&&(0,o.jsxs)("div",{className:"relative group/picker",children:[(0,o.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ep(!1),eg(!1),ev(!1),ef(e=>!e)},className:`px-3 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1.5 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ${eh?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"}`,children:[o.jsx(G,{size:12,className:"text-cyan-400"}),eM]}),eh&&o.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-28 bg-[#18181b] border border-white/10 rounded-xl p-1.5 shadow-2xl z-[10001] flex flex-col gap-0.5",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:eL.map(r=>o.jsx("button",{type:"button",onMouseDown:n=>{n.preventDefault(),n.stopPropagation(),t(e.id,{aspectRatio:r}),ef(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-[11px] font-bold transition-all z-[10003] ${eM===r?"bg-cyan-500/20 text-cyan-400":"text-slate-300 hover:bg-white/10 hover:text-white"}`,children:r},r))})]}),(e.type===n.IMAGE_GENERATOR||e.type===n.VIDEO_GENERATOR||e.type===n.STORYBOARD_GENERATOR)&&(0,o.jsxs)("div",{className:"relative group/picker",children:[(0,o.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ep(!1),ef(!1),ev(!1),eg(e=>!e)},className:`px-3 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1.5 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ${em?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"}`,children:[o.jsx(c,{size:12,className:"text-purple-400"}),eD]}),em&&o.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-28 bg-[#18181b] border border-white/10 rounded-xl p-1.5 shadow-2xl z-[10001] flex flex-col gap-0.5",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:(e.type===n.IMAGE_GENERATOR||e.type===n.STORYBOARD_GENERATOR?$:z).map(r=>o.jsx("button",{type:"button",onMouseDown:n=>{n.preventDefault(),n.stopPropagation(),t(e.id,{resolution:r}),eg(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-[11px] font-bold transition-all z-[10003] ${eD===r?"bg-purple-500/20 text-purple-400":"text-slate-300 hover:bg-white/10 hover:text-white"}`,children:r},r))})]}),e.type===n.VIDEO_GENERATOR&&(0,o.jsxs)("div",{className:"relative group/picker",children:[(0,o.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ep(!1),ef(!1),eg(!1),ev(e=>!e)},className:`px-2.5 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ${ey?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"}`,children:[o.jsx(F.Z,{size:10,className:"text-amber-400"}),eU,"s"]}),ey&&o.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-28 bg-[#18181b] border border-white/10 rounded-xl p-1.5 shadow-2xl z-[10001] flex flex-col gap-0.5",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:J.map(r=>(0,o.jsxs)("button",{type:"button",onMouseDown:n=>{n.preventDefault(),n.stopPropagation(),t(e.id,{duration:r}),ev(!1)},className:`w-full text-left px-3 py-2 rounded-lg text-[11px] font-bold transition-all z-[10003] ${eU===r?"bg-amber-500/20 text-amber-400":"text-slate-300 hover:bg-white/10 hover:text-white"}`,children:[r,"s"]},r))})]}),e.type===n.VIDEO_GENERATOR&&(0,o.jsxs)("div",{className:"relative group/picker",children:[(0,o.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ep(!1),ef(!1),eg(!1),ev(!1),e_(e=>!e)},className:`px-2.5 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ${eb?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"}`,title:"",children:[o.jsx(b,{size:10,className:"text-emerald-400"}),""]}),eb&&o.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-48 bg-[#18181b] border border-white/10 rounded-xl p-2 shadow-2xl z-[10001] grid grid-cols-2 gap-1",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:W.map(r=>(0,o.jsxs)("button",{type:"button",onMouseDown:n=>{n.preventDefault(),n.stopPropagation();let i=eo.trim(),o=`${i}${i?" ":""}${r.prompt}`;es(o),t(e.id,{prompt:o}),e_(!1)},className:"flex flex-col items-center gap-1 p-2 rounded-lg text-slate-400 hover:bg-white/5 hover:text-white transition-all z-[10003]",children:[o.jsx(r.icon,{size:14,className:"text-emerald-500/70"}),o.jsx("span",{className:"text-[9px] font-bold",children:r.label})]},r.id))})]})]}),o.jsx("button",{type:"button",onMouseDown:t=>{t.stopPropagation(),X?.(e.id)},onClick:t=>{t.stopPropagation(),a(e.id,eo)},disabled:Q,className:"flex items-center justify-center px-3 py-1.5 rounded-lg font-black text-[10px] text-white transition-all bg-gradient-to-r from-cyan-500 to-blue-600 shadow-lg shadow-cyan-900/30 hover:scale-105 active:scale-95 disabled:opacity-50 group/render shrink-0 whitespace-nowrap h-[28px] self-end",children:Q?o.jsx(E,{className:"animate-spin",size:14}):o.jsx(q,{size:14,className:"group-hover/render:fill-white"})})]})]})})]})}),Y=(0,l.Z)("MicVocal",[["path",{d:"m12 8-9.04 9.06a2.82 2.82 0 1 0 3.98 3.98L16 12",key:"zoua8r"}],["circle",{cx:"17",cy:"7",r:"5",key:"1fomce"}]]),X=(0,l.Z)("Brush",[["path",{d:"m9.06 11.9 8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08",key:"1styjt"}],["path",{d:"M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z",key:"z0l1mu"}]]),Z=(0,l.Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Q=(0,l.Z)("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),ee=(0,l.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),et=(0,l.Z)("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),er=(0,l.Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),en=(0,l.Z)("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),ei=(0,l.Z)("Workflow",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]),eo=(0,l.Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),es=(0,l.Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),ea=(0,l.Z)("FolderHeart",[["path",{d:"M11 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v1.5",key:"6hud8k"}],["path",{d:"M13.9 17.45c-1.2-1.2-1.14-2.8-.2-3.73a2.43 2.43 0 0 1 3.44 0l.36.34.34-.34a2.43 2.43 0 0 1 3.45-.01v0c.95.95 1 2.53-.2 3.74L17.5 21Z",key:"vgq86i"}]]),el=(0,l.Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),ec=(0,l.Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),eu=(0,l.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ed=e=>{switch(e){case n.PROMPT_INPUT:return"";case n.IMAGE_GENERATOR:return"";case n.STORYBOARD_GENERATOR:return"";case n.VIDEO_GENERATOR:return"";case n.AUDIO_GENERATOR:return"";case n.VIDEO_ANALYZER:return"";case n.IMAGE_EDITOR:return"";case n.SCRIPT_MASTER:return"";default:return e}},ep=e=>{switch(e){case n.PROMPT_INPUT:return C;case n.IMAGE_GENERATOR:return I;case n.STORYBOARD_GENERATOR:return S.Z;case n.VIDEO_GENERATOR:return j;case n.AUDIO_GENERATOR:return Y;case n.VIDEO_ANALYZER:return T;case n.IMAGE_EDITOR:return X;case n.SCRIPT_MASTER:return w;default:return k.Z}},eh=({onAddNode:e,onUndo:t,isChatOpen:r,onToggleChat:i,isMultiFrameOpen:a,onToggleMultiFrame:l,isSonicStudioOpen:c,onToggleSonicStudio:u,assetHistory:d,onHistoryItemClick:p,onDeleteAsset:h,workflows:f,selectedWorkflowId:g,onSelectWorkflow:y,onSaveWorkflow:v,onDeleteWorkflow:b,onRenameWorkflow:_,onImportWorkflow:E,characters:w,onAddCharacter:S,onDeleteCharacter:T,onApplyCharacter:A,onOpenSettings:C,onOpenAdmin:O,isReadOnly:I})=>{let[P,j]=(0,s.useState)(null),[M,D]=(0,s.useState)(null),[U,L]=(0,s.useState)(""),[G,F]=(0,s.useState)(!1),B=()=>o.jsx("div",{className:"px-3 mb-6",children:G?(0,o.jsxs)("div",{className:"w-full p-3 bg-white/5 rounded-2xl border border-white/5 flex items-center justify-between group",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsxs)("div",{className:"relative",children:[o.jsx("img",{src:"https://api.dicebear.com/7.x/avataaars/svg?seed=Felix",className:"w-8 h-8 rounded-full bg-indigo-500/20"}),o.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 bg-emerald-500 border-2 border-[#0c0c0e] rounded-full"})]}),(0,o.jsxs)("div",{className:"text-left",children:[o.jsx("p",{className:"text-[10px] font-black text-white uppercase tracking-widest",children:"Creator #882"}),(0,o.jsxs)("div",{className:"flex items-center gap-1.5 mt-0.5",children:[o.jsx(q,{size:8,className:"text-amber-400"}),o.jsx("span",{className:"text-[8px] text-slate-500 font-bold uppercase tracking-widest",children:"Pro Plan  850 Credits"})]})]})]}),o.jsx("button",{onClick:()=>F(!1),className:"p-1.5 text-slate-600 hover:text-white opacity-0 group-hover:opacity-100 transition-all",children:o.jsx(N,{size:14})})]}):(0,o.jsxs)("button",{onClick:()=>F(!0),className:"w-full p-3 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-2xl border border-white/10 shadow-lg hover:scale-[1.02] transition-all group overflow-hidden relative",children:[o.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"}),(0,o.jsxs)("div",{className:"flex items-center gap-3 relative z-10",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:o.jsx(Z,{size:16,className:"text-white"})}),(0,o.jsxs)("div",{className:"text-left",children:[o.jsx("p",{className:"text-[10px] font-black text-white uppercase tracking-widest",children:" / "}),o.jsx("p",{className:"text-[8px] text-white/60 font-medium",children:""})]})]})]})}),H=(e,t)=>{e.dataTransfer.setData("assetType",t.type),e.dataTransfer.setData("assetSrc",t.src),e.dataTransfer.setData("assetTitle",t.title||"")};return(0,o.jsxs)(o.Fragment,{children:[o.jsx("div",{className:"fixed left-6 top-1/2 -translate-y-1/2 flex flex-col items-center gap-3 p-2 bg-[#1c1c1e]/80 backdrop-blur-3xl border border-white/10 rounded-2xl shadow-2xl z-50 animate-in slide-in-from-left-10 duration-500 ease-[${SPRING}]",children:[{id:"nodes",icon:k.Z,action:()=>j("nodes"===P?null:"nodes")},{id:"workflow",icon:ea,action:()=>j("workflow"===P?null:"workflow")},{id:"history",icon:es,action:()=>j("history"===P?null:"history")},{id:"characters",icon:Q,action:()=>j("characters"===P?null:"characters")},{id:"smart_sequence",icon:R,action:l,active:a},{id:"chat",icon:el,action:i,active:r},{id:"admin",icon:ec,action:O,color:"text-amber-500"},{id:"undo",icon:m,action:t},{id:"settings",icon:eu,action:C}].map(e=>o.jsx("button",{onClick:e.action,className:`w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-300 hover:scale-110 ${P===e.id||e.active?"bg-white text-black shadow-lg":"hover:bg-white/10 text-slate-400 hover:text-white"}`,title:e.id.toUpperCase(),children:o.jsx(e.icon,{size:18})},e.id))}),o.jsx("div",{className:`fixed left-24 top-1/2 -translate-y-1/2 max-h-[85vh] h-[600px] w-72 bg-[#1c1c1e]/95 backdrop-blur-3xl border border-white/10 rounded-2xl shadow-2xl transition-all duration-500 ease-[cubic-bezier(0.32, 0.72, 0, 1)] z-40 flex flex-col overflow-hidden ${P?"translate-x-0 opacity-100":"-translate-x-10 opacity-0 pointer-events-none scale-95"}`,children:P&&("nodes"===P?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[o.jsx("button",{onClick:()=>j(null),children:o.jsx(N,{size:14,className:"text-slate-500 hover:text-white"})}),o.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-white/50",children:"Node Hub"})]}),(0,o.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar space-y-2",children:[B(),I?(0,o.jsxs)("div",{className:"text-center py-10 px-4",children:[o.jsx(et,{size:32,className:"mx-auto text-slate-700 mb-2 opacity-20"}),o.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:""})]}):[n.PROMPT_INPUT,n.SCRIPT_MASTER,n.IMAGE_GENERATOR,n.STORYBOARD_GENERATOR,n.VIDEO_GENERATOR,n.VIDEO_ANALYZER,n.IMAGE_EDITOR,n.AUDIO_GENERATOR].map(t=>{let r=ep(t);return(0,o.jsxs)("button",{onClick:()=>{e(t),j(null)},className:"w-full text-left p-3 rounded-xl bg-white/5 hover:bg-white/10 flex items-center gap-3 text-sm text-slate-200 transition-all border border-transparent hover:border-white/5 hover:translate-x-1",children:[o.jsx("div",{className:"p-2 bg-white/5 rounded-lg text-cyan-400 group-hover:bg-cyan-400 group-hover:text-black transition-colors",children:o.jsx(r,{size:16})}),o.jsx("span",{className:"font-bold text-xs",children:ed(t)})]},t)})]})]}):"workflow"===P?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[o.jsx("button",{onClick:()=>j(null),children:o.jsx(N,{size:14,className:"text-slate-500 hover:text-white"})}),o.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-white/50",children:"Workflows"})]}),(0,o.jsxs)("div",{className:"p-3",children:[B(),(0,o.jsxs)("button",{onClick:()=>{v(),j("workflow")},className:"w-full py-3 bg-cyan-500 hover:bg-cyan-400 text-black rounded-xl font-black text-[11px] uppercase tracking-wider flex items-center justify-center gap-2 transition-all shadow-lg shadow-cyan-500/20 active:scale-95",children:[o.jsx(er,{size:14})," "]}),(0,o.jsxs)("label",{className:"w-full py-3 mt-2 bg-white/5 hover:bg-white/10 text-slate-300 rounded-xl font-bold text-[11px] uppercase tracking-wider flex items-center justify-center gap-2 transition-all cursor-pointer border border-white/5 hover:border-white/10",children:[o.jsx(en,{size:14}),"  (JSON)",o.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:e=>{let t=e.target.files?.[0];if(!t)return;let r=new FileReader;r.onload=e=>{try{let t=e.target?.result,r=JSON.parse(t);if(!r.id||!r.nodes||!r.connections){alert("");return}r.id=`imported-${Date.now()}`,r.title=`${r.title} (Imported)`,E(r),j("workflow")}catch(e){alert("")}},r.readAsText(t)}})]})]}),o.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar space-y-2",children:0===f.length?(0,o.jsxs)("div",{className:"text-center py-10 opacity-30 flex flex-col items-center gap-3",children:[o.jsx(ei,{size:32,strokeWidth:1}),o.jsx("p",{className:"text-[10px] font-bold uppercase tracking-[0.2em]",children:""})]}):f.map(e=>(0,o.jsxs)("div",{className:`group relative p-3 rounded-xl border transition-all ${g===e.id?"bg-cyan-500/10 border-cyan-500/30":"bg-white/5 border-transparent hover:border-white/10"}`,children:[(0,o.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>y(e.id),children:[o.jsx("div",{className:"w-10 h-10 rounded-lg bg-black/40 overflow-hidden flex items-center justify-center border border-white/5",children:e.thumbnail?o.jsx("img",{src:e.thumbnail,className:"w-full h-full object-cover"}):o.jsx(ei,{size:16,className:"text-slate-600"})}),(0,o.jsxs)("div",{className:"flex-1 min-w-0",children:[M===e.id?o.jsx("input",{autoFocus:!0,className:"w-full bg-black/40 border border-cyan-500/50 rounded px-1.5 py-0.5 text-xs text-white focus:outline-none",value:U,onChange:e=>L(e.target.value),onBlur:()=>{_(e.id,U),D(null)},onKeyDown:e=>"Enter"===e.key&&e.currentTarget.blur()}):o.jsx("p",{className:"text-xs font-bold text-slate-200 truncate",children:e.title}),(0,o.jsxs)("p",{className:"text-[9px] text-slate-500 mt-0.5 font-mono uppercase",children:["Nodes: ",e.nodes.length]})]})]}),(0,o.jsxs)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[o.jsx("button",{onClick:t=>{t.stopPropagation();let r=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download=`inkai-workflow-${e.title.replace(/\s+/g,"_")}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},className:"p-1.5 hover:bg-white/10 rounded text-slate-400 hover:text-white",title:" JSON",children:o.jsx(en,{size:12,className:"rotate-180"})}),o.jsx("button",{onClick:t=>{t.stopPropagation(),D(e.id),L(e.title)},className:"p-1.5 hover:bg-white/10 rounded text-slate-400 hover:text-white",children:o.jsx(eo,{size:12})}),o.jsx("button",{onClick:t=>{t.stopPropagation(),b(e.id)},className:"p-1.5 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400",children:o.jsx(x.Z,{size:12})})]})]},e.id))})]}):"history"===P?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[o.jsx("button",{onClick:()=>j(null),children:o.jsx(N,{size:14,className:"text-slate-500 hover:text-white"})}),o.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-white/50",children:"History Assets"})]}),(0,o.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar space-y-2",children:[B(),0===d.length?(0,o.jsxs)("div",{className:"text-center py-10 opacity-30 flex flex-col items-center gap-3",children:[o.jsx(es,{size:32,strokeWidth:1}),o.jsx("p",{className:"text-[10px] font-bold uppercase tracking-[0.2em]",children:""})]}):d.map(e=>(0,o.jsxs)("div",{draggable:!0,onDragStart:t=>H(t,e),className:"group relative p-2 rounded-xl bg-white/5 hover:bg-white/10 border border-transparent hover:border-white/10 transition-all cursor-pointer active:scale-95",onClick:()=>p(e),children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-lg bg-black overflow-hidden flex items-center justify-center border border-white/5",children:"image"===e.type?o.jsx("img",{src:e.src,className:"w-full h-full object-cover"}):"video"===e.type?o.jsx("video",{src:e.src,className:"w-full h-full object-cover",muted:!0}):o.jsx(Y,{className:"text-cyan-500",size:16})}),(0,o.jsxs)("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-[10px] font-bold text-slate-300 truncate pr-6",children:e.title||"Untitled"}),(0,o.jsxs)("p",{className:"text-[9px] text-slate-500 mt-1 uppercase tracking-widest",children:[e.type,"  ",new Date(e.timestamp).toLocaleTimeString()]})]})]}),o.jsx("button",{onClick:t=>{t.stopPropagation(),h(e.id)},className:"absolute right-2 top-2 p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-500/10 opacity-0 group-hover:opacity-100 transition-all",children:o.jsx(x.Z,{size:12})})]},e.id))]})]}):"characters"===P?(0,o.jsxs)("div",{className:"flex flex-col h-full bg-[#0c0c0e]/95 backdrop-blur-xl border-r border-white/5 w-72 animate-in slide-in-from-left duration-300",children:[(0,o.jsxs)("div",{className:"p-4 border-b border-white/5 flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[o.jsx(Q,{size:18,className:"text-purple-400"}),o.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-white",children:""})]}),o.jsx("button",{onClick:()=>j(null),className:"p-1 hover:bg-white/5 rounded-lg text-slate-500",children:o.jsx(N,{size:16})})]}),(0,o.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar",children:[B(),0===w.length?(0,o.jsxs)("div",{className:"text-center py-10",children:[o.jsx(Q,{size:32,className:"mx-auto text-slate-700 mb-2 opacity-20"}),o.jsx("p",{className:"text-[10px] text-slate-500",children:""})]}):w.map(e=>(0,o.jsxs)("div",{className:"group relative bg-white/5 rounded-xl overflow-hidden border border-white/5 hover:border-purple-500/30 transition-all",children:[o.jsx("img",{src:e.image,className:"w-full h-32 object-cover opacity-80 group-hover:opacity-100 transition-opacity"}),(0,o.jsxs)("div",{className:"p-3 bg-gradient-to-t from-black/80 to-transparent absolute bottom-0 left-0 right-0",children:[o.jsx("h4",{className:"text-[11px] font-bold text-white truncate",children:e.name}),o.jsx("p",{className:"text-[9px] text-slate-400 truncate mt-0.5",children:e.description})]}),(0,o.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[o.jsx("button",{onClick:()=>A(e),className:"p-1.5 bg-purple-500 text-white rounded-lg shadow-lg hover:scale-105 transition-all",title:"",children:o.jsx(ee,{size:12})}),o.jsx("button",{onClick:()=>T(e.id),className:"p-1.5 bg-black/60 text-red-400 rounded-lg hover:bg-red-500/20 transition-all",children:o.jsx(x.Z,{size:12})})]})]},e.id))]})]}):null)})]})},ef=(0,l.Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),em=(0,l.Z)("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]),eg=(0,l.Z)("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),ey=(0,l.Z)("CornerDownLeft",[["polyline",{points:"9 10 4 15 9 20",key:"r3jprv"}],["path",{d:"M20 4v7a4 4 0 0 1-4 4H4",key:"6o5b7l"}]]);var ev=r(6737);let eb=e=>e.split(/(\*\*.*?\*\*)/g).map((e,t)=>{if(e.startsWith("**")&&e.endsWith("**")){let r=e.slice(2,-2);return o.jsx("span",{className:"text-white font-bold mx-0.5",children:r},t)}return e}),e_=e=>{let t=e.split("\n"),r=[];return t.forEach((e,t)=>{let n=`line-${t}`,i=e.trim();if(!i){r.push(o.jsx("div",{className:"h-2"},n));return}if(e.startsWith("# ")){r.push(o.jsx("h1",{className:"text-base font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 mt-5 mb-3 border-b border-white/10 pb-2",children:e.replace(/^#\s/,"")},n));return}if(e.startsWith("## ")){r.push((0,o.jsxs)("h2",{className:"text-sm font-bold text-white mt-4 mb-2 flex items-center gap-2",children:[o.jsx("span",{className:"w-1 h-4 bg-cyan-500 rounded-full inline-block"}),e.replace(/^##\s/,"")]},n));return}if(i.startsWith("* ")||i.startsWith("- ")){let e=i.replace(/^[\*\-]\s/,"");r.push((0,o.jsxs)("div",{className:"flex gap-2 ml-1 mb-1.5 items-start group/list",children:[o.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-white/20 mt-[7px] shrink-0 group-hover/list:bg-cyan-400 transition-colors"}),o.jsx("div",{className:"text-[13px] leading-relaxed text-slate-300 flex-1",children:eb(e)})]},n));return}r.push(o.jsx("div",{className:"text-[13px] leading-relaxed text-slate-300 mb-1",children:eb(e)},n))}),o.jsx("div",{className:"space-y-0.5 select-text cursor-text",children:r})},eE=({isOpen:e,onClose:t})=>{let[r,n]=(0,s.useState)([{role:"model",text:""}]),[i,a]=(0,s.useState)(!1),[l,c]=(0,s.useState)(""),[u,d]=(0,s.useState)(!1),[p,h]=(0,s.useState)(!1),[f,m]=(0,s.useState)(!1),g=(0,s.useRef)(null),y=(0,s.useRef)(null),[v,b]=(0,s.useState)(null);(0,s.useEffect)(()=>{e&&setTimeout(()=>g.current?.scrollIntoView({behavior:"smooth"}),100)},[r,i,e]);let _=async()=>{if(l.trim()&&!i){c(""),n([...r,{role:"user",text:l}]),a(!0);try{let e=r.map(e=>({role:e.role,parts:[{text:e.text}]})),t=await (0,ev.bE)(e,l,{isThinkingMode:u,isCinematicMode:p,isHelpMeWrite:f});n(e=>[...e,{role:"model",text:t}])}catch(e){n(t=>[...t,{role:"model",text:e.message||""}])}finally{a(!1)}}};return(0,o.jsxs)("div",{ref:y,className:`fixed right-6 top-1/2 -translate-y-1/2 h-[85vh] w-[420px] bg-[#1c1c1e]/95 backdrop-blur-3xl rounded-[24px] border border-white/10 shadow-2xl z-40 flex flex-col overflow-hidden transition-all duration-500 ease-[cubic-bezier(0.32,0.72,0,1)] ${e?"opacity-100 translate-x-0 scale-100":"opacity-0 translate-x-10 scale-95 pointer-events-none"}`,onMouseDown:e=>e.stopPropagation(),onWheel:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5 backdrop-blur-md z-10 shrink-0",children:[o.jsx("button",{onClick:t,className:"p-2 hover:bg-white/10 rounded-full text-slate-500 hover:text-white transition-colors group",children:o.jsx(N,{size:14,className:"group-hover:scale-110 transition-transform"})}),(0,o.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,o.jsxs)("div",{className:"flex flex-col items-end",children:[o.jsx("span",{className:"text-xs font-bold text-slate-200 tracking-wide",children:"AI "}),o.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:""})]}),o.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-tr from-cyan-500/20 to-blue-500/20 flex items-center justify-center border border-white/10 shadow-inner",children:o.jsx(U,{size:14,className:"text-cyan-400"})})]})]}),(0,o.jsxs)("div",{className:"flex-1 overflow-y-auto p-5 space-y-6 custom-scrollbar bg-[#0a0a0c]/50",children:[r.map((e,t)=>o.jsx("div",{className:`flex w-full ${"user"===e.role?"justify-end":"justify-start"}`,children:(0,o.jsxs)("div",{className:`flex flex-col max-w-[92%] gap-1.5 ${"user"===e.role?"items-end":"items-start"}`,children:[o.jsx("div",{className:"flex items-center gap-2 px-1",children:o.jsx("span",{className:"text-[10px] font-bold text-cyan-500/80 uppercase tracking-wider",children:"model"===e.role?"InkAI":"You"})}),o.jsx("div",{className:"group relative transition-all w-full",children:(0,o.jsxs)("div",{className:`relative px-5 py-4 rounded-2xl shadow-sm border select-text cursor-text ${"user"===e.role?"bg-[#2c2c2e] border-white/10 text-slate-100 rounded-tr-sm":"bg-[#1c1c1e] border-white/5 text-slate-300 rounded-tl-sm w-full pr-10"}`,children:["model"===e.role?e_(e.text):o.jsx("p",{className:"leading-6 text-[13px] whitespace-pre-wrap",children:e.text}),o.jsx("button",{onClick:()=>{navigator.clipboard.writeText(e.text),b(t),setTimeout(()=>b(null),2e3)},className:"absolute top-2 right-2 p-1.5 rounded-full bg-black/20 hover:bg-black/50 border border-white/5 text-slate-400 opacity-0 group-hover:opacity-100 transition-all hover:text-white hover:scale-110 z-10",children:v===t?o.jsx("span",{className:"text-[10px] font-bold text-green-400",children:"OK"}):o.jsx(ef,{size:10})})]})})]})},t)),i&&o.jsx("div",{className:"flex justify-start w-full animate-in fade-in slide-in-from-bottom-2",children:(0,o.jsxs)("div",{className:"flex flex-col gap-2 max-w-[85%]",children:[o.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider px-1 ${u?"text-indigo-400":"text-cyan-500/80"}`,children:u?"Deep Thinking":"Thinking"}),(0,o.jsxs)("div",{className:`px-5 py-4 bg-[#1c1c1e] border rounded-2xl rounded-tl-sm flex items-center gap-3 w-fit shadow-lg ${u?"border-indigo-500/30 shadow-indigo-900/20":"border-white/5 shadow-cyan-900/10"}`,children:[o.jsx(E,{size:16,className:`animate-spin ${u?"text-indigo-400":"text-cyan-500"}`}),o.jsx("span",{className:`text-xs font-medium tracking-wide ${u?"text-indigo-200":"text-slate-400"}`,children:p?"...":"..."})]})]})}),o.jsx("div",{ref:g})]}),(0,o.jsxs)("div",{className:"p-4 bg-[#1c1c1e] border-t border-white/5 shrink-0 flex flex-col gap-2",children:[o.jsx("div",{className:"flex items-center justify-between px-1",children:(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsxs)("button",{onClick:()=>{d(!u),h(!1)},className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold transition-all border ${u?"bg-indigo-500/20 text-indigo-300 border-indigo-500/50":"bg-white/5 text-slate-500 border-transparent"}`,children:[o.jsx(em,{size:12}),o.jsx("span",{children:""})]}),(0,o.jsxs)("button",{onClick:()=>{h(!p),d(!1)},className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold transition-all border ${p?"bg-amber-500/20 text-amber-300 border-amber-500/50 shadow-[0_0_10px_rgba(245,158,11,0.2)]":"bg-white/5 text-slate-500 border-transparent"}`,children:[o.jsx(j,{size:12}),o.jsx("span",{children:""})]}),(0,o.jsxs)("button",{onClick:()=>{m(!f)},className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold transition-all border ${f?"bg-pink-500/20 text-pink-300 border-pink-500/50":"bg-white/5 text-slate-500 border-transparent"}`,children:[o.jsx(eg,{size:12}),o.jsx("span",{children:""})]})]})}),(0,o.jsxs)("div",{className:"relative group/input",children:[o.jsx("textarea",{className:"w-full bg-black/20 border border-white/10 rounded-[20px] pl-4 pr-12 py-3.5 text-xs text-white placeholder-slate-500 focus:outline-none focus:bg-black/40 focus:border-cyan-500/30 transition-all resize-none custom-scrollbar leading-5",placeholder:p?"AI  Prompt ...":"...",value:l,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())},rows:1,style:{minHeight:"48px",maxHeight:"120px"}}),o.jsx("button",{onClick:_,disabled:!l.trim()||i,className:`absolute right-2 top-2 p-2 rounded-full transition-all duration-300 ${l.trim()&&!i?"bg-cyan-500 text-black hover:bg-cyan-400":"bg-white/5 text-slate-600"}`,children:o.jsx(ey,{size:16})})]})]})]})},ew=(0,l.Z)("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]),ex=(0,l.Z)("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]),eS=[{label:"",value:null},{label:"16:9",value:16/9},{label:"9:16",value:9/16},{label:"4:3",value:4/3},{label:"3:4",value:3/4},{label:"1:1",value:1}],eT=({imageSrc:e,onConfirm:t,onCancel:r})=>{let[n,i]=(0,s.useState)(null),[a,l]=(0,s.useState)(null),c=(0,s.useRef)(null),u=(0,s.useRef)(null),[d,p]=(0,s.useState)({type:"create",startPos:{x:0,y:0},startCrop:null}),h=e=>{if(!c.current)return{x:0,y:0};let t=c.current.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top,rawX:e.clientX,rawY:e.clientY}},f=(e,t,r)=>{let{x:n,y:i,width:o,height:s}=e;return n<0&&(n=0),i<0&&(i=0),o>t&&(o=t),s>r&&(s=r),n+o>t&&(n=t-o),i+s>r&&(i=r-s),{x:n,y:i,width:o,height:s}},m=(e,t,r)=>{e.preventDefault(),e.stopPropagation();let o=h(e),s=n;"create"===t&&i(s={x:o.x,y:o.y,width:0,height:0}),p({type:t,handle:r,startPos:{x:o.x,y:o.y},startCrop:s?{...s}:null})},g=e=>{if(!c.current||!d.startCrop)return;if(0===e.buttons){p(e=>({...e,type:"create"}));return}let t=h(e),r=c.current.width,n=c.current.height,{startPos:o,startCrop:s}=d;if("move"===d.type){let e=t.x-o.x,a=t.y-o.y;i(f({...s,x:s.x+e,y:s.y+a},r,n))}else if("create"===d.type){let e=Math.max(0,Math.min(t.x,r)),o=Math.max(0,Math.min(t.y,n)),l=s.x,c=s.y,u=Math.abs(e-l),d=Math.abs(o-c);a&&(u/d>a?d=u/a:u=d*a);let p=e>=l?1:-1,h=o>=c?1:-1,f=l+(-1===p?-u:0),m=c+(-1===h?-d:0);f<0&&(f=0,a&&(d=u/a)),m<0&&(m=0,a&&(u=d*a)),f+u>r&&(1===p?u=r-f:f=r-u,a&&(d=u/a)),m+d>n&&(1===h?d=n-m:m=n-d,a&&(u=d*a)),i({x:f,y:m,width:u,height:d})}else if("resize"===d.type&&d.handle){let e=0,o=0;switch(d.handle){case"nw":e=s.x+s.width,o=s.y+s.height;break;case"ne":e=s.x,o=s.y+s.height;break;case"sw":e=s.x+s.width,o=s.y;break;case"se":e=s.x,o=s.y}let l=Math.max(0,Math.min(t.x,r)),c=Math.max(0,Math.min(t.y,n)),u=Math.abs(l-e),p=Math.abs(c-o);if(a){p=u/a;let e=d.handle.includes("n")?o-p:o+p;(e<0||e>n)&&(u=(p=Math.abs(c-o))*a)}let h=d.handle.includes("w")?e-u:e,f=d.handle.includes("n")?o-p:o;h<0&&(h=0),f<0&&(f=0),h+u>r&&(u=r-h),f+p>n&&(p=n-f),i({x:h,y:f,width:u,height:p})}},y=()=>{p(e=>({...e,type:"create",startCrop:null}))};return(0,s.useEffect)(()=>(window.addEventListener("mousemove",g),window.addEventListener("mouseup",y),()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",y)}),[d]),(0,s.useEffect)(()=>{if(n&&a&&n.width>0&&n.height>0){let e=n.x+n.width/2,t=n.y+n.height/2,r=n.width,o=r/a;o>(c.current?.height||0)&&(r=(o=c.current?.height||0)*a);let s=e-r/2,l=t-o/2;c.current&&i(f({x:s,y:l,width:r,height:o},c.current.width,c.current.height))}},[a]),(0,o.jsxs)("div",{className:"fixed inset-0 z-[200] bg-black/90 backdrop-blur-xl flex flex-col items-center justify-center animate-in fade-in duration-300",children:[(0,o.jsxs)("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2",children:[(0,o.jsxs)("div",{className:"bg-[#2c2c2e]/90 backdrop-blur-md px-6 py-2.5 rounded-full border border-white/10 text-slate-300 text-xs font-medium flex items-center gap-2 shadow-2xl",children:[o.jsx(ew,{size:14,className:"text-cyan-400"}),o.jsx("span",{children:""})]}),o.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:"  "})]}),(0,o.jsxs)("div",{ref:u,className:"relative max-w-[85vw] max-h-[65vh] border border-white/10 shadow-2xl rounded-lg overflow-hidden select-none bg-black/50 group",style:{cursor:"crosshair"},onMouseDown:e=>m(e,"create"),children:[o.jsx("img",{ref:c,src:e,className:"max-w-full max-h-[65vh] object-contain block opacity-50",draggable:!1}),n&&n.width>0&&(0,o.jsxs)("div",{className:"absolute",style:{left:n.x,top:n.y,width:n.width,height:n.height},children:[o.jsx("div",{className:"absolute inset-0 overflow-hidden",children:o.jsx("img",{src:e,className:"absolute max-w-none",style:{width:c.current?.width,height:c.current?.height,left:-n.x,top:-n.y,opacity:1}})}),o.jsx("div",{className:"absolute inset-0 shadow-[0_0_0_9999px_rgba(0,0,0,0.7)] pointer-events-none"}),o.jsx("div",{className:"absolute inset-0 border-2 border-cyan-400 z-10 pointer-events-none",children:(0,o.jsxs)("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 opacity-40",children:[o.jsx("div",{className:"border-r border-white/50"}),o.jsx("div",{className:"border-r border-white/50"}),o.jsx("div",{className:"col-span-3 border-b border-white/50 -mt-[33%]"}),o.jsx("div",{className:"col-span-3 border-b border-white/50 mt-[33%]"})]})}),o.jsx("div",{className:"absolute inset-0 z-20 cursor-move group/move",onMouseDown:e=>m(e,"move"),children:o.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover/move:opacity-100 transition-opacity duration-200",children:o.jsx("div",{className:"bg-black/50 p-2 rounded-full backdrop-blur-sm",children:o.jsx(ex,{size:16,className:"text-white"})})})}),["nw","ne","sw","se"].map(e=>o.jsx("div",{className:`
                            absolute w-4 h-4 bg-white border-2 border-cyan-500 rounded-full z-30 shadow-sm
                            hover:scale-125 transition-transform
                        `,style:{cursor:`${e}-resize`,left:e.includes("w")?-8:"auto",right:e.includes("e")?-8:"auto",top:e.includes("n")?-8:"auto",bottom:e.includes("s")?-8:"auto"},onMouseDown:t=>m(t,"resize",e)},e)),(0,o.jsxs)("div",{className:"absolute -top-7 left-0 flex gap-2 z-20 pointer-events-none",children:[(0,o.jsxs)("div",{className:"bg-cyan-500 text-black text-[9px] font-bold px-1.5 py-0.5 rounded-sm shadow-md",children:[Math.round(n.width)," \xd7 ",Math.round(n.height)]}),a&&o.jsx("div",{className:"bg-black/60 text-cyan-400 border border-cyan-500/30 text-[9px] font-bold px-1.5 py-0.5 rounded-sm shadow-md",children:eS.find(e=>e.value===a)?.label})]})]})]}),(0,o.jsxs)("div",{className:"flex flex-col items-center gap-6 mt-8 w-full max-w-2xl px-4",children:[o.jsx("div",{className:"flex items-center gap-2 p-1 bg-[#1c1c1e] border border-white/10 rounded-xl shadow-lg overflow-x-auto custom-scrollbar max-w-full",children:eS.map(e=>o.jsx("button",{onClick:()=>l(e.value),className:`
                        relative px-4 py-2 rounded-lg text-xs font-bold transition-all whitespace-nowrap
                        ${a===e.value?"bg-cyan-500 text-black shadow-md scale-105 z-10":"text-slate-400 hover:text-white hover:bg-white/5"}
                    `,children:e.label},e.label))}),(0,o.jsxs)("div",{className:"flex gap-4",children:[o.jsx("button",{onClick:r,className:"px-6 py-2.5 rounded-full bg-white/5 hover:bg-white/10 text-white text-xs font-medium transition-colors border border-white/5",children:""}),(0,o.jsxs)("button",{onClick:()=>{if(!c.current||!n||0===n.width){t(e);return}let r=document.createElement("canvas"),i=c.current.naturalWidth/c.current.width,o=c.current.naturalHeight/c.current.height;r.width=n.width*i,r.height=n.height*o;let s=r.getContext("2d");s&&(s.drawImage(c.current,n.x*i,n.y*o,n.width*i,n.height*o,0,0,n.width*i,n.height*o),t(r.toDataURL("image/png")))},disabled:!n||0===n.width,className:`
                    px-8 py-2.5 rounded-full text-xs font-bold shadow-lg transition-all flex items-center gap-2
                    ${n&&0!==n.width?"bg-cyan-500 hover:bg-cyan-400 text-black hover:scale-105 shadow-cyan-500/20":"bg-white/5 text-slate-500 cursor-not-allowed"}
                `,children:[o.jsx(ee,{size:14})," "]})]})]})]})},eA=(0,l.Z)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),eC=(0,l.Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),eO=(0,l.Z)("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]),eI=(0,l.Z)("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),eN=(0,l.Z)("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),ek=(0,l.Z)("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),eR=(0,l.Z)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),eP=["#000000","#ffffff","#ff3b30","#ff9500","#ffcc00","#4cd964","#5ac8fa","#007aff","#5856d6","#ff2d55","#8e8e93"],ej=({onClose:e,onGenerate:t})=>{let r=(0,s.useRef)(null),[n,i]=(0,s.useState)(!1),[a,l]=(0,s.useState)("brush"),[c,u]=(0,s.useState)("#000000"),[d,p]=(0,s.useState)(5),[h,m]=(0,s.useState)(30),[g,y]=(0,s.useState)([]),[v,b]=(0,s.useState)(null),_=(0,s.useRef)(null),[w,S]=(0,s.useState)("video"),[T,C]=(0,s.useState)(""),[O,k]=(0,s.useState)(!1),[R,P]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=r.current;if(!e)return;let t=window.devicePixelRatio||1,n=e.getBoundingClientRect();e.width=n.width*t,e.height=n.height*t;let i=e.getContext("2d");i&&(i.scale(t,t),i.clearRect(0,0,n.width,n.height),i.lineCap="round",i.lineJoin="round",L())},[]);let[j,M]=(0,s.useState)([]),D=()=>{if(g.length<=1)return;let e=r.current,t=e?.getContext("2d");if(e&&t){let r=t.getImageData(0,0,e.width,e.height);M(e=>[...e,r])}let n=[...g];n.pop();let i=n[n.length-1];y(n),e&&t&&i&&t.putImageData(i,0,0)},U=()=>{if(0===j.length)return;let e=[...j],t=e.pop();M(e);let n=r.current,i=n?.getContext("2d");n&&i&&t&&(i.putImageData(t,0,0),y(e=>[...e,t]))},L=()=>{let e=r.current,t=e?.getContext("2d");if(e&&t){let r=t.getImageData(0,0,e.width,e.height);y(e=>[...e.slice(-10),r]),M([])}},G=e=>{let t=r.current;if(!t)return{x:0,y:0};let n=t.getBoundingClientRect(),i="touches"in e?e.touches[0].clientX:e.clientX,o="touches"in e?e.touches[0].clientY:e.clientY;return{x:i-n.left,y:o-n.top}},F=e=>{i(!0);let{x:t,y:n}=G(e),o=r.current?.getContext("2d");o&&(o.beginPath(),o.moveTo(t,n),"eraser"===a?(o.globalCompositeOperation="destination-out",o.lineWidth=h):(o.globalCompositeOperation="source-over",o.strokeStyle=c,o.lineWidth=d))},q=e=>{if(!n)return;let{x:t,y:i}=G(e),o=r.current?.getContext("2d");o&&(o.lineTo(t,i),o.stroke())},B=()=>{if(n){i(!1);let e=r.current?.getContext("2d");e?.closePath(),e&&(e.globalCompositeOperation="source-over"),L()}};(0,s.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&"z"===e.key&&(e.preventDefault(),D()),(e.ctrlKey||e.metaKey)&&("y"===e.key||e.shiftKey&&"Z"===e.key)&&(e.preventDefault(),U())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[g,j]);let H=()=>{let e=r.current;if(!e)return"";let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let n=t.getContext("2d");if(!n)return"";if(n.fillStyle="#ffffff",n.fillRect(0,0,t.width,t.height),v){let e=Math.min(t.width/v.width,t.height/v.height),r=v.width*e,i=v.height*e,o=(t.width-r)/2,s=(t.height-i)/2;n.drawImage(v,o,s,r,i)}return n.drawImage(e,0,0),t.toDataURL("image/png")},V=async()=>{if(T.trim()&&!O){k(!0);try{if("pose"===w){let e=`
                Generate a simple, high-contrast black line art sketch on a white background.
                Subject: ${T}.
                Style: Minimalist stick figure or outline drawing, clear lines, no shading.
                `,t=(await (0,ev.oE)(e,"gemini-2.5-flash-image",[],{aspectRatio:"16:9",count:1}))[0],n=new Image;n.crossOrigin="anonymous",n.onload=()=>{let e=r.current,t=e?.getContext("2d");if(e&&t){t.globalCompositeOperation="source-over";let r=Math.min(e.width/n.width,e.height/n.height),i=n.width*r,o=n.height*r,s=(e.width-i)/2,a=(e.height-o)/2;t.drawImage(n,s,a,i,o),L(),k(!1)}},n.onerror=()=>{throw Error("Failed to load generated pose image")},n.src=t}else{let r=H();if("video"===w){let e=await (0,ev.wo)(T,"veo-3.1-fast-generate-preview",{aspectRatio:"16:9"},r);t("video",e.uri,T)}else{let e=await (0,ev.oE)(T,"gemini-2.5-flash-image",[r],{aspectRatio:"16:9",count:1});t("image",e[0],T)}e()}}catch(e){console.error(e),alert(""),k(!1)}}};return(0,o.jsxs)("div",{className:"fixed inset-0 z-[100] bg-[#0a0a0c] flex flex-col animate-in fade-in duration-300",children:[(0,o.jsxs)("div",{className:"h-14 border-b border-white/10 flex items-center justify-between px-6 bg-[#1c1c1e]",children:[o.jsx("button",{onClick:e,className:"absolute left-6 p-2 rounded-full bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:o.jsx(N,{size:16})}),o.jsx("div",{className:"flex-1 flex justify-center",children:o.jsx("div",{className:"flex bg-black/30 p-1 rounded-lg",children:[{id:"video",label:"",icon:eA},{id:"image",label:"",icon:I},{id:"pose",label:" (Pose)",icon:eC}].map(e=>(0,o.jsxs)("button",{onClick:()=>S(e.id),className:`
                                    flex items-center gap-2 px-6 py-1.5 rounded-md text-xs font-bold transition-all
                                    ${w===e.id?"bg-white/10 text-white shadow-sm":"text-slate-500 hover:text-slate-300"}
                                `,children:[o.jsx(e.icon,{size:12}),e.label]},e.id))})})]}),(0,o.jsxs)("div",{className:"flex-1 relative bg-[#121214] flex items-center justify-center p-8 overflow-hidden",children:[(0,o.jsxs)("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 z-20 flex items-center gap-2 p-1.5 bg-[#2c2c2e]/90 backdrop-blur-xl border border-white/10 rounded-full shadow-2xl",children:[o.jsx("button",{onClick:()=>l("brush"),className:`p-2.5 rounded-full transition-colors ${"brush"===a?"bg-cyan-500 text-black":"text-slate-400 hover:text-white hover:bg-white/5"}`,title:"",children:o.jsx(X,{size:16})}),o.jsx("button",{onClick:()=>l("eraser"),className:`p-2.5 rounded-full transition-colors ${"eraser"===a?"bg-cyan-500 text-black":"text-slate-400 hover:text-white hover:bg-white/5"}`,title:"",children:o.jsx(eO,{size:16})}),o.jsx("div",{className:"w-px h-6 bg-white/10 mx-1"}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsxs)("button",{onClick:()=>P(!R),className:"p-2.5 rounded-full transition-colors text-slate-400 hover:text-white hover:bg-white/5 relative",title:"",children:[o.jsx(eI,{size:16,style:{color:"brush"===a?c:void 0}}),o.jsx("div",{className:"absolute bottom-1 right-1 w-2 h-2 rounded-full border border-[#2c2c2e]",style:{backgroundColor:c}})]}),R&&o.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-3 p-3 bg-[#1c1c1e] border border-white/10 rounded-xl shadow-xl grid grid-cols-4 gap-2 w-48 z-30",children:eP.map(e=>o.jsx("button",{onClick:()=>{u(e),l("brush"),P(!1)},className:`w-8 h-8 rounded-full border-2 ${c===e?"border-white":"border-transparent hover:scale-110"}`,style:{backgroundColor:e}},e))})]}),o.jsx("div",{className:"w-px h-6 bg-white/10 mx-1"}),(0,o.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-black/20 rounded-full border border-white/5",children:[o.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Size"}),o.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:"eraser"===a?h:d,onChange:e=>{let t=parseInt(e.target.value);"eraser"===a?m(t):p(t)},className:"w-20 h-1 bg-white/10 rounded-full appearance-none [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-cyan-500 cursor-pointer"}),o.jsx("span",{className:"text-[10px] font-mono text-slate-400 min-w-[20px]",children:"eraser"===a?h:d})]}),o.jsx("div",{className:"w-px h-6 bg-white/10 mx-1"}),o.jsx("button",{onClick:D,disabled:g.length<=1,className:`p-2.5 rounded-full transition-colors ${g.length<=1?"opacity-20 cursor-not-allowed":"text-slate-400 hover:text-white hover:bg-white/5"}`,title:" (Ctrl+Z)",children:o.jsx(eN,{size:16})}),o.jsx("button",{onClick:U,disabled:0===j.length,className:`p-2.5 rounded-full transition-colors ${0===j.length?"opacity-20 cursor-not-allowed":"text-slate-400 hover:text-white hover:bg-white/5"}`,title:" (Ctrl+Y)",children:o.jsx(ek,{size:16})}),o.jsx("button",{onClick:()=>{let e=r.current,t=e?.getContext("2d");e&&t&&(t.clearRect(0,0,e.width,e.height),L())},className:"p-2.5 rounded-full text-red-400 hover:bg-red-500/10",title:"",children:o.jsx(x.Z,{size:16})})]}),(0,o.jsxs)("div",{className:"relative shadow-2xl rounded-lg overflow-hidden border border-white/5 bg-[#ffffff] select-none",style:{aspectRatio:"16/9",height:"100%",maxHeight:"800px"},children:[v&&o.jsx("img",{src:v.src,className:"absolute inset-0 w-full h-full object-contain pointer-events-none opacity-50",alt:"Reference"}),o.jsx("canvas",{ref:r,className:"absolute inset-0 w-full h-full cursor-crosshair touch-none",onMouseDown:F,onMouseMove:q,onMouseUp:B,onMouseLeave:B,onTouchStart:F,onTouchMove:q,onTouchEnd:B})]})]}),(0,o.jsxs)("div",{className:"h-20 bg-[#1c1c1e] border-t border-white/10 flex items-center px-8 gap-4",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 mr-4",children:[(0,o.jsxs)("div",{className:"relative p-2 rounded-lg bg-white/5 text-slate-400 hover:text-white border border-white/5 cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>_.current?.click(),title:"",children:[o.jsx(eR,{size:16}),o.jsx("input",{type:"file",ref:_,className:"hidden",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=e=>{let t=new Image;t.onload=()=>b(t),t.src=e.target?.result},e.readAsDataURL(t)}}})]}),o.jsx("button",{onClick:()=>{if(r.current){let e=document.createElement("a");e.href=H(),e.download="sketch.png",e.click()}},className:"p-2 rounded-lg bg-white/5 text-slate-400 hover:text-white border border-white/5",title:"",children:o.jsx(A,{size:16})})]}),o.jsx("div",{className:"flex-1 relative",children:o.jsx("input",{type:"text",value:T,onChange:e=>C(e.target.value),placeholder:"pose"===w?" (e.g. A stick figure running fast)...":" (e.g. Milk splash around the bottle)...",className:"w-full h-11 bg-black/30 border border-white/10 rounded-xl px-4 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&V()})}),(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsxs)("div",{className:"h-11 px-4 flex items-center gap-2 bg-black/30 border border-white/10 rounded-xl text-xs text-slate-300 font-medium",children:[o.jsx("span",{children:"pose"===w?"Gemini 2.5 (Pose)":"video"===w?"Veo 3.1 Fast":"Gemini 2.5"}),o.jsx(f,{size:12,className:"text-slate-500"})]}),o.jsx("div",{className:"w-px h-6 bg-white/10 mx-2"}),(0,o.jsxs)("button",{onClick:V,disabled:O||!T.trim(),className:`
                            h-11 px-6 rounded-xl flex items-center gap-2 font-bold text-sm transition-all
                            ${O||!T.trim()?"bg-white/5 text-slate-500 cursor-not-allowed":"pose"===w?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white hover:scale-105":"bg-gradient-to-r from-cyan-600 to-blue-600 text-white hover:scale-105"}
                        `,children:[O?o.jsx(E,{className:"animate-spin",size:16}):o.jsx(eg,{size:16}),o.jsx("span",{children:"pose"===w?"":""})]})]})]})]})},eM=(0,l.Z)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),eD=(0,l.Z)("MonitorPlay",[["path",{d:"m10 7 5 3-5 3Z",key:"29ljg6"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}]]),eU=(0,l.Z)("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),eL=(0,l.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),eG=(0,l.Z)("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),eF="cubic-bezier(0.32, 0.72, 0, 1)",eq=({isOpen:e,onClose:t,onGenerate:r,onGenerateAudio:n,onGenerateSegment:i,onConnectStart:l})=>{let[d,p]=(0,s.useState)([]),[h,f]=(0,s.useState)(null),[m,g]=(0,s.useState)(null),[y,b]=(0,s.useState)(null),[_,w]=(0,s.useState)(!1),[S,T]=(0,s.useState)(!1),C=(0,s.useRef)(null),O=(0,s.useRef)(null),[I,R]=(0,s.useState)([]),[P,j]=(0,s.useState)(0),[D,U]=(0,s.useState)(null),[L,G]=(0,s.useState)(!1),[q,B]=(0,s.useState)(!1),[H,V]=(0,s.useState)(null),[$,z]=(0,s.useState)({current:0,total:0}),[J,W]=(0,s.useState)(null),[K,Y]=(0,s.useState)(""),[X,Z]=(0,s.useState)(3),Q=(0,s.useRef)(null),ee=(0,s.useRef)(null),et=(0,s.useRef)(null),er=d.reduce((e,t,r)=>r<d.length-1?e+t.transition.duration:e,0);(0,s.useEffect)(()=>{let e=e=>{J&&et.current&&!et.current.contains(e.target)&&!e.target.closest("button[data-link-btn]")&&eu()};return window.addEventListener("mousedown",e),()=>window.removeEventListener("mousedown",e)},[J,K,X]);let en=async()=>{if(!(d.length<2)&&!L){G(!0),z({current:0,total:d.length-1}),R([]),j(0),w(!1);try{let e=await r(d,(e,t)=>{z({current:e,total:t})});Array.isArray(e)?R(e):R([e]),setTimeout(()=>{C.current&&C.current.play().then(()=>w(!0)).catch(()=>{})},100)}catch(e){console.error("Generation failed",e),alert(`: ${e.message||""}`)}finally{G(!1),z({current:0,total:0})}}},ei=async()=>{if(!(d.length<2)&&!q&&n){B(!0);try{let e=d.map(e=>e.transition.prompt).filter(Boolean).join(". ")||"Cinematic sequence",t=`Soundtrack for a video: ${e}. Mood: Cinematic, Ambient, Flowing.`,r=await n(t);U(r)}catch(e){console.error("Audio generation failed",e),alert("")}finally{B(!1)}}},eo=()=>{C.current&&0!==I.length&&(_?(C.current.pause(),O.current?.pause(),w(!1)):(C.current.play(),O.current?.play(),w(!0)))};(0,s.useEffect)(()=>{0===P&&_&&O.current&&(O.current.currentTime=0,O.current.play())},[P,_]);let es=(e,t)=>{f(t),e.dataTransfer.effectAllowed="move";let r=new Image;r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",e.dataTransfer.setDragImage(r,0,0)},ea=(e,t)=>{if(e.preventDefault(),null!==h&&h!==t){g(t);let e=[...d],[r]=e.splice(h,1);e.splice(t,0,r),p(e),f(t)}},el=e=>{e.preventDefault(),f(null),g(null);let t=e.dataTransfer.getData("application/inkai-media");if(t)try{let e=JSON.parse(t);if("image"===e.type&&e.src){let t={id:`seq-${Date.now()}-${Math.random()}`,src:e.src,transition:{duration:3,prompt:""}};p(e=>[...e,t].slice(0,10));return}}catch(e){console.error("Failed to parse internal drag data",e)}if(e.dataTransfer.files?.length>0){let t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));t.length>0&&Promise.all(t.map(e=>new Promise(t=>{let r=new FileReader;r.onload=e=>t({id:`seq-${Date.now()}-${Math.random()}`,src:e.target?.result,transition:{duration:3,prompt:""}}),r.readAsDataURL(e)}))).then(e=>{p(t=>[...t,...e].slice(0,10))})}},ec=(e,t)=>{J===e?eu():(eu(),W(e),Y(t.prompt),Z(t.duration))},eu=()=>{J&&(p(e=>e.map(e=>e.id===J?{...e,transition:{prompt:K,duration:X}}:e)),W(null))};if(!e)return null;let ed=async()=>{if(i&&!(P>=d.length-1)){V(P),w(!1);try{let e=d[P],t=d[P+1],r=await i(e,t);R(e=>{let t=[...e];return t[P]=r,t}),C.current&&(C.current.currentTime=0,C.current.play(),w(!0))}catch(e){console.error("Segment regeneration failed",e),alert(`: ${e.message||""}`)}finally{V(null)}}};return(0,o.jsxs)(o.Fragment,{children:[S&&o.jsx("div",{className:"fixed inset-0 z-[90] bg-black/80 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>T(!1),children:o.jsx("button",{className:"absolute top-6 right-6 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white/70 hover:text-white transition-all z-[110]",onClick:e=>{e.stopPropagation(),T(!1)},children:o.jsx(N,{size:24})})}),(0,o.jsxs)("div",{ref:ee,className:`fixed bottom-8 left-1/2 -translate-x-1/2 z-[80] flex flex-col items-center gap-2 transition-all duration-500 ease-[${eF}] animate-in slide-in-from-bottom-20 fade-in`,children:[(0,o.jsxs)("div",{className:"relative group/player mb-2",children:[!S&&(0,o.jsxs)(o.Fragment,{children:[o.jsx("div",{onMouseDown:e=>l?.(e,"input"),className:"absolute -left-8 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border border-white/20 bg-[#1c1c1e] flex items-center justify-center opacity-0 group-hover/player:opacity-100 hover:scale-125 transition-all cursor-crosshair z-30",title:"Connect Input",children:o.jsx(k.Z,{size:12,className:"text-white/50"})}),o.jsx("div",{onMouseDown:e=>l?.(e,"output"),className:"absolute -right-8 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border border-white/20 bg-[#1c1c1e] flex items-center justify-center opacity-0 group-hover/player:opacity-100 hover:scale-125 transition-all cursor-crosshair z-30",title:"Connect Output",children:o.jsx(k.Z,{size:12,className:"text-white/50"})})]}),(0,o.jsxs)("div",{className:`
            relative bg-black border border-white/10 shadow-2xl overflow-hidden flex items-center justify-center transition-all duration-500 ease-[${eF}]
            ${S?"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[50vw] h-[28.125vw] max-w-[90vw] max-h-[80vh] z-[100] rounded-2xl shadow-[0_0_100px_rgba(0,0,0,0.8)]":"w-[360px] h-[202px] rounded-xl"}
        `,children:[(0,o.jsxs)("div",{className:`absolute top-3 left-3 flex gap-2 z-20 transition-opacity duration-200 ${L?"opacity-0":"opacity-0 hover:opacity-100 group-hover/player:opacity-100"}`,children:[o.jsx("button",{onClick:e=>{e.stopPropagation(),T(!S)},className:"p-2 bg-black/60 backdrop-blur-md rounded-lg text-white/70 hover:text-white border border-white/10 hover:scale-105 transition-all",title:S?"":"",children:S?o.jsx(u,{size:16}):o.jsx(c,{size:16})}),I.length>0&&(0,o.jsxs)(o.Fragment,{children:[o.jsx("a",{href:I[P],download:`sunstudio_seq_${Date.now()}_part${P+1}.mp4`,onClick:e=>e.stopPropagation(),className:"p-2 bg-black/60 backdrop-blur-md rounded-lg text-white/70 hover:text-white border border-white/10 hover:scale-105 transition-all",title:"",target:"_blank",rel:"noopener noreferrer",children:o.jsx(A,{size:16})}),o.jsx("button",{onClick:e=>{e.stopPropagation();let t=d[P];t&&ec(t.id,t.transition)},className:"p-2 bg-black/60 backdrop-blur-md rounded-lg text-white/70 hover:text-white border border-white/10 hover:scale-105 transition-all",title:"",children:H===P?o.jsx(E,{size:16,className:"animate-spin"}):o.jsx(v,{size:16})})]})]}),L?(0,o.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[o.jsx(E,{size:32,className:"animate-spin text-cyan-500"}),o.jsx("span",{className:"text-[10px] font-bold text-slate-400 tracking-widest uppercase animate-pulse",children:$.total>0?` ${$.current} / ${$.total}...`:"..."}),$.total>1&&o.jsx("div",{className:"w-24 h-1 bg-white/10 rounded-full overflow-hidden mt-1",children:o.jsx("div",{className:"h-full bg-cyan-500 transition-all duration-500",style:{width:`${$.current/$.total*100}%`}})})]}):I.length>0?(0,o.jsxs)("div",{className:"relative w-full h-full group/video",onClick:eo,children:[D&&o.jsx("audio",{ref:O,src:D,loop:!0}),o.jsx("video",{ref:C,src:I[P],className:"w-full h-full object-contain bg-black",playsInline:!0,crossOrigin:"anonymous",onEnded:()=>{P<I.length-1?(j(e=>e+1),setTimeout(()=>C.current?.play(),50)):(w(!1),j(0),O.current?.pause())},onError:e=>{console.error("Video playback error",e)}}),!_&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-[1px]",children:o.jsx(eA,{size:48,className:"text-white/80 fill-white/20"})}),I.length>1&&o.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-1 pointer-events-none",children:I.map((e,t)=>o.jsx("div",{className:`h-1 rounded-full transition-all ${t===P?"w-6 bg-cyan-500":"w-2 bg-white/30"}`},t))})]}):d.length>0?(0,o.jsxs)("div",{className:"relative w-full h-full",children:[o.jsx("img",{src:null!==y&&d[y]?d[y].src:d[0].src,className:"w-full h-full object-contain opacity-80"}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("button",{onClick:eo,disabled:0===I.length,className:`w-14 h-14 rounded-full flex items-center justify-center transition-all backdrop-blur-md group/play
                                ${I.length>0?"bg-cyan-500/20 hover:bg-cyan-500/40 border border-cyan-500/50 shadow-[0_0_20px_rgba(6,182,212,0.3)]":"bg-white/5 border border-white/10 cursor-default opacity-50"}
                             `,children:_?o.jsx(eM,{size:24,className:"text-white"}):o.jsx(eA,{size:24,className:"text-white ml-1",fill:I.length>0?"currentColor":"none"})})}),(0,o.jsxs)("div",{className:"absolute top-2 right-2 px-2 py-1 bg-black/50 backdrop-blur rounded text-[9px] text-slate-300 font-mono border border-white/5 pointer-events-none",children:[er,"s  ",d.length," Frames"]})]}):(0,o.jsxs)("div",{className:"flex flex-col items-center text-slate-600 gap-2 select-none",children:[o.jsx(eD,{size:32,strokeWidth:1}),o.jsx("span",{className:"text-[10px] font-medium tracking-wider",children:""})]})]})]}),(0,o.jsxs)("div",{className:"w-full h-6 bg-[#1c1c1e]/80 backdrop-blur-md rounded-t-lg border-t border-x border-white/5 relative overflow-hidden flex cursor-crosshair group/strip",style:{width:"min(90vw, 820px)"},onMouseMove:e=>{let t=e.currentTarget.getBoundingClientRect();b(Math.min(d.length-1,Math.floor((e.clientX-t.left)/t.width*d.length)))},onMouseLeave:()=>b(null),children:[d.map((e,t)=>o.jsx("div",{className:"flex-1 h-full relative border-r border-white/5 last:border-0 overflow-hidden",children:o.jsx("img",{src:e.src,className:"w-full h-full object-cover opacity-30 grayscale group-hover/strip:opacity-50 transition-opacity"})},e.id)),null!==y&&d.length>0&&o.jsx("div",{className:"absolute top-0 bottom-0 bg-cyan-500/20 border-x border-cyan-500/50 pointer-events-none transition-all duration-75 ease-out",style:{left:`${y/d.length*100}%`,width:`${100/d.length}%`}})]}),(0,o.jsxs)("div",{className:"bg-[#0a0a0c]/95 backdrop-blur-2xl border border-white/10 rounded-b-2xl rounded-t-sm shadow-[0_20px_60px_rgba(0,0,0,0.6)] p-4 flex items-center gap-4 relative z-10",style:{width:"min(90vw, 820px)"},children:[o.jsx("button",{onClick:t,className:"absolute -top-3 left-0 -translate-y-full p-2 text-slate-400 hover:text-white bg-black/50 backdrop-blur rounded-full border border-white/10 transition-colors",children:o.jsx(N,{size:14})}),(0,o.jsxs)("div",{className:"flex-1 flex items-center gap-2 overflow-x-auto custom-scrollbar pb-1 min-h-[80px]",children:[d.map((e,t)=>(0,o.jsxs)(a().Fragment,{children:[(0,o.jsxs)("div",{className:`
                                        relative w-[72px] h-[72px] shrink-0 rounded-lg overflow-hidden border transition-all duration-300 ease-out group select-none
                                        ${h===t?"opacity-30 scale-90 grayscale":"border-white/10 hover:border-white/30 bg-white/5"}
                                        ${m===t?"translate-x-2":""}
                                    `,onDragOver:e=>ea(e,t),onDrop:el,children:[o.jsx("img",{src:e.src,className:"w-full h-full object-cover pointer-events-none"}),o.jsx("div",{className:"absolute top-0.5 right-0.5 w-4 h-4 bg-black/60 rounded-full flex items-center justify-center text-[8px] font-bold text-white/80 pointer-events-none",children:t+1}),o.jsx("button",{onClick:t=>{t.stopPropagation(),p(t=>t.filter(t=>t.id!==e.id))},className:"absolute top-0.5 left-0.5 w-4 h-4 rounded-full flex items-center justify-center bg-black/60 hover:bg-red-500 text-white/70 hover:text-white transition-colors opacity-0 group-hover:opacity-100 z-20",children:o.jsx(N,{size:10,strokeWidth:3})}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-grab active:cursor-grabbing bg-black/20 backdrop-blur-[1px]",draggable:!0,onDragStart:e=>es(e,t),children:o.jsx("div",{className:"w-8 h-8 rounded-full bg-black/50 flex items-center justify-center border border-white/20 text-white/80 hover:scale-110 transition-transform",children:o.jsx(eU,{size:16})})})]}),t<d.length-1&&(0,o.jsxs)("div",{className:"relative flex flex-col items-center justify-center w-6 shrink-0 z-10",children:[o.jsx("div",{className:"h-[2px] w-full bg-white/10 absolute top-1/2 -translate-y-1/2 -z-10"}),o.jsx("button",{"data-link-btn":!0,onClick:()=>ec(e.id,e.transition),className:`
                                                w-5 h-5 rounded-full flex items-center justify-center transition-all hover:scale-110 border
                                                ${e.transition.prompt?"bg-cyan-500 border-cyan-400 text-black shadow-[0_0_10px_rgba(6,182,212,0.5)]":"bg-[#2c2c2e] border-white/20 text-slate-500 hover:text-white hover:border-white"}
                                            `,children:o.jsx(M,{size:10,strokeWidth:2.5})}),(0,o.jsxs)("span",{className:"text-[8px] text-slate-500 mt-1 font-mono tracking-tighter",children:[e.transition.duration,"s"]})]})]},e.id)),d.length<10&&(0,o.jsxs)("div",{className:"w-[72px] h-[72px] shrink-0 rounded-lg border border-dashed border-white/10 hover:border-white/30 bg-white/5 hover:bg-white/10 flex flex-col items-center justify-center gap-1 cursor-pointer transition-all group active:scale-95",onClick:()=>Q.current?.click(),onDragOver:e=>e.preventDefault(),onDrop:el,children:[o.jsx(k.Z,{size:18,className:"text-slate-500 group-hover:text-white transition-colors"}),o.jsx("span",{className:"text-[9px] text-slate-500 font-medium",children:"Add"})]}),o.jsx("input",{type:"file",ref:Q,className:"hidden",accept:"image/*",multiple:!0,onChange:e=>{e.target.files&&e.target.files.length>0&&Promise.all(Array.from(e.target.files).map(e=>new Promise(t=>{let r=new FileReader;r.onload=e=>t({id:`seq-${Date.now()}-${Math.random()}`,src:e.target?.result,transition:{duration:3,prompt:""}}),r.readAsDataURL(e)}))).then(e=>p(t=>[...t,...e].slice(0,10))),e.target.value=""}})]}),(0,o.jsxs)("div",{className:"pl-4 border-l border-white/10 flex flex-col gap-2 shrink-0",children:[o.jsx("button",{onClick:()=>p([]),className:"p-2 rounded-lg bg-white/5 hover:bg-red-500/20 text-slate-400 hover:text-red-400 transition-colors",title:"",children:o.jsx(x.Z,{size:14})}),o.jsx("button",{onClick:en,disabled:d.length<2||L,className:`
                                w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-lg
                                ${d.length>=2&&!L?"bg-gradient-to-br from-cyan-500 to-blue-600 text-white hover:scale-110 hover:shadow-cyan-500/30":"bg-white/10 text-slate-600 cursor-not-allowed"}
                            `,title:"",children:L?o.jsx(E,{size:18,className:"animate-spin"}):o.jsx(eL,{size:18,strokeWidth:3})}),o.jsx("button",{onClick:ei,disabled:0===I.length||q,className:`
                                w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-lg
                                ${I.length>0&&!q?D?"bg-purple-500/20 text-purple-400 border border-purple-500/50":"bg-white/5 hover:bg-purple-500/20 text-slate-400 hover:text-purple-400":"bg-white/5 text-slate-600 cursor-not-allowed opacity-50"}
                            `,title:D?"":"",children:q?o.jsx(E,{size:16,className:"animate-spin"}):o.jsx(eG,{size:16})})]})]}),J&&(0,o.jsxs)("div",{ref:et,className:"absolute bottom-[130px] z-[100] w-[240px] aspect-[9/16] bg-[#18181b] border border-white/10 rounded-2xl shadow-[0_20px_60px_rgba(0,0,0,0.9)] flex flex-col animate-in slide-in-from-bottom-4 zoom-in-95 duration-300 overflow-hidden",style:{left:"50%",transform:"translateX(-50%)"},children:[(0,o.jsxs)("div",{className:"px-4 py-4 border-b border-white/5 bg-white/5 flex justify-between items-center",children:[o.jsx("span",{className:"text-xs font-bold text-slate-200 tracking-wide",children:""}),o.jsx("button",{onClick:()=>eu(),className:"text-slate-500 hover:text-white",children:o.jsx(N,{size:12})})]}),o.jsx("div",{className:"flex-1 p-4",children:o.jsx("textarea",{className:"w-full h-full bg-[#09090b] border border-white/10 rounded-xl p-3 text-xs text-slate-200 placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 resize-none leading-relaxed custom-scrollbar shadow-inner",placeholder:"...",value:K,onChange:e=>Y(e.target.value),autoFocus:!0})}),(0,o.jsxs)("div",{className:"p-4 pt-0 flex flex-col gap-3",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 bg-[#09090b] border border-white/10 rounded-xl px-3 py-2",children:[o.jsx(F.Z,{size:12,className:"text-slate-500 shrink-0"}),o.jsx("input",{type:"range",min:"1",max:"6",step:"0.5",value:X,onChange:e=>Z(parseFloat(e.target.value)),className:"flex-1 h-1 bg-white/10 rounded-full appearance-none [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-cyan-500 cursor-pointer"}),(0,o.jsxs)("span",{className:"text-[10px] font-mono text-slate-300 min-w-[24px] text-right",children:[X,"s"]})]}),(0,o.jsxs)("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:eu,className:"flex-1 py-2.5 bg-white text-black hover:bg-slate-200 rounded-xl text-xs font-bold transition-colors shadow-lg",children:""}),I.length>0&&I[d.findIndex(e=>e.id===J)]&&o.jsx("button",{onClick:()=>{eu();let e=d.findIndex(e=>e.id===J);-1!==e&&(j(e),setTimeout(ed,50))},className:"px-3 py-2.5 bg-cyan-500 hover:bg-cyan-400 text-black rounded-xl text-xs font-bold transition-colors shadow-lg shadow-cyan-500/20",title:"",children:o.jsx(v,{size:14})})]})]}),o.jsx("div",{className:"absolute bottom-[-5px] left-1/2 -translate-x-1/2 w-3 h-3 bg-[#18181b] border-r border-b border-white/10 rotate-45 pointer-events-none"})]})]})]})},eB=(0,l.Z)("AudioLines",[["path",{d:"M2 10v3",key:"1fnikh"}],["path",{d:"M6 6v11",key:"11sgs0"}],["path",{d:"M10 3v18",key:"yhl04a"}],["path",{d:"M14 8v7",key:"3a1oy3"}],["path",{d:"M18 5v13",key:"123xd1"}],["path",{d:"M22 10v3",key:"154ddg"}]]),eH=(0,l.Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),eV=(0,l.Z)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),e$=(0,l.Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ez=(0,l.Z)("FileAudio",[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]]),eJ=(0,l.Z)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),eW=(0,l.Z)("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),eK=(0,l.Z)("Disc",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),eY=[{label:" (Narrator)",desc:"Deep, resonant male voice, slow pacing, storytelling style.",gender:"Male"},{label:" (Energetic)",desc:"High energy, fast paced, enthusiastic YouTuber style.",gender:"Any"},{label:" (News)",desc:"Professional, articulate, neutral tone, broadcast standard.",gender:"Female"},{label:" (Anime)",desc:'High pitched, cute, expressive, "kawaii" aesthetic.',gender:"Female"},{label:" (Epic)",desc:"Gravelly, dramatic, movie trailer voice, intense.",gender:"Male"},{label:" (Elder)",desc:"Warm, shaky, wise, slow speaking grandmother/grandfather.",gender:"Any"}],eX=[{label:" (Neutral)",value:"neutral"},{label:" (Happy)",value:"cheerful and excited"},{label:" (Sad)",value:"melancholic and tearful"},{label:" (Angry)",value:"furious and shouting"},{label:" (Whisper)",value:"whispering quietly"},{label:" (Scared)",value:"trembling and fearful"}],eZ=["from-pink-500 to-rose-500","from-cyan-500 to-blue-500","from-purple-500 to-indigo-500","from-emerald-500 to-teal-500","from-orange-500 to-amber-500","from-slate-700 to-slate-900"],eQ=async(e,t)=>{let r=atob(e),n=r.length,i=new Uint8Array(n);for(let e=0;e<n;e++)i[e]=r.charCodeAt(e);let o=new Int16Array(i.buffer),s=new Float32Array(o.length);for(let e=0;e<o.length;e++)s[e]=o[e]/32768;let a=t.createBuffer(1,s.length,24e3);return a.copyToChannel(s,0),a},e0=e=>{let t=new Int16Array(e.length);for(let r=0;r<e.length;r++){let n=Math.max(-1,Math.min(1,e[r]));t[r]=n<0?32768*n:32767*n}return t},e1=e=>{let t="",r=new Uint8Array(e),n=r.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(r[e]);return btoa(t)},e2=({isOpen:e,onClose:t,history:r,onGenerate:n,onSaveToAssets:i})=>{let[a,l]=(0,s.useState)("factory"),[c,u]=(0,s.useState)([]),[d,p]=(0,s.useState)(!1),h=(0,s.useRef)(null),f=(0,s.useRef)(null),m=(0,s.useRef)(null),g=(0,s.useRef)(null),y=(0,s.useRef)(null),[v,b]=(0,s.useState)(null),[_,w]=(0,s.useState)(!1),[S,T]=(0,s.useState)(.8),[C,O]=(0,s.useState)(0),[I,k]=(0,s.useState)(0),R=(0,s.useRef)(null),P=(0,s.useRef)(null),j=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(_&&h.current&&R.current){if(!f.current){let e=new(window.AudioContext||window.webkitAudioContext);f.current=e;let t=e.createAnalyser();t.fftSize=256,g.current=t;let r=e.createMediaElementSource(R.current);m.current=r,r.connect(t),t.connect(e.destination)}let e=f.current,t=g.current;"suspended"===e.state&&e.resume();let r=()=>{let e;let n=h.current;if(!n)return;let i=n.getContext("2d");if(!i)return;let o=t.frequencyBinCount,s=new Uint8Array(o);t.getByteFrequencyData(s),i.clearRect(0,0,n.width,n.height);let a=n.width/o*2.5,l=0;for(let t=0;t<o;t++){e=s[t]/2;let r=i.createLinearGradient(0,n.height,0,0);r.addColorStop(0,"#06b6d4"),r.addColorStop(1,"#8b5cf6"),i.fillStyle=r,i.fillRect(l,n.height-e,a,e),l+=a+1}y.current=requestAnimationFrame(r)};return r(),()=>{y.current&&cancelAnimationFrame(y.current)}}},[_,v]);let[M,D]=(0,s.useState)(""),[U,L]=(0,s.useState)(null),[G,F]=(0,s.useState)(eX[0]),[q,B]=(0,s.useState)(null),[H,V]=(0,s.useState)(null),[$,z]=(0,s.useState)(!1),[J,W]=(0,s.useState)(null),[K,X]=(0,s.useState)(null),[Q,ee]=(0,s.useState)(""),[et,er]=(0,s.useState)(!1),[ei,eo]=(0,s.useState)(!1),[es,ea]=(0,s.useState)("Ready"),[el,ec]=(0,s.useState)(null),eu=(0,s.useRef)(0),ed=(0,s.useRef)(null),ep=(0,s.useRef)(null),eh=(0,s.useRef)(null);(0,s.useEffect)(()=>{v&&R.current&&(R.current.src=v.src,R.current.play().then(()=>w(!0)).catch(()=>{}))},[v]);let ef=()=>{R.current&&(O(R.current.currentTime),k(R.current.duration||0))},em=async()=>{if(M.trim()&&!$){z(!0);try{let e=await (0,ev.gW)(M,q||void 0,{persona:U,emotion:G});n(e,M,0),b({id:`temp-${Date.now()}`,src:e,title:M.substring(0,30)+(M.length>30?"...":""),timestamp:Date.now()})}catch(e){console.error(e),alert("")}finally{z(!1)}}},ey=async()=>{if(J&&!et){er(!0);try{let e=await (0,ev.KR)(J);ee(e)}catch(e){console.error(e),alert("")}finally{er(!1)}}},eb=async()=>{try{ea("Connecting...");let e=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});ec(e),eu.current=0;let t=await (0,ev.jL)(async t=>{"suspended"===e.state&&await e.resume();let r=await eQ(t,e),n=e.createBufferSource();n.buffer=r,n.connect(e.destination);let i=e.currentTime,o=Math.max(i,eu.current);n.start(o),eu.current=o+r.duration},()=>e_());ed.current=t;let r=await navigator.mediaDevices.getUserMedia({audio:!0});eh.current=r;let n=e.createMediaStreamSource(r),i=e.createScriptProcessor(4096,1,1);ep.current=i,i.onaudioprocess=e=>{let r=e.inputBuffer.getChannelData(0),n=e0(r),i=e1(n.buffer);t.sendRealtimeInput({media:{mimeType:"audio/pcm;rate=16000",data:i}})},n.connect(i),i.connect(e.destination);let o=e.createGain();o.gain.value=0,i.connect(o),o.connect(e.destination),ea("Connected & Listening"),eo(!0)}catch(e){console.error("Live Error",e),ea("Error Connecting"),e_()}},e_=()=>{ed.current&&(ed.current=null),ep.current&&(ep.current.disconnect(),ep.current=null),eh.current&&(eh.current.getTracks().forEach(e=>e.stop()),eh.current=null),el&&(el.close(),ec(null)),eo(!1),ea("Ready")},eE=e=>{let t=e.charCodeAt(e.length-1)%eZ.length;return eZ[t]};return(0,o.jsxs)("div",{className:`fixed inset-0 z-[100] transition-all duration-500 ease-[cubic-bezier(0.32,0.72,0,1)] bg-[#0a0a0c] overflow-hidden flex ${e?"opacity-100 scale-100 translate-x-0":"opacity-0 scale-95 -translate-x-10 pointer-events-none"}`,style:{transformOrigin:"left center"},children:[o.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[600px] h-[600px] rounded-full bg-cyan-900/10 blur-[120px] pointer-events-none"}),o.jsx("div",{className:"absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] rounded-full bg-purple-900/10 blur-[100px] pointer-events-none"}),(0,o.jsxs)("div",{className:"w-64 h-full border-r border-white/5 bg-[#121214] flex flex-col z-10",children:[(0,o.jsxs)("div",{className:"h-16 flex items-center px-6 border-b border-white/5 gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-purple-900/20",children:o.jsx(eB,{size:16,className:"text-white"})}),o.jsx("span",{className:"text-sm font-bold tracking-wide text-white",children:"Audio Hub"})]}),(0,o.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,o.jsxs)("button",{onClick:()=>l("factory"),className:`flex items-center gap-3 px-3 py-2.5 rounded-xl text-xs font-bold transition-all ${"factory"===a?"bg-white/10 text-white shadow-md":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[o.jsx(Y,{size:16}),"  (Voice Factory)"]}),(0,o.jsxs)("button",{onClick:()=>l("transcribe"),className:`flex items-center gap-3 px-3 py-2.5 rounded-xl text-xs font-bold transition-all ${"transcribe"===a?"bg-white/10 text-white shadow-md":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[o.jsx(eH,{size:16}),"  (Transcriber)"]}),(0,o.jsxs)("button",{onClick:()=>l("live"),className:`flex items-center gap-3 px-3 py-2.5 rounded-xl text-xs font-bold transition-all ${"live"===a?"bg-white/10 text-white shadow-md":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[o.jsx(eV,{size:16}),"  (Live Chat)"]}),(0,o.jsxs)("button",{onClick:()=>p(!d),className:`flex items-center gap-3 px-3 py-2.5 rounded-xl text-xs font-bold transition-all ${d?"bg-cyan-500/20 text-cyan-400":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[o.jsx(eC,{size:16}),"  (Multi-track)"]})]}),(0,o.jsxs)("div",{className:"mt-auto p-4 border-t border-white/5",children:[o.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2",children:""}),o.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-1 h-48",children:0===r.length?o.jsx("div",{className:"text-xs text-slate-600 text-center py-4",children:""}):r.map(e=>(0,o.jsxs)("div",{onClick:()=>b(e),className:`group flex items-center gap-2 p-2 rounded-lg cursor-pointer transition-all ${v?.id===e.id?"bg-white/10":"hover:bg-white/5"}`,children:[o.jsx("div",{className:`w-6 h-6 rounded bg-gradient-to-br ${eE(e.id)} flex items-center justify-center shrink-0`,children:o.jsx(Y,{size:10,className:"text-white/70"})}),o.jsx("span",{className:`text-xs truncate ${v?.id===e.id?"text-cyan-400":"text-slate-400"}`,children:e.title})]},e.id))})]})]}),(0,o.jsxs)("div",{className:"flex-1 flex flex-col relative z-0",children:[o.jsx("div",{className:"absolute top-6 left-6 flex items-center gap-4 z-20",children:o.jsx("button",{onClick:t,className:"p-2 rounded-full bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:o.jsx(N,{size:20})})}),o.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8 pb-32",children:(0,o.jsxs)("div",{className:"max-w-5xl mx-auto flex flex-col gap-8",children:["factory"===a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"space-y-1 pl-12",children:[" ",(0,o.jsxs)("h1",{className:"text-3xl font-black text-white tracking-tight",children:[" ",o.jsx("span",{className:"text-slate-500 font-light ml-2 text-xl",children:"Voice Factory"})]}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Create realistic voiceovers, clone voices, and generate emotional speech."})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,o.jsxs)("div",{className:"lg:col-span-1 flex flex-col gap-6",children:[(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("h2",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[o.jsx(e$,{size:12}),"  ()"]}),(0,o.jsxs)("div",{className:`relative h-32 rounded-xl border border-dashed transition-all flex flex-col items-center justify-center gap-2 cursor-pointer group overflow-hidden ${q?"border-cyan-500/50 bg-cyan-500/5":"border-white/10 hover:border-white/30 bg-white/5 hover:bg-white/10"}`,onClick:()=>P.current?.click(),children:[o.jsx("input",{type:"file",ref:P,className:"hidden",accept:"audio/*",onChange:e=>{let t=e.target.files?.[0];if(t){V(t.name);let e=new FileReader;e.onload=e=>B(e.target?.result),e.readAsDataURL(t)}}}),q?(0,o.jsxs)(o.Fragment,{children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-cyan-500/20 flex items-center justify-center text-cyan-400",children:o.jsx(ez,{size:20})}),o.jsx("span",{className:"text-xs font-medium text-cyan-200 truncate max-w-[80%]",children:H}),o.jsx("button",{onClick:e=>{e.stopPropagation(),B(null),V(null)},className:"absolute top-2 right-2 p-1.5 rounded-full bg-black/40 hover:bg-red-500/80 text-white/50 hover:text-white transition-colors",children:o.jsx(N,{size:10})})]}):(0,o.jsxs)(o.Fragment,{children:[o.jsx(Y,{size:24,className:"text-slate-500 group-hover:text-cyan-400 transition-colors"}),o.jsx("span",{className:"text-xs text-slate-500 group-hover:text-slate-300",children:""}),o.jsx("span",{className:"text-[9px] text-slate-600 text-center px-4",children:"AI  (Approximate)"})]})]})]}),(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("h2",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[o.jsx(eJ,{size:12})," "]}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:eX.map(e=>o.jsx("button",{onClick:()=>F(e),className:`px-3 py-2 rounded-lg text-xs font-medium text-left transition-all ${G.value===e.value?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"bg-white/5 text-slate-400 hover:bg-white/10 border border-transparent"}`,children:e.label},e.value))})]})]}),(0,o.jsxs)("div",{className:"lg:col-span-2 flex flex-col gap-6",children:[(0,o.jsxs)("div",{className:"relative group flex-1",children:[o.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-cyan-500/10 to-purple-500/10 rounded-2xl blur opacity-0 group-hover:opacity-100 transition duration-500"}),(0,o.jsxs)("div",{className:"relative bg-[#1c1c1e] border border-white/10 rounded-2xl p-5 shadow-2xl flex flex-col h-full min-h-[240px]",children:[o.jsx("textarea",{className:"w-full flex-1 bg-transparent text-lg text-slate-200 placeholder-slate-600 focus:outline-none resize-none font-medium leading-relaxed",placeholder:"...",value:M,onChange:e=>D(e.target.value)}),(0,o.jsxs)("div",{className:"flex justify-between items-center mt-4 pt-4 border-t border-white/5",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[U&&(0,o.jsxs)("div",{className:"px-2 py-1 bg-purple-500/20 border border-purple-500/30 rounded text-[10px] text-purple-300 flex items-center gap-1",children:[o.jsx(Z,{size:10})," ",U.label]}),q&&(0,o.jsxs)("div",{className:"px-2 py-1 bg-cyan-500/20 border border-cyan-500/30 rounded text-[10px] text-cyan-300 flex items-center gap-1",children:[o.jsx(ez,{size:10})," Custom Clone"]})]}),(0,o.jsxs)("button",{onClick:em,disabled:!M.trim()||$,className:`px-6 py-2.5 rounded-xl font-bold text-sm shadow-lg transition-all flex items-center gap-2 ${!M.trim()||$?"bg-white/5 text-slate-500 cursor-not-allowed":"bg-gradient-to-r from-cyan-500 to-blue-600 text-white hover:scale-105 hover:shadow-cyan-500/25"}`,children:[$?o.jsx(E,{size:16,className:"animate-spin"}):o.jsx(eg,{size:16}),$?"...":""]})]})]})]}),(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("h2",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[o.jsx(Z,{size:12}),"  (Personas)"]}),o.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:eY.map(e=>(0,o.jsxs)("button",{onClick:()=>{L(e),B(null),V(null)},className:`p-3 rounded-xl border text-left transition-all group ${U?.label===e.label?"bg-purple-500/10 border-purple-500/50":"bg-white/5 border-white/5 hover:border-white/20 hover:bg-white/10"}`,children:[o.jsx("div",{className:"flex justify-between items-start mb-1",children:o.jsx("span",{className:`text-xs font-bold ${U?.label===e.label?"text-purple-400":"text-slate-300"}`,children:e.label})}),o.jsx("p",{className:"text-[9px] text-slate-500 leading-relaxed line-clamp-2",children:e.desc})]},e.label))})]})]})]})]}),"transcribe"===a&&(0,o.jsxs)("div",{className:"flex flex-col gap-6 animate-in fade-in slide-in-from-bottom-4 duration-300 pl-12",children:[(0,o.jsxs)("div",{className:"space-y-1",children:[(0,o.jsxs)("h1",{className:"text-3xl font-black text-white tracking-tight",children:[" ",o.jsx("span",{className:"text-slate-500 font-light ml-2 text-xl",children:"Transcriber"})]}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Accurately transcribe audio files into text using Gemini 2.5."})]}),(0,o.jsxs)("div",{className:`relative h-40 rounded-2xl border-2 border-dashed flex flex-col items-center justify-center gap-4 cursor-pointer transition-all hover:bg-white/5 ${J?"border-cyan-500/30 bg-cyan-500/5":"border-white/10"}`,onClick:()=>j.current?.click(),children:[o.jsx("input",{type:"file",ref:j,className:"hidden",accept:"audio/*",onChange:e=>{let t=e.target.files?.[0];if(t){X(t.name);let e=new FileReader;e.onload=e=>W(e.target?.result),e.readAsDataURL(t)}}}),J?(0,o.jsxs)(o.Fragment,{children:[o.jsx(ez,{size:48,className:"text-cyan-400"}),o.jsx("span",{className:"text-sm font-medium text-cyan-200",children:K}),o.jsx("button",{onClick:e=>{e.stopPropagation(),W(null)},className:"absolute top-4 right-4 p-2 bg-black/40 hover:bg-red-500/20 text-white/50 hover:text-red-400 rounded-full",children:o.jsx(N,{size:16})})]}):(0,o.jsxs)(o.Fragment,{children:[o.jsx(e$,{size:48,className:"text-slate-600"}),(0,o.jsxs)("div",{className:"text-center",children:[o.jsx("span",{className:"text-sm font-bold text-slate-400",children:""}),o.jsx("p",{className:"text-xs text-slate-600 mt-1",children:" MP3, WAV, M4A, AAC"})]})]})]}),o.jsx("div",{className:"flex justify-center",children:(0,o.jsxs)("button",{onClick:ey,disabled:!J||et,className:`px-8 py-3 rounded-full font-bold text-sm shadow-lg transition-all flex items-center gap-2 ${!J||et?"bg-white/5 text-slate-500 cursor-not-allowed":"bg-cyan-500 text-black hover:scale-105"}`,children:[et?o.jsx(E,{size:18,className:"animate-spin"}):o.jsx(eH,{size:18}),et?"...":""]})}),Q&&(0,o.jsxs)("div",{className:"bg-[#1c1c1e] border border-white/10 rounded-2xl p-6 relative",children:[o.jsx("button",{onClick:()=>navigator.clipboard.writeText(Q),className:"absolute top-4 right-4 p-2 text-slate-500 hover:text-white bg-black/20 hover:bg-black/40 rounded-lg transition-colors",title:"",children:o.jsx(eH,{size:14})}),o.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4",children:""}),o.jsx("p",{className:"text-sm text-slate-300 leading-relaxed whitespace-pre-wrap",children:Q})]})]}),"live"===a&&(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center gap-10 py-10 animate-in fade-in slide-in-from-bottom-4 duration-300 pl-12",children:[(0,o.jsxs)("div",{className:"space-y-2 text-center",children:[(0,o.jsxs)("h1",{className:"text-3xl font-black text-white tracking-tight",children:[" ",o.jsx("span",{className:"text-slate-500 font-light ml-2 text-xl",children:"Live"})]}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Bidirectional real-time conversation with Gemini 2.0 Flash Exp."})]}),(0,o.jsxs)("div",{className:"relative w-64 h-64 flex items-center justify-center",children:[ei&&(0,o.jsxs)(o.Fragment,{children:[o.jsx("div",{className:"absolute inset-0 bg-cyan-500/20 rounded-full animate-ping opacity-20",style:{animationDuration:"2s"}}),o.jsx("div",{className:"absolute inset-4 bg-purple-500/20 rounded-full animate-ping opacity-20",style:{animationDuration:"3s",animationDelay:"0.5s"}})]}),(0,o.jsxs)("div",{className:`relative z-10 w-48 h-48 rounded-full flex flex-col items-center justify-center transition-all duration-500 border-4 ${ei?"bg-gradient-to-br from-cyan-900/50 to-purple-900/50 border-cyan-500 shadow-[0_0_50px_rgba(6,182,212,0.3)]":"bg-[#1c1c1e] border-white/10"}`,children:[o.jsx(eC,{size:48,className:ei?"text-cyan-400 animate-pulse":"text-slate-600"}),o.jsx("span",{className:`text-xs font-bold mt-4 uppercase tracking-widest ${ei?"text-cyan-200":"text-slate-600"}`,children:es})]})]}),(0,o.jsxs)("button",{onClick:()=>{ei?e_():eb()},className:`px-10 py-4 rounded-full font-bold text-base shadow-xl transition-all flex items-center gap-3 hover:scale-105 active:scale-95 ${ei?"bg-red-500/20 text-red-400 border border-red-500/50 hover:bg-red-500 hover:text-white":"bg-cyan-500 text-black hover:bg-cyan-400"}`,children:[ei?o.jsx(N,{size:20}):o.jsx(Y,{size:20}),ei?"":""]}),o.jsx("p",{className:"text-[10px] text-slate-500 max-w-sm text-center",children:"Uses Gemini Live API (WebSocket). Please allow microphone access. Ensure you are in a quiet environment for best results."})]}),d&&(0,o.jsxs)("div",{className:"bg-[#121214] border border-white/10 rounded-2xl p-6 shadow-2xl animate-in fade-in slide-in-from-right-10 duration-500",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[o.jsx(eC,{size:18,className:"text-cyan-400"}),o.jsx("h2",{className:"text-sm font-black uppercase tracking-widest text-white",children:" (Mixer)"})]}),o.jsx("button",{onClick:()=>p(!1),className:"text-slate-500 hover:text-white",children:o.jsx(N,{size:18})})]}),o.jsx("div",{className:"space-y-4",children:0===c.length?o.jsx("div",{className:"py-10 text-center border border-dashed border-white/5 rounded-xl",children:o.jsx("p",{className:"text-[10px] text-slate-600 uppercase font-bold tracking-widest",children:""})}):c.map((e,t)=>(0,o.jsxs)("div",{className:"bg-white/5 p-4 rounded-xl flex items-center gap-4 border border-white/5",children:[o.jsx("div",{className:`w-10 h-10 rounded-lg bg-gradient-to-br ${eE(e.id)} flex items-center justify-center shrink-0`,children:o.jsx(Y,{size:16,className:"text-white/70"})}),(0,o.jsxs)("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"text-[11px] font-bold text-white truncate",children:e.title}),(0,o.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[o.jsx(eW,{size:12,className:"text-slate-500"}),o.jsx("input",{type:"range",className:"flex-1 h-1 bg-white/10 rounded-full appearance-none accent-cyan-500"})]})]}),o.jsx("button",{onClick:()=>u(e=>e.filter((e,r)=>r!==t)),className:"p-2 text-slate-600 hover:text-red-400",children:o.jsx(x.Z,{size:16})})]},t))})]})]})}),("factory"===a||v&&"live"!==a)&&(0,o.jsxs)("div",{className:"h-24 bg-[#121214]/90 backdrop-blur-xl border-t border-white/10 flex items-center px-8 gap-8 relative z-20",children:[(0,o.jsxs)("div",{className:"w-64 flex items-center gap-4",children:[(0,o.jsxs)("div",{className:`w-14 h-14 rounded-lg bg-gradient-to-br ${v?eE(v.id):"from-slate-700 to-slate-800"} shadow-lg flex items-center justify-center relative overflow-hidden group/cover`,children:[v?o.jsx(Y,{size:24,className:"text-white/80"}):o.jsx(eK,{size:24,className:"text-slate-500"}),o.jsx("canvas",{ref:h,className:"absolute inset-0 w-full h-full opacity-40",width:56,height:56})]}),(0,o.jsxs)("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"text-sm font-bold text-white truncate",children:v?.title||"Ready to speak"}),o.jsx("span",{className:"text-xs text-slate-500",children:"Voice Factory AI"})]})]}),(0,o.jsxs)("div",{className:"flex-1 flex flex-col items-center gap-2 max-w-2xl mx-auto",children:[o.jsx("div",{className:"flex items-center gap-6",children:o.jsx("button",{onClick:()=>{R.current&&v&&(_?(R.current.pause(),w(!1)):(R.current.play(),w(!0)))},disabled:!v,className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ${v?"bg-white text-black hover:scale-110":"bg-white/10 text-slate-600"}`,children:_?o.jsx(eM,{size:20,fill:"currentColor"}):o.jsx(eA,{size:20,fill:"currentColor",className:"ml-0.5"})})}),(0,o.jsxs)("div",{className:"w-full flex items-center gap-3 text-[10px] font-mono text-slate-500",children:[(0,o.jsxs)("span",{children:[Math.floor(C/60),":",Math.floor(C%60).toString().padStart(2,"0")]}),o.jsx("div",{className:"flex-1 h-1 bg-white/10 rounded-full relative overflow-hidden group/bar cursor-pointer",children:o.jsx("div",{className:"absolute top-0 left-0 h-full bg-cyan-500 rounded-full",style:{width:`${C/(I||1)*100}%`}})}),(0,o.jsxs)("span",{children:[Math.floor(I/60),":",Math.floor(I%60).toString().padStart(2,"0")]})]})]}),(0,o.jsxs)("div",{className:"w-64 flex items-center justify-end gap-3",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2 group/vol",children:[o.jsx(eW,{size:16,className:"text-slate-400"}),o.jsx("div",{className:"w-16 h-1 bg-white/10 rounded-full relative cursor-pointer",children:o.jsx("div",{className:"absolute top-0 left-0 h-full bg-slate-400 group-hover/vol:bg-white rounded-full",style:{width:`${100*S}%`}})})]}),o.jsx("button",{onClick:()=>v&&i?.({...v,type:"audio"}),className:"p-2 rounded-lg bg-white/5 hover:bg-purple-500/20 text-slate-400 hover:text-purple-400 transition-all",title:"",children:o.jsx(en,{size:18})}),o.jsx("button",{className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:o.jsx(A,{size:18})})]}),o.jsx("audio",{ref:R,onTimeUpdate:ef,onEnded:()=>w(!1),onLoadedMetadata:ef})]})]})]})},e4=(0,l.Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),e5=(0,l.Z)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),e3=(0,l.Z)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),e6=({isOpen:e,onClose:t})=>{let[n,i]=(0,s.useState)(""),[a,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[d,p]=(0,s.useState)(""),[h,f]=(0,s.useState)(""),[m,g]=(0,s.useState)(""),[y,v]=(0,s.useState)(!1),[b,_]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let t=async()=>{let e=localStorage.getItem("pollo_api_key")||"",t=localStorage.getItem("jimeng_api_key")||"",r=localStorage.getItem("mj_api_key")||"",n=localStorage.getItem("openai_api_key")||"",o=localStorage.getItem("openai_base_url")||"https://api.openai.com/v1",s=localStorage.getItem("inkai_api_key")||"";i(e),l(t),u(r),p(n),f(o),g(s),window.aistudio?v(await window.aistudio.hasSelectedApiKey()):v(!!s)};e&&t()},[e]);let E=async()=>{if(confirm("/"))try{let{del:e}=await r.e(711).then(r.bind(r,70711));await e("assets"),alert(" ()"),window.location.reload()}catch(e){alert("")}},w=async()=>{window.aistudio&&(await window.aistudio.openSelectKey(),v(!0))};return e?o.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center animate-in fade-in duration-200",onClick:t,children:(0,o.jsxs)("div",{className:"w-[540px] bg-[#1c1c1e] border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200 flex flex-col max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[o.jsx("button",{onClick:t,className:"text-slate-500 hover:text-white transition-colors",children:o.jsx(N,{size:18})}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"p-1.5 bg-slate-700/50 rounded-lg",children:o.jsx(e4,{size:16,className:"text-white"})}),o.jsx("span",{className:"text-sm font-bold text-white",children:"API  (Settings)"})]})]}),(0,o.jsxs)("div",{className:"p-6 space-y-8 overflow-y-auto custom-scrollbar flex-1",children:[(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[o.jsx(U,{size:16,className:"text-cyan-400"}),o.jsx("label",{className:"text-xs font-bold text-white uppercase tracking-wider",children:"Google Gemini API"})]}),o.jsx("div",{className:`px-2 py-0.5 rounded-full text-[9px] font-bold uppercase ${y?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-amber-500/20 text-amber-400 border border-amber-500/30"}`,children:y?" (Active)":" (Not Set)"})]}),(0,o.jsxs)("button",{onClick:w,className:`w-full flex items-center justify-center gap-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl py-4 transition-all group ${window.aistudio?"":"hidden"}`,children:[o.jsx(q,{size:18,className:"text-cyan-400 group-hover:scale-110 transition-transform"}),o.jsx("span",{className:"text-sm font-bold text-slate-200",children:" Gemini API Key"})]}),(0,o.jsxs)("div",{className:"space-y-1.5",children:[o.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase ml-1",children:"Google Gemini API Key ()"}),o.jsx("input",{type:"password",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 transition-colors font-mono",placeholder:" Key (AIzaSy...)",value:m,onChange:e=>g(e.target.value)})]}),(0,o.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,o.jsxs)("p",{className:"text-[11px] text-slate-400 leading-relaxed",children:[" ",o.jsx("strong",{children:"Gemini 3 Pro"})," (/), ",o.jsx("strong",{children:"Nano Banana Pro"})," ()  ",o.jsx("strong",{children:"Veo 3.1"})," () "]}),(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsxs)("a",{href:"https://ai.google.dev/gemini-api/docs/billing",target:"_blank",rel:"noreferrer",className:"text-[10px] text-cyan-500 hover:underline flex items-center gap-1",children:[" ",o.jsx(e5,{size:10})]}),o.jsx("span",{className:"text-[10px] text-slate-600",children:"|"}),o.jsx("span",{className:"text-[10px] text-slate-500 italic",children:" Veo "})]})]})]}),o.jsx("div",{className:"h-px bg-white/5 w-full"}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[o.jsx(et,{size:16,className:"text-purple-400"}),o.jsx("label",{className:"text-xs font-bold text-slate-200 uppercase tracking-wider",children:" (Data Management)"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,o.jsxs)("button",{onClick:()=>{try{let e=localStorage.getItem("inkai-storage-workflows");if(!e){alert("");return}let t=JSON.parse(e);if(!Array.isArray(t)||0===t.length){alert("");return}let r={version:"1.0",timestamp:Date.now(),workflows:t},n=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=`inkai-backup-all-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(e){console.error(e),alert("")}},className:"flex flex-col items-center justify-center gap-2 p-4 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-purple-500/30 rounded-xl transition-all group",children:[o.jsx(en,{size:20,className:"text-slate-400 group-hover:text-purple-400"}),o.jsx("span",{className:"text-xs font-bold text-slate-300",children:""})]}),(0,o.jsxs)("button",{onClick:E,className:"flex flex-col items-center justify-center gap-2 p-4 bg-white/5 hover:bg-red-500/10 border border-white/10 hover:border-red-500/30 rounded-xl transition-all group",children:[o.jsx(x.Z,{size:20,className:"text-slate-400 group-hover:text-red-400"}),o.jsx("span",{className:"text-xs font-bold text-slate-300 group-hover:text-red-400",children:""})]})]}),o.jsx("p",{className:"text-[11px] text-slate-500",children:" (IndexedDB)"})]}),o.jsx("div",{className:"h-px bg-white/5 w-full"}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[o.jsx(eV,{size:16,className:"text-emerald-400"}),o.jsx("label",{className:"text-xs font-bold text-slate-200 uppercase tracking-wider",children:"OpenAI (ChatGPT) "})]}),(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("div",{className:"space-y-1.5",children:[o.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase ml-1",children:"API Key"}),o.jsx("input",{type:"password",autoComplete:"off",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-emerald-500/50 transition-colors font-mono",placeholder:"sk-...",value:d,onChange:e=>p(e.target.value)})]}),(0,o.jsxs)("div",{className:"space-y-1.5",children:[(0,o.jsxs)("span",{className:"text-[10px] font-bold text-slate-500 uppercase ml-1 flex items-center gap-1",children:[o.jsx(e3,{size:10})," Base URL (Optional Proxy)"]}),o.jsx("input",{type:"text",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-emerald-500/50 transition-colors font-mono",placeholder:"https://api.openai.com/v1",value:h,onChange:e=>f(e.target.value)})]})]}),(0,o.jsxs)("p",{className:"text-[11px] text-slate-500",children:[" ",o.jsx("strong",{children:"GPT-4o / o1"})," "]})]}),o.jsx("div",{className:"h-px bg-white/5 w-full"}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[o.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Pollo.ai API Key (Wan 2.5)"}),(0,o.jsxs)("a",{href:"https://pollo.ai/dashboard/api-keys",target:"_blank",rel:"noreferrer",className:"flex items-center gap-1 text-[10px] text-cyan-400 hover:text-cyan-300 transition-colors",children:[o.jsx("span",{children:" Key"}),o.jsx(e5,{size:10})]})]}),o.jsx("input",{type:"password",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 transition-colors font-mono",placeholder:" Pollo API Key...",value:n,onChange:e=>i(e.target.value)}),(0,o.jsxs)("p",{className:"text-[11px] text-slate-500",children:[" ",o.jsx("strong",{children:"Wan 2.1 / 2.5"})," "]})]}),o.jsx("div",{className:"h-px bg-white/5 w-full"}),(0,o.jsxs)("div",{className:"space-y-4",children:[o.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:" (Jimeng) API Key"}),o.jsx("input",{type:"password",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 transition-colors font-mono",placeholder:" Jimeng API Key...",value:a,onChange:e=>l(e.target.value)}),(0,o.jsxs)("p",{className:"text-[11px] text-slate-500",children:[" ",o.jsx("strong",{children:" (Jimeng 2.1)"})," "]})]}),o.jsx("div",{className:"h-px bg-white/5 w-full"}),(0,o.jsxs)("div",{className:"space-y-4 pb-4",children:[o.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Midjourney API Key"}),o.jsx("input",{type:"password",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 transition-colors font-mono",placeholder:" Midjourney API Key...",value:c,onChange:e=>u(e.target.value)}),(0,o.jsxs)("p",{className:"text-[11px] text-slate-500",children:[" ",o.jsx("strong",{children:"Midjourney V7.0"})," "]})]})]}),o.jsx("div",{className:"p-4 border-t border-white/5 bg-[#121214] flex justify-end",children:o.jsx("button",{onClick:()=>{localStorage.setItem("pollo_api_key",n.trim()),localStorage.setItem("jimeng_api_key",a.trim()),localStorage.setItem("mj_api_key",c.trim()),localStorage.setItem("openai_api_key",d.trim()),localStorage.setItem("openai_base_url",h.trim()),localStorage.setItem("inkai_api_key",m.trim()),_(!0),setTimeout(()=>_(!1),2e3),setTimeout(t,500)},className:`px-8 py-2.5 rounded-xl text-xs font-bold transition-all ${b?"bg-green-500 text-white":"bg-white text-black hover:bg-cyan-400 active:scale-95"}`,children:b?" (Saved)":" (Save Changes)"})})]})}):null},e8=(0,l.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),e7=(0,l.Z)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),e9=(0,l.Z)("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),te=(0,l.Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),tt=(0,l.Z)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),tr=({isOpen:e,onClose:t})=>{let[r,n]=(0,s.useState)("overview");return e?(0,o.jsxs)("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 md:p-12",children:[o.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-xl",onClick:t}),(0,o.jsxs)("div",{className:"relative w-full max-w-6xl h-full bg-[#0c0c0e] border border-white/10 rounded-[32px] shadow-2xl overflow-hidden flex flex-col animate-in zoom-in-95 duration-300",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between px-8 py-6 border-b border-white/5 bg-white/[0.02]",children:[(0,o.jsxs)("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-12 h-12 rounded-2xl bg-cyan-500/10 border border-cyan-500/20 flex items-center justify-center text-cyan-400",children:o.jsx(ec,{size:24})}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("h2",{className:"text-xl font-black text-white tracking-tight",children:[" ",o.jsx("span",{className:"text-[10px] font-bold text-cyan-500 ml-2 bg-cyan-500/10 px-2 py-0.5 rounded-full",children:"PROTOTYPE"})]}),o.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em] mt-0.5",children:"Admin Management Dashboard"})]})]}),o.jsx("button",{onClick:t,className:"p-3 hover:bg-white/5 rounded-2xl text-slate-500 transition-colors",children:o.jsx(N,{size:24})})]}),(0,o.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[o.jsx("div",{className:"w-48 border-r border-white/5 bg-black/20 p-4 space-y-2",children:[{id:"overview",label:"",icon:tt},{id:"tasks",label:"",icon:eC},{id:"models",label:"",icon:e9},{id:"users",label:"",icon:e8}].map(e=>(0,o.jsxs)("button",{onClick:()=>n(e.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold transition-all ${r===e.id?"bg-cyan-500 text-black shadow-lg shadow-cyan-500/20":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[o.jsx(e.icon,{size:16}),e.label]},e.id))}),(0,o.jsxs)("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar",children:["overview"===r&&(0,o.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{label:"",value:"1,284",change:"+12.5%",icon:eC,color:"text-cyan-400"},{label:" (DAU)",value:"452",change:"+8.2%",icon:e8,color:"text-purple-400"},{label:"API ",value:"99.4%",change:"+0.1%",icon:L,color:"text-emerald-400"},{label:"",value:"85.2k",change:"+15.4%",icon:q,color:"text-amber-400"}].map((e,t)=>(0,o.jsxs)("div",{className:"bg-white/5 border border-white/5 rounded-2xl p-4",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[o.jsx(e.icon,{size:18,className:e.color}),(0,o.jsxs)("span",{className:"text-[10px] font-bold text-emerald-400 flex items-center gap-0.5",children:[o.jsx(e7,{size:10})," ",e.change]})]}),o.jsx("div",{className:"text-2xl font-black text-white",children:e.value}),o.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1",children:e.label})]},t))}),(0,o.jsxs)("div",{className:"bg-white/5 border border-white/5 rounded-2xl overflow-hidden",children:[(0,o.jsxs)("div",{className:"p-4 border-b border-white/5 flex items-center justify-between",children:[o.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-white",children:""}),o.jsx("button",{className:"text-[10px] font-bold text-cyan-400 hover:text-cyan-300",children:""})]}),o.jsx("div",{className:"p-0",children:(0,o.jsxs)("table",{className:"w-full text-[11px] text-left",children:[o.jsx("thead",{children:(0,o.jsxs)("tr",{className:"bg-white/[0.02] text-slate-500 font-bold uppercase tracking-wider",children:[o.jsx("th",{className:"px-4 py-3",children:" ID"}),o.jsx("th",{className:"px-4 py-3",children:""}),o.jsx("th",{className:"px-4 py-3",children:""}),o.jsx("th",{className:"px-4 py-3",children:""}),o.jsx("th",{className:"px-4 py-3",children:""})]})}),o.jsx("tbody",{className:"divide-y divide-white/5",children:[{id:"TASK-9281",user:"user_291..",type:"Video Gen",status:"Running",time:"45s",statusColor:"text-cyan-400"},{id:"TASK-9280",user:"user_882..",type:"Image Gen",status:"Success",time:"12s",statusColor:"text-emerald-400"},{id:"TASK-9279",user:"user_102..",type:"Audio Gen",status:"Pending",time:"-",statusColor:"text-amber-400"},{id:"TASK-9278",user:"user_441..",type:"Storyboard",status:"Success",time:"8s",statusColor:"text-emerald-400"}].map((e,t)=>(0,o.jsxs)("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[o.jsx("td",{className:"px-4 py-3 font-mono text-slate-400",children:e.id}),o.jsx("td",{className:"px-4 py-3 text-slate-300",children:e.user}),o.jsx("td",{className:"px-4 py-3 text-slate-300",children:e.type}),o.jsx("td",{className:`px-4 py-3 font-bold ${e.statusColor}`,children:e.status}),o.jsx("td",{className:"px-4 py-3 text-slate-500",children:e.time})]},t))})]})})]})]}),"models"===r&&o.jsx("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,o.jsxs)("div",{className:"bg-white/5 border border-white/5 rounded-2xl p-6",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx(e9,{size:20,className:"text-cyan-400"}),o.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-white",children:""})]}),o.jsx("div",{className:"space-y-4",children:[{name:"Gemini 3 Pro",status:"Optimal",load:"42%",active:!0},{name:"Gemini 3 Flash",status:"High Load",load:"88%",active:!0},{name:"Veo 3.1 Video",status:"Optimal",load:"15%",active:!0},{name:"Imagen 3 (Legacy)",status:"Deprecated",load:"0%",active:!1}].map((e,t)=>(0,o.jsxs)("div",{className:"flex items-center justify-between p-3 bg-black/20 rounded-xl border border-white/5",children:[(0,o.jsxs)("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-xs font-bold text-white",children:e.name}),o.jsx("span",{className:`text-[9px] font-bold uppercase tracking-wider ${e.active?"text-emerald-500":"text-slate-500"}`,children:e.status})]}),(0,o.jsxs)("div",{className:"flex items-center gap-4",children:[(0,o.jsxs)("div",{className:"flex flex-col items-end",children:[o.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase",children:"Load"}),o.jsx("span",{className:"text-xs font-mono text-slate-300",children:e.load})]}),o.jsx("div",{className:`w-10 h-5 rounded-full relative transition-colors ${e.active?"bg-cyan-500/20":"bg-white/10"}`,children:o.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full transition-all ${e.active?"bg-cyan-400 right-1":"bg-slate-500 left-1"}`})})]})]},t))})]}),(0,o.jsxs)("div",{className:"bg-white/5 border border-white/5 rounded-2xl p-6",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[o.jsx(te,{size:20,className:"text-purple-400"}),o.jsx("h3",{className:"text-sm font-black uppercase tracking-widest text-white",children:"API "})]}),o.jsx("div",{className:"space-y-4",children:[{id:"PROD-KEY-01",type:"Primary",quota:"85%",health:"Excellent"},{id:"PROD-KEY-02",type:"Backup",quota:"12%",health:"Excellent"},{id:"DEV-KEY-01",type:"Sandbox",quota:"98%",health:"Warning"}].map((e,t)=>(0,o.jsxs)("div",{className:"p-3 bg-black/20 rounded-xl border border-white/5 space-y-2",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:e.id}),o.jsx("span",{className:"px-2 py-0.5 bg-white/5 rounded text-[8px] font-black text-slate-500 uppercase",children:e.type})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"flex-1 h-1 bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-purple-500",style:{width:e.quota}})}),o.jsx("span",{className:"text-[10px] font-bold text-slate-300",children:e.quota})]}),(0,o.jsxs)("div",{className:"flex items-center justify-between pt-1",children:[o.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest",children:"Health"}),o.jsx("span",{className:`text-[9px] font-bold uppercase ${"Excellent"===e.health?"text-emerald-500":"text-amber-500"}`,children:e.health})]})]},t))})]})]})}),"tasks"===r&&(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center h-full opacity-20",children:[o.jsx(eC,{size:48,className:"mb-4"}),o.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"..."})]}),"users"===r&&(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center h-full opacity-20",children:[o.jsx(e8,{size:48,className:"mb-4"}),o.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"..."})]})]})]}),(0,o.jsxs)("div",{className:"px-8 py-4 border-t border-white/5 bg-black/40 flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:[(0,o.jsxs)("div",{className:"flex items-center gap-1.5",children:[o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," "]}),(0,o.jsxs)("div",{className:"flex items-center gap-1.5",children:[o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500"})," : -"]})]}),o.jsx("div",{className:"text-[10px] font-bold text-slate-600",children:"InkAI v1.2.0-commercial-beta"})]})]})]}):null},tn=(e,t)=>"image"===t?e.find(e=>e.data.croppedFrame||e.data.image||e.data.images?.length):e.find(e=>e.data.videoUri||e.data.videoMetadata),ti=e=>{let t=[];return e.forEach(e=>{e.data.images&&e.data.images.length>0?t=[...t,...e.data.images]:e.data.image?t.push(e.data.image):e.data.croppedFrame&&t.push(e.data.croppedFrame)}),Array.from(new Set(t))},to=async(e,t,r)=>{let n=e.data.videoMode||"T2V",i=e.data.generationMode||"DEFAULT";tn(t,"image");let o=tn(t,"video"),s=ti(t),a=e.data.images||(e.data.image?[e.data.image]:[]),l={finalPrompt:r,videoInput:e.data.videoMetadata||o?.data.videoMetadata||null,inputImageForGeneration:null,referenceImages:void 0,lastFrameImage:e.data.lastFrameImage||null,generationMode:i};if("T2V"===n)return l;let c=[...a,...s].slice(0,3);if(("I2V"===n||"DIRECTOR"===n)&&(c.length>1&&"FIRST_LAST_FRAME"!==i?l.referenceImages=c:c.length>0&&(l.inputImageForGeneration=c[0])),"DIRECTOR"===n)switch(i){case"CONTINUE":if(!l.videoInput&&o?.data.videoUri)try{let e=o.data.videoUri;e.startsWith("http")&&(e=await (0,ev.d4)(e)),l.inputImageForGeneration=await (0,ev.X_)(e)}catch(e){console.warn("Frame extraction failed",e)}break;case"FIRST_LAST_FRAME":c.length>0&&(l.inputImageForGeneration=c[0])}return l},ts=(0,l.Z)("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),ta="cubic-bezier(0.32, 0.72, 0, 1)",tl=e=>{switch(e){case n.PROMPT_INPUT:return"";case n.IMAGE_GENERATOR:return"";case n.STORYBOARD_GENERATOR:return"";case n.VIDEO_GENERATOR:return"";case n.AUDIO_GENERATOR:return"";case n.VIDEO_ANALYZER:return"";case n.IMAGE_EDITOR:return"";case n.SCRIPT_MASTER:return"";default:return e}},tc=e=>e.height?e.height:["PROMPT_INPUT","VIDEO_ANALYZER","IMAGE_EDITOR","SCRIPT_MASTER","STORYBOARD_GENERATOR"].includes(e.type)?380:e.type===n.AUDIO_GENERATOR?200:380,tu=e=>{let t=e.height||tc(e),r=e.width||420;return{x:e.x,y:e.y,width:r,height:t,r:e.x+r,b:e.y+t}},td=({media:e,onClose:t})=>{let[r,n]=(0,s.useState)(!1),[i,a]=(0,s.useState)(0),[l,c]=(0,s.useState)(null);(0,s.useEffect)(()=>{e?(requestAnimationFrame(()=>n(!0)),a(e.initialIndex||0)):n(!1)},[e]);let u=(0,s.useCallback)(()=>{n(!1),setTimeout(t,400)},[t]);if((0,s.useEffect)(()=>{if(!e)return;let t=e.images?e.images[i]:e.src;if("video"===e.type&&!(t&&t.startsWith("data:image"))){if(t.startsWith("blob:")||t.startsWith("data:")){c(t);return}let e=!0;return fetch(t).then(e=>e.blob()).then(t=>{e&&c(URL.createObjectURL(new Blob([t],{type:"video/mp4"})))}),()=>{e=!1}}c(null)},[e,i]),!e)return null;let h=e.images?e.images[i]:e.src,f="video"===e.type&&!(h&&h.startsWith("data:image"));return(0,o.jsxs)("div",{className:`fixed inset-0 z-[100] flex items-center justify-center transition-all duration-500 ease-[${ta}] ${r?"bg-black/90 backdrop-blur-xl":"bg-transparent pointer-events-none opacity-0"}`,onClick:u,children:[(0,o.jsxs)("div",{className:`relative w-full h-full flex items-center justify-center p-8 transition-all duration-500 ease-[${ta}] ${r?"scale-100 opacity-100":"scale-90 opacity-0"}`,onClick:e=>e.stopPropagation(),children:[e.images?.length>1&&o.jsx("button",{onClick:t=>{t.stopPropagation(),a(t=>(t-1+e.images.length)%e.images.length)},className:"absolute left-8 p-3 bg-white/10 rounded-full text-white",children:o.jsx(d,{size:32})}),o.jsx("div",{className:"relative max-w-full max-h-full",children:f?l&&o.jsx("video",{src:l,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl",controls:!0,autoPlay:!0},l):o.jsx("img",{src:h,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl"},h)}),e.images?.length>1&&o.jsx("button",{onClick:t=>{t.stopPropagation(),a(t=>(t+1)%e.images.length)},className:"absolute right-8 p-3 bg-white/10 rounded-full text-white",children:o.jsx(p,{size:32})})]}),o.jsx("button",{onClick:u,className:"absolute top-6 left-6 p-3 bg-white/10 rounded-full text-white",children:o.jsx(N,{size:24})})]})};function tp({workflowId:e}){let[t,r]=(0,s.useState)([]),[a,l]=(0,s.useState)([]),[c,u]=(0,s.useState)([]),[d,p]=(0,s.useState)(!1),[h,f]=(0,s.useState)(e),[m,g]=(0,s.useState)(!1),[y,v]=(0,s.useState)(!1),[b,_]=(0,s.useState)(!1),[E,A]=(0,s.useState)(!1),[C,O]=(0,s.useState)(!1),[N,k]=(0,s.useState)(!1),[R,P]=(0,s.useState)(!1),[M,D]=(0,s.useState)([]),[L,G]=(0,s.useState)([]),[F,q]=(0,s.useState)([]),[B,H]=(0,s.useState)([]),[V,$]=(0,s.useState)(-1),[z,J]=(0,s.useState)(1),[W,Y]=(0,s.useState)({x:0,y:0}),[Z,Q]=(0,s.useState)(!1),ee=(0,s.useRef)({x:0,y:0}),[et,er]=(0,s.useState)([]),[en,ei]=(0,s.useState)(null),[eo,es]=(0,s.useState)([]),[ea,el]=(0,s.useState)(null),[ec,eu]=(0,s.useState)(null),[ed,ep]=(0,s.useState)(null),[ef,em]=(0,s.useState)(null),[eg,ey]=(0,s.useState)(null),[eb,e_]=(0,s.useState)(null),[ew,ex]=(0,s.useState)(null),[eS,eA]=(0,s.useState)(null),[eC,eO]=(0,s.useState)(null),[eI,eN]=(0,s.useState)(null),[ek,eR]=(0,s.useState)(!1),[eP,eM]=(0,s.useState)(null),eD=(0,s.useRef)(M),eU=(0,s.useRef)(L),eL=(0,s.useRef)(F),eF=(0,s.useRef)(B),eB=(0,s.useRef)(V),eH=(0,s.useRef)(eI),eV=(0,s.useRef)(null),e$=(0,s.useRef)(null),ez=(0,s.useRef)(null),eJ=(0,s.useCallback)(()=>{let e={nodes:JSON.parse(JSON.stringify(eD.current)),connections:JSON.parse(JSON.stringify(eU.current)),groups:JSON.parse(JSON.stringify(eL.current))},t=eF.current.slice(0,eB.current+1);t.push(e),t.length>50&&t.shift(),H(t),$(t.length-1)},[]),eW=(0,s.useCallback)(()=>{let e=eB.current;if(e>0){let t=eF.current[e-1];D(t.nodes),G(t.connections),q(t.groups),$(e-1)}},[]),eK=(0,s.useCallback)(e=>{0!==e.length&&(eJ(),D(t=>t.filter(t=>!e.includes(t.id)).map(t=>({...t,inputs:t.inputs.filter(t=>!e.includes(t))}))),G(t=>t.filter(t=>!e.includes(t.from)&&!e.includes(t.to))),er([]))},[eJ]);(0,s.useCallback)(e=>{0!==e.length&&(eJ(),G(t=>t.filter(t=>!e.includes(`${t.from}-${t.to}`))),D(t=>t.map(t=>{let r=e.filter(e=>e.endsWith(`-${t.id}`));if(r.length>0){let e=r.map(e=>e.split("-")[0]);return{...t,inputs:t.inputs.filter(t=>!e.includes(t))}}return t})),es([]))},[eJ]);let eY=(0,s.useCallback)(e=>{eJ(),q(t=>t.filter(t=>t.id!==e)),en===e&&ei(null)},[eJ,en]),eX=(0,s.useCallback)((e,t,r,o)=>{if(e===n.IMAGE_EDITOR){v(!0);return}eJ();let s="gemini-3-pro-preview";e===n.IMAGE_GENERATOR||e===n.STORYBOARD_GENERATOR?s="gemini-3-pro-image-preview":e===n.VIDEO_GENERATOR&&(s="veo-3.1-fast-generate-preview");let a={model:s,aspectRatio:"16:9",scriptMode:e===n.SCRIPT_MASTER?"CREATE":void 0,cinematicVersion:e===n.STORYBOARD_GENERATOR?"V1":void 0,...o},l=void 0!==t?t:(-W.x+window.innerWidth/2)/z-210,c=void 0!==r?r:(-W.y+window.innerHeight/2)/z-180,u={id:`n-${Date.now()}-${Math.floor(1e3*Math.random())}`,type:e,x:isNaN(l)?100:l,y:isNaN(c)?100:c,width:420,title:tl(e),status:i.IDLE,data:a,inputs:[]};D(e=>[...e,u])},[W,z,eJ]),eZ=(0,s.useCallback)((e,t,r)=>{u(n=>n.find(e=>e.src===t)?n:[{id:`a-${Date.now()}`,type:e,src:t,title:r,timestamp:Date.now()},...n])},[]),eQ=(0,s.useCallback)((e,t,r,n)=>{D(i=>i.map(i=>{if(i.id===e){let e={...i,data:{...i.data,...t},title:n||i.title};return r&&(r.width&&(e.width=r.width),r.height&&(e.height=r.height)),t.image&&eZ("image",t.image,e.title),t.videoUri&&eZ("video",t.videoUri,e.title),t.audioUri&&eZ("audio",t.audioUri,e.title),e}return i}))},[eZ]),e0=(0,s.useCallback)(async(e,t)=>{let r=eD.current.find(t=>t.id===e);if(r){eQ(e,{error:void 0}),D(t=>t.map(t=>t.id===e?{...t,status:i.WORKING}:t));try{let o=r.inputs.map(e=>eD.current.find(t=>t.id===e)).filter(Boolean),s=o.map(e=>e.data.remixedScript||e.data.displayResult||e.data.analysis||e.data.prompt).filter(e=>e&&e.trim().length>0),a=o.map(e=>e.data.croppedFrame||e.data.image).filter(Boolean),l=t||r.data.prompt||"",c=s.join("\n\n");if(r.type===n.SCRIPT_MASTER){let t=r.data.scriptMode||"CREATE",n="";if("CREATE"===t){let e=r.data.displayResult||c;n=await (0,ev.wj)(e,l,r.data.model)}else if("REMIX"===t){let e=r.data.displayResult||c,t=r.data.videoUri||o.find(e=>e.data.videoUri)?.data.videoUri,i="";if(t){let e=t;t.startsWith("http")&&(e=await (0,ev.d4)(e)),i=await (0,ev.iO)(e,"","gemini-3-flash-preview")}n=await (0,ev.Ms)(e,i,l,r.data.model)}else n=await (0,ev.expandVisualDescription)(l||c,r.data.model);eQ(e,{remixedScript:n})}else if(r.type===n.STORYBOARD_GENERATOR){let t=r.data.prompt||c,o=r.data.image||a[0],s=r.data.cinematicVersion||"V1";if(!t&&!o)throw Error(" Prompt");let l=await (0,ev.CN)(t||"Analyze this image",s,o);if(l.length>0){eJ();let t=[],o=[],s=r.x+500,a=r.y;l.forEach((e,l)=>{let c=l%3,u=Math.floor(l/3),d=`n-story-${Date.now()}-${l}`;t.push({id:d,type:n.IMAGE_GENERATOR,x:s+460*c,y:a+420*u,width:420,title:` ${l+1}`,status:i.IDLE,data:{prompt:e,model:"gemini-3-pro-image-preview",aspectRatio:r.data.aspectRatio||"16:9",autoStart:!0},inputs:[r.id]}),o.push({from:r.id,to:d})}),q(e=>[...e,{id:`g-story-${Date.now()}`,title:"",x:s-40,y:a-40,width:1380,height:420*Math.ceil(l.length/3)}]),D(e=>[...e,...t]),G(e=>[...e,...o]),eQ(e,{status:i.SUCCESS});return}}else if(r.type===n.IMAGE_GENERATOR){let t=[...a];r.data.image&&!t.includes(r.data.image)&&t.push(r.data.image);let n=await (0,ev.oE)(l||c,r.data.model,t,{aspectRatio:r.data.aspectRatio,resolution:r.data.resolution});eQ(e,{image:n[0],images:n})}else if(r.type===n.VIDEO_GENERATOR){let t=await to(r,o,l||c),n=await (0,ev.wo)(t.finalPrompt,r.data.model,{aspectRatio:r.data.aspectRatio,resolution:r.data.resolution,duration:r.data.duration},t.inputImageForGeneration,t.videoInput,t.referenceImages,t.lastFrameImage);eQ(e,{videoUri:n.uri,videoMetadata:n.videoMetadata})}else if(r.type===n.AUDIO_GENERATOR){let t=await (0,ev.gW)(l||c);eQ(e,{audioUri:t})}else if(r.type===n.PROMPT_INPUT){let t=await (0,ev.bE)([],l||c,{isThinkingMode:!0,model:r.data.model});eQ(e,{displayResult:t})}else if(r.type===n.VIDEO_ANALYZER){let t=r.data.videoUri||o.find(e=>e.data.videoUri)?.data.videoUri;if(!t)throw Error("");let n=t;t.startsWith("http")&&(n=await (0,ev.d4)(t));let i=await (0,ev.iO)(n,l||"",r.data.model);eQ(e,{analysis:i})}D(t=>t.map(t=>t.id===e?{...t,status:i.SUCCESS}:t))}catch(t){eQ(e,{error:t.message}),D(t=>t.map(t=>t.id===e?{...t,status:i.ERROR}:t))}}},[eQ,eJ]),e1=(0,s.useCallback)(e=>{let t=F.find(t=>t.id===e);if(!t)return;eJ();let r=M.filter(e=>{let r=tu(e);return r.x+r.width/2>t.x&&r.x+r.width/2<t.x+t.width&&r.y+160>t.y&&r.y+160<t.y+t.height});if(0===r.length)return;r.sort((e,t)=>{let r=e.title||"",n=t.title||"",i=r.match(/\s*(\d+)/),o=n.match(/\s*(\d+)/);if(i&&o)return parseInt(i[1])-parseInt(o[1]);let s=parseInt(e.id.split("-")[2]||"0"),a=parseInt(t.id.split("-")[2]||"0");return s!==a?s-a:e.y-t.y||e.x-t.x});let n=t.x+40,i=t.y+60,o=[...M];r.forEach((e,t)=>{let r=o.findIndex(t=>t.id===e.id);-1!==r&&(o[r]={...o[r],x:n+t%3*460,y:i+420*Math.floor(t/3)})});let s=Math.ceil(r.length/3),a=Math.max(t.height,420*s+80);D(o),q(t=>t.map(t=>t.id===e?{...t,height:a}:t))},[M,F,eJ]);return(0,s.useRef)(new Set),(0,s.useCallback)(e=>{eV.current||(eV.current=requestAnimationFrame(()=>{if(eV.current=null,Z){let t=e.clientX-ee.current.x,r=e.clientY-ee.current.y;Y(e=>({x:e.x+t,y:e.y+r})),ee.current={x:e.clientX,y:e.clientY}}if(eM(t=>{if(t){let r={...t,endX:e.clientX,endY:e.clientY},n=Math.min(r.startX,r.endX),i=Math.min(r.startY,r.endY),o=Math.max(r.startX,r.endX),s=Math.max(r.startY,r.endY),a=eD.current.filter(e=>{let t=tu(e),r=t.x*z+W.x,a=t.y*z+W.y,l=t.width*z,c=t.height*z;return r<o&&r+l>n&&a<s&&a+c>i}).map(e=>e.id);return(a.length>0||et.length>0)&&er(a),r}return null}),ec&&e$.current){let{startX:t,startY:r,mouseStartX:n,mouseStartY:i,otherSelectedNodes:o}=e$.current,s=(e.clientX-n)/z,a=(e.clientY-i)/z;D(e=>e.map(e=>{if(e.id===ec)return{...e,x:t+s,y:r+a};let n=o?.find(t=>t.id===e.id);return n?{...e,x:n.startX+s,y:n.startY+a}:e}))}if(ez.current){let{id:t,startX:r,startY:n,mouseStartX:i,mouseStartY:o,childNodes:s}=ez.current,a=(e.clientX-i)/z,l=(e.clientY-o)/z;q(e=>e.map(e=>e.id===t?{...e,x:r+a,y:n+l}:e)),s.length>0&&D(e=>e.map(e=>{let t=s.find(t=>t.id===e.id);return t?{...e,x:t.startX+a,y:t.startY+l}:e}))}}))},[Z,ec,z]),(0,s.useCallback)(()=>{eV.current&&cancelAnimationFrame(eV.current),eV.current=null,(ec||ez.current)&&eJ(),eM(e=>{if(e){let t=Math.min(e.startX,e.endX),r=Math.min(e.startY,e.endY),n=Math.max(e.startX,e.endX),i=Math.max(e.startY,e.endY);D(e=>{let o=e.filter(e=>{let o=tu(e),s=o.x*z+W.x,a=o.y*z+W.y,l=o.width*z,c=o.height*z;return s<n&&s+l>t&&a<i&&a+c>r}).map(e=>e.id);return o.length>0&&er(e=>o),e})}return null}),Q(!1),eu(null),e$.current=null,ez.current=null},[eJ,ec,z,W]),o.jsx("div",{className:"w-screen h-screen overflow-hidden bg-[#0a0a0c]",children:(0,o.jsxs)("div",{className:`w-full h-full relative ${Z?"cursor-grabbing":ek?"cursor-grab":"cursor-default"}`,onMouseDown:e=>{eb&&e_(null),ei(null),0!==e.button||e.shiftKey||(ek?(Q(!0),ee.current={x:e.clientX,y:e.clientY}):(eM({startX:e.clientX,startY:e.clientY,endX:e.clientX,endY:e.clientY}),e.metaKey||e.ctrlKey||er([])))},onContextMenu:e=>{e.preventDefault(),R||e_({visible:!0,x:e.clientX,y:e.clientY})},onWheel:e=>{e.preventDefault();let t=Math.min(Math.max(.2,z+-(.001*e.deltaY)),3),r=e.clientX,n=e.clientY,i=(r-W.x)/z,o=(n-W.y)/z;J(t),Y({x:r-i*t,y:n-o*t})},children:[o.jsx("div",{className:"absolute inset-0 noise-bg opacity-[0.03]"}),o.jsx("div",{className:"absolute top-8 left-12 z-50 pointer-events-none opacity-20",children:o.jsx("h1",{className:"text-4xl font-black italic tracking-tighter text-white pr-2",children:"InkAI"})}),R&&o.jsx("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 z-[100] animate-in slide-in-from-top duration-500",children:(0,o.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 bg-purple-500/20 backdrop-blur-3xl border border-purple-500/30 rounded-full shadow-2xl",children:[o.jsx(T,{size:16,className:"text-purple-400 animate-pulse"}),o.jsx("span",{className:"text-xs font-black text-purple-200 uppercase tracking-widest",children:" (Shared View)"})]})}),0===M.length&&(0,o.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-40 transition-all duration-1000 animate-in fade-in slide-in-from-bottom-12",children:[(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center mb-16 select-none",children:[o.jsx("h1",{className:"text-8xl md:text-[140px] font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-b from-white via-zinc-200 to-zinc-600 drop-shadow-[0_10px_30px_rgba(0,0,0,0.5)] py-8 pl-8 pr-24 italic text-center leading-tight",children:"InkAI"}),o.jsx("p",{className:"text-zinc-500 text-sm font-bold tracking-[0.4em] uppercase mt-[-20px] opacity-40",children:"Turning ideas into reality"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 max-w-6xl px-6 w-full",children:[o.jsx("div",{onClick:()=>eX(n.IMAGE_GENERATOR),className:"group relative h-48 bg-[#121214]/60 backdrop-blur-2xl border border-white/5 hover:border-cyan-500/30 rounded-3xl p-6 cursor-pointer transition-all duration-500 hover:-translate-y-2 overflow-hidden shadow-2xl",children:(0,o.jsxs)("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[o.jsx("div",{className:"w-10 h-10 rounded-2xl bg-cyan-500/10 border border-cyan-500/20 flex items-center justify-center text-cyan-400",children:o.jsx(I,{size:18})}),(0,o.jsxs)("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:""}),o.jsx("p",{className:"text-[11px] text-zinc-500 font-medium leading-relaxed",children:""})]})]})}),o.jsx("div",{onClick:()=>eX(n.VIDEO_GENERATOR),className:"group relative h-48 bg-[#121214]/60 backdrop-blur-2xl border border-white/5 hover:border-purple-500/30 rounded-3xl p-6 cursor-pointer transition-all duration-500 hover:-translate-y-2 overflow-hidden shadow-2xl",children:(0,o.jsxs)("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[o.jsx("div",{className:"w-10 h-10 rounded-2xl bg-purple-500/10 border border-purple-500/20 flex items-center justify-center text-purple-400",children:o.jsx(j,{size:18})}),(0,o.jsxs)("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:""}),o.jsx("p",{className:"text-[11px] text-zinc-500 font-medium leading-relaxed",children:""})]})]})}),o.jsx("div",{onClick:()=>eX(n.SCRIPT_MASTER),className:"group relative h-48 bg-[#121214]/60 backdrop-blur-2xl border border-white/5 hover:border-amber-500/30 rounded-3xl p-6 cursor-pointer transition-all duration-500 hover:-translate-y-2 overflow-hidden shadow-2xl",children:(0,o.jsxs)("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[o.jsx("div",{className:"w-10 h-10 rounded-2xl bg-amber-500/10 border border-amber-500/20 flex items-center justify-center text-amber-400",children:o.jsx(w,{size:18})}),(0,o.jsxs)("div",{children:[o.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:""}),o.jsx("p",{className:"text-[11px] text-zinc-500 font-medium leading-relaxed",children:""})]})]})})]})]}),eP&&o.jsx("div",{className:"absolute border border-cyan-500/50 bg-cyan-500/10 pointer-events-none z-[100]",style:{left:Math.min(eP.startX,eP.endX),top:Math.min(eP.startY,eP.endY),width:Math.abs(eP.endX-eP.startX),height:Math.abs(eP.endY-eP.startY)}}),eb?.visible&&o.jsx("div",{className:"fixed z-[200] bg-[#1c1c1e] border border-white/10 rounded-xl shadow-2xl p-1.5 min-w-[160px] animate-in zoom-in-95 duration-100",style:{left:eb.x,top:eb.y},onMouseDown:e=>e.stopPropagation(),children:[{id:n.PROMPT_INPUT,label:" (Prompt)",icon:U},{id:n.SCRIPT_MASTER,label:" (Script)",icon:w},{id:n.IMAGE_GENERATOR,label:" (Image)",icon:I},{id:n.STORYBOARD_GENERATOR,label:" (Storyboard)",icon:S.Z},{id:n.VIDEO_GENERATOR,label:" (Video)",icon:j},{id:n.VIDEO_ANALYZER,label:" (Analyze)",icon:T},{id:n.IMAGE_EDITOR,label:" (Editor)",icon:X},{id:n.AUDIO_GENERATOR,label:" (Audio)",icon:eG}].map(e=>(0,o.jsxs)("button",{onClick:()=>{let t=(eb.x-W.x)/z,r=(eb.y-W.y)/z;eX(e.id,t,r),e_(null)},className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg text-xs text-slate-300 hover:bg-white/10 hover:text-white transition-colors",children:[o.jsx(e.icon,{size:14,className:"text-slate-500"}),o.jsx("span",{children:e.label})]},e.id))}),(0,o.jsxs)("div",{style:{transform:`translate(${W.x}px, ${W.y}px) scale(${z})`,width:"100%",height:"100%",transformOrigin:"0 0"},children:[F.map(e=>o.jsx("div",{className:`group/groupbox absolute rounded-[32px] border transition-all ${en===e.id?"border-cyan-500/30 bg-cyan-500/5":"border-white/10 bg-white/5"}`,style:{left:e.x,top:e.y,width:e.width,height:e.height},onMouseDown:t=>{if(ek)return;t.stopPropagation(),ei(e.id);let r=M.filter(t=>{let r=tu(t);return r.x+r.width/2>e.x&&r.x+r.width/2<e.x+e.width&&r.y+160>e.y&&r.y+160<e.y+e.height}).map(e=>({id:e.id,startX:e.x,startY:e.y}));ez.current={id:e.id,startX:e.x,startY:e.y,mouseStartX:t.clientX,mouseStartY:t.clientY,childNodes:r}},children:(0,o.jsxs)("div",{className:"absolute -top-10 left-0 flex items-center gap-2",children:[o.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-widest px-4 py-1 rounded-full bg-white/5 border border-white/5",children:e.title}),o.jsx("button",{onClick:t=>{t.stopPropagation(),e1(e.id)},className:"p-1 rounded-full bg-cyan-500/20 text-cyan-400 opacity-0 group-hover/groupbox:opacity-100 transition-opacity hover:bg-cyan-500/30",title:"",children:o.jsx(ts,{size:12})}),o.jsx("button",{onClick:t=>{t.stopPropagation(),eY(e.id)},className:"p-1 rounded-full bg-red-500/20 text-red-400 opacity-0 group-hover/groupbox:opacity-100 transition-opacity hover:bg-red-500/30",children:o.jsx(x.Z,{size:12})})]})},e.id)),o.jsx("svg",{className:"absolute inset-0 overflow-visible pointer-events-none",children:L.map(e=>{let t=M.find(t=>t.id===e.from),r=M.find(t=>t.id===e.to);if(!t||!r)return null;let n=t.height||tc(t),i=r.height||tc(r),s=t.x+(t.width||420)+3,a=t.y+n/2,l=r.x-3,c=r.y+i/2,u=`${e.from}-${e.to}`,d=eo.includes(u),p=ea===u;return(0,o.jsxs)("g",{onMouseEnter:()=>el(u),onMouseLeave:()=>el(null),children:[o.jsx("path",{d:`M ${s} ${a} C ${s+(l-s)*.5} ${a} ${l-(l-s)*.5} ${c} ${l} ${c}`,stroke:"transparent",strokeWidth:"20",fill:"none",className:"pointer-events-auto cursor-pointer",onClick:e=>{e.stopPropagation(),es([u]),er([]),ei(null)}}),o.jsx("path",{d:`M ${s} ${a} C ${s+(l-s)*.5} ${a} ${l-(l-s)*.5} ${c} ${l} ${c}`,stroke:d?"#22d3ee":p?"rgba(34,211,238,0.6)":"rgba(34,211,238,0.3)",strokeWidth:d?"4":p?"4":"3",fill:"none",className:"pointer-events-none transition-all duration-200",style:{filter:d||p?"drop-shadow(0 0 4px rgba(34,211,238,0.5))":"none"}})]},u)})}),M.map(e=>o.jsx(K,{node:e,onUpdate:eQ,onAction:e0,onDelete:e=>eK([e]),onExpand:ex,onCrop:(e,t)=>{eA(e),eO(t)},onSelect:e=>er([e]),onSaveCharacter:(e,t,r)=>{let n={id:`char-${Date.now()}`,name:e,description:t,image:r,createdAt:Date.now()};l(e=>[n,...e])},onNodeMouseDown:(e,t)=>{if(ek)return;e.stopPropagation();let r=et.includes(t),n=[t];e.metaKey||e.ctrlKey||e.shiftKey?n=r?et.filter(e=>e!==t):[...et,t]:r&&(n=et),er(n),ei(null),es([]);let i=M.find(e=>e.id===t);if(i){let r=M.filter(e=>n.includes(e.id)&&e.id!==t).map(e=>({id:e.id,startX:e.x,startY:e.y}));e$.current={id:t,startX:i.x,startY:i.y,mouseStartX:e.clientX,mouseStartY:e.clientY,otherSelectedNodes:r},eu(t)}},onPortMouseDown:(e,t)=>{ek||(e.stopPropagation(),eN({id:t,x:e.clientX,y:e.clientY}))},onPortMouseUp:(e,t)=>{e.stopPropagation();let r=eH.current;r&&r.id!==t&&(G(e=>[...e,{from:r.id,to:t}]),D(e=>e.map(e=>e.id===t?{...e,inputs:[...e.inputs,r.id]}:e))),eN(null)},onNodeContextMenu:(e,t)=>{e.preventDefault(),e.stopPropagation(),e_({visible:!0,x:e.clientX,y:e.clientY,id:t})},onResizeMouseDown:(e,t,r,n)=>{ek||(e.stopPropagation(),ep(t),em({width:r,height:n}),ey({x:e.clientX,y:e.clientY}))},isSelected:et.includes(e.id)},e.id))]}),o.jsx(eh,{onAddNode:eX,onUndo:eW,isChatOpen:d,onToggleChat:()=>p(!d),isMultiFrameOpen:b,onToggleMultiFrame:()=>_(!b),assetHistory:c,onHistoryItemClick:e=>eX("image"===e.type?n.IMAGE_GENERATOR:n.VIDEO_GENERATOR,void 0,void 0,"image"===e.type?{image:e.src}:{videoUri:e.src}),onDeleteAsset:e=>u(t=>t.filter(t=>t.id!==e)),workflows:t,selectedWorkflowId:h,onSelectWorkflow:e=>{let r=t.find(t=>t.id===e);r&&(D(JSON.parse(JSON.stringify(r.nodes))),G(JSON.parse(JSON.stringify(r.connections))),q(JSON.parse(JSON.stringify(r.groups))),f(e))},onSaveWorkflow:()=>{let e={id:`wf-${Date.now()}`,title:` ${new Date().toLocaleDateString()}`,thumbnail:M.find(e=>e.data.image)?.data.image||"",nodes:JSON.parse(JSON.stringify(M)),connections:JSON.parse(JSON.stringify(L)),groups:JSON.parse(JSON.stringify(F))};r(t=>[e,...t])},onDeleteWorkflow:e=>r(t=>t.filter(t=>t.id!==e)),onRenameWorkflow:(e,t)=>r(r=>r.map(r=>r.id===e?{...r,title:t}:r)),onImportWorkflow:e=>{r(t=>[e,...t]),f(e.id),D(e.nodes),G(e.connections),q(e.groups||[])},characters:a,onAddCharacter:e=>l(t=>[e,...t]),onDeleteCharacter:e=>l(t=>t.filter(t=>t.id!==e)),onApplyCharacter:e=>{1===et.length?eQ(et[0],{images:[e.image],prompt:e.description}):eX(n.IMAGE_GENERATOR,void 0,void 0,{imageMode:"I2I",images:[e.image],prompt:e.description})},onOpenSettings:()=>O(!0),onOpenAdmin:()=>k(!0),isReadOnly:R}),o.jsx(td,{media:ew,onClose:()=>ex(null)}),o.jsx(e6,{isOpen:C,onClose:()=>O(!1)}),o.jsx(tr,{isOpen:N,onClose:()=>k(!1)}),o.jsx(eE,{isOpen:d,onClose:()=>p(!1)}),eS&&eC&&o.jsx(eT,{imageSrc:eC,onCancel:()=>{eA(null),eO(null)},onConfirm:e=>{eQ(eS,{croppedFrame:e}),eA(null),eO(null)}}),y&&o.jsx(ej,{onClose:()=>v(!1),onGenerate:(e,t,r)=>{eX("image"===e?n.IMAGE_GENERATOR:n.VIDEO_GENERATOR,void 0,void 0,"image"===e?{image:t,prompt:r}:{videoUri:t,prompt:r})}}),o.jsx(eq,{isOpen:b,onClose:()=>_(!1),onGenerateAudio:async e=>await (0,ev.gW)(e),onGenerate:async(e,t)=>await (0,ev.MH)(e,"veo-3.1-fast-generate-preview",{aspectRatio:"16:9"},t),onGenerateSegment:async(e,t)=>{let r=e.transition.prompt||"Maintain strict visual continuity and smooth motion between frames.",n=e.transition.duration||3,i=await (0,ev.wo)(r,"veo-3.1-fast-generate-preview",{aspectRatio:"16:9",duration:n},e.src,void 0,void 0,t.src);if(i?.uri)return i.uri;if(i?.videoMetadata?.uri)return i.videoMetadata.uri;throw Error("Segment generation failed")}}),o.jsx(e2,{isOpen:E,onClose:()=>A(!1),history:c.filter(e=>"audio"===e.type),onGenerate:(e,t)=>eZ("audio",e,t),onSaveToAssets:e=>u(t=>[e,...t])})]})})}},6737:(e,t,r)=>{"use strict";let n,i,o,s,a;r.d(t,{Ms:()=>n2,iO:()=>n0,jL:()=>n9,wj:()=>n1,expandVisualDescription:()=>n4,X_:()=>n6,gW:()=>n8,oE:()=>nQ,wo:()=>nX,MH:()=>nZ,CN:()=>nY,bE:()=>n5,KR:()=>n7,d4:()=>n3});var l,c,u,d,p,h,f,m,g,y,v,b,_,E,w,x,S,T,A,C,O,I,N,k,R,P,j,M,D,U,L,G,F,q,B,H,V,$,z,J,W,K,Y,X,Z,Q,ee,et,er,en,ei,eo,es,ea,el,ec,eu,ed,ep=r(44401),eh=r(57147),ef=r(73292),em=r(84492),eg=r(76402);r(42504),r(83958),r(74036);var ey=r(46342);r(30359);var ev=r(71017);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class eb{}function e_(e,t){return e.replace(/\{([^}]+)\}/g,(e,r)=>{if(Object.prototype.hasOwnProperty.call(t,r)){let e=t[r];return null!=e?String(e):""}throw Error(`Key '${r}' not found in valueMap.`)})}function eE(e,t,r){for(let n=0;n<t.length-1;n++){let i=t[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e)){if(Array.isArray(r))e[o]=Array.from({length:r.length},()=>({}));else throw Error(`Value must be a list given an array path ${i}`)}if(Array.isArray(e[o])){let i=e[o];if(Array.isArray(r))for(let e=0;e<i.length;e++)eE(i[e],t.slice(n+1),r[e]);else for(let e of i)eE(e,t.slice(n+1),r)}return}if(i.endsWith("[0]")){let o=i.slice(0,-3);o in e||(e[o]=[{}]),eE(e[o][0],t.slice(n+1),r);return}e[i]&&"object"==typeof e[i]||(e[i]={}),e=e[i]}let n=t[t.length-1],i=e[n];if(void 0!==i){if(!r||"object"==typeof r&&0===Object.keys(r).length||r===i)return;if("object"==typeof i&&"object"==typeof r&&null!==i&&null!==r)Object.assign(i,r);else throw Error(`Cannot set value for an existing key. Key: ${n}`)}else"_self"!==n||"object"!=typeof r||null===r||Array.isArray(r)?e[n]=r:Object.assign(e,r)}function ew(e,t,r){try{if(1===t.length&&"_self"===t[0])return e;for(let n=0;n<t.length;n++){if("object"!=typeof e||null===e)return r;let i=t[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e))return r;{let i=e[o];if(!Array.isArray(i))return r;return i.map(e=>ew(e,t.slice(n+1),r))}}e=e[i]}return e}catch(e){if(e instanceof TypeError)return r;throw e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ex(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}function eS(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["parent"]);null!=n&&eE(t,["parent"],n);let i=ew(e,["documentName"]);return null!=i&&eE(t,["documentName"],i),t}(s)),t}(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(l||(l={})),function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"}(c||(c={})),function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"}(u||(u={})),function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"}(d||(d={})),function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"}(p||(p={})),function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"}(h||(h={})),function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"}(f||(f={})),function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"}(m||(m={})),function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"}(g||(g={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(y||(y={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"}(v||(v={})),function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"}(b||(b={})),function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"}(_||(_={})),function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"}(E||(E={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"}(w||(w={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"}(x||(x={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(S||(S={})),function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"}(T||(T={})),function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"}(A||(A={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"}(C||(C={})),function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"}(O||(O={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"}(I||(I={})),function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"}(N||(N={})),function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"}(k||(k={})),function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"}(R||(R={})),function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"}(P||(P={})),function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"}(j||(j={})),function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"}(M||(M={})),(D||(D={})).COLLECTION="COLLECTION",function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"}(U||(U={})),function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"}(L||(L={})),function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(G||(G={})),function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"}(F||(F={})),function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"}(q||(q={})),function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"}(B||(B={})),function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"}(H||(H={})),function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"}(V||(V={})),function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"}($||($={})),function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"}(z||(z={})),function(e){e.ASSET="ASSET",e.STYLE="STYLE"}(J||(J={})),function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"}(W||(W={})),function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"}(K||(K={})),function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING"}(Y||(Y={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"}(X||(X={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"}(Z||(Z={})),function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED",e.REGISTERED="REGISTERED"}(Q||(Q={})),function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"}(ee||(ee={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"}(et||(et={})),function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"}(er||(er={})),function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.ACTIVITY_START="ACTIVITY_START",e.ACTIVITY_END="ACTIVITY_END"}(en||(en={})),function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"}(ei||(ei={})),function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"}(eo||(eo={})),function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"}(es||(es={})),function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"}(ea||(ea={})),function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"}(el||(el={})),function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"}(ec||(ec={})),function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"}(eu||(eu={}));class eT{constructor(e){let t={};for(let r of e.headers.entries())t[r[0]]=r[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class eA{get text(){var e,t,r,n,i,o,s,a;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",c=!1,u=[];for(let e of null!==(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(let[t,r]of Object.entries(e))"text"!==t&&"thought"!==t&&"thoughtSignature"!==t&&(null!==r||void 0!==r)&&u.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;c=!0,l+=e.text}}return u.length>0&&console.warn(`there are non-text parts ${u} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),c?l:void 0}get data(){var e,t,r,n,i,o,s,a;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="",c=[];for(let e of null!==(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(let[t,r]of Object.entries(e))"inlineData"!==t&&(null!==r||void 0!==r)&&c.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(l+=atob(e.inlineData.data))}return c.length>0&&console.warn(`there are non-data parts ${c} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var e,t,r,n,i,o,s,a;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let l=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==l?void 0:l.length)!==0)return l}get executableCode(){var e,t,r,n,i,o,s,a,l;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let c=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==c?void 0:c.length)!==0)return null===(l=null==c?void 0:c[0])||void 0===l?void 0:l.code}get codeExecutionResult(){var e,t,r,n,i,o,s,a,l;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let c=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==c?void 0:c.length)!==0)return null===(l=null==c?void 0:c[0])||void 0===l?void 0:l.output}}class eC{}class eO{}class eI{}class eN{}class ek{}class eR{}class eP{}class ej{}class eM{}class eD{}class eU{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new eU;return Object.assign(r,t?function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["videos"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["_self"]);return null!=r&&eE(t,["video"],function(e){let t={},r=ew(e,["gcsUri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["bytesBase64Encoded"]);null!=n&&eE(t,["videoBytes"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}(r)),t})(e))),eE(t,["generatedVideos"],e)}let n=ew(e,["raiMediaFilteredCount"]);null!=n&&eE(t,["raiMediaFilteredCount"],n);let i=ew(e,["raiMediaFilteredReasons"]);return null!=i&&eE(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e):function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response","generateVideoResponse"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["generatedSamples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["video"]);return null!=r&&eE(t,["video"],function(e){let t={},r=ew(e,["uri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["encodedVideo"]);null!=n&&eE(t,["videoBytes"],ex(n));let i=ew(e,["encoding"]);return null!=i&&eE(t,["mimeType"],i),t}(r)),t})(e))),eE(t,["generatedVideos"],e)}let n=ew(e,["raiMediaFilteredCount"]);null!=n&&eE(t,["raiMediaFilteredCount"],n);let i=ew(e,["raiMediaFilteredReasons"]);return null!=i&&eE(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e)),r}}class eL{}class eG{}class eF{}class eq{}class eB{}class eH{}class eV{}class e${_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new e$;return Object.assign(r,function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["parent"]);null!=n&&eE(t,["parent"],n);let i=ew(e,["documentName"]);return null!=i&&eE(t,["documentName"],i),t}(s)),t}(e)),r}}class ez{}class eJ{}class eW{}class eK{}class eY{get text(){var e,t,r;let n="",i=!1,o=[];for(let s of null!==(r=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==r?r:[]){for(let[e,t]of Object.entries(s))"text"!==e&&"thought"!==e&&null!==t&&o.push(e);if("string"==typeof s.text){if("boolean"==typeof s.thought&&s.thought)continue;i=!0,n+=s.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?n:void 0}get data(){var e,t,r;let n="",i=[];for(let o of null!==(r=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==r?r:[]){for(let[e,t]of Object.entries(o))"inlineData"!==e&&null!==t&&i.push(e);o.inlineData&&"string"==typeof o.inlineData.data&&(n+=atob(o.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),n.length>0?btoa(n):void 0}}class eX{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class eZ{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new eZ;return Object.assign(r,eS(e)),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function eQ(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;{let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function e0(e,t){let r=eQ(e,t);return r?r.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${r}`:r.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${r}`:r:""}function e1(e){return Array.isArray(e)?e.map(e=>e2(e)):[e2(e)]}function e2(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function e4(e){let t=e2(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function e5(e){let t=e2(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function e3(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function e6(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>e3(e)):[e3(e)]}function e8(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function e7(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function e9(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function te(e){if(null==e)throw Error("ContentUnion is required");return e8(e)?e:{role:"user",parts:e6(e)}}function tt(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=te(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=te(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>te(e)):[te(t)]}function tr(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(e7(e)||e9(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[te(e)]}let t=[],r=[],n=e8(e[0]);for(let i of e){let e=e8(i);if(e!=n)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(i);else if(e7(i)||e9(i))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else r.push(i)}return n||t.push({role:"user",parts:e6(r)}),t}function tn(e){let t={},r=["items"],n=["anyOf"],i=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let o=e.anyOf;for(let[s,a]of(null!=o&&2==o.length&&("null"===o[0].type?(t.nullable=!0,e=o[1]):"null"===o[1].type&&(t.nullable=!0,e=o[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let r=e.filter(e=>"null"!==e);if(1===r.length)t.type=Object.values(d).includes(r[0].toUpperCase())?r[0].toUpperCase():d.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],r))t.anyOf.push({type:Object.values(d).includes(e.toUpperCase())?e.toUpperCase():d.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=a){if("type"==s){if("null"===a)throw Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(d).includes(a.toUpperCase())?a.toUpperCase():d.TYPE_UNSPECIFIED}else if(r.includes(s))t[s]=tn(a);else if(n.includes(s)){let e=[];for(let r of a){if("null"==r.type){t.nullable=!0;continue}e.push(tn(r))}t[s]=e}else if(i.includes(s)){let e={};for(let[t,r]of Object.entries(a))e[t]=tn(r);t[s]=e}else{if("additionalProperties"===s)continue;t[s]=a}}return t}function ti(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function to(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function ts(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=tn(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=tn(t.response));return e}function ta(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let r of e)t.push(r);return t}function tl(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,r,n=1){let i=!t.startsWith(`${r}/`)&&t.split("/").length===n;if(e.isVertexAI())return t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${r}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:i?`projects/${e.getProject()}/locations/${e.getLocation()}/${r}/${t}`:t;return i?`${r}/${t}`:t}(e,t,"cachedContents")}function tc(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function tu(e){return null!=e&&"object"==typeof e&&"video"in e}function td(e){return null!=e&&"object"==typeof e&&"uri"in e}function tp(e){var t;let r;if(null!=e&&"object"==typeof e&&"name"in e&&(r=e.name),!(td(e)&&void 0===(r=e.uri)||tu(e)&&void 0===(r=null===(t=e.video)||void 0===t?void 0:t.uri))){if("string"==typeof e&&(r=e),void 0===r)throw Error("Could not extract file name from the provided input.");if(r.startsWith("https://")){let e=r.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${r}`);r=e[0]}else r.startsWith("files/")&&(r=r.split("files/")[1]);return r}}function th(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function tf(e){for(let t of["models","tunedModels","publisherModels"]){if(null!==e&&"object"==typeof e&&t in e)return e[t]}return[]}function tm(e,t){let r;if("string"==typeof t){if(e.isVertexAI()){if(t.startsWith("gs://"))r={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))r={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`)}else if(t.startsWith("files/"))r={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`)}else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");r={inlinedRequests:t}}else r=t;let n=[r.gcsUri,r.bigqueryUri].filter(Boolean).length,i=[r.inlinedRequests,r.fileName].filter(Boolean).length;if(e.isVertexAI()){if(i>0||1!==n)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||1!==i)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return r}function tg(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let r=t.inlinedResponses;if(!Array.isArray(r)||0===r.length)return e;let n=!1;for(let e of r){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){n=!0;break}}return n&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function ty(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function tv(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function tb(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata","displayName"]);null!=n&&eE(t,["displayName"],n);let i=ew(e,["metadata","state"]);null!=i&&eE(t,["state"],tv(i));let o=ew(e,["metadata","createTime"]);null!=o&&eE(t,["createTime"],o);let s=ew(e,["metadata","endTime"]);null!=s&&eE(t,["endTime"],s);let a=ew(e,["metadata","updateTime"]);null!=a&&eE(t,["updateTime"],a);let l=ew(e,["metadata","model"]);null!=l&&eE(t,["model"],l);let c=ew(e,["metadata","output"]);return null!=c&&eE(t,["dest"],/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["responsesFile"]);null!=r&&eE(t,["fileName"],r);let n=ew(e,["inlinedResponses","inlinedResponses"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["response"]);null!=r&&eE(t,["response"],function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["candidates"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["content"]);null!=r&&eE(t,["content"],r);let n=ew(e,["citationMetadata"]);null!=n&&eE(t,["citationMetadata"],function(e){let t={},r=ew(e,["citationSources"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["citations"],e)}return t}(n));let i=ew(e,["tokenCount"]);null!=i&&eE(t,["tokenCount"],i);let o=ew(e,["finishReason"]);null!=o&&eE(t,["finishReason"],o);let s=ew(e,["avgLogprobs"]);null!=s&&eE(t,["avgLogprobs"],s);let a=ew(e,["groundingMetadata"]);null!=a&&eE(t,["groundingMetadata"],a);let l=ew(e,["index"]);null!=l&&eE(t,["index"],l);let c=ew(e,["logprobsResult"]);null!=c&&eE(t,["logprobsResult"],c);let u=ew(e,["safetyRatings"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["safetyRatings"],e)}let d=ew(e,["urlContextMetadata"]);return null!=d&&eE(t,["urlContextMetadata"],d),t})(e))),eE(t,["candidates"],e)}let i=ew(e,["modelVersion"]);null!=i&&eE(t,["modelVersion"],i);let o=ew(e,["promptFeedback"]);null!=o&&eE(t,["promptFeedback"],o);let s=ew(e,["responseId"]);null!=s&&eE(t,["responseId"],s);let a=ew(e,["usageMetadata"]);return null!=a&&eE(t,["usageMetadata"],a),t}(r));let n=ew(e,["error"]);return null!=n&&eE(t,["error"],n),t})(e))),eE(t,["inlinedResponses"],e)}let i=ew(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["inlinedEmbedContentResponses"],e)}return t}(tg(c))),t}function t_(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["displayName"]);null!=n&&eE(t,["displayName"],n);let i=ew(e,["state"]);null!=i&&eE(t,["state"],tv(i));let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["createTime"]);null!=s&&eE(t,["createTime"],s);let a=ew(e,["startTime"]);null!=a&&eE(t,["startTime"],a);let l=ew(e,["endTime"]);null!=l&&eE(t,["endTime"],l);let c=ew(e,["updateTime"]);null!=c&&eE(t,["updateTime"],c);let u=ew(e,["model"]);null!=u&&eE(t,["model"],u);let d=ew(e,["inputConfig"]);null!=d&&eE(t,["src"],function(e){let t={},r=ew(e,["instancesFormat"]);null!=r&&eE(t,["format"],r);let n=ew(e,["gcsSource","uris"]);null!=n&&eE(t,["gcsUri"],n);let i=ew(e,["bigquerySource","inputUri"]);return null!=i&&eE(t,["bigqueryUri"],i),t}(d));let p=ew(e,["outputConfig"]);null!=p&&eE(t,["dest"],function(e){let t={},r=ew(e,["predictionsFormat"]);null!=r&&eE(t,["format"],r);let n=ew(e,["gcsDestination","outputUriPrefix"]);null!=n&&eE(t,["gcsUri"],n);let i=ew(e,["bigqueryDestination","outputUri"]);return null!=i&&eE(t,["bigqueryUri"],i),t}(tg(p)));let h=ew(e,["completionStats"]);return null!=h&&eE(t,["completionStats"],h),t}function tE(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],function(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}function tw(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["src"]);null!=i&&eE(r,["batch","inputConfig"],function(e,t){let r={};if(void 0!==ew(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==ew(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==ew(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let n=ew(t,["fileName"]);null!=n&&eE(r,["fileName"],n);let i=ew(t,["inlinedRequests"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["request","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>tE(e))),eE(r,["request","contents"],e)}let o=ew(t,["metadata"]);null!=o&&eE(r,["metadata"],o);let s=ew(t,["config"]);return null!=s&&eE(r,["request","generationConfig"],function(e,t,r){let n={},i=ew(t,["systemInstruction"]);void 0!==r&&null!=i&&eE(r,["systemInstruction"],tE(te(i)));let o=ew(t,["temperature"]);null!=o&&eE(n,["temperature"],o);let s=ew(t,["topP"]);null!=s&&eE(n,["topP"],s);let a=ew(t,["topK"]);null!=a&&eE(n,["topK"],a);let l=ew(t,["candidateCount"]);null!=l&&eE(n,["candidateCount"],l);let c=ew(t,["maxOutputTokens"]);null!=c&&eE(n,["maxOutputTokens"],c);let u=ew(t,["stopSequences"]);null!=u&&eE(n,["stopSequences"],u);let d=ew(t,["responseLogprobs"]);null!=d&&eE(n,["responseLogprobs"],d);let p=ew(t,["logprobs"]);null!=p&&eE(n,["logprobs"],p);let h=ew(t,["presencePenalty"]);null!=h&&eE(n,["presencePenalty"],h);let f=ew(t,["frequencyPenalty"]);null!=f&&eE(n,["frequencyPenalty"],f);let m=ew(t,["seed"]);null!=m&&eE(n,["seed"],m);let g=ew(t,["responseMimeType"]);null!=g&&eE(n,["responseMimeType"],g);let y=ew(t,["responseSchema"]);null!=y&&eE(n,["responseSchema"],tn(y));let v=ew(t,["responseJsonSchema"]);if(null!=v&&eE(n,["responseJsonSchema"],v),void 0!==ew(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==ew(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let b=ew(t,["safetySettings"]);if(void 0!==r&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["category"]);if(null!=r&&eE(t,["category"],r),void 0!==ew(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=ew(e,["threshold"]);return null!=n&&eE(t,["threshold"],n),t})(e))),eE(r,["safetySettings"],e)}let _=ew(t,["tools"]);if(void 0!==r&&null!=_){let e=ta(_);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(ts(e)))),eE(r,["tools"],e)}let E=ew(t,["toolConfig"]);if(void 0!==r&&null!=E&&eE(r,["toolConfig"],function(e){let t={},r=ew(e,["retrievalConfig"]);null!=r&&eE(t,["retrievalConfig"],r);let n=ew(e,["functionCallingConfig"]);return null!=n&&eE(t,["functionCallingConfig"],function(e){let t={},r=ew(e,["allowedFunctionNames"]);null!=r&&eE(t,["allowedFunctionNames"],r);let n=ew(e,["mode"]);if(null!=n&&eE(t,["mode"],n),void 0!==ew(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(n)),t}(E)),void 0!==ew(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let w=ew(t,["cachedContent"]);void 0!==r&&null!=w&&eE(r,["cachedContent"],tl(e,w));let x=ew(t,["responseModalities"]);null!=x&&eE(n,["responseModalities"],x);let S=ew(t,["mediaResolution"]);null!=S&&eE(n,["mediaResolution"],S);let T=ew(t,["speechConfig"]);if(null!=T&&eE(n,["speechConfig"],ti(T)),void 0!==ew(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let A=ew(t,["thinkingConfig"]);null!=A&&eE(n,["thinkingConfig"],A);let C=ew(t,["imageConfig"]);null!=C&&eE(n,["imageConfig"],function(e){let t={},r=ew(e,["aspectRatio"]);null!=r&&eE(t,["aspectRatio"],r);let n=ew(e,["imageSize"]);if(null!=n&&eE(t,["imageSize"],n),void 0!==ew(e,["personGeneration"]))throw Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==ew(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==ew(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(C));let O=ew(t,["enableEnhancedCivicAnswers"]);if(null!=O&&eE(n,["enableEnhancedCivicAnswers"],O),void 0!==ew(t,["modelArmorConfig"]))throw Error("modelArmorConfig parameter is not supported in Gemini API.");return n}(e,s,ew(r,["request"],{}))),r})(e,t))),eE(r,["requests","requests"],t)}return r}(e,tm(e,i)));let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["displayName"]);if(void 0!==t&&null!=r&&eE(t,["batch","displayName"],r),void 0!==ew(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(o,r),r}!function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"}(ed||(ed={}));class tx{constructor(e,t,r,n){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,r,n)}init(e,t,r){var n,i;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};(o=r&&0!==Object.keys(r).length?"object"==typeof r?Object.assign({},r):r:{config:{}}).config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=null!==(i=null===(n=o.config)||void 0===n?void 0:n.pageSize)&&void 0!==i?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength){if(!this.hasNextPage())return{value:void 0,done:!0};await this.nextPage()}let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null===(e=this.params.config)||void 0===e?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tS extends eb{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tx(ed.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(e){let t=tw(this.apiClient,e),r=e_("{model}:batchGenerateContent",t._url),n=t.batch.inputConfig.requests,i=n.requests,o=[];for(let e of i){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let r=t.request;r.systemInstruction=e,t.request=r}o.push(t)}return n.requests=o,delete t.config,delete t._url,delete t._query,{path:r,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let r=t?Object.assign({},t):{},n=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${n}`),void 0===r.dest){let t=this.getGcsUri(e),i=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?r.dest=`${t.slice(0,-6)}/dest`:r.dest=`${t}_dest_${n}`;else if(i)r.dest=`${i}_dest_${n}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["model"],eQ(e,n));let i=ew(t,["src"]);null!=i&&eE(r,["inputConfig"],function(e){let t={},r=ew(e,["format"]);null!=r&&eE(t,["instancesFormat"],r);let n=ew(e,["gcsUri"]);null!=n&&eE(t,["gcsSource","uris"],n);let i=ew(e,["bigqueryUri"]);if(null!=i&&eE(t,["bigquerySource","inputUri"],i),void 0!==ew(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==ew(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(tm(e,i)));let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["displayName"],r);let n=ew(e,["dest"]);void 0!==t&&null!=n&&eE(t,["outputConfig"],function(e){let t={},r=ew(e,["format"]);null!=r&&eE(t,["predictionsFormat"],r);let n=ew(e,["gcsUri"]);null!=n&&eE(t,["gcsDestination","outputUriPrefix"],n);let i=ew(e,["bigqueryUri"]);if(null!=i&&eE(t,["bigqueryDestination","outputUri"],i),void 0!==ew(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==ew(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==ew(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(n)))}(o,r),r}(this.apiClient,e);return o=e_("batchPredictionJobs",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>t_(e))}{let t=tw(this.apiClient,e);return o=e_("{model}:batchGenerateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tb(e))}}async createEmbeddingsInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["src"]);null!=i&&eE(r,["batch","inputConfig"],function(e,t){let r={},n=ew(t,["fileName"]);null!=n&&eE(r,["file_name"],n);let i=ew(t,["inlinedRequests"]);return null!=i&&eE(r,["requests"],function(e,t){let r={},n=ew(t,["contents"]);if(null!=n){let t=tt(e,n);Array.isArray(t)&&(t=t.map(e=>e)),eE(r,["requests[]","request","content"],t)}let i=ew(t,["config"]);return null!=i&&(eE(r,["_self"],function(e,t){let r=ew(e,["taskType"]);void 0!==t&&null!=r&&eE(t,["requests[]","taskType"],r);let n=ew(e,["title"]);void 0!==t&&null!=n&&eE(t,["requests[]","title"],n);let i=ew(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&eE(t,["requests[]","outputDimensionality"],i),void 0!==ew(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==ew(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(i,r)),function(e,t){for(let[r,n]of Object.entries(t)){let t=r.split("."),i=n.split("."),o=new Set,s=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){s=e;break}if(-1!==s&&i.length>s)for(let e=s;e<i.length;e++){let t=i[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||o.add(t)}(function e(t,r,n,i,o){if(i>=r.length||"object"!=typeof t||null===t)return;let s=r[i];if(s.endsWith("[]")){let a=s.slice(0,-2);if(a in t&&Array.isArray(t[a]))for(let s of t[a])e(s,r,n,i+1,o)}else if("*"===s){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!o.has(e)),r={};for(let n of e)r[n]=t[n];for(let[e,o]of Object.entries(r)){let r=[];for(let t of n.slice(i))"*"===t?r.push(e):r.push(t);eE(t,r,o)}for(let r of e)delete t[r]}}else s in t&&e(t[s],r,n,i+1,o)})(e,t,i,0,o)}}(r,{"requests[].*":"requests[].request.*"})),r}(e,i)),r}(e,i));let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["batch","displayName"],r)}(o,r),r}(this.apiClient,e);return n=e_("{model}:asyncBatchEmbedContent",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>tb(e))}}async get(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);return o=e_("batchPredictionJobs/{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>t_(e))}{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);return o=e_("batches/{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tb(e))}}async cancel(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);o=e_("batchPredictionJobs/{name}:cancel",n._url),s=n._query,delete n._url,delete n._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal})}else{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);o=e_("batches/{name}:cancel",t._url),s=t._query,delete t._url,delete t._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal})}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n);let i=ew(e,["filter"]);void 0!==t&&null!=i&&eE(t,["_query","filter"],i)}(r,t),t}(e);return o=e_("batchPredictionJobs",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["batchPredictionJobs"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>t_(e))),eE(t,["batchJobs"],e)}return t}(e),r=new eK;return Object.assign(r,t),r})}{let t=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);if(void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n),void 0!==ew(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(r,t),t}(e);return o=e_("batches",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["operations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>tb(e))),eE(t,["batchJobs"],e)}return t}(e),r=new eK;return Object.assign(r,t),r})}}async delete(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);return o=e_("batchPredictionJobs/{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);return null!=o&&eE(t,["error"],o),t})(e))}{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);return o=e_("batches/{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);return null!=o&&eE(t,["error"],o),t})(e))}}}function tT(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tA extends eb{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tx(ed.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["model"],e0(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["ttl"]);void 0!==t&&null!=r&&eE(t,["ttl"],r);let n=ew(e,["expireTime"]);void 0!==t&&null!=n&&eE(t,["expireTime"],n);let i=ew(e,["displayName"]);void 0!==t&&null!=i&&eE(t,["displayName"],i);let o=ew(e,["contents"]);if(void 0!==t&&null!=o){let e=tr(o);Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["contents"],e)}let s=ew(e,["systemInstruction"]);void 0!==t&&null!=s&&eE(t,["systemInstruction"],te(s));let a=ew(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["retrieval"]);null!=r&&eE(t,["retrieval"],r);let n=ew(e,["computerUse"]);if(null!=n&&eE(t,["computerUse"],n),void 0!==ew(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let i=ew(e,["codeExecution"]);null!=i&&eE(t,["codeExecution"],i);let o=ew(e,["enterpriseWebSearch"]);null!=o&&eE(t,["enterpriseWebSearch"],o);let s=ew(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["description"]);null!=r&&eE(t,["description"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["parameters"]);null!=i&&eE(t,["parameters"],i);let o=ew(e,["parametersJsonSchema"]);null!=o&&eE(t,["parametersJsonSchema"],o);let s=ew(e,["response"]);null!=s&&eE(t,["response"],s);let a=ew(e,["responseJsonSchema"]);if(null!=a&&eE(t,["responseJsonSchema"],a),void 0!==ew(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),eE(t,["functionDeclarations"],e)}let a=ew(e,["googleMaps"]);null!=a&&eE(t,["googleMaps"],a);let l=ew(e,["googleSearch"]);null!=l&&eE(t,["googleSearch"],l);let c=ew(e,["googleSearchRetrieval"]);null!=c&&eE(t,["googleSearchRetrieval"],c);let u=ew(e,["urlContext"]);return null!=u&&eE(t,["urlContext"],u),t})(e))),eE(t,["tools"],e)}let l=ew(e,["toolConfig"]);void 0!==t&&null!=l&&eE(t,["toolConfig"],l);let c=ew(e,["kmsKeyName"]);void 0!==t&&null!=c&&eE(t,["encryption_spec","kmsKeyName"],c)}(i,r),r}(this.apiClient,e);return o=e_("cachedContents",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["model"],e0(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["ttl"]);void 0!==t&&null!=r&&eE(t,["ttl"],r);let n=ew(e,["expireTime"]);void 0!==t&&null!=n&&eE(t,["expireTime"],n);let i=ew(e,["displayName"]);void 0!==t&&null!=i&&eE(t,["displayName"],i);let o=ew(e,["contents"]);if(void 0!==t&&null!=o){let e=tr(o);Array.isArray(e)&&(e=e.map(e=>tT(e))),eE(t,["contents"],e)}let s=ew(e,["systemInstruction"]);void 0!==t&&null!=s&&eE(t,["systemInstruction"],tT(te(s)));let a=ew(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(e))),eE(t,["tools"],e)}let l=ew(e,["toolConfig"]);if(void 0!==t&&null!=l&&eE(t,["toolConfig"],function(e){let t={},r=ew(e,["retrievalConfig"]);null!=r&&eE(t,["retrievalConfig"],r);let n=ew(e,["functionCallingConfig"]);return null!=n&&eE(t,["functionCallingConfig"],function(e){let t={},r=ew(e,["allowedFunctionNames"]);null!=r&&eE(t,["allowedFunctionNames"],r);let n=ew(e,["mode"]);if(null!=n&&eE(t,["mode"],n),void 0!==ew(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(n)),t}(l)),void 0!==ew(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(i,r),r}(this.apiClient,e);return o=e_("cachedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],tl(e,n)),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],tl(e,n)),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],tl(e,n)),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eF;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],tl(e,n)),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eF;return Object.assign(r,t),r})}}async update(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);null!=n&&eE(r,["_url","name"],tl(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["ttl"]);void 0!==t&&null!=r&&eE(t,["ttl"],r);let n=ew(e,["expireTime"]);void 0!==t&&null!=n&&eE(t,["expireTime"],n)}(i,r),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let r={},n=ew(t,["name"]);null!=n&&eE(r,["_url","name"],tl(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["ttl"]);void 0!==t&&null!=r&&eE(t,["ttl"],r);let n=ew(e,["expireTime"]);void 0!==t&&null!=n&&eE(t,["expireTime"],n)}(i,r),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(r,t),t}(e);return o=e_("cachedContents",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["cachedContents"],e)}return t}(e),r=new eq;return Object.assign(r,t),r})}{let t=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(r,t),t}(e);return o=e_("cachedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["cachedContents"],e)}return t}(e),r=new eq;return Object.assign(r,t),r})}}}function tC(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function tO(e){return this instanceof tO?(this.v=e,this):new tO(e)}function tI(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),n[Symbol.asyncIterator]=function(){return this},n;function s(e,t){i[e]&&(n[e]=function(t){return new Promise(function(r,n){o.push([e,t,r,n])>1||a(e,t)})},t&&(n[e]=t(n[e])))}function a(e,t){try{var r;(r=i[e](t)).value instanceof tO?Promise.resolve(r.value.v).then(l,c):u(o[0][2],r)}catch(e){u(o[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function tN(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,i,(t=e[r](t)).done,t.value)})}}}function tk(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function tR(e){if(void 0===e||0===e.length)return[];let t=[],r=e.length,n=0;for(;n<r;)if("user"===e[n].role)t.push(e[n]),n++;else{let i=[],o=!0;for(;n<r&&"model"===e[n].role;)i.push(e[n]),o&&!tk(e[n])&&(o=!1),n++;o?t.push(...i):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class tP{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new tj(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class tj{constructor(e,t,r,n={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=r,this.config=n,this.history=i,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(i)}async sendMessage(e){var t;await this.sendPromise;let r=te(e.message),n=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:null!==(t=e.config)&&void 0!==t?t:this.config});return this.sendPromise=(async()=>{var e,t,i;let o=await n,s=null===(t=null===(e=o.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content,a=o.automaticFunctionCallingHistory,l=this.getHistory(!0).length,c=[];null!=a&&(c=null!==(i=a.slice(l))&&void 0!==i?i:[]),this.recordHistory(r,s?[s]:[],c)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),n}async sendMessageStream(e){var t;await this.sendPromise;let r=te(e.message),n=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:null!==(t=e.config)&&void 0!==t?t:this.config});this.sendPromise=n.then(()=>void 0).catch(()=>void 0);let i=await n;return this.processStreamResponse(i,r)}getHistory(e=!1){return structuredClone(e?tR(this.history):this.history)}processStreamResponse(e,t){return tI(this,arguments,function*(){let r=[];try{for(var n,i,o,s,a,l,c,u=!0,d=tN(e);!(n=(c=yield tO(d.next())).done);u=!0){if(s=c.value,u=!1,/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let r=null===(t=e.candidates[0])||void 0===t?void 0:t.content;return void 0!==r&&tk(r)}(s)){let e=null===(l=null===(a=s.candidates)||void 0===a?void 0:a[0])||void 0===l?void 0:l.content;void 0!==e&&r.push(e)}yield yield tO(s)}}catch(e){i={error:e}}finally{try{!u&&!n&&(o=d.return)&&(yield tO(o.call(d)))}finally{if(i)throw i.error}}this.recordHistory(t,r)})}recordHistory(e,t,r){let n=[];t.length>0&&t.every(e=>void 0!==e.role)?n=t:n.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...tR(r)):this.history.push(e),this.history.push(...n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tM extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,tM.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tD extends eb{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tx(ed.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(r,t),t}(e);return n=e_("files",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["files"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["files"],e)}return t}(e),r=new ez;return Object.assign(r,t),r})}}async createInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["file"]);return null!=r&&eE(t,["file"],r),t}(e);return n=e_("upload/v1beta/files",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eJ;return Object.assign(r,t),r})}}async get(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);return null!=r&&eE(t,["_url","file"],tp(r)),t}(e);return n=e_("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);return null!=r&&eE(t,["_url","file"],tp(r)),t}(e);return n=e_("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eW;return Object.assign(r,t),r})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tU(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}function tL(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}function tG(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>tL(e))),eE(r,["contents"],e)}let o=ew(t,["config"]);return null!=o&&eE(r,["generationConfig"],function(e,t,r){let n={},i=ew(t,["systemInstruction"]);void 0!==r&&null!=i&&eE(r,["systemInstruction"],tL(te(i)));let o=ew(t,["temperature"]);null!=o&&eE(n,["temperature"],o);let s=ew(t,["topP"]);null!=s&&eE(n,["topP"],s);let a=ew(t,["topK"]);null!=a&&eE(n,["topK"],a);let l=ew(t,["candidateCount"]);null!=l&&eE(n,["candidateCount"],l);let c=ew(t,["maxOutputTokens"]);null!=c&&eE(n,["maxOutputTokens"],c);let u=ew(t,["stopSequences"]);null!=u&&eE(n,["stopSequences"],u);let d=ew(t,["responseLogprobs"]);null!=d&&eE(n,["responseLogprobs"],d);let p=ew(t,["logprobs"]);null!=p&&eE(n,["logprobs"],p);let h=ew(t,["presencePenalty"]);null!=h&&eE(n,["presencePenalty"],h);let f=ew(t,["frequencyPenalty"]);null!=f&&eE(n,["frequencyPenalty"],f);let m=ew(t,["seed"]);null!=m&&eE(n,["seed"],m);let g=ew(t,["responseMimeType"]);null!=g&&eE(n,["responseMimeType"],g);let y=ew(t,["responseSchema"]);null!=y&&eE(n,["responseSchema"],tn(y));let v=ew(t,["responseJsonSchema"]);if(null!=v&&eE(n,["responseJsonSchema"],v),void 0!==ew(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==ew(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let b=ew(t,["safetySettings"]);if(void 0!==r&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["category"]);if(null!=r&&eE(t,["category"],r),void 0!==ew(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=ew(e,["threshold"]);return null!=n&&eE(t,["threshold"],n),t})(e))),eE(r,["safetySettings"],e)}let _=ew(t,["tools"]);if(void 0!==r&&null!=_){let e=ta(_);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(ts(e)))),eE(r,["tools"],e)}let E=ew(t,["toolConfig"]);if(void 0!==r&&null!=E&&eE(r,["toolConfig"],function(e){let t={},r=ew(e,["retrievalConfig"]);null!=r&&eE(t,["retrievalConfig"],r);let n=ew(e,["functionCallingConfig"]);return null!=n&&eE(t,["functionCallingConfig"],function(e){let t={},r=ew(e,["allowedFunctionNames"]);null!=r&&eE(t,["allowedFunctionNames"],r);let n=ew(e,["mode"]);if(null!=n&&eE(t,["mode"],n),void 0!==ew(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(n)),t}(E)),void 0!==ew(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let w=ew(t,["cachedContent"]);void 0!==r&&null!=w&&eE(r,["cachedContent"],tl(e,w));let x=ew(t,["responseModalities"]);null!=x&&eE(n,["responseModalities"],x);let S=ew(t,["mediaResolution"]);null!=S&&eE(n,["mediaResolution"],S);let T=ew(t,["speechConfig"]);if(null!=T&&eE(n,["speechConfig"],ti(T)),void 0!==ew(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let A=ew(t,["thinkingConfig"]);null!=A&&eE(n,["thinkingConfig"],A);let C=ew(t,["imageConfig"]);null!=C&&eE(n,["imageConfig"],function(e){let t={},r=ew(e,["aspectRatio"]);null!=r&&eE(t,["aspectRatio"],r);let n=ew(e,["imageSize"]);if(null!=n&&eE(t,["imageSize"],n),void 0!==ew(e,["personGeneration"]))throw Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==ew(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==ew(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(C));let O=ew(t,["enableEnhancedCivicAnswers"]);if(null!=O&&eE(n,["enableEnhancedCivicAnswers"],O),void 0!==ew(t,["modelArmorConfig"]))throw Error("modelArmorConfig parameter is not supported in Gemini API.");return n}(e,o,r)),r}function tF(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>e)),eE(r,["contents"],e)}let o=ew(t,["config"]);return null!=o&&eE(r,["generationConfig"],function(e,t,r){let n={},i=ew(t,["systemInstruction"]);void 0!==r&&null!=i&&eE(r,["systemInstruction"],te(i));let o=ew(t,["temperature"]);null!=o&&eE(n,["temperature"],o);let s=ew(t,["topP"]);null!=s&&eE(n,["topP"],s);let a=ew(t,["topK"]);null!=a&&eE(n,["topK"],a);let l=ew(t,["candidateCount"]);null!=l&&eE(n,["candidateCount"],l);let c=ew(t,["maxOutputTokens"]);null!=c&&eE(n,["maxOutputTokens"],c);let u=ew(t,["stopSequences"]);null!=u&&eE(n,["stopSequences"],u);let d=ew(t,["responseLogprobs"]);null!=d&&eE(n,["responseLogprobs"],d);let p=ew(t,["logprobs"]);null!=p&&eE(n,["logprobs"],p);let h=ew(t,["presencePenalty"]);null!=h&&eE(n,["presencePenalty"],h);let f=ew(t,["frequencyPenalty"]);null!=f&&eE(n,["frequencyPenalty"],f);let m=ew(t,["seed"]);null!=m&&eE(n,["seed"],m);let g=ew(t,["responseMimeType"]);null!=g&&eE(n,["responseMimeType"],g);let y=ew(t,["responseSchema"]);null!=y&&eE(n,["responseSchema"],tn(y));let v=ew(t,["responseJsonSchema"]);null!=v&&eE(n,["responseJsonSchema"],v);let b=ew(t,["routingConfig"]);null!=b&&eE(n,["routingConfig"],b);let _=ew(t,["modelSelectionConfig"]);null!=_&&eE(n,["modelConfig"],_);let E=ew(t,["safetySettings"]);if(void 0!==r&&null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>e)),eE(r,["safetySettings"],e)}let w=ew(t,["tools"]);if(void 0!==r&&null!=w){let e=ta(w);Array.isArray(e)&&(e=e.map(e=>tX(ts(e)))),eE(r,["tools"],e)}let x=ew(t,["toolConfig"]);void 0!==r&&null!=x&&eE(r,["toolConfig"],x);let S=ew(t,["labels"]);void 0!==r&&null!=S&&eE(r,["labels"],S);let T=ew(t,["cachedContent"]);void 0!==r&&null!=T&&eE(r,["cachedContent"],tl(e,T));let A=ew(t,["responseModalities"]);null!=A&&eE(n,["responseModalities"],A);let C=ew(t,["mediaResolution"]);null!=C&&eE(n,["mediaResolution"],C);let O=ew(t,["speechConfig"]);null!=O&&eE(n,["speechConfig"],ti(O));let I=ew(t,["audioTimestamp"]);null!=I&&eE(n,["audioTimestamp"],I);let N=ew(t,["thinkingConfig"]);null!=N&&eE(n,["thinkingConfig"],N);let k=ew(t,["imageConfig"]);if(null!=k&&eE(n,["imageConfig"],function(e){let t={},r=ew(e,["aspectRatio"]);null!=r&&eE(t,["aspectRatio"],r);let n=ew(e,["imageSize"]);null!=n&&eE(t,["imageSize"],n);let i=ew(e,["personGeneration"]);null!=i&&eE(t,["personGeneration"],i);let o=ew(e,["outputMimeType"]);null!=o&&eE(t,["imageOutputOptions","mimeType"],o);let s=ew(e,["outputCompressionQuality"]);return null!=s&&eE(t,["imageOutputOptions","compressionQuality"],s),t}(k)),void 0!==ew(t,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");let R=ew(t,["modelArmorConfig"]);return void 0!==r&&null!=R&&eE(r,["modelArmorConfig"],R),n}(e,o,r)),r}function tq(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["candidates"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["content"]);null!=r&&eE(t,["content"],r);let n=ew(e,["citationMetadata"]);null!=n&&eE(t,["citationMetadata"],function(e){let t={},r=ew(e,["citationSources"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["citations"],e)}return t}(n));let i=ew(e,["tokenCount"]);null!=i&&eE(t,["tokenCount"],i);let o=ew(e,["finishReason"]);null!=o&&eE(t,["finishReason"],o);let s=ew(e,["avgLogprobs"]);null!=s&&eE(t,["avgLogprobs"],s);let a=ew(e,["groundingMetadata"]);null!=a&&eE(t,["groundingMetadata"],a);let l=ew(e,["index"]);null!=l&&eE(t,["index"],l);let c=ew(e,["logprobsResult"]);null!=c&&eE(t,["logprobsResult"],c);let u=ew(e,["safetyRatings"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["safetyRatings"],e)}let d=ew(e,["urlContextMetadata"]);return null!=d&&eE(t,["urlContextMetadata"],d),t})(e))),eE(t,["candidates"],e)}let i=ew(e,["modelVersion"]);null!=i&&eE(t,["modelVersion"],i);let o=ew(e,["promptFeedback"]);null!=o&&eE(t,["promptFeedback"],o);let s=ew(e,["responseId"]);null!=s&&eE(t,["responseId"],s);let a=ew(e,["usageMetadata"]);return null!=a&&eE(t,["usageMetadata"],a),t}function tB(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["candidates"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["candidates"],e)}let i=ew(e,["createTime"]);null!=i&&eE(t,["createTime"],i);let o=ew(e,["modelVersion"]);null!=o&&eE(t,["modelVersion"],o);let s=ew(e,["promptFeedback"]);null!=s&&eE(t,["promptFeedback"],s);let a=ew(e,["responseId"]);null!=a&&eE(t,["responseId"],a);let l=ew(e,["usageMetadata"]);return null!=l&&eE(t,["usageMetadata"],l),t}function tH(e){let t={},r=ew(e,["_self"]);null!=r&&eE(t,["image"],tV(r));let n=ew(e,["raiFilteredReason"]);null!=n&&eE(t,["raiFilteredReason"],n);let i=ew(e,["_self"]);null!=i&&eE(t,["safetyAttributes"],tY(i));let o=ew(e,["prompt"]);return null!=o&&eE(t,["enhancedPrompt"],o),t}function tV(e){let t={},r=ew(e,["gcsUri"]);null!=r&&eE(t,["gcsUri"],r);let n=ew(e,["bytesBase64Encoded"]);null!=n&&eE(t,["imageBytes"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}function t$(e){let t={};if(void 0!==ew(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let r=ew(e,["imageBytes"]);null!=r&&eE(t,["bytesBase64Encoded"],ex(r));let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}function tz(e){let t={},r=ew(e,["gcsUri"]);null!=r&&eE(t,["gcsUri"],r);let n=ew(e,["imageBytes"]);null!=n&&eE(t,["bytesBase64Encoded"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}function tJ(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["displayName"]);null!=n&&eE(t,["displayName"],n);let i=ew(e,["description"]);null!=i&&eE(t,["description"],i);let o=ew(e,["version"]);null!=o&&eE(t,["version"],o);let s=ew(e,["_self"]);null!=s&&eE(t,["tunedModelInfo"],function(e){let t={},r=ew(e,["baseModel"]);null!=r&&eE(t,["baseModel"],r);let n=ew(e,["createTime"]);null!=n&&eE(t,["createTime"],n);let i=ew(e,["updateTime"]);return null!=i&&eE(t,["updateTime"],i),t}(s));let a=ew(e,["inputTokenLimit"]);null!=a&&eE(t,["inputTokenLimit"],a);let l=ew(e,["outputTokenLimit"]);null!=l&&eE(t,["outputTokenLimit"],l);let c=ew(e,["supportedGenerationMethods"]);null!=c&&eE(t,["supportedActions"],c);let u=ew(e,["temperature"]);null!=u&&eE(t,["temperature"],u);let d=ew(e,["maxTemperature"]);null!=d&&eE(t,["maxTemperature"],d);let p=ew(e,["topP"]);null!=p&&eE(t,["topP"],p);let h=ew(e,["topK"]);null!=h&&eE(t,["topK"],h);let f=ew(e,["thinking"]);return null!=f&&eE(t,["thinking"],f),t}function tW(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["displayName"]);null!=n&&eE(t,["displayName"],n);let i=ew(e,["description"]);null!=i&&eE(t,["description"],i);let o=ew(e,["versionId"]);null!=o&&eE(t,["version"],o);let s=ew(e,["deployedModels"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["endpoint"]);null!=r&&eE(t,["name"],r);let n=ew(e,["deployedModelId"]);return null!=n&&eE(t,["deployedModelId"],n),t})(e))),eE(t,["endpoints"],e)}let a=ew(e,["labels"]);null!=a&&eE(t,["labels"],a);let l=ew(e,["_self"]);null!=l&&eE(t,["tunedModelInfo"],function(e){let t={},r=ew(e,["labels","google-vertex-llm-tuning-base-model-id"]);null!=r&&eE(t,["baseModel"],r);let n=ew(e,["createTime"]);null!=n&&eE(t,["createTime"],n);let i=ew(e,["updateTime"]);return null!=i&&eE(t,["updateTime"],i),t}(l));let c=ew(e,["defaultCheckpointId"]);null!=c&&eE(t,["defaultCheckpointId"],c);let u=ew(e,["checkpoints"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["checkpoints"],e)}return t}function tK(e){let t={},r=ew(e,["safetyAttributes","categories"]);null!=r&&eE(t,["categories"],r);let n=ew(e,["safetyAttributes","scores"]);null!=n&&eE(t,["scores"],n);let i=ew(e,["contentType"]);return null!=i&&eE(t,["contentType"],i),t}function tY(e){let t={},r=ew(e,["safetyAttributes","categories"]);null!=r&&eE(t,["categories"],r);let n=ew(e,["safetyAttributes","scores"]);null!=n&&eE(t,["scores"],n);let i=ew(e,["contentType"]);return null!=i&&eE(t,["contentType"],i),t}function tX(e){let t={},r=ew(e,["retrieval"]);null!=r&&eE(t,["retrieval"],r);let n=ew(e,["computerUse"]);if(null!=n&&eE(t,["computerUse"],n),void 0!==ew(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let i=ew(e,["codeExecution"]);null!=i&&eE(t,["codeExecution"],i);let o=ew(e,["enterpriseWebSearch"]);null!=o&&eE(t,["enterpriseWebSearch"],o);let s=ew(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["description"]);null!=r&&eE(t,["description"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["parameters"]);null!=i&&eE(t,["parameters"],i);let o=ew(e,["parametersJsonSchema"]);null!=o&&eE(t,["parametersJsonSchema"],o);let s=ew(e,["response"]);null!=s&&eE(t,["response"],s);let a=ew(e,["responseJsonSchema"]);if(null!=a&&eE(t,["responseJsonSchema"],a),void 0!==ew(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),eE(t,["functionDeclarations"],e)}let a=ew(e,["googleMaps"]);null!=a&&eE(t,["googleMaps"],a);let l=ew(e,["googleSearch"]);null!=l&&eE(t,["googleSearch"],l);let c=ew(e,["googleSearchRetrieval"]);null!=c&&eE(t,["googleSearchRetrieval"],c);let u=ew(e,["urlContext"]);return null!=u&&eE(t,["urlContext"],u),t}function tZ(e){let t={},r=ew(e,["uri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["videoBytes"]);null!=n&&eE(t,["encodedVideo"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["encoding"],i),t}function tQ(e){let t={},r=ew(e,["uri"]);null!=r&&eE(t,["gcsUri"],r);let n=ew(e,["videoBytes"]);null!=n&&eE(t,["bytesBase64Encoded"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}function t0(e,t){let r=ew(e,["mimeType"]);void 0!==t&&null!=r&&eE(t,["mimeType"],r);let n=ew(e,["displayName"]);void 0!==t&&null!=n&&eE(t,["displayName"],n);let i=ew(e,["customMetadata"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["customMetadata"],e)}let o=ew(e,["chunkingConfig"]);return void 0!==t&&null!=o&&eE(t,["chunkingConfig"],o),{}}let t1="x-goog-api-client";class t2{constructor(e){var t,r,n;this.clientOptions=Object.assign({},e),this.customBaseUrl=null===(t=e.httpOptions)||void 0===t?void 0:t.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));let i={};if(this.clientOptions.vertexai){if(this.clientOptions.location||this.clientOptions.apiKey||this.customBaseUrl||(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");let t=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!t?(i.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||"global"===this.clientOptions.location?i.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),i.apiVersion=null!==(r=this.clientOptions.apiVersion)&&void 0!==r?r:"v1beta1"}else{if(!this.clientOptions.apiKey)throw new tM({message:"API key must be set when using the Gemini API.",status:403});i.apiVersion=null!==(n=this.clientOptions.apiVersion)&&void 0!==n?n:"v1beta",i.baseUrl="https://generativelanguage.googleapis.com/"}i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}isVertexAI(){var e;return null!==(e=this.clientOptions.vertexai)&&void 0!==e&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,r){let n=[this.getRequestUrlInternal(t)];return r&&n.push(this.getBaseResourcePath()),""!==e&&n.push(e),new URL(`${n.join("/")}`)}shouldPrependVertexProjectPath(e,t){return!(t.baseUrl&&t.baseUrlResourceScope===D.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e,t),n=this.constructUrl(e.path,t,r);if(e.queryParams)for(let[t,r]of Object.entries(e.queryParams))n.searchParams.append(t,String(r));let i={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,n.toString(),e.abortSignal),this.unaryApiCall(n,i,e.httpMethod)}patchHttpOptions(e,t){let r=JSON.parse(JSON.stringify(e));for(let[e,n]of Object.entries(t))"object"==typeof n?r[e]=Object.assign(Object.assign({},r[e]),n):void 0!==n&&(r[e]=n);return r}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e,t),n=this.constructUrl(e.path,t,r);n.searchParams.has("alt")&&"sse"===n.searchParams.get("alt")||n.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,n.toString(),e.abortSignal),this.streamApiCall(n,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,r,n){if(t&&t.timeout||n){let r=new AbortController,i=r.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>r.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}n&&n.addEventListener("abort",()=>{r.abort()}),e.signal=i}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let r={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t)){console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}r=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}let n=function e(t,r){let n=Object.assign({},t);for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)){let i=r[t],o=n[t];i&&"object"==typeof i&&!Array.isArray(i)&&o&&"object"==typeof o&&!Array.isArray(o)?n[t]=e(o,i):(o&&i&&typeof o!=typeof i&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof o}, New type: ${typeof i}. Overwriting.`),n[t]=i)}return n}(r,t);e.body=JSON.stringify(n)}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,r),e}async unaryApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async e=>(await t4(e),new eT(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async e=>(await t4(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){return tI(this,arguments,function*(){var t;let r=null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.getReader(),n=new TextDecoder("utf-8");if(!r)throw Error("Response body is empty");try{let t="",i="data:",o=["\n\n","\r\r","\r\n\r\n"];for(;;){let{done:s,value:a}=yield tO(r.read());if(s){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let l=n.decode(a,{stream:!0});try{let e=JSON.parse(l);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),r=t.status,n=t.code,i=`got status: ${r}. ${JSON.stringify(e)}`;if(n>=400&&n<600)throw new tM({message:i,status:n})}}catch(e){if("ApiError"===e.name)throw e}t+=l;let c=-1,u=0;for(;;){for(let e of(c=-1,u=0,o)){let r=t.indexOf(e);-1!==r&&(-1===c||r<c)&&(c=r,u=e.length)}if(-1===c)break;let r=t.substring(0,c);t=t.substring(c+u);let n=r.trim();if(n.startsWith(i)){let t=n.substring(i.length).trim();try{let r=new Response(t,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield tO(new eT(r))}catch(e){throw Error(`exception parsing stream chunk ${t}. ${e}`)}}}}}finally{r.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.38.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[t1]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let r=new Headers;if(e&&e.headers){for(let[t,n]of Object.entries(e.headers))r.append(t,n);e.timeout&&e.timeout>0&&r.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,t),r}getFileName(e){var t;let r="";return"string"==typeof e&&(r=null!==(t=(r=e.replace(/[/\\]+$/,"")).split(/[/\\]/).pop())&&void 0!==t?t:""),r}async uploadFile(e,t){var r;let n={};null!=t&&(n.mimeType=t.mimeType,n.name=t.name,n.displayName=t.displayName),n.name&&!n.name.startsWith("files/")&&(n.name=`files/${n.name}`);let i=this.clientOptions.uploader,o=await i.stat(e);n.sizeBytes=String(o.size);let s=null!==(r=null==t?void 0:t.mimeType)&&void 0!==r?r:o.type;if(void 0===s||""===s)throw Error("Can not determine mimeType. Please provide mimeType in the config.");n.mimeType=s;let a={file:n},l=this.getFileName(e),c=e_("upload/v1beta/files",a._url),u=await this.fetchUploadUrl(c,n.sizeBytes,n.mimeType,l,a,null==t?void 0:t.httpOptions);return i.upload(e,u,this)}async uploadFileToFileSearchStore(e,t,r){var n;let i=this.clientOptions.uploader,o=await i.stat(t),s=String(o.size),a=null!==(n=null==r?void 0:r.mimeType)&&void 0!==n?n:o.type;if(void 0===a||""===a)throw Error("Can not determine mimeType. Please provide mimeType in the config.");let l=`upload/v1beta/${e}:uploadToFileSearchStore`,c=this.getFileName(t),u={};null!=r&&t0(r,u);let d=await this.fetchUploadUrl(l,s,a,c,u,null==r?void 0:r.httpOptions);return i.uploadToFileSearchStore(t,d,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t,r,n,i,o){var s;let a={};a=o||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${r}`},n?{"X-Goog-Upload-File-Name":n}:{})};let l=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:a});if(!l||!(null==l?void 0:l.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let c=null===(s=null==l?void 0:l.headers)||void 0===s?void 0:s["x-goog-upload-url"];if(void 0===c)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function t4(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let r=e.status,n=JSON.stringify((null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(r>=400&&r<600)throw new tM({message:n,status:r});throw Error(n)}}function t5(e){for(let t of e){if(null!==t&&"object"==typeof t&&t instanceof t6||"object"==typeof t&&"inputSchema"in t)return!0}return!1}function t3(e){var t;let r=null!==(t=e[t1])&&void 0!==t?t:"";e[t1]=(r+" mcp_used/unknown").trimStart()}class t6{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new t6(e,t)}async initialize(){var e,t,r,n;if(this.mcpTools.length>0)return;let i={},o=[];for(let c of this.mcpClients)try{for(var s,a=!0,l=(t=void 0,tN(function(e){return tI(this,arguments,function*(e,t=100){let r;let n=0;for(;n<t;){let t=yield tO(e.listTools({cursor:r}));for(let e of t.tools)yield yield tO(e),n++;if(!t.nextCursor)break;r=t.nextCursor}})}(c)));!(e=(s=await l.next()).done);a=!0){n=s.value,a=!1,o.push(n);let e=n.name;if(i[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i[e]=c}}catch(e){t={error:e}}finally{try{!a&&!e&&(r=l.return)&&await r.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),function(e,t={}){let r=[],n=new Set;for(let i of e){let e=i.name;if(n.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);n.add(e);let o=function(e,t={}){let r={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(r.responseJsonSchema=e.outputSchema),t.behavior&&(r.behavior=t.behavior),{functionDeclarations:[r]}}(i,t);o.functionDeclarations&&r.push(...o.functionDeclarations)}return{functionDeclarations:r}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let r of e)if(r.name in this.functionNameToMcpClient){let e;let n=this.functionNameToMcpClient[r.name];this.config.timeout&&(e={timeout:this.config.timeout});let i=await n.callTool({name:r.name,arguments:r.args},void 0,e);t.push({functionResponse:{name:r.name,response:i.isError?{error:i}:i}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function t8(e,t,r){let n;let i=new eX;r.data instanceof Blob?n=JSON.parse(await r.data.text()):n=JSON.parse(r.data),Object.assign(i,n),t(i)}class t7{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r}async connect(e){var t,r;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let n=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),o=function(e){let t=new Headers;for(let[r,n]of Object.entries(e))t.append(r,n);return t}(this.apiClient.getDefaultHeaders()),s=this.apiClient.getApiKey(),a=`${n}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${s}`,l=()=>{},c=new Promise(e=>{l=e}),u=e.callbacks,d=this.apiClient,p={onopen:function(){l({})},onmessage:e=>{t8(d,u.onmessage,e)},onerror:null!==(t=null==u?void 0:u.onerror)&&void 0!==t?t:function(e){},onclose:null!==(r=null==u?void 0:u.onclose)&&void 0!==r?r:function(e){}},h=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,r)=>{t[r]=e}),t}(o),p);h.connect(),await c;let f=eQ(this.apiClient,e.model);return h.send(JSON.stringify({setup:{model:f}})),new t9(h,this.apiClient)}}class t9{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},r=ew(e,["weightedPrompts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=function(e){let t={},r=ew(e,["musicGenerationConfig"]);return null!=r&&eE(t,["musicGenerationConfig"],r),t}(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(eu.PLAY)}pause(){this.sendPlaybackControl(eu.PAUSE)}stop(){this.sendPlaybackControl(eu.STOP)}resetContext(){this.sendPlaybackControl(eu.RESET_CONTEXT)}close(){this.conn.close()}}async function re(e,t,r){let n;let i=new eY;r.data instanceof Blob?n=await r.data.text():n=r.data instanceof ArrayBuffer?new TextDecoder().decode(r.data):r.data;let o=JSON.parse(n);e.isVertexAI()?Object.assign(i,function(e){let t={},r=ew(e,["setupComplete"]);null!=r&&eE(t,["setupComplete"],r);let n=ew(e,["serverContent"]);null!=n&&eE(t,["serverContent"],n);let i=ew(e,["toolCall"]);null!=i&&eE(t,["toolCall"],i);let o=ew(e,["toolCallCancellation"]);null!=o&&eE(t,["toolCallCancellation"],o);let s=ew(e,["usageMetadata"]);null!=s&&eE(t,["usageMetadata"],function(e){let t={},r=ew(e,["promptTokenCount"]);null!=r&&eE(t,["promptTokenCount"],r);let n=ew(e,["cachedContentTokenCount"]);null!=n&&eE(t,["cachedContentTokenCount"],n);let i=ew(e,["candidatesTokenCount"]);null!=i&&eE(t,["responseTokenCount"],i);let o=ew(e,["toolUsePromptTokenCount"]);null!=o&&eE(t,["toolUsePromptTokenCount"],o);let s=ew(e,["thoughtsTokenCount"]);null!=s&&eE(t,["thoughtsTokenCount"],s);let a=ew(e,["totalTokenCount"]);null!=a&&eE(t,["totalTokenCount"],a);let l=ew(e,["promptTokensDetails"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["promptTokensDetails"],e)}let c=ew(e,["cacheTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["cacheTokensDetails"],e)}let u=ew(e,["candidatesTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["responseTokensDetails"],e)}let d=ew(e,["toolUsePromptTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["toolUsePromptTokensDetails"],e)}let p=ew(e,["trafficType"]);return null!=p&&eE(t,["trafficType"],p),t}(s));let a=ew(e,["goAway"]);null!=a&&eE(t,["goAway"],a);let l=ew(e,["sessionResumptionUpdate"]);null!=l&&eE(t,["sessionResumptionUpdate"],l);let c=ew(e,["voiceActivityDetectionSignal"]);null!=c&&eE(t,["voiceActivityDetectionSignal"],c);let u=ew(e,["voiceActivity"]);return null!=u&&eE(t,["voiceActivity"],function(e){let t={},r=ew(e,["type"]);return null!=r&&eE(t,["voiceActivityType"],r),t}(u)),t}(o)):Object.assign(i,o),t(i)}class rt{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r,this.music=new t7(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,r,n,i,o,s;let a;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),u=this.apiClient.getHeaders();e.config&&e.config.tools&&t5(e.config.tools)&&t3(u);let d=function(e){let t=new Headers;for(let[r,n]of Object.entries(e))t.append(r,n);return t}(u);if(this.apiClient.isVertexAI()){let e=this.apiClient.getProject(),t=this.apiClient.getLocation(),r=this.apiClient.getApiKey();this.apiClient.getCustomBaseUrl()&&!(e&&t||r)?a=l:(a=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(d,a))}else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",r="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==c&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",r="access_token"),a=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${t}?${r}=${e}`}let p=()=>{},h=new Promise(e=>{p=e}),f=e.callbacks,m=this.apiClient,g={onopen:function(){var e;null===(e=null==f?void 0:f.onopen)||void 0===e||e.call(f),p({})},onmessage:e=>{re(m,f.onmessage,e)},onerror:null!==(t=null==f?void 0:f.onerror)&&void 0!==t?t:function(e){},onclose:null!==(r=null==f?void 0:f.onclose)&&void 0!==r?r:function(e){}},y=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,r)=>{t[r]=e}),t}(d),g);y.connect(),await h;let v=eQ(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&v.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();e&&t&&(v=`projects/${e}/locations/${t}/`+v)}let b={};this.apiClient.isVertexAI()&&(null===(n=e.config)||void 0===n?void 0:n.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[I.AUDIO]}:e.config.responseModalities=[I.AUDIO]),(null===(i=e.config)||void 0===i?void 0:i.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let _=null!==(s=null===(o=e.config)||void 0===o?void 0:o.tools)&&void 0!==s?s:[],E=[];for(let e of _)this.isCallableTool(e)?E.push(await e.tool()):E.push(e);E.length>0&&(e.config.tools=E);let w={model:v,config:e.config,callbacks:e.callbacks};return b=this.apiClient.isVertexAI()?function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["setup","model"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&eE(r,["config"],function(e,t){let r=ew(e,["generationConfig"]);void 0!==t&&null!=r&&eE(t,["setup","generationConfig"],function(e){let t={},r=ew(e,["modelSelectionConfig"]);null!=r&&eE(t,["modelConfig"],r);let n=ew(e,["responseJsonSchema"]);null!=n&&eE(t,["responseJsonSchema"],n);let i=ew(e,["audioTimestamp"]);null!=i&&eE(t,["audioTimestamp"],i);let o=ew(e,["candidateCount"]);null!=o&&eE(t,["candidateCount"],o);let s=ew(e,["enableAffectiveDialog"]);null!=s&&eE(t,["enableAffectiveDialog"],s);let a=ew(e,["frequencyPenalty"]);null!=a&&eE(t,["frequencyPenalty"],a);let l=ew(e,["logprobs"]);null!=l&&eE(t,["logprobs"],l);let c=ew(e,["maxOutputTokens"]);null!=c&&eE(t,["maxOutputTokens"],c);let u=ew(e,["mediaResolution"]);null!=u&&eE(t,["mediaResolution"],u);let d=ew(e,["presencePenalty"]);null!=d&&eE(t,["presencePenalty"],d);let p=ew(e,["responseLogprobs"]);null!=p&&eE(t,["responseLogprobs"],p);let h=ew(e,["responseMimeType"]);null!=h&&eE(t,["responseMimeType"],h);let f=ew(e,["responseModalities"]);null!=f&&eE(t,["responseModalities"],f);let m=ew(e,["responseSchema"]);null!=m&&eE(t,["responseSchema"],m);let g=ew(e,["routingConfig"]);null!=g&&eE(t,["routingConfig"],g);let y=ew(e,["seed"]);null!=y&&eE(t,["seed"],y);let v=ew(e,["speechConfig"]);null!=v&&eE(t,["speechConfig"],v);let b=ew(e,["stopSequences"]);null!=b&&eE(t,["stopSequences"],b);let _=ew(e,["temperature"]);null!=_&&eE(t,["temperature"],_);let E=ew(e,["thinkingConfig"]);null!=E&&eE(t,["thinkingConfig"],E);let w=ew(e,["topK"]);null!=w&&eE(t,["topK"],w);let x=ew(e,["topP"]);if(null!=x&&eE(t,["topP"],x),void 0!==ew(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(r));let n=ew(e,["responseModalities"]);void 0!==t&&null!=n&&eE(t,["setup","generationConfig","responseModalities"],n);let i=ew(e,["temperature"]);void 0!==t&&null!=i&&eE(t,["setup","generationConfig","temperature"],i);let o=ew(e,["topP"]);void 0!==t&&null!=o&&eE(t,["setup","generationConfig","topP"],o);let s=ew(e,["topK"]);void 0!==t&&null!=s&&eE(t,["setup","generationConfig","topK"],s);let a=ew(e,["maxOutputTokens"]);void 0!==t&&null!=a&&eE(t,["setup","generationConfig","maxOutputTokens"],a);let l=ew(e,["mediaResolution"]);void 0!==t&&null!=l&&eE(t,["setup","generationConfig","mediaResolution"],l);let c=ew(e,["seed"]);void 0!==t&&null!=c&&eE(t,["setup","generationConfig","seed"],c);let u=ew(e,["speechConfig"]);void 0!==t&&null!=u&&eE(t,["setup","generationConfig","speechConfig"],to(u));let d=ew(e,["thinkingConfig"]);void 0!==t&&null!=d&&eE(t,["setup","generationConfig","thinkingConfig"],d);let p=ew(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&eE(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=ew(e,["systemInstruction"]);void 0!==t&&null!=h&&eE(t,["setup","systemInstruction"],te(h));let f=ew(e,["tools"]);if(void 0!==t&&null!=f){let e=ta(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["retrieval"]);null!=r&&eE(t,["retrieval"],r);let n=ew(e,["computerUse"]);if(null!=n&&eE(t,["computerUse"],n),void 0!==ew(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let i=ew(e,["codeExecution"]);null!=i&&eE(t,["codeExecution"],i);let o=ew(e,["enterpriseWebSearch"]);null!=o&&eE(t,["enterpriseWebSearch"],o);let s=ew(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["description"]);null!=r&&eE(t,["description"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["parameters"]);null!=i&&eE(t,["parameters"],i);let o=ew(e,["parametersJsonSchema"]);null!=o&&eE(t,["parametersJsonSchema"],o);let s=ew(e,["response"]);null!=s&&eE(t,["response"],s);let a=ew(e,["responseJsonSchema"]);if(null!=a&&eE(t,["responseJsonSchema"],a),void 0!==ew(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),eE(t,["functionDeclarations"],e)}let a=ew(e,["googleMaps"]);null!=a&&eE(t,["googleMaps"],a);let l=ew(e,["googleSearch"]);null!=l&&eE(t,["googleSearch"],l);let c=ew(e,["googleSearchRetrieval"]);null!=c&&eE(t,["googleSearchRetrieval"],c);let u=ew(e,["urlContext"]);return null!=u&&eE(t,["urlContext"],u),t})(ts(e)))),eE(t,["setup","tools"],e)}let m=ew(e,["sessionResumption"]);void 0!==t&&null!=m&&eE(t,["setup","sessionResumption"],m);let g=ew(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&eE(t,["setup","inputAudioTranscription"],g);let y=ew(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&eE(t,["setup","outputAudioTranscription"],y);let v=ew(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&eE(t,["setup","realtimeInputConfig"],v);let b=ew(e,["contextWindowCompression"]);void 0!==t&&null!=b&&eE(t,["setup","contextWindowCompression"],b);let _=ew(e,["proactivity"]);void 0!==t&&null!=_&&eE(t,["setup","proactivity"],_);let E=ew(e,["explicitVadSignal"]);return void 0!==t&&null!=E&&eE(t,["setup","explicitVadSignal"],E),{}}(i,r)),r}(this.apiClient,w):function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["setup","model"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&eE(r,["config"],function(e,t){let r=ew(e,["generationConfig"]);void 0!==t&&null!=r&&eE(t,["setup","generationConfig"],r);let n=ew(e,["responseModalities"]);void 0!==t&&null!=n&&eE(t,["setup","generationConfig","responseModalities"],n);let i=ew(e,["temperature"]);void 0!==t&&null!=i&&eE(t,["setup","generationConfig","temperature"],i);let o=ew(e,["topP"]);void 0!==t&&null!=o&&eE(t,["setup","generationConfig","topP"],o);let s=ew(e,["topK"]);void 0!==t&&null!=s&&eE(t,["setup","generationConfig","topK"],s);let a=ew(e,["maxOutputTokens"]);void 0!==t&&null!=a&&eE(t,["setup","generationConfig","maxOutputTokens"],a);let l=ew(e,["mediaResolution"]);void 0!==t&&null!=l&&eE(t,["setup","generationConfig","mediaResolution"],l);let c=ew(e,["seed"]);void 0!==t&&null!=c&&eE(t,["setup","generationConfig","seed"],c);let u=ew(e,["speechConfig"]);void 0!==t&&null!=u&&eE(t,["setup","generationConfig","speechConfig"],to(u));let d=ew(e,["thinkingConfig"]);void 0!==t&&null!=d&&eE(t,["setup","generationConfig","thinkingConfig"],d);let p=ew(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&eE(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=ew(e,["systemInstruction"]);void 0!==t&&null!=h&&eE(t,["setup","systemInstruction"],function(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],tU(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}(te(h)));let f=ew(e,["tools"]);if(void 0!==t&&null!=f){let e=ta(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(ts(e)))),eE(t,["setup","tools"],e)}let m=ew(e,["sessionResumption"]);void 0!==t&&null!=m&&eE(t,["setup","sessionResumption"],function(e){let t={},r=ew(e,["handle"]);if(null!=r&&eE(t,["handle"],r),void 0!==ew(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=ew(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&eE(t,["setup","inputAudioTranscription"],g);let y=ew(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&eE(t,["setup","outputAudioTranscription"],y);let v=ew(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&eE(t,["setup","realtimeInputConfig"],v);let b=ew(e,["contextWindowCompression"]);void 0!==t&&null!=b&&eE(t,["setup","contextWindowCompression"],b);let _=ew(e,["proactivity"]);if(void 0!==t&&null!=_&&eE(t,["setup","proactivity"],_),void 0!==ew(e,["explicitVadSignal"]))throw Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}(i,r)),r}(this.apiClient,w),delete b.config,y.send(JSON.stringify(b)),new rn(y,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let rr={turnComplete:!0};class rn{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let r=[];try{r=tr(t.turns),e.isVertexAI()||(r=r.map(e=>tL(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:r,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let r=[];if(null==t.functionResponses||0===(r=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of r){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},rr),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},r=ew(e,["media"]);if(null!=r){let e=e1(r);Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["mediaChunks"],e)}let n=ew(e,["audio"]);null!=n&&eE(t,["audio"],e5(n));let i=ew(e,["audioStreamEnd"]);null!=i&&eE(t,["audioStreamEnd"],i);let o=ew(e,["video"]);null!=o&&eE(t,["video"],e4(o));let s=ew(e,["text"]);null!=s&&eE(t,["text"],s);let a=ew(e,["activityStart"]);null!=a&&eE(t,["activityStart"],a);let l=ew(e,["activityEnd"]);return null!=l&&eE(t,["activityEnd"],l),t}(e)}:{realtimeInput:function(e){let t={},r=ew(e,["media"]);if(null!=r){let e=e1(r);Array.isArray(e)&&(e=e.map(e=>tU(e))),eE(t,["mediaChunks"],e)}let n=ew(e,["audio"]);null!=n&&eE(t,["audio"],tU(e5(n)));let i=ew(e,["audioStreamEnd"]);null!=i&&eE(t,["audioStreamEnd"],i);let o=ew(e,["video"]);null!=o&&eE(t,["video"],tU(e4(o)));let s=ew(e,["text"]);null!=s&&eE(t,["text"],s);let a=ew(e,["activityStart"]);null!=a&&eE(t,["activityStart"],a);let l=ew(e,["activityEnd"]);return null!=l&&eE(t,["activityEnd"],l),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function ri(e){var t,r,n;if(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.disable)return!0;let i=!1;for(let t of null!==(r=null==e?void 0:e.tools)&&void 0!==r?r:[])if(ro(t)){i=!0;break}if(!i)return!0;let o=null===(n=null==e?void 0:e.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls;return(!!o&&(o<0||!Number.isInteger(o))||0==o)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0)}function ro(e){return"callTool"in e&&"function"==typeof e.callTool}function rs(e){var t;let r=[];return(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.tools)&&e.config.tools.forEach((e,t)=>{!ro(e)&&e.functionDeclarations&&e.functionDeclarations.length>0&&r.push(t)}),r}function ra(e){var t;return!(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rl extends eb{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,r,n,i,o;let s,a;let l=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!function(e){var t,r,n;return null!==(n=null===(r=null===(t=e.config)||void 0===t?void 0:t.tools)||void 0===r?void 0:r.some(e=>ro(e)))&&void 0!==n&&n}(e)||ri(e.config))return await this.generateContentInternal(l);let c=rs(e);if(c.length>0){let e=c.map(e=>`tools[${e}]`).join(", ");throw Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let u=tr(l.contents),d=null!==(n=null===(r=null===(t=l.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===r?void 0:r.maximumRemoteCalls)&&void 0!==n?n:10,p=0;for(;p<d&&(s=await this.generateContentInternal(l)).functionCalls&&0!==s.functionCalls.length;){let t=s.candidates[0].content,r=[];for(let t of null!==(o=null===(i=e.config)||void 0===i?void 0:i.tools)&&void 0!==o?o:[])if(ro(t)){let e=await t.callTool(s.functionCalls);r.push(...e)}p++,a={role:"user",parts:r},l.contents=tr(l.contents),l.contents.push(t),l.contents.push(a),ra(l.config)&&(u.push(t),u.push(a))}return ra(l.config)&&(s.automaticFunctionCallingHistory=u),s},this.generateContentStream=async e=>{var t,r,n,i,o;if(this.maybeMoveToResponseJsonSchem(e),ri(e.config)){let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}let s=rs(e);if(s.length>0){let e=s.map(e=>`tools[${e}]`).join(", ");throw Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let a=null===(n=null===(r=null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.toolConfig)||void 0===r?void 0:r.functionCallingConfig)||void 0===n?void 0:n.streamFunctionCallArguments,l=null===(o=null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.automaticFunctionCalling)||void 0===o?void 0:o.disable;if(a&&!l)throw Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let r;let n=[];if(null==e?void 0:e.generatedImages)for(let i of e.generatedImages)i&&(null==i?void 0:i.safetyAttributes)&&(null===(t=null==i?void 0:i.safetyAttributes)||void 0===t?void 0:t.contentType)==="Positive Prompt"?r=null==i?void 0:i.safetyAttributes:n.push(i);return r?{generatedImages:n,positivePromptSafetyAttributes:r,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:n,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let r={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!r.config.queryBase){if(null===(t=r.config)||void 0===t?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");r.config.filter="labels.tune-type:*"}return new tx(ed.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(r),r)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let r={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(r)},this.generateVideos=async e=>{var t,r,n,i,o,s;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null===(t=e.video)||void 0===t?void 0:t.uri)&&(null===(r=e.video)||void 0===r?void 0:r.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null===(i=null===(n=e.source)||void 0===n?void 0:n.video)||void 0===i?void 0:i.uri)&&(null===(s=null===(o=e.source)||void 0===o?void 0:o.video)||void 0===s?void 0:s.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,r,n;let i=null===(t=e.config)||void 0===t?void 0:t.tools;if(!i)return e;let o=await Promise.all(i.map(async e=>ro(e)?await e.tool():e)),s={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(s.config.tools=o,e.config&&e.config.tools&&t5(e.config.tools)){let t=Object.assign({},null!==(n=null===(r=e.config.httpOptions)||void 0===r?void 0:r.headers)&&void 0!==n?n:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),t3(t),s.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return s}async initAfcToolsMap(e){var t,r,n;let i=new Map;for(let o of null!==(r=null===(t=e.config)||void 0===t?void 0:t.tools)&&void 0!==r?r:[])if(ro(o))for(let e of null!==(n=(await o.tool()).functionDeclarations)&&void 0!==n?n:[]){if(!e.name)throw Error("Function declaration name is required.");if(i.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);i.set(e.name,o)}return i}async processAfcStream(e){var t,r,n;let i=null!==(n=null===(r=null===(t=e.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===r?void 0:r.maximumRemoteCalls)&&void 0!==n?n:10,o=!1,s=0;return function(e,t,r){return tI(this,arguments,function*(){for(;s<i;){o&&(s++,o=!1);let m=yield tO(e.processParamsMaybeAddMcpUsage(r)),g=yield tO(e.generateContentStreamInternal(m)),y=[],v=[];try{for(var n,a,l,c,u,d,p,h=!0,f=(a=void 0,tN(g));!(n=(p=yield tO(f.next())).done);h=!0)if(c=p.value,h=!1,yield yield tO(c),c.candidates&&(null===(u=c.candidates[0])||void 0===u?void 0:u.content)){for(let e of(v.push(c.candidates[0].content),null!==(d=c.candidates[0].content.parts)&&void 0!==d?d:[]))if(s<i&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let r=yield tO(t.get(e.functionCall.name).callTool([e.functionCall]));y.push(...r)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){a={error:e}}finally{try{!h&&!n&&(l=f.return)&&(yield tO(l.call(f)))}finally{if(a)throw a.error}}if(y.length>0){o=!0;let e=new eA;e.candidates=[{content:{role:"user",parts:y}}],yield yield tO(e);let t=[];t.push(...v),t.push({role:"user",parts:y});let n=tr(r.contents).concat(t);r.contents=n}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=tF(this.apiClient,e);return o=e_("{model}:generateContent",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=tB(e),r=new eA;return Object.assign(r,t),r})}{let t=tG(this.apiClient,e);return o=e_("{model}:generateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=tq(e),r=new eA;return Object.assign(r,t),r})}}async generateContentStreamInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=tF(this.apiClient,e);return o=e_("{model}:streamGenerateContent?alt=sse",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(function(e){return tI(this,arguments,function*(){var t,r,n,i;try{for(var o,s=!0,a=tN(e);!(t=(o=yield tO(a.next())).done);s=!0){i=o.value,s=!1;let e=tB((yield tO(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new eA;Object.assign(t,e),yield yield tO(t)}}catch(e){r={error:e}}finally{try{!s&&!t&&(n=a.return)&&(yield tO(n.call(a)))}finally{if(r)throw r.error}}})})}{let t=tG(this.apiClient,e);return o=e_("{model}:streamGenerateContent?alt=sse",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(function(e){return tI(this,arguments,function*(){var t,r,n,i;try{for(var o,s=!0,a=tN(e);!(t=(o=yield tO(a.next())).done);s=!0){i=o.value,s=!1;let e=tq((yield tO(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new eA;Object.assign(t,e),yield yield tO(t)}}catch(e){r={error:e}}finally{try{!s&&!t&&(n=a.return)&&(yield tO(n.call(a)))}finally{if(r)throw r.error}}})})}}async embedContent(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let t=tt(e,i);Array.isArray(t)&&(t=t.map(e=>e)),eE(r,["instances[]","content"],t)}let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["taskType"]);void 0!==t&&null!=r&&eE(t,["instances[]","task_type"],r);let n=ew(e,["title"]);void 0!==t&&null!=n&&eE(t,["instances[]","title"],n);let i=ew(e,["outputDimensionality"]);void 0!==t&&null!=i&&eE(t,["parameters","outputDimensionality"],i);let o=ew(e,["mimeType"]);void 0!==t&&null!=o&&eE(t,["instances[]","mimeType"],o);let s=ew(e,["autoTruncate"]);void 0!==t&&null!=s&&eE(t,["parameters","autoTruncate"],s)}(o,r),r}(this.apiClient,e);return o=e_("{model}:predict",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions[]","embeddings"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["values"]);null!=r&&eE(t,["values"],r);let n=ew(e,["statistics"]);return null!=n&&eE(t,["statistics"],function(e){let t={},r=ew(e,["truncated"]);null!=r&&eE(t,["truncated"],r);let n=ew(e,["token_count"]);return null!=n&&eE(t,["tokenCount"],n),t}(n)),t})(e))),eE(t,["embeddings"],e)}let i=ew(e,["metadata"]);return null!=i&&eE(t,["metadata"],i),t}(e),r=new eC;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let t=tt(e,i);Array.isArray(t)&&(t=t.map(e=>e)),eE(r,["requests[]","content"],t)}let o=ew(t,["config"]);null!=o&&function(e,t){let r=ew(e,["taskType"]);void 0!==t&&null!=r&&eE(t,["requests[]","taskType"],r);let n=ew(e,["title"]);void 0!==t&&null!=n&&eE(t,["requests[]","title"],n);let i=ew(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&eE(t,["requests[]","outputDimensionality"],i),void 0!==ew(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==ew(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(o,r);let s=ew(t,["model"]);return void 0!==s&&eE(r,["requests[]","model"],eQ(e,s)),r}(this.apiClient,e);return o=e_("{model}:batchEmbedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["embeddings"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["embeddings"],e)}let i=ew(e,["metadata"]);return null!=i&&eE(t,["metadata"],i),t}(e),r=new eC;return Object.assign(r,t),r})}}async generateImagesInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["outputGcsUri"]);void 0!==t&&null!=r&&eE(t,["parameters","storageUri"],r);let n=ew(e,["negativePrompt"]);void 0!==t&&null!=n&&eE(t,["parameters","negativePrompt"],n);let i=ew(e,["numberOfImages"]);void 0!==t&&null!=i&&eE(t,["parameters","sampleCount"],i);let o=ew(e,["aspectRatio"]);void 0!==t&&null!=o&&eE(t,["parameters","aspectRatio"],o);let s=ew(e,["guidanceScale"]);void 0!==t&&null!=s&&eE(t,["parameters","guidanceScale"],s);let a=ew(e,["seed"]);void 0!==t&&null!=a&&eE(t,["parameters","seed"],a);let l=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&eE(t,["parameters","safetySetting"],l);let c=ew(e,["personGeneration"]);void 0!==t&&null!=c&&eE(t,["parameters","personGeneration"],c);let u=ew(e,["includeSafetyAttributes"]);void 0!==t&&null!=u&&eE(t,["parameters","includeSafetyAttributes"],u);let d=ew(e,["includeRaiReason"]);void 0!==t&&null!=d&&eE(t,["parameters","includeRaiReason"],d);let p=ew(e,["language"]);void 0!==t&&null!=p&&eE(t,["parameters","language"],p);let h=ew(e,["outputMimeType"]);void 0!==t&&null!=h&&eE(t,["parameters","outputOptions","mimeType"],h);let f=ew(e,["outputCompressionQuality"]);void 0!==t&&null!=f&&eE(t,["parameters","outputOptions","compressionQuality"],f);let m=ew(e,["addWatermark"]);void 0!==t&&null!=m&&eE(t,["parameters","addWatermark"],m);let g=ew(e,["labels"]);void 0!==t&&null!=g&&eE(t,["labels"],g);let y=ew(e,["imageSize"]);void 0!==t&&null!=y&&eE(t,["parameters","sampleImageSize"],y);let v=ew(e,["enhancePrompt"]);void 0!==t&&null!=v&&eE(t,["parameters","enhancePrompt"],v)}(o,r),r}(this.apiClient,e);return o=e_("{model}:predict",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>tH(e))),eE(t,["generatedImages"],e)}let i=ew(e,["positivePromptSafetyAttributes"]);return null!=i&&eE(t,["positivePromptSafetyAttributes"],tY(i)),t}(e),r=new eO;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["config"]);return null!=o&&function(e,t){if(void 0!==ew(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==ew(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let r=ew(e,["numberOfImages"]);void 0!==t&&null!=r&&eE(t,["parameters","sampleCount"],r);let n=ew(e,["aspectRatio"]);void 0!==t&&null!=n&&eE(t,["parameters","aspectRatio"],n);let i=ew(e,["guidanceScale"]);if(void 0!==t&&null!=i&&eE(t,["parameters","guidanceScale"],i),void 0!==ew(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let o=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=o&&eE(t,["parameters","safetySetting"],o);let s=ew(e,["personGeneration"]);void 0!==t&&null!=s&&eE(t,["parameters","personGeneration"],s);let a=ew(e,["includeSafetyAttributes"]);void 0!==t&&null!=a&&eE(t,["parameters","includeSafetyAttributes"],a);let l=ew(e,["includeRaiReason"]);void 0!==t&&null!=l&&eE(t,["parameters","includeRaiReason"],l);let c=ew(e,["language"]);void 0!==t&&null!=c&&eE(t,["parameters","language"],c);let u=ew(e,["outputMimeType"]);void 0!==t&&null!=u&&eE(t,["parameters","outputOptions","mimeType"],u);let d=ew(e,["outputCompressionQuality"]);if(void 0!==t&&null!=d&&eE(t,["parameters","outputOptions","compressionQuality"],d),void 0!==ew(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==ew(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let p=ew(e,["imageSize"]);if(void 0!==t&&null!=p&&eE(t,["parameters","sampleImageSize"],p),void 0!==ew(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(o,r),r}(this.apiClient,e);return o=e_("{model}:predict",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["_self"]);null!=r&&eE(t,["image"],function(e){let t={},r=ew(e,["bytesBase64Encoded"]);null!=r&&eE(t,["imageBytes"],ex(r));let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(r));let n=ew(e,["raiFilteredReason"]);null!=n&&eE(t,["raiFilteredReason"],n);let i=ew(e,["_self"]);return null!=i&&eE(t,["safetyAttributes"],tK(i)),t})(e))),eE(t,["generatedImages"],e)}let i=ew(e,["positivePromptSafetyAttributes"]);return null!=i&&eE(t,["positivePromptSafetyAttributes"],tK(i)),t}(e),r=new eO;return Object.assign(r,t),r})}}async editImageInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["referenceImages"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["referenceImage"]);null!=r&&eE(t,["referenceImage"],tz(r));let n=ew(e,["referenceId"]);null!=n&&eE(t,["referenceId"],n);let i=ew(e,["referenceType"]);null!=i&&eE(t,["referenceType"],i);let o=ew(e,["maskImageConfig"]);null!=o&&eE(t,["maskImageConfig"],function(e){let t={},r=ew(e,["maskMode"]);null!=r&&eE(t,["maskMode"],r);let n=ew(e,["segmentationClasses"]);null!=n&&eE(t,["maskClasses"],n);let i=ew(e,["maskDilation"]);return null!=i&&eE(t,["dilation"],i),t}(o));let s=ew(e,["controlImageConfig"]);null!=s&&eE(t,["controlImageConfig"],function(e){let t={},r=ew(e,["controlType"]);null!=r&&eE(t,["controlType"],r);let n=ew(e,["enableControlImageComputation"]);return null!=n&&eE(t,["computeControl"],n),t}(s));let a=ew(e,["styleImageConfig"]);null!=a&&eE(t,["styleImageConfig"],a);let l=ew(e,["subjectImageConfig"]);return null!=l&&eE(t,["subjectImageConfig"],l),t})(e))),eE(r,["instances[0]","referenceImages"],e)}let s=ew(t,["config"]);return null!=s&&function(e,t){let r=ew(e,["outputGcsUri"]);void 0!==t&&null!=r&&eE(t,["parameters","storageUri"],r);let n=ew(e,["negativePrompt"]);void 0!==t&&null!=n&&eE(t,["parameters","negativePrompt"],n);let i=ew(e,["numberOfImages"]);void 0!==t&&null!=i&&eE(t,["parameters","sampleCount"],i);let o=ew(e,["aspectRatio"]);void 0!==t&&null!=o&&eE(t,["parameters","aspectRatio"],o);let s=ew(e,["guidanceScale"]);void 0!==t&&null!=s&&eE(t,["parameters","guidanceScale"],s);let a=ew(e,["seed"]);void 0!==t&&null!=a&&eE(t,["parameters","seed"],a);let l=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&eE(t,["parameters","safetySetting"],l);let c=ew(e,["personGeneration"]);void 0!==t&&null!=c&&eE(t,["parameters","personGeneration"],c);let u=ew(e,["includeSafetyAttributes"]);void 0!==t&&null!=u&&eE(t,["parameters","includeSafetyAttributes"],u);let d=ew(e,["includeRaiReason"]);void 0!==t&&null!=d&&eE(t,["parameters","includeRaiReason"],d);let p=ew(e,["language"]);void 0!==t&&null!=p&&eE(t,["parameters","language"],p);let h=ew(e,["outputMimeType"]);void 0!==t&&null!=h&&eE(t,["parameters","outputOptions","mimeType"],h);let f=ew(e,["outputCompressionQuality"]);void 0!==t&&null!=f&&eE(t,["parameters","outputOptions","compressionQuality"],f);let m=ew(e,["addWatermark"]);void 0!==t&&null!=m&&eE(t,["parameters","addWatermark"],m);let g=ew(e,["labels"]);void 0!==t&&null!=g&&eE(t,["labels"],g);let y=ew(e,["editMode"]);void 0!==t&&null!=y&&eE(t,["parameters","editMode"],y);let v=ew(e,["baseSteps"]);void 0!==t&&null!=v&&eE(t,["parameters","editConfig","baseSteps"],v)}(s,r),r}(this.apiClient,e);return n=e_("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>tH(e))),eE(t,["generatedImages"],e)}return t}(e),r=new eI;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["image"]);null!=i&&eE(r,["instances[0]","image"],tz(i));let o=ew(t,["upscaleFactor"]);null!=o&&eE(r,["parameters","upscaleConfig","upscaleFactor"],o);let s=ew(t,["config"]);return null!=s&&function(e,t){let r=ew(e,["outputGcsUri"]);void 0!==t&&null!=r&&eE(t,["parameters","storageUri"],r);let n=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=n&&eE(t,["parameters","safetySetting"],n);let i=ew(e,["personGeneration"]);void 0!==t&&null!=i&&eE(t,["parameters","personGeneration"],i);let o=ew(e,["includeRaiReason"]);void 0!==t&&null!=o&&eE(t,["parameters","includeRaiReason"],o);let s=ew(e,["outputMimeType"]);void 0!==t&&null!=s&&eE(t,["parameters","outputOptions","mimeType"],s);let a=ew(e,["outputCompressionQuality"]);void 0!==t&&null!=a&&eE(t,["parameters","outputOptions","compressionQuality"],a);let l=ew(e,["enhanceInputImage"]);void 0!==t&&null!=l&&eE(t,["parameters","upscaleConfig","enhanceInputImage"],l);let c=ew(e,["imagePreservationFactor"]);void 0!==t&&null!=c&&eE(t,["parameters","upscaleConfig","imagePreservationFactor"],c);let u=ew(e,["labels"]);void 0!==t&&null!=u&&eE(t,["labels"],u);let d=ew(e,["numberOfImages"]);void 0!==t&&null!=d&&eE(t,["parameters","sampleCount"],d);let p=ew(e,["mode"]);void 0!==t&&null!=p&&eE(t,["parameters","mode"],p)}(s,r),r}(this.apiClient,e);return n=e_("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>tH(e))),eE(t,["generatedImages"],e)}return t}(e),r=new eN;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["source"]);null!=i&&function(e,t){let r=ew(e,["prompt"]);void 0!==t&&null!=r&&eE(t,["instances[0]","prompt"],r);let n=ew(e,["personImage"]);void 0!==t&&null!=n&&eE(t,["instances[0]","personImage","image"],tz(n));let i=ew(e,["productImages"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["productImage"]);return null!=r&&eE(t,["image"],tz(r)),t})(e))),eE(t,["instances[0]","productImages"],e)}}(i,r);let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["numberOfImages"]);void 0!==t&&null!=r&&eE(t,["parameters","sampleCount"],r);let n=ew(e,["baseSteps"]);void 0!==t&&null!=n&&eE(t,["parameters","baseSteps"],n);let i=ew(e,["outputGcsUri"]);void 0!==t&&null!=i&&eE(t,["parameters","storageUri"],i);let o=ew(e,["seed"]);void 0!==t&&null!=o&&eE(t,["parameters","seed"],o);let s=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=s&&eE(t,["parameters","safetySetting"],s);let a=ew(e,["personGeneration"]);void 0!==t&&null!=a&&eE(t,["parameters","personGeneration"],a);let l=ew(e,["addWatermark"]);void 0!==t&&null!=l&&eE(t,["parameters","addWatermark"],l);let c=ew(e,["outputMimeType"]);void 0!==t&&null!=c&&eE(t,["parameters","outputOptions","mimeType"],c);let u=ew(e,["outputCompressionQuality"]);void 0!==t&&null!=u&&eE(t,["parameters","outputOptions","compressionQuality"],u);let d=ew(e,["enhancePrompt"]);void 0!==t&&null!=d&&eE(t,["parameters","enhancePrompt"],d);let p=ew(e,["labels"]);void 0!==t&&null!=p&&eE(t,["labels"],p)}(o,r),r}(this.apiClient,e);return n=e_("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>tH(e))),eE(t,["generatedImages"],e)}return t}(e),r=new ek;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["source"]);null!=i&&function(e,t){let r=ew(e,["prompt"]);void 0!==t&&null!=r&&eE(t,["instances[0]","prompt"],r);let n=ew(e,["image"]);void 0!==t&&null!=n&&eE(t,["instances[0]","image"],tz(n));let i=ew(e,["scribbleImage"]);void 0!==t&&null!=i&&eE(t,["instances[0]","scribble"],function(e){let t={},r=ew(e,["image"]);return null!=r&&eE(t,["image"],tz(r)),t}(i))}(i,r);let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["mode"]);void 0!==t&&null!=r&&eE(t,["parameters","mode"],r);let n=ew(e,["maxPredictions"]);void 0!==t&&null!=n&&eE(t,["parameters","maxPredictions"],n);let i=ew(e,["confidenceThreshold"]);void 0!==t&&null!=i&&eE(t,["parameters","confidenceThreshold"],i);let o=ew(e,["maskDilation"]);void 0!==t&&null!=o&&eE(t,["parameters","maskDilation"],o);let s=ew(e,["binaryColorThreshold"]);void 0!==t&&null!=s&&eE(t,["parameters","binaryColorThreshold"],s);let a=ew(e,["labels"]);void 0!==t&&null!=a&&eE(t,["labels"],a)}(o,r),r}(this.apiClient,e);return n=e_("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["_self"]);null!=r&&eE(t,["mask"],tV(r));let n=ew(e,["labels"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["labels"],e)}return t})(e))),eE(t,["generatedMasks"],e)}return t}(e),r=new eR;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);return null!=n&&eE(r,["_url","name"],eQ(e,n)),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>tW(e))}{let t=function(e,t){let r={},n=ew(t,["model"]);return null!=n&&eE(r,["_url","name"],eQ(e,n)),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tJ(e))}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["config"]);return null!=n&&function(e,t,r){let n=ew(t,["pageSize"]);void 0!==r&&null!=n&&eE(r,["_query","pageSize"],n);let i=ew(t,["pageToken"]);void 0!==r&&null!=i&&eE(r,["_query","pageToken"],i);let o=ew(t,["filter"]);void 0!==r&&null!=o&&eE(r,["_query","filter"],o);let s=ew(t,["queryBase"]);void 0!==r&&null!=s&&eE(r,["_url","models_url"],th(e,s))}(e,n,r),r}(this.apiClient,e);return o=e_("{models_url}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["_self"]);if(null!=i){let e=tf(i);Array.isArray(e)&&(e=e.map(e=>tW(e))),eE(t,["models"],e)}return t}(e),r=new eP;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["config"]);return null!=n&&function(e,t,r){let n=ew(t,["pageSize"]);void 0!==r&&null!=n&&eE(r,["_query","pageSize"],n);let i=ew(t,["pageToken"]);void 0!==r&&null!=i&&eE(r,["_query","pageToken"],i);let o=ew(t,["filter"]);void 0!==r&&null!=o&&eE(r,["_query","filter"],o);let s=ew(t,["queryBase"]);void 0!==r&&null!=s&&eE(r,["_url","models_url"],th(e,s))}(e,n,r),r}(this.apiClient,e);return o=e_("{models_url}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["_self"]);if(null!=i){let e=tf(i);Array.isArray(e)&&(e=e.map(e=>tJ(e))),eE(t,["models"],e)}return t}(e),r=new eP;return Object.assign(r,t),r})}}async update(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["displayName"],r);let n=ew(e,["description"]);void 0!==t&&null!=n&&eE(t,["description"],n);let i=ew(e,["defaultCheckpointId"]);void 0!==t&&null!=i&&eE(t,["defaultCheckpointId"],i)}(i,r),r}(this.apiClient,e);return o=e_("{model}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>tW(e))}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","name"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["displayName"],r);let n=ew(e,["description"]);void 0!==t&&null!=n&&eE(t,["description"],n);let i=ew(e,["defaultCheckpointId"]);void 0!==t&&null!=i&&eE(t,["defaultCheckpointId"],i)}(i,r),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tJ(e))}}async delete(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);return null!=n&&eE(r,["_url","name"],eQ(e,n)),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new ej;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);return null!=n&&eE(r,["_url","name"],eQ(e,n)),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new ej;return Object.assign(r,t),r})}}async countTokens(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>e)),eE(r,["contents"],e)}let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["systemInstruction"]);void 0!==t&&null!=r&&eE(t,["systemInstruction"],te(r));let n=ew(e,["tools"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>tX(e))),eE(t,["tools"],e)}let i=ew(e,["generationConfig"]);void 0!==t&&null!=i&&eE(t,["generationConfig"],function(e){let t={},r=ew(e,["modelSelectionConfig"]);null!=r&&eE(t,["modelConfig"],r);let n=ew(e,["responseJsonSchema"]);null!=n&&eE(t,["responseJsonSchema"],n);let i=ew(e,["audioTimestamp"]);null!=i&&eE(t,["audioTimestamp"],i);let o=ew(e,["candidateCount"]);null!=o&&eE(t,["candidateCount"],o);let s=ew(e,["enableAffectiveDialog"]);null!=s&&eE(t,["enableAffectiveDialog"],s);let a=ew(e,["frequencyPenalty"]);null!=a&&eE(t,["frequencyPenalty"],a);let l=ew(e,["logprobs"]);null!=l&&eE(t,["logprobs"],l);let c=ew(e,["maxOutputTokens"]);null!=c&&eE(t,["maxOutputTokens"],c);let u=ew(e,["mediaResolution"]);null!=u&&eE(t,["mediaResolution"],u);let d=ew(e,["presencePenalty"]);null!=d&&eE(t,["presencePenalty"],d);let p=ew(e,["responseLogprobs"]);null!=p&&eE(t,["responseLogprobs"],p);let h=ew(e,["responseMimeType"]);null!=h&&eE(t,["responseMimeType"],h);let f=ew(e,["responseModalities"]);null!=f&&eE(t,["responseModalities"],f);let m=ew(e,["responseSchema"]);null!=m&&eE(t,["responseSchema"],m);let g=ew(e,["routingConfig"]);null!=g&&eE(t,["routingConfig"],g);let y=ew(e,["seed"]);null!=y&&eE(t,["seed"],y);let v=ew(e,["speechConfig"]);null!=v&&eE(t,["speechConfig"],v);let b=ew(e,["stopSequences"]);null!=b&&eE(t,["stopSequences"],b);let _=ew(e,["temperature"]);null!=_&&eE(t,["temperature"],_);let E=ew(e,["thinkingConfig"]);null!=E&&eE(t,["thinkingConfig"],E);let w=ew(e,["topK"]);null!=w&&eE(t,["topK"],w);let x=ew(e,["topP"]);if(null!=x&&eE(t,["topP"],x),void 0!==ew(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(i))}(o,r),r}(this.apiClient,e);return o=e_("{model}:countTokens",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["totalTokens"]);return null!=n&&eE(t,["totalTokens"],n),t}(e),r=new eM;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>tL(e))),eE(r,["contents"],e)}let o=ew(t,["config"]);return null!=o&&function(e){if(void 0!==ew(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==ew(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==ew(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(o),r}(this.apiClient,e);return o=e_("{model}:countTokens",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["totalTokens"]);null!=n&&eE(t,["totalTokens"],n);let i=ew(e,["cachedContentTokenCount"]);return null!=i&&eE(t,["cachedContentTokenCount"],i),t}(e),r=new eM;return Object.assign(r,t),r})}}async computeTokens(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>e)),eE(r,["contents"],e)}return r}(this.apiClient,e);return n=e_("{model}:computeTokens",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["tokensInfo"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["tokensInfo"],e)}return t}(e),r=new eD;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["image"]);null!=o&&eE(r,["instances[0]","image"],tz(o));let s=ew(t,["video"]);null!=s&&eE(r,["instances[0]","video"],tQ(s));let a=ew(t,["source"]);null!=a&&function(e,t){let r=ew(e,["prompt"]);void 0!==t&&null!=r&&eE(t,["instances[0]","prompt"],r);let n=ew(e,["image"]);void 0!==t&&null!=n&&eE(t,["instances[0]","image"],tz(n));let i=ew(e,["video"]);void 0!==t&&null!=i&&eE(t,["instances[0]","video"],tQ(i))}(a,r);let l=ew(t,["config"]);return null!=l&&function(e,t){let r=ew(e,["numberOfVideos"]);void 0!==t&&null!=r&&eE(t,["parameters","sampleCount"],r);let n=ew(e,["outputGcsUri"]);void 0!==t&&null!=n&&eE(t,["parameters","storageUri"],n);let i=ew(e,["fps"]);void 0!==t&&null!=i&&eE(t,["parameters","fps"],i);let o=ew(e,["durationSeconds"]);void 0!==t&&null!=o&&eE(t,["parameters","durationSeconds"],o);let s=ew(e,["seed"]);void 0!==t&&null!=s&&eE(t,["parameters","seed"],s);let a=ew(e,["aspectRatio"]);void 0!==t&&null!=a&&eE(t,["parameters","aspectRatio"],a);let l=ew(e,["resolution"]);void 0!==t&&null!=l&&eE(t,["parameters","resolution"],l);let c=ew(e,["personGeneration"]);void 0!==t&&null!=c&&eE(t,["parameters","personGeneration"],c);let u=ew(e,["pubsubTopic"]);void 0!==t&&null!=u&&eE(t,["parameters","pubsubTopic"],u);let d=ew(e,["negativePrompt"]);void 0!==t&&null!=d&&eE(t,["parameters","negativePrompt"],d);let p=ew(e,["enhancePrompt"]);void 0!==t&&null!=p&&eE(t,["parameters","enhancePrompt"],p);let h=ew(e,["generateAudio"]);void 0!==t&&null!=h&&eE(t,["parameters","generateAudio"],h);let f=ew(e,["lastFrame"]);void 0!==t&&null!=f&&eE(t,["instances[0]","lastFrame"],tz(f));let m=ew(e,["referenceImages"]);if(void 0!==t&&null!=m){let e=m;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["image"]);null!=r&&eE(t,["image"],tz(r));let n=ew(e,["referenceType"]);return null!=n&&eE(t,["referenceType"],n),t})(e))),eE(t,["instances[0]","referenceImages"],e)}let g=ew(e,["mask"]);void 0!==t&&null!=g&&eE(t,["instances[0]","mask"],function(e){let t={},r=ew(e,["image"]);null!=r&&eE(t,["_self"],tz(r));let n=ew(e,["maskMode"]);return null!=n&&eE(t,["maskMode"],n),t}(g));let y=ew(e,["compressionQuality"]);void 0!==t&&null!=y&&eE(t,["parameters","compressionQuality"],y)}(l,r),r}(this.apiClient,e);return o=e_("{model}:predictLongRunning",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["videos"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["_self"]);return null!=r&&eE(t,["video"],function(e){let t={},r=ew(e,["gcsUri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["bytesBase64Encoded"]);null!=n&&eE(t,["videoBytes"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}(r)),t})(e))),eE(t,["generatedVideos"],e)}let n=ew(e,["raiMediaFilteredCount"]);null!=n&&eE(t,["raiMediaFilteredCount"],n);let i=ew(e,["raiMediaFilteredReasons"]);return null!=i&&eE(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e),r=new eU;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["image"]);null!=o&&eE(r,["instances[0]","image"],t$(o));let s=ew(t,["video"]);null!=s&&eE(r,["instances[0]","video"],tZ(s));let a=ew(t,["source"]);null!=a&&function(e,t){let r=ew(e,["prompt"]);void 0!==t&&null!=r&&eE(t,["instances[0]","prompt"],r);let n=ew(e,["image"]);void 0!==t&&null!=n&&eE(t,["instances[0]","image"],t$(n));let i=ew(e,["video"]);void 0!==t&&null!=i&&eE(t,["instances[0]","video"],tZ(i))}(a,r);let l=ew(t,["config"]);return null!=l&&function(e,t){let r=ew(e,["numberOfVideos"]);if(void 0!==t&&null!=r&&eE(t,["parameters","sampleCount"],r),void 0!==ew(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==ew(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let n=ew(e,["durationSeconds"]);if(void 0!==t&&null!=n&&eE(t,["parameters","durationSeconds"],n),void 0!==ew(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let i=ew(e,["aspectRatio"]);void 0!==t&&null!=i&&eE(t,["parameters","aspectRatio"],i);let o=ew(e,["resolution"]);void 0!==t&&null!=o&&eE(t,["parameters","resolution"],o);let s=ew(e,["personGeneration"]);if(void 0!==t&&null!=s&&eE(t,["parameters","personGeneration"],s),void 0!==ew(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let a=ew(e,["negativePrompt"]);void 0!==t&&null!=a&&eE(t,["parameters","negativePrompt"],a);let l=ew(e,["enhancePrompt"]);if(void 0!==t&&null!=l&&eE(t,["parameters","enhancePrompt"],l),void 0!==ew(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let c=ew(e,["lastFrame"]);void 0!==t&&null!=c&&eE(t,["instances[0]","lastFrame"],t$(c));let u=ew(e,["referenceImages"]);if(void 0!==t&&null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["image"]);null!=r&&eE(t,["image"],t$(r));let n=ew(e,["referenceType"]);return null!=n&&eE(t,["referenceType"],n),t})(e))),eE(t,["instances[0]","referenceImages"],e)}if(void 0!==ew(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==ew(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(l,r),r}(this.apiClient,e);return o=e_("{model}:predictLongRunning",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response","generateVideoResponse"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["generatedSamples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["video"]);return null!=r&&eE(t,["video"],function(e){let t={},r=ew(e,["uri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["encodedVideo"]);null!=n&&eE(t,["videoBytes"],ex(n));let i=ew(e,["encoding"]);return null!=i&&eE(t,["mimeType"],i),t}(r)),t})(e))),eE(t,["generatedVideos"],e)}let n=ew(e,["raiMediaFilteredCount"]);null!=n&&eE(t,["raiMediaFilteredCount"],n);let i=ew(e,["raiMediaFilteredReasons"]);return null!=i&&eE(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e),r=new eU;return Object.assign(r,t),r})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rc extends eb{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,r=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e;let n=t.name.split("/operations/")[0];r&&"httpOptions"in r&&(e=r.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:n,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){let t=e.operation,r=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e;let n=t.name.split("/operations/")[0];r&&"httpOptions"in r&&(e=r.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:n,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e){let t={},r=ew(e,["operationName"]);return null!=r&&eE(t,["_url","operationName"],r),t}(e);return o=e_("{operationName}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json())}{let t=function(e){let t={},r=ew(e,["operationName"]);return null!=r&&eE(t,["_url","operationName"],r),t}(e);return o=e_("{operationName}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["operationName"]);null!=r&&eE(t,["operationName"],r);let n=ew(e,["resourceName"]);return null!=n&&eE(t,["_url","resourceName"],n),t}(e);return n=e_("{resourceName}:fetchPredictOperation",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class ru extends eb{constructor(e){super(),this.apiClient=e}async create(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let o=function(e,t){let r={},n=ew(t,["config"]);return null!=n&&eE(r,["config"],function(e,t,r){let n=ew(t,["expireTime"]);void 0!==r&&null!=n&&eE(r,["expireTime"],n);let i=ew(t,["newSessionExpireTime"]);void 0!==r&&null!=i&&eE(r,["newSessionExpireTime"],i);let o=ew(t,["uses"]);void 0!==r&&null!=o&&eE(r,["uses"],o);let s=ew(t,["liveConnectConstraints"]);void 0!==r&&null!=s&&eE(r,["bidiGenerateContentSetup"],function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["setup","model"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&eE(r,["config"],function(e,t){let r=ew(e,["generationConfig"]);void 0!==t&&null!=r&&eE(t,["setup","generationConfig"],r);let n=ew(e,["responseModalities"]);void 0!==t&&null!=n&&eE(t,["setup","generationConfig","responseModalities"],n);let i=ew(e,["temperature"]);void 0!==t&&null!=i&&eE(t,["setup","generationConfig","temperature"],i);let o=ew(e,["topP"]);void 0!==t&&null!=o&&eE(t,["setup","generationConfig","topP"],o);let s=ew(e,["topK"]);void 0!==t&&null!=s&&eE(t,["setup","generationConfig","topK"],s);let a=ew(e,["maxOutputTokens"]);void 0!==t&&null!=a&&eE(t,["setup","generationConfig","maxOutputTokens"],a);let l=ew(e,["mediaResolution"]);void 0!==t&&null!=l&&eE(t,["setup","generationConfig","mediaResolution"],l);let c=ew(e,["seed"]);void 0!==t&&null!=c&&eE(t,["setup","generationConfig","seed"],c);let u=ew(e,["speechConfig"]);void 0!==t&&null!=u&&eE(t,["setup","generationConfig","speechConfig"],to(u));let d=ew(e,["thinkingConfig"]);void 0!==t&&null!=d&&eE(t,["setup","generationConfig","thinkingConfig"],d);let p=ew(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&eE(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=ew(e,["systemInstruction"]);void 0!==t&&null!=h&&eE(t,["setup","systemInstruction"],function(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}(te(h)));let f=ew(e,["tools"]);if(void 0!==t&&null!=f){let e=ta(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(ts(e)))),eE(t,["setup","tools"],e)}let m=ew(e,["sessionResumption"]);void 0!==t&&null!=m&&eE(t,["setup","sessionResumption"],function(e){let t={},r=ew(e,["handle"]);if(null!=r&&eE(t,["handle"],r),void 0!==ew(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=ew(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&eE(t,["setup","inputAudioTranscription"],g);let y=ew(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&eE(t,["setup","outputAudioTranscription"],y);let v=ew(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&eE(t,["setup","realtimeInputConfig"],v);let b=ew(e,["contextWindowCompression"]);void 0!==t&&null!=b&&eE(t,["setup","contextWindowCompression"],b);let _=ew(e,["proactivity"]);if(void 0!==t&&null!=_&&eE(t,["setup","proactivity"],_),void 0!==ew(e,["explicitVadSignal"]))throw Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}(i,r)),r}(e,s));let a=ew(t,["lockAdditionalFields"]);return void 0!==r&&null!=a&&eE(r,["fieldMask"],a),{}}(e,n,r)),r}(this.apiClient,e);n=e_("auth_tokens",o._url),i=o._query,delete o.config,delete o._url,delete o._query;let s=function(e,t){let r=null,n=e.bidiGenerateContentSetup;if("object"==typeof n&&null!==n&&"setup"in n){let t=n.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,r=t):delete e.bidiGenerateContentSetup}else void 0!==n&&delete e.bidiGenerateContentSetup;let i=e.fieldMask;if(r){let n=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t=[];for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r];if("object"==typeof n&&null!=n&&Object.keys(n).length>0){let e=Object.keys(n).map(e=>`${r}.${e}`);t.push(...e)}else t.push(r)}return t.join(",")}(r);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)n?e.fieldMask=n:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==i&&Array.isArray(i)&&i.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],r=[];i.length>0&&(r=i.map(e=>t.includes(e)?`generationConfig.${e}`:e));let o=[];n&&o.push(n),r.length>0&&o.push(...r),o.length>0?e.fieldMask=o.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==i&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(","):delete e.fieldMask;return e}(o,e.config);return this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rd extends eb{constructor(e){super(),this.apiClient=e,this.list=async e=>new tx(ed.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);return null!=r&&eE(t,["_url","name"],r),t}(e);return n=e_("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["_url","name"],r);let n=ew(e,["config"]);return null!=n&&/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e,t){let r=ew(e,["force"]);void 0!==t&&null!=r&&eE(t,["_query","force"],r)}(n,t),t}(e);n=e_("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal})}}async listInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["parent"]);null!=r&&eE(t,["_url","parent"],r);let n=ew(e,["config"]);return null!=n&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(n,t),t}(e);return n=e_("{parent}/documents",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["documents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["documents"],e)}return t}(e),r=new eB;return Object.assign(r,t),r})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rp extends eb{constructor(e,t=new rd(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new tx(ed.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["config"]);return null!=r&&/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["displayName"],r)}(r,t),t}(e);return n=e_("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);return null!=r&&eE(t,["_url","name"],r),t}(e);return n=e_("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["_url","name"],r);let n=ew(e,["config"]);return null!=n&&function(e,t){let r=ew(e,["force"]);void 0!==t&&null!=r&&eE(t,["_query","force"],r)}(n,t),t}(e);n=e_("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal})}}async listInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(r,t),t}(e);return n=e_("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["fileSearchStores"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["fileSearchStores"],e)}return t}(e),r=new eH;return Object.assign(r,t),r})}}async uploadToFileSearchStoreInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["fileSearchStoreName"]);null!=r&&eE(t,["_url","file_search_store_name"],r);let n=ew(e,["config"]);return null!=n&&t0(n,t),t}(e);return n=e_("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eV;return Object.assign(r,t),r})}}async importFile(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["fileSearchStoreName"]);null!=r&&eE(t,["_url","file_search_store_name"],r);let n=ew(e,["fileName"]);null!=n&&eE(t,["fileName"],n);let i=ew(e,["config"]);return null!=i&&function(e,t){let r=ew(e,["customMetadata"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["customMetadata"],e)}let n=ew(e,["chunkingConfig"]);void 0!==t&&null!=n&&eE(t,["chunkingConfig"],n)}(i,t),t}(e);return n=e_("{file_search_store_name}:importFile",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["parent"]);null!=n&&eE(t,["parent"],n);let i=ew(e,["documentName"]);return null!=i&&eE(t,["documentName"],i),t}(s)),t}(e),r=new e$;return Object.assign(r,t),r})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let rh=function(){let{crypto:e}=globalThis;if(null==e?void 0:e.randomUUID)return rh=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^r()&15>>+e/4).toString(16))},rf=()=>rh();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function rm(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let rg=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch(e){}try{return Error(JSON.stringify(e))}catch(e){}}return Error(e)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ry extends Error{}class rv extends ry{constructor(e,t,r,n){super(`${rv.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.error=t}static makeMessage(e,t,r){let n=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){return e&&n?400===e?new rw(e,t,r,n):401===e?new rx(e,t,r,n):403===e?new rS(e,t,r,n):404===e?new rT(e,t,r,n):409===e?new rA(e,t,r,n):422===e?new rC(e,t,r,n):429===e?new rO(e,t,r,n):e>=500?new rI(e,t,r,n):new rv(e,t,r,n):new r_({message:r,cause:rg(t)})}}class rb extends rv{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class r_ extends rv{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class rE extends r_{constructor({message:e}={}){super({message:null!=e?e:"Request timed out."})}}class rw extends rv{}class rx extends rv{}class rS extends rv{}class rT extends rv{}class rA extends rv{}class rC extends rv{}class rO extends rv{}class rI extends rv{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let rN=/^[a-z][a-z0-9+.-]*:/i,rk=e=>rN.test(e),rR=e=>(rR=Array.isArray)(e),rP=rR,rj=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new ry(`${e} must be an integer`);if(t<0)throw new ry(`${e} must be a positive integer`);return t},rM=e=>{try{return JSON.parse(e)}catch(e){return}},rD=e=>new Promise(t=>setTimeout(t,e)),rU="0.0.1",rL=()=>{var e,t,r,n,i;let o="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":rF(Deno.build.os),"X-Stainless-Arch":rG(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:null!==(t=null===(e=Deno.version)||void 0===e?void 0:e.deno)&&void 0!==t?t:"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":rF(null!==(r=globalThis.process.platform)&&void 0!==r?r:"unknown"),"X-Stainless-Arch":rG(null!==(n=globalThis.process.arch)&&void 0!==n?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":null!==(i=globalThis.process.version)&&void 0!==i?i:"unknown"};let s=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,n=r[2]||0,i=r[3]||0;return{browser:e,version:`${t}.${n}.${i}`}}}return null}();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},rG=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",rF=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",rq=()=>null!=n?n:n=rL();function rB(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function rH(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function rV(e){var t,r;if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await (null===(r=(t=e[Symbol.asyncIterator]()).return)||void 0===r?void 0:r.call(t));return}let n=e.getReader(),i=n.cancel();n.releaseLock(),await i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let r$=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),rz=()=>{var e;if("undefined"==typeof File){let{process:t}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof(null===(e=null==t?void 0:t.versions)||void 0===e?void 0:e.node)&&20>parseInt(t.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function rJ(e,t,r){return rz(),new File(e,null!=t?t:"unknown_file",r)}let rW=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],rK=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,rY=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&rK(e),rX=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function rZ(e,t,r){var n;if(rz(),rY(e=await e))return e instanceof File?e:rJ([await e.arrayBuffer()],e.name);if(rX(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),rJ(await rQ(n),t,r)}let i=await rQ(e);if(t||(t=("object"==typeof(n=e)&&null!==n&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0),!(null==r?void 0:r.type)){let e=i.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(r=Object.assign(Object.assign({},r),{type:e}))}return rJ(i,t,r)}async function rQ(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(rK(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(rW(e))try{for(var r,n,i,o,s,a,l=!0,c=tN(e);!(r=(a=await c.next()).done);l=!0)o=a.value,l=!1,t.push(...await rQ(o))}catch(e){n={error:e}}finally{try{!l&&!r&&(i=c.return)&&await i.call(c)}finally{if(n)throw n.error}}else{let t=null===(s=null==e?void 0:e.constructor)||void 0===s?void 0:s.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class r0{constructor(e){this._client=e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function r1(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}r0._key=[];let r2=Object.freeze(Object.create(null)),r4=((e=r1)=>function(t,...r){let n;if(1===t.length)return t[0];let i=!1,o=[],s=t.reduce((t,n,s)=>{var a,l,c;/[?#]/.test(n)&&(i=!0);let u=r[s],d=(i?encodeURIComponent:e)(""+u);return s!==r.length&&(null==u||"object"==typeof u&&u.toString===(null===(c=Object.getPrototypeOf(null!==(l=Object.getPrototypeOf(null!==(a=u.hasOwnProperty)&&void 0!==a?a:r2))&&void 0!==l?l:r2))||void 0===c?void 0:c.toString))&&(d=u+"",o.push({start:t.length+n.length,length:d.length,error:`Value of type ${Object.prototype.toString.call(u).slice(8,-1)} is not a valid path parameter`})),t+n+(s===r.length?"":d)},""),a=s.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(a));)o.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(o.sort((e,t)=>e.start-t.start),o.length>0){let e=0,t=o.reduce((t,r)=>{let n=" ".repeat(r.start-e),i="^".repeat(r.length);return e=r.start+r.length,t+n+i},"");throw new ry(`Path parameters result in path with invalid segments:
${o.map(e=>e.error).join("\n")}
${s}
${t}`)}return s})(r1);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class r5 extends r0{create(e,t){var r;let{api_version:n=this._client.apiVersion}=e,i=tC(e,["api_version"]);if("model"in i&&"agent_config"in i)throw new ry("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new ry("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(r4`/${n}/interactions`,Object.assign(Object.assign({body:i},t),{stream:null!==(r=e.stream)&&void 0!==r&&r}))}delete(e,t={},r){let{api_version:n=this._client.apiVersion}=null!=t?t:{};return this._client.delete(r4`/${n}/interactions/${e}`,r)}cancel(e,t={},r){let{api_version:n=this._client.apiVersion}=null!=t?t:{};return this._client.post(r4`/${n}/interactions/${e}/cancel`,r)}get(e,t={},r){var n;let i=null!=t?t:{},{api_version:o=this._client.apiVersion}=i,s=tC(i,["api_version"]);return this._client.get(r4`/${o}/interactions/${e}`,Object.assign(Object.assign({query:s},r),{stream:null!==(n=null==t?void 0:t.stream)&&void 0!==n&&n}))}}r5._key=Object.freeze(["interactions"]);class r3 extends r5{}function r6(e){let t;return(null!=i?i:i=(t=new globalThis.TextEncoder).encode.bind(t))(e)}function r8(e){let t;return(null!=o?o:o=(t=new globalThis.TextDecoder).decode.bind(t))(e)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class r7{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?r6(e):e;this.buffer=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t=0;for(let r of e)t+=r.length;let r=new Uint8Array(t),n=0;for(let t of e)r.set(t,n),n+=t.length;return r}([this.buffer,r]);let n=[];for(;null!=(t=function(e,t){for(let r=null!=t?t:0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(this.buffer,this.carriageReturnIndex));){if(t.carriage&&null==this.carriageReturnIndex){this.carriageReturnIndex=t.index;continue}if(null!=this.carriageReturnIndex&&(t.index!==this.carriageReturnIndex+1||t.carriage)){n.push(r8(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let e=null!==this.carriageReturnIndex?t.preceding-1:t.preceding,r=r8(this.buffer.subarray(0,e));n.push(r),this.buffer=this.buffer.subarray(t.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode("\n"):[]}}r7.NEWLINE_CHARS=new Set(["\n","\r"]),r7.NEWLINE_REGEXP=/\r\n|[\n\r]/g;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let r9={off:0,error:200,warn:300,info:400,debug:500},ne=(e,t,r)=>{if(e){if(Object.prototype.hasOwnProperty.call(r9,e))return e;no(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(r9))}`)}};function nt(){}function nr(e,t,r){return!t||r9[e]>r9[r]?nt:t[e].bind(t)}let nn={error:nt,warn:nt,info:nt,debug:nt},ni=new WeakMap;function no(e){var t;let r=e.logger,n=null!==(t=e.logLevel)&&void 0!==t?t:"off";if(!r)return nn;let i=ni.get(r);if(i&&i[0]===n)return i[1];let o={error:nr("error",r,n),warn:nr("warn",r,n),info:nr("info",r,n),debug:nr("debug",r,n)};return ni.set(r,[n,o]),o}let ns=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-goog-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class na{constructor(e,t,r){this.iterator=e,this.controller=t,this.client=r}static fromSSEResponse(e,t,r){let n=!1,i=r?no(r):console;return new na(function(){return tI(this,arguments,function*(){var r,o,s,a;if(n)throw new ry("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let l=!1;try{try{for(var c,u=!0,d=tN(function(e,t){return tI(this,arguments,function*(){var r,n,i,o;if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new ry("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new ry("Attempted to iterate over a response with no body")}let s=new nl,a=new r7,l=rH(e.body);try{for(var c,u=!0,d=tN(function(e){return tI(this,arguments,function*(){var t,r,n,i;let o=new Uint8Array;try{for(var s,a=!0,l=tN(e);!(t=(s=yield tO(l.next())).done);a=!0){let e;if(i=s.value,a=!1,null==i)continue;let t=i instanceof ArrayBuffer?new Uint8Array(i):"string"==typeof i?r6(i):i,r=new Uint8Array(o.length+t.length);for(r.set(o),r.set(t,o.length),o=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(o));)yield yield tO(o.slice(0,e)),o=o.slice(e)}}catch(e){r={error:e}}finally{try{!a&&!t&&(n=l.return)&&(yield tO(n.call(l)))}finally{if(r)throw r.error}}o.length>0&&(yield yield tO(o))})}(l));!(r=(c=yield tO(d.next())).done);u=!0)for(let e of(o=c.value,u=!1,a.decode(o))){let t=s.decode(e);t&&(yield yield tO(t))}}catch(e){n={error:e}}finally{try{!u&&!r&&(i=d.return)&&(yield tO(i.call(d)))}finally{if(n)throw n.error}}for(let e of a.flush()){let t=s.decode(e);t&&(yield yield tO(t))}})}(e,t));!(r=(c=yield tO(d.next())).done);u=!0)if(a=c.value,u=!1,!l){if(a.data.startsWith("[DONE]")){l=!0;continue}try{yield yield tO(JSON.parse(a.data))}catch(e){throw i.error("Could not parse message into JSON:",a.data),i.error("From chunk:",a.raw),e}}}catch(e){o={error:e}}finally{try{!u&&!r&&(s=d.return)&&(yield tO(s.call(d)))}finally{if(o)throw o.error}}l=!0}catch(e){if(rm(e))return yield tO(void 0);throw e}finally{l||t.abort()}})},t,r)}static fromReadableStream(e,t,r){let n=!1;return new na(function(){return tI(this,arguments,function*(){var r,i,o,s;if(n)throw new ry("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{try{for(var l,c=!0,u=tN(function(){return tI(this,arguments,function*(){var t,r,n,i;let o=new r7,s=rH(e);try{for(var a,l=!0,c=tN(s);!(t=(a=yield tO(c.next())).done);l=!0)for(let e of(i=a.value,l=!1,o.decode(i)))yield yield tO(e)}catch(e){r={error:e}}finally{try{!l&&!t&&(n=c.return)&&(yield tO(n.call(c)))}finally{if(r)throw r.error}}for(let e of o.flush())yield yield tO(e)})}());!(r=(l=yield tO(u.next())).done);c=!0)s=l.value,c=!1,!a&&s&&(yield yield tO(JSON.parse(s)))}catch(e){i={error:e}}finally{try{!c&&!r&&(o=u.return)&&(yield tO(o.call(u)))}finally{if(i)throw i.error}}a=!0}catch(e){if(rm(e))return yield tO(void 0);throw e}finally{a||t.abort()}})},t,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new na(()=>n(e),this.controller,this.client),new na(()=>n(t),this.controller,this.client)]}toReadableStream(){let e;let t=this;return rB({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:r,done:n}=await e.next();if(n)return t.close();let i=r6(JSON.stringify(r)+"\n");t.enqueue(i)}catch(e){t.error(e)}},async cancel(){var t;await (null===(t=e.return)||void 0===t?void 0:t.call(e))}})}}class nl{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){let r=e.indexOf(":");return -1!==r?[e.substring(0,r),":",e.substring(r+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function nc(e,t){let{response:r,requestLogID:n,retryOfRequestLogID:i,startTime:o}=t,s=await (async()=>{var n;if(t.options.stream)return(no(e).debug("response",r.status,r.url,r.headers,r.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(r,t.controller,e):na.fromSSEResponse(r,t.controller,e);if(204===r.status)return null;if(t.options.__binaryResponse)return r;let i=r.headers.get("content-type"),o=null===(n=null==i?void 0:i.split(";")[0])||void 0===n?void 0:n.trim();return(null==o?void 0:o.includes("application/json"))||(null==o?void 0:o.endsWith("+json"))?await r.json():await r.text()})();return no(e).debug(`[${n}] response parsed`,ns({retryOfRequestLogID:i,url:r.url,status:r.status,body:s,durationMs:Date.now()-o})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nu extends Promise{constructor(e,t,r=nc){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=r,this.client=e}_thenUnwrap(e){return new nu(this.client,this.responsePromise,async(t,r)=>e(await this.parseResponse(t,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let nd=Symbol("brand.privateNullableHeaders"),np=e=>{let t=new Headers,r=new Set;for(let n of e){let e=new Set;for(let[i,o]of function*(e){let t;if(!e)return;if(nd in e){let{values:t,nulls:r}=e;for(let e of(yield*t.entries(),r))yield[e,null];return}let r=!1;for(let n of(e instanceof Headers?t=e.entries():rP(e)?t=e:(r=!0,t=Object.entries(null!=e?e:{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=rP(n[1])?n[1]:[n[1]],i=!1;for(let n of t)void 0!==n&&(r&&!i&&(i=!0,yield[e,null]),yield[e,n])}}(n)){let n=i.toLowerCase();e.has(n)||(t.delete(i),e.add(n)),null===o?(t.delete(i),r.add(n)):(t.append(i,o),r.delete(n))}}return{[nd]:!0,values:t,nulls:r}},nh=e=>{var t,r,n,i,o,s;return void 0!==globalThis.process?null!==(n=null===(r=null===(t=globalThis.process.env)||void 0===t?void 0:t[e])||void 0===r?void 0:r.trim())&&void 0!==n?n:void 0:void 0!==globalThis.Deno?null===(s=null===(o=null===(i=globalThis.Deno.env)||void 0===i?void 0:i.get)||void 0===o?void 0:o.call(i,e))||void 0===s?void 0:s.trim():void 0};class nf{constructor(e){var t,r,n,i,o,s,a,{baseURL:l=nh("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:c=null!==(t=nh("GEMINI_API_KEY"))&&void 0!==t?t:null,apiVersion:u="v1beta"}=e;let d=Object.assign(Object.assign({apiKey:c,apiVersion:u},tC(e,["baseURL","apiKey","apiVersion"])),{baseURL:l||"https://generativelanguage.googleapis.com"});this.baseURL=d.baseURL,this.timeout=null!==(r=d.timeout)&&void 0!==r?r:nf.DEFAULT_TIMEOUT,this.logger=null!==(n=d.logger)&&void 0!==n?n:console;let p="warn";this.logLevel=p,this.logLevel=null!==(o=null!==(i=ne(d.logLevel,"ClientOptions.logLevel",this))&&void 0!==i?i:ne(nh("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))&&void 0!==o?o:p,this.fetchOptions=d.fetchOptions,this.maxRetries=null!==(s=d.maxRetries)&&void 0!==s?s:2,this.fetch=null!==(a=d.fetch)&&void 0!==a?a:/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),this.encoder=r$,this._options=d,this.apiKey=c,this.apiVersion=u,this.clientAdapter=d.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return"https://generativelanguage.googleapis.com"!==this.baseURL}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key")||this.apiKey&&e.get("x-goog-api-key")||t.has("x-goog-api-key")))throw Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=np([e.headers]);return t.values.has("authorization")||t.values.has("x-goog-api-key")?void 0:this.apiKey?np([{"x-goog-api-key":this.apiKey}]):this.clientAdapter.isVertexAI()?np([await this.clientAdapter.getAuthHeaders()]):void 0}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new ry(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${rU}`}defaultIdempotencyKey(){return`stainless-node-retry-${rf()}`}makeStatusError(e,t,r,n){return rv.generate(e,t,r,n)}buildURL(e,t,r){let n=!this.baseURLOverridden()&&r||this.baseURL,i=new URL(rk(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(o)&&(t=Object.assign(Object.assign({},o),t)),"object"==typeof t&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>Object.assign({method:e,path:t},r)))}request(e,t=null){return new nu(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){var n,i,o;let s=await e,a=null!==(n=s.maxRetries)&&void 0!==n?n:this.maxRetries;null==t&&(t=a),await this.prepareOptions(s);let{req:l,url:c,timeout:u}=await this.buildRequest(s,{retryCount:a-t});await this.prepareRequest(l,{url:c,options:s});let d="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),p=void 0===r?"":`, retryOf: ${r}`,h=Date.now();if(no(this).debug(`[${d}] sending request`,ns({retryOfRequestLogID:r,method:s.method,url:c,options:s,headers:l.headers})),null===(i=s.signal)||void 0===i?void 0:i.aborted)throw new rb;let f=new AbortController,m=await this.fetchWithTimeout(c,l,u,f).catch(rg),g=Date.now();if(m instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(null===(o=s.signal)||void 0===o?void 0:o.aborted)throw new rb;let n=rm(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(t)return no(this).info(`[${d}] connection ${n?"timed out":"failed"} - ${e}`),no(this).debug(`[${d}] connection ${n?"timed out":"failed"} (${e})`,ns({retryOfRequestLogID:r,url:c,durationMs:g-h,message:m.message})),this.retryRequest(s,t,null!=r?r:d);if(no(this).info(`[${d}] connection ${n?"timed out":"failed"} - error; no more retries left`),no(this).debug(`[${d}] connection ${n?"timed out":"failed"} (error; no more retries left)`,ns({retryOfRequestLogID:r,url:c,durationMs:g-h,message:m.message})),n)throw new rE;throw new r_({cause:m})}let y=`[${d}${p}] ${l.method} ${c} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${g-h}ms`;if(!m.ok){let e=await this.shouldRetry(m);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await rV(m.body),no(this).info(`${y} - ${e}`),no(this).debug(`[${d}] response error (${e})`,ns({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,durationMs:g-h})),this.retryRequest(s,t,null!=r?r:d,m.headers)}let n=e?"error; no more retries left":"error; not retryable";no(this).info(`${y} - ${n}`);let i=await m.text().catch(e=>rg(e).message),o=rM(i),a=o?void 0:i;throw no(this).debug(`[${d}] response error (${n})`,ns({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,message:a,durationMs:Date.now()-h})),this.makeStatusError(m.status,o,a,m.headers)}return no(this).info(y),no(this).debug(`[${d}] response start`,ns({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,durationMs:g-h})),{response:m,options:s,controller:f,requestLogID:d,retryOfRequestLogID:r,startTime:h}}async fetchWithTimeout(e,t,r,n){let i=t||{},{signal:o,method:s}=i,a=tC(i,["signal","method"]);o&&o.addEventListener("abort",()=>n.abort());let l=setTimeout(()=>n.abort(),r),c=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,u=Object.assign(Object.assign(Object.assign({signal:n.signal},c?{duplex:"half"}:{}),{method:"GET"}),a);s&&(u.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(l)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r,n){var i;let o;let s=null==n?void 0:n.get("retry-after-ms");if(s){let e=parseFloat(s);Number.isNaN(e)||(o=e)}let a=null==n?void 0:n.get("retry-after");if(a&&!o){let e=parseFloat(a);o=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(o&&0<=o&&o<6e4)){let r=null!==(i=e.maxRetries)&&void 0!==i?i:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,r)}return await rD(o),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){var r,n,i;let o=Object.assign({},e),{method:s,path:a,query:l,defaultBaseURL:c}=o,u=this.buildURL(a,l,c);"timeout"in o&&rj("timeout",o.timeout),o.timeout=null!==(r=o.timeout)&&void 0!==r?r:this.timeout;let{bodyHeaders:d,body:p}=this.buildBody({options:o}),h=await this.buildHeaders({options:e,method:s,bodyHeaders:d,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:s,headers:h},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&p instanceof globalThis.ReadableStream&&{duplex:"half"}),p&&{body:p}),null!==(n=this.fetchOptions)&&void 0!==n?n:{}),null!==(i=o.fetchOptions)&&void 0!==i?i:{}),url:u,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:n}){let i={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let o=await this.authHeaders(e),s=np([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),rq()),this._options.defaultHeaders,r,e.headers,o]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=np([t]);if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream)return{bodyHeaders:void 0,body:e};if("object"!=typeof e||!(Symbol.asyncIterator in e)&&(!(Symbol.iterator in e)||!("next"in e)||"function"!=typeof e.next))return this.encoder({body:e,headers:r});{let t;return{bodyHeaders:void 0,body:(t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator](),rB({start(){},async pull(e){let{done:r,value:n}=await t.next();r?e.close():e.enqueue(n)},async cancel(){var e;await (null===(e=t.return)||void 0===e?void 0:e.call(t))}}))}}}}nf.DEFAULT_TIMEOUT=6e4;class nm extends nf{constructor(){super(...arguments),this.interactions=new r3(this)}}nm.GeminiNextGenAPIClient=nm,nm.GeminiNextGenAPIClientError=ry,nm.APIError=rv,nm.APIConnectionError=r_,nm.APIConnectionTimeoutError=rE,nm.APIUserAbortError=rb,nm.NotFoundError=rT,nm.ConflictError=rA,nm.RateLimitError=rO,nm.BadRequestError=rw,nm.AuthenticationError=rx,nm.InternalServerError=rI,nm.PermissionDeniedError=rS,nm.UnprocessableEntityError=rC,nm.toFile=rZ,nm.Interactions=r3;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let ng="x-goog-api-key",ny="https://www.googleapis.com/auth/cloud-platform";class nv{constructor(e){if(void 0!==e.apiKey){this.apiKey=e.apiKey;return}let t=function(e){if(!e)return{scopes:[ny]};if(e.scopes){if("string"==typeof e.scopes&&e.scopes!==ny||Array.isArray(e.scopes)&&0>e.scopes.indexOf(ny))throw Error(`Invalid auth scopes. Scopes must include: ${ny}`)}else e.scopes=[ny];return e}(e.googleAuthOptions);this.googleAuth=new ep.eE(t)}async addAuthHeaders(e,t){if(void 0!==this.apiKey){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,t)}addKeyHeader(e){if(null===e.get(ng)){if(void 0===this.apiKey)throw Error("Trying to set API key header but apiKey is not set");e.append(ng,this.apiKey)}}async addGoogleAuthHeaders(e,t){if(void 0===this.googleAuth)throw Error("Trying to set google-auth headers but googleAuth is unset");for(let[r,n]of(await this.googleAuth.getRequestHeaders(t)))null===e.get(r)&&e.append(r,n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nb{async download(e,t){if(e.downloadPath){let r=await n_(e,t);if(r instanceof eT){let t=(0,eh.createWriteStream)(e.downloadPath);em.Readable.fromWeb(r.responseInternal.body).pipe(t),await (0,eg.finished)(t)}else try{await (0,ef.writeFile)(e.downloadPath,r,{encoding:"base64"})}catch(t){throw Error(`Failed to write file to ${e.downloadPath}: ${t}`)}}}}async function n_(e,t){var r,n,i;let o=tp(e.file);if(void 0!==o)return await t.request({path:`files/${o}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal});if(tu(e.file)){let t=null===(i=e.file.video)||void 0===i?void 0:i.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download generated video, Uri or videoBytes not found.")}if(td(e.file)){let t=e.file.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download video, Uri or videoBytes not found.")}throw Error("Unsupported file type")}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nE{create(e,t,r){return new nw(e,t,r)}}class nw{constructor(e,t,r){this.url=e,this.headers=t,this.callbacks=r}connect(){this.ws=new ey(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}function nx(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["name"]);null!=i&&eE(r,["name"],i);let o=ew(e,["state"]);null!=o&&eE(r,["state"],tc(o));let s=ew(e,["createTime"]);null!=s&&eE(r,["createTime"],s);let a=ew(e,["tuningTask","startTime"]);null!=a&&eE(r,["startTime"],a);let l=ew(e,["tuningTask","completeTime"]);null!=l&&eE(r,["endTime"],l);let c=ew(e,["updateTime"]);null!=c&&eE(r,["updateTime"],c);let u=ew(e,["description"]);null!=u&&eE(r,["description"],u);let d=ew(e,["baseModel"]);null!=d&&eE(r,["baseModel"],d);let p=ew(e,["_self"]);return null!=p&&eE(r,["tunedModel"],function(e,t){let r={},n=ew(e,["name"]);null!=n&&eE(r,["model"],n);let i=ew(e,["name"]);return null!=i&&eE(r,["endpoint"],i),r}(p)),r}function nS(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["name"]);null!=i&&eE(r,["name"],i);let o=ew(e,["state"]);null!=o&&eE(r,["state"],tc(o));let s=ew(e,["createTime"]);null!=s&&eE(r,["createTime"],s);let a=ew(e,["startTime"]);null!=a&&eE(r,["startTime"],a);let l=ew(e,["endTime"]);null!=l&&eE(r,["endTime"],l);let c=ew(e,["updateTime"]);null!=c&&eE(r,["updateTime"],c);let u=ew(e,["error"]);null!=u&&eE(r,["error"],u);let d=ew(e,["description"]);null!=d&&eE(r,["description"],d);let p=ew(e,["baseModel"]);null!=p&&eE(r,["baseModel"],p);let h=ew(e,["tunedModel"]);null!=h&&eE(r,["tunedModel"],h);let f=ew(e,["preTunedModel"]);null!=f&&eE(r,["preTunedModel"],f);let m=ew(e,["supervisedTuningSpec"]);null!=m&&eE(r,["supervisedTuningSpec"],m);let g=ew(e,["preferenceOptimizationSpec"]);null!=g&&eE(r,["preferenceOptimizationSpec"],g);let y=ew(e,["tuningDataStats"]);null!=y&&eE(r,["tuningDataStats"],y);let v=ew(e,["encryptionSpec"]);null!=v&&eE(r,["encryptionSpec"],v);let b=ew(e,["partnerModelTuningSpec"]);null!=b&&eE(r,["partnerModelTuningSpec"],b);let _=ew(e,["customBaseModel"]);null!=_&&eE(r,["customBaseModel"],_);let E=ew(e,["experiment"]);null!=E&&eE(r,["experiment"],E);let w=ew(e,["labels"]);null!=w&&eE(r,["labels"],w);let x=ew(e,["outputUri"]);null!=x&&eE(r,["outputUri"],x);let S=ew(e,["pipelineJob"]);null!=S&&eE(r,["pipelineJob"],S);let T=ew(e,["serviceAccount"]);null!=T&&eE(r,["serviceAccount"],T);let A=ew(e,["tunedModelDisplayName"]);null!=A&&eE(r,["tunedModelDisplayName"],A);let C=ew(e,["veoTuningSpec"]);return null!=C&&eE(r,["veoTuningSpec"],C),r}function nT(e,t){let r={},n=ew(e,["gcsUri"]);null!=n&&eE(r,["validationDatasetUri"],n);let i=ew(e,["vertexDatasetResource"]);return null!=i&&eE(r,["validationDatasetUri"],i),r}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nA extends eb{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tx(ed.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI()){if(e.baseModel.startsWith("projects/")){let r={tunedModelName:e.baseModel};(null===(t=e.config)||void 0===t?void 0:t.preTunedModelCheckpointId)&&(r.checkpointId=e.config.preTunedModelCheckpointId);let n=Object.assign(Object.assign({},e),{preTunedModel:r});return n.baseModel=void 0,await this.tuneInternal(n)}{let t=Object.assign({},e);return await this.tuneInternal(t)}}{let t=Object.assign({},e),r=await this.tuneMldevInternal(t),n="";return void 0!==r.metadata&&void 0!==r.metadata.tunedModel?n=r.metadata.tunedModel:void 0!==r.name&&r.name.includes("/operations/")&&(n=r.name.split("/operations/")[0]),{name:n,state:P.JOB_STATE_QUEUED}}}}async getInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(e,["name"]);return null!=n&&eE(r,["_url","name"],n),r}(e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nS(e))}{let t=function(e,t){let r={},n=ew(e,["name"]);return null!=n&&eE(r,["_url","name"],n),r}(e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nx(e))}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(e,["config"]);return null!=n&&function(e,t,r){let n=ew(e,["pageSize"]);void 0!==t&&null!=n&&eE(t,["_query","pageSize"],n);let i=ew(e,["pageToken"]);void 0!==t&&null!=i&&eE(t,["_query","pageToken"],i);let o=ew(e,["filter"]);void 0!==t&&null!=o&&eE(t,["_query","filter"],o)}(n,r),r}(e);return o=e_("tuningJobs",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["nextPageToken"]);null!=i&&eE(r,["nextPageToken"],i);let o=ew(e,["tuningJobs"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>nS(e))),eE(r,["tuningJobs"],e)}return r}(e),r=new eL;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(e,["config"]);return null!=n&&function(e,t,r){let n=ew(e,["pageSize"]);void 0!==t&&null!=n&&eE(t,["_query","pageSize"],n);let i=ew(e,["pageToken"]);void 0!==t&&null!=i&&eE(t,["_query","pageToken"],i);let o=ew(e,["filter"]);void 0!==t&&null!=o&&eE(t,["_query","filter"],o)}(n,r),r}(e);return o=e_("tunedModels",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["nextPageToken"]);null!=i&&eE(r,["nextPageToken"],i);let o=ew(e,["tunedModels"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>nx(e))),eE(r,["tuningJobs"],e)}return r}(e),r=new eL;return Object.assign(r,t),r})}}async cancel(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(e,["name"]);return null!=n&&eE(r,["_url","name"],n),r}(e);return o=e_("{name}:cancel",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);return null!=n&&eE(r,["sdkHttpResponse"],n),r}(e),r=new eG;return Object.assign(r,t),r})}{let t=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e,t){let r={},n=ew(e,["name"]);return null!=n&&eE(r,["_url","name"],n),r}(e);return o=e_("{name}:cancel",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);return null!=n&&eE(r,["sdkHttpResponse"],n),r}(e),r=new eG;return Object.assign(r,t),r})}}async tuneInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(e,["baseModel"]);null!=n&&eE(r,["baseModel"],n);let i=ew(e,["preTunedModel"]);null!=i&&eE(r,["preTunedModel"],i);let o=ew(e,["trainingDataset"]);null!=o&&function(e,t,r){let n=ew(r,["config","method"]);if(void 0===n&&(n="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===n){let r=ew(e,["gcsUri"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","trainingDatasetUri"],r)}else if("PREFERENCE_TUNING"===n){let r=ew(e,["gcsUri"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","trainingDatasetUri"],r)}let i=ew(r,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let r=ew(e,["vertexDatasetResource"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","trainingDatasetUri"],r)}else if("PREFERENCE_TUNING"===i){let r=ew(e,["vertexDatasetResource"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","trainingDatasetUri"],r)}if(void 0!==ew(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(o,r,t);let s=ew(e,["config"]);return null!=s&&function(e,t,r){let n=ew(r,["config","method"]);if(void 0===n&&(n="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===n){let r=ew(e,["validationDataset"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec"],nT(r))}else if("PREFERENCE_TUNING"===n){let r=ew(e,["validationDataset"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec"],nT(r))}let i=ew(e,["tunedModelDisplayName"]);void 0!==t&&null!=i&&eE(t,["tunedModelDisplayName"],i);let o=ew(e,["description"]);void 0!==t&&null!=o&&eE(t,["description"],o);let s=ew(r,["config","method"]);if(void 0===s&&(s="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===s){let r=ew(e,["epochCount"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","hyperParameters","epochCount"],r)}else if("PREFERENCE_TUNING"===s){let r=ew(e,["epochCount"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],r)}let a=ew(r,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){let r=ew(e,["learningRateMultiplier"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],r)}else if("PREFERENCE_TUNING"===a){let r=ew(e,["learningRateMultiplier"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],r)}let l=ew(r,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){let r=ew(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","exportLastCheckpointOnly"],r)}else if("PREFERENCE_TUNING"===l){let r=ew(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],r)}let c=ew(r,["config","method"]);if(void 0===c&&(c="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===c){let r=ew(e,["adapterSize"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","hyperParameters","adapterSize"],r)}else if("PREFERENCE_TUNING"===c){let r=ew(e,["adapterSize"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],r)}if(void 0!==ew(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==ew(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let u=ew(e,["labels"]);void 0!==t&&null!=u&&eE(t,["labels"],u);let d=ew(e,["beta"]);void 0!==t&&null!=d&&eE(t,["preferenceOptimizationSpec","hyperParameters","beta"],d)}(s,r,t),r}(e,e);return n=e_("tuningJobs",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nS(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e,t){let r={},n=ew(e,["baseModel"]);null!=n&&eE(r,["baseModel"],n);let i=ew(e,["preTunedModel"]);null!=i&&eE(r,["preTunedModel"],i);let o=ew(e,["trainingDataset"]);null!=o&&function(e,t){if(void 0!==ew(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==ew(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let r=ew(e,["examples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE({},["examples","examples"],e)}}(o);let s=ew(e,["config"]);return null!=s&&function(e,t,r){if(void 0!==ew(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let n=ew(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=n&&eE(t,["displayName"],n),void 0!==ew(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let i=ew(e,["epochCount"]);void 0!==t&&null!=i&&eE(t,["tuningTask","hyperparameters","epochCount"],i);let o=ew(e,["learningRateMultiplier"]);if(null!=o&&eE({},["tuningTask","hyperparameters","learningRateMultiplier"],o),void 0!==ew(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==ew(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==ew(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let s=ew(e,["batchSize"]);void 0!==t&&null!=s&&eE(t,["tuningTask","hyperparameters","batchSize"],s);let a=ew(e,["learningRate"]);if(void 0!==t&&null!=a&&eE(t,["tuningTask","hyperparameters","learningRate"],a),void 0!==ew(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");if(void 0!==ew(e,["beta"]))throw Error("beta parameter is not supported in Gemini API.")}(s,r),r}(e);return n=e_("tunedModels",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["name"]);null!=i&&eE(r,["name"],i);let o=ew(e,["metadata"]);null!=o&&eE(r,["metadata"],o);let s=ew(e,["done"]);null!=s&&eE(r,["done"],s);let a=ew(e,["error"]);return null!=a&&eE(r,["error"],a),r})(e))}}}let nC="x-goog-upload-status";async function nO(e,t,r){var n;let i=await nN(e,t,r),o=await (null==i?void 0:i.json());if((null===(n=null==i?void 0:i.headers)||void 0===n?void 0:n[nC])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return o.file}async function nI(e,t,r){var n;let i=await nN(e,t,r),o=await (null==i?void 0:i.json());if((null===(n=null==i?void 0:i.headers)||void 0===n?void 0:n[nC])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let s=eS(o),a=new eZ;return Object.assign(a,s),a}async function nN(e,t,r){var n,i;let o=0,s=0,a=new eT(new Response),l="upload";for(o=e.size;s<o;){let c=Math.min(8388608,o-s),u=e.slice(s,s+c);s+c>=o&&(l+=", finalize");let d=0,p=1e3;for(;d<3&&(null===(n=null==(a=await r.request({path:"",body:u,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(s),"Content-Length":String(c)}}}))?void 0:a.headers)||void 0===n||!n[nC]);)d++,await nR(p),p*=2;if(s+=c,(null===(i=null==a?void 0:a.headers)||void 0===i?void 0:i[nC])!=="active")break;if(o<=s)throw Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function nk(e){return{size:e.size,type:e.type}}function nR(e){return new Promise(t=>setTimeout(t,e))}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nP{async stat(e){let t={size:0,type:void 0};if("string"!=typeof e)return await nk(e);{let r=await ef.stat(e);return t.size=r.size,t.type=this.inferMimeType(e),t}}async upload(e,t,r){return"string"==typeof e?await this.uploadFileFromPath(e,t,r):nO(e,t,r)}async uploadToFileSearchStore(e,t,r){return"string"==typeof e?await this.uploadFileToFileSearchStoreFromPath(e,t,r):nI(e,t,r)}inferMimeType(e){return({aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"})[e.slice(e.lastIndexOf(".")+1).toLowerCase()]}async uploadFileFromPath(e,t,r){var n;let i=await this.uploadFileFromPathInternal(e,t,r),o=await (null==i?void 0:i.json());if((null===(n=null==i?void 0:i.headers)||void 0===n?void 0:n[nC])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return o.file}async uploadFileToFileSearchStoreFromPath(e,t,r){var n;let i=await this.uploadFileFromPathInternal(e,t,r),o=await (null==i?void 0:i.json());if((null===(n=null==i?void 0:i.headers)||void 0===n?void 0:n[nC])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let s=eS(o),a=new eZ;return Object.assign(a,s),a}async uploadFileFromPathInternal(e,t,r){var n,i;let o;let s=0,a=0,l=new eT(new Response),c="upload",u=ev.basename(e);try{if(!(o=await ef.open(e,"r")))throw Error("Failed to open file");for(s=(await o.stat()).size;a<s;){let e=Math.min(8388608,s-a);a+e>=s&&(c+=", finalize");let d=new Uint8Array(e),{bytesRead:p}=await o.read(d,0,e,a);if(p!==e)throw Error(`Failed to read ${e} bytes from file at offset ${a}. bytes actually read: ${p}`);let h=new Blob([d]),f=0,m=1e3;for(;f<3&&(l=await r.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(a),"Content-Length":String(p),"X-Goog-Upload-File-Name":u}}}),null===(n=null==l?void 0:l.headers)||void 0===n||!n[nC]);)f++,await nR(m),m*=2;if(a+=p,(null===(i=null==l?void 0:l.headers)||void 0===i?void 0:i[nC])!=="active")break;if(s<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}return l}finally{o&&await o.close()}}}class nj{get interactions(){if(void 0!==this._interactions)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;(null==e?void 0:e.extraBody)&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new nm({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:null==e?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t,r,n,i,o,l;if((e.project||e.location)&&e.apiKey)throw Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=null!==(r=null!==(t=e.vertexai)&&void 0!==t?t:function(e){var t;return void 0!==(t=nM(e))&&"true"===t.toLowerCase()}("GOOGLE_GENAI_USE_VERTEXAI"))&&void 0!==r&&r;let c=function(){let e=nM("GOOGLE_API_KEY"),t=nM("GEMINI_API_KEY");return e&&t&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),e||t||void 0}(),u=nM("GOOGLE_CLOUD_PROJECT"),d=nM("GOOGLE_CLOUD_LOCATION");if(this.apiKey=null!==(n=e.apiKey)&&void 0!==n?n:c,this.project=null!==(i=e.project)&&void 0!==i?i:u,this.location=null!==(o=e.location)&&void 0!==o?o:d,!this.vertexai&&!this.apiKey)throw Error("API key must be set when using the Gemini API.");!e.vertexai||((null===(l=e.googleAuthOptions)||void 0===l?void 0:l.credentials)&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(u||d)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&c?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(u||d)&&c&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0),this.location||this.apiKey||(this.location="global"));let p=function(e,t,r,n){var i,o;if(!(null==e?void 0:e.baseUrl)){let e={geminiUrl:s,vertexUrl:a};return t?null!==(i=e.vertexUrl)&&void 0!==i?i:r:null!==(o=e.geminiUrl)&&void 0!==o?o:n}return e.baseUrl}(e.httpOptions,e.vertexai,nM("GOOGLE_VERTEX_BASE_URL"),nM("GOOGLE_GEMINI_BASE_URL"));p&&(e.httpOptions?e.httpOptions.baseUrl=p:e.httpOptions={baseUrl:p}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let h=new nv({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new t2({auth:h,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:"gl-node/"+process.version,uploader:new nP,downloader:new nb}),this.models=new rl(this.apiClient),this.live=new rt(this.apiClient,h,new nE),this.batches=new tS(this.apiClient),this.chats=new tP(this.models,this.apiClient),this.caches=new tA(this.apiClient),this.files=new tD(this.apiClient),this.operations=new rc(this.apiClient),this.authTokens=new ru(this.apiClient),this.tunings=new nA(this.apiClient),this.fileSearchStores=new rp(this.apiClient)}}function nM(e){var t,r,n;return null!==(n=null===(r=null===(t=null==process?void 0:process.env)||void 0===t?void 0:t[e])||void 0===r?void 0:r.trim())&&void 0!==n?n:void 0}r(15424);var nD=r(46242),nU=(0,nD.$)("10ee66149d7292c70664a2b6fcd7f7a70d2c3076"),nL=(0,nD.$)("eb151d3fd857512271a65ce58cdee5f0c1e7b492"),nG=(0,nD.$)("339fcfd5065a4751c35774d5057596578758eddb"),nF=(0,nD.$)("fce521ad3c90b3e771b86791ccd823b072aac3aa"),nq=(0,nD.$)("dccf7eab92aa7700d0bfbb18afb2b6f9bff04cb8"),nB=(0,nD.$)("1d6c83ceea59af419a9339e920af96f843ae4931"),nH=(0,nD.$)("a78d6bd7ccacd86d81fd5dfaacb074eca54b8ecd"),nV=(0,nD.$)("6e4f4bd43c5cc2f1c37851bff4349970904bddc6");let n$=()=>null,nz=()=>{let e=n$()||"PLACEHOLDER_API_KEY";return e?new nj({apiKey:e}):null},nJ=e=>new Promise(t=>setTimeout(t,e)),nW=e=>{if(!e)return"";let t=e.split(",");return t.length>1?t[1]:t[0]},nK=e=>{let t=e.match(/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+);base64,/);return t?t[1]:"image/png"},nY=async(e,t="V1",r)=>{let n=nz();if(!n)return await nL(e,t,r);let i="";i="V1"===t?`
        <instruction> Analyze the entire composition of the input image. Identify ALL key subjects present (whether it's a single person, a group/couple, a vehicle, or a specific object) and their spatial relationship/interaction.
        Generate a cohesive 3x3 grid "Cinematic Contact Sheet" featuring 9 distinct camera shots of exactly these subjects in the same environment.
        You must adapt the standard cinematic shot types to fit the content (e.g., if a group, keep the group together; if an object, frame the whole object):
        Row 1 (Establishing Context):
        1.Extreme Long Shot (ELS): The subject(s) are seen small within the vast environment.
        2.Long Shot (LS): The complete subject(s) or group is visible from top to bottom (head to toe / wheels to roof).
        3.Medium Long Shot (American/3-4): Framed from knees up (for people) or a 3/4 view (for objects).
        Row 2 (The Core Coverage): 4. Medium Shot (MS): Framed from the waist up (or the central core of the object). Focus on interaction/action. 5. Medium Close-Up (MCU): Framed from chest up. Intimate framing of the main subject(s). 6. Close-Up (CU): Tight framing on the face(s) or the "front" of the object.
        Row 3 (Details & Angles): 7. Extreme Close-Up (ECU): Macro detail focusing intensely on a key feature (eyes, hands, logo, texture). 8. Low Angle Shot (Worm's Eye): Looking up at the subject(s) from the ground (imposing/heroic). 9. High Angle Shot (Bird's Eye): Looking down on the subject(s) from above.
        Ensure strict consistency: The same people/objects, same clothes, and same lighting across all 9 panels. The depth of field should shift realistically (bokeh in close-ups). </instruction>
        A professional 3x3 cinematic storyboard grid containing 9 panels.
        The grid showcases the specific subject/scene from the input image in a comprehensive range of focal lengths.
        Top Row: Wide environmental shot, Full view, 3/4 cut.
        Middle Row: Waist-up view, Chest-up view, Face/Front close-up.
        Bottom Row: Macro detail, Low Angle, High Angle.
        All frames feature photorealistic textures, consistent cinematic color grading, and correct framing for the specific number of subjects or objects analyzed.
        
        OUTPUT REQUIREMENT: Return exactly a JSON array containing 9 strings, where each string describes one of the 9 panels defined above.
        `:"V2"===t?`
        <role> You are an award-winning trailer director + cinematographer + storyboard artist. Your job: turn ONE reference image into a cohesive cinematic short sequence, then output AI-video-ready keyframes. </role>
        <input> User provides: one reference image (image). </input>
        <non-negotiable rules - continuity & truthfulness>
        1.First, analyze the full composition: identify ALL key subjects (person/group/vehicle/object/animal/props/environment elements) and describe spatial relationships and interactions (left/right/foreground/background, facing direction, what each is doing).
        2.Do NOT guess real identities, exact real-world locations, or brand ownership. Stick to visible facts. Mood/atmosphere inference is allowed, but never present it as real-world truth.
        3.Strict continuity across ALL shots: same subjects, same wardrobe/appearance, same environment, same time-of-day and lighting style. Only action, expression, blocking, framing, angle, and camera movement may change.
        4.Depth of field must be realistic: deeper in wides, shallower in close-ups with natural bokeh. Keep ONE consistent cinematic color grade across the entire sequence.
        5.Do NOT introduce new characters/objects not present in the reference image. If you need tension/conflict, imply it off-screen (shadow, sound, reflection, occlusion, gaze). </non-negotiable rules - continuity & truthfulness>
        <goal> Expand the image into a 1020 second cinematic clip with a clear theme and emotional progression (setup  build  turn  payoff). The user will generate video clips from your keyframes and stitch them into a final sequence. </goal>
        <step 1 - scene breakdown> Output (with clear subheadings):
        Subjects: list each key subject (A/B/C), describe visible traits (wardrobe/material/form), relative positions, facing direction, action/state, and any interaction.
        Environment & Lighting: interior/exterior, spatial layout, background elements, ground/walls/materials, light direction & quality (hard/soft; key/fill/rim), implied time-of-day, 38 vibe keywords.
        Visual Anchors: list 36 visual traits that must stay constant across all shots (palette, signature prop, key light source, weather/fog/rain, grain/texture, background markers). </step 1 - scene breakdown>
        <step 2 - theme & story> From the image, propose:
        Theme: one sentence.
        Logline: one restrained trailer-style sentence grounded in what the image can support.
        Emotional Arc: 4 beats (setup/build/turn/payoff), one line each. </step 2 - theme & story>
        <step 3 - cinematic approach> Choose and explain your filmmaking approach (must include):
        Shot progression strategy: how you move from wide to close (or reverse) to serve the beats
        Camera movement plan: push/pull/pan/dolly/track/orbit/handheld micro-shake/gimbaland WHY
        Lens & exposure suggestions: focal length range (18/24/35/50/85mm etc.), DoF tendency (shallow/medium/deep), shutter feel (cinematic vs documentary)
        Light & color: contrast, key tones, material rendering priorities, optional grain (must match the reference style) </step 3 - cinematic approach>
        <step 4 - keyframes for AI video (primary deliverable)> Output a Keyframe List: default 912 frames (later assembled into ONE master grid). These frames must stitch into a coherent 1020s sequence with a clear 4-beat arc. Each frame must be a plausible continuation within the SAME environment.
        Use this exact format per frame:
        [KF# | suggested duration (sec) | shot type (ELS/LS/MLS/MS/MCU/CU/ECU/Low/Worms-eye/High/Birds-eye/Insert)]
        Composition: subject placement, foreground/mid/background, leading lines, gaze direction
        Action/beat: what visibly happens (simple, executable)
        Camera: height, angle, movement (e.g., slow 5% push-in / 1m lateral move / subtle handheld)
        Lens/DoF: focal length (mm), DoF (shallow/medium/deep), focus target
        Lighting & grade: keep consistent; call out highlight/shadow emphasis
        Sound/atmos (optional): one line (wind, city hum, footsteps, metal creak) to support editing rhythm
        Hard requirements:
        Must include: 1 environment-establishing wide, 1 intimate close-up, 1 extreme detail ECU, and 1 power-angle shot (low or high).
        Ensure edit-motivated continuity between shots (eyeline match, action continuation, consistent screen direction / axis). </step 4 - keyframes for AI video>
        
        OUTPUT REQUIREMENT: Based on the Keyframe List generated in Step 4, return exactly a JSON array containing 9 strings. Each string should be a full, detailed image prompt for one keyframe, incorporating all the visual anchors and continuity details to ensure character consistency.
        `:"V3"===t?`
        STORY-TO-STORYBOARD META-PROMPT
        IMPORTANT: Do not create the image, create the detailed prompt for the image.
        The image prompt must make reference to the story and reference image provided by user, the prompt must follow exactly the details of the image prompt
        When the user provides a short story synopsis, follow these steps:
        Analyze the synopsis and identify:
        The main subject(s) (person, pair, group, creature, vehicle, object)
        Their appearance and defining traits
        The environment and tone
        The emotional or narrative beat
        Lighting/mood implied by the story
        Create a full 3\xd73 cinematic storyboard grid with 9 distinct shots of the same subject(s) in the same environment, using consistent wardrobe, lighting, and atmosphere.
        
        OUTPUT FORMAT
        Cinematic 3\xd73 Storyboard Prompt
        Story Synopsis (interpreted):
        <one-sentence interpretation of the users synopsis>
        Create a professional 3\xd73 cinematic storyboard grid featuring the same subject(s) from the synopsis in the same environment.
        Maintain total consistency in appearance, clothing, lighting, mood, and environmental details.
        Each panel represents a distinct camera shot following cinematic conventions.
        Row 1  Establishing Context
        Extreme Long Shot (ELS):
        Full environment revealed, subject(s) small in frame. Match the storys setting, lighting, and mood.
        Long Shot (LS):
        Entire subject(s) visible head-to-toe (or full object/vehicle), standing naturally within the environment.
        Medium Long Shot (MLS / 3-4 / American Shot):
        Subject(s) framed from knees up (or 3/4 angle for objects), showing stance, posture, and core emotion.
        Row 2  Core Coverage
        Medium Shot (MS):
        Waist-up framing. Capture the key action, attitude, or emotional beat implied by the story.
        Medium Close-Up (MCU):
        Chest-up. Focus on emotion, expression, micro-interaction, or narrative tension.
        Close-Up (CU):
        Tight shot of the face (or front detail of an object). Cinematic depth of field, emotional clarity.
        Row 3  Details & Angles
        Extreme Close-Up (ECU):
        Macro detail: eyes, hands, symbolic object, texture, or a key story element.
        Low Angle Shot (Worms Eye):
        Camera looking up at the subject(s) from below. Dramatic, heroic, or imposing based on the storys tone.
        High Angle Shot (Birds Eye):
        Camera looking down from above. Spatial clarity, vulnerability, or overview of action.
        Global Requirements
        Same subject from image prompt(s) in all 9 frames
        Same clothing, hairstyle, props, weapons, or accessories
        Same lighting conditions and color grading
        Consistent environment and weather
        Correct realism and cinematic depth of field per shot
        Photorealistic textures
        Cinematic camera behavior and focal-length accuracy

        Example of How This Works with a Synopsis
        User input:
        A lone desert scout tracks a signal across a ruined canyon at sunset.
        Output (shortened example):
        Story Synopsis: A lone desert scout navigates a canyon wasteland at sunset while tracking a mysterious signal.
        ELS: small figure against vast ruined canyon
        LS: scout silhouetted in sunset light
        MLS: knees-up shot with gear visible
        MS: waist-up, scanning horizon
        MCU: chest-up, focused expression
        CU: dust-covered face, tracking device glow
        ECU: close-up of the device display
        Low Angle: heroic stance on canyon ridge
        High Angle: scout from above, canyon below

        OUTPUT REQUIREMENT: Return exactly a JSON array containing 9 strings. Each string must be the detailed visual description for one of the 9 frames (ELS, LS, MLS, MS, MCU, CU, ECU, Low Angle, High Angle), fully incorporating the character and environment details from the input story and reference image.
        `:`
        STORY-TO-STORYBOARD META-PROMPT. Create a full 3\xd73 cinematic storyboard grid with 9 distinct shots.
        OUTPUT REQUIREMENT: Return exactly a JSON array containing 9 strings.
        `;let o=[];r&&o.push({inlineData:{data:nW(r),mimeType:"image/png"}}),o.push({text:`REFERENCE MATERIAL: """${e}"""

SYSTEM INSTRUCTION:
${i}`});try{let t=((await n.models.generateContent({model:"gemini-3-pro-preview",contents:{parts:o},config:{responseMimeType:"application/json"}})).text||"").replace(/```json|```/g,"").trim(),r=JSON.parse(t);return Array.isArray(r)?r.slice(0,9):[e]}catch(e){return[]}},nX=async(e,t,r={},n,i,o,s)=>{let a=nz();if(!a){let a=await nG(e,t,r,n,i,o,s);return a&&a.uri?{...a,uri:`/api/proxy-file?uri=${encodeURIComponent(a.uri)}`}:a}let l={numberOfVideos:1,aspectRatio:r.aspectRatio||"16:9",resolution:r.resolution||"720p",duration:r.duration?`${r.duration}s`:void 0},c={prompt:e||"Cinematic video with professional lighting."};n&&(c.image={imageBytes:nW(n),mimeType:nK(n)}),s&&(l.lastFrame={imageBytes:nW(s),mimeType:nK(s)}),i&&(c.video=i);try{let e=await a.models.generateVideos({model:t||"veo-3.1-fast-generate-preview",...c,config:l});for(;!e.done;)await nJ(5e3),e=await a.operations.getVideosOperation({operation:e});if(e.error)throw Error(e.error.message);let r=e.response?.generatedVideos?.[0]?.video;if(!r||!r.uri)throw Error("Video generation failed: No video returned");let n=r.uri||r.videoUri;if(!n)throw Error("No video URI in response");let i=n$(),o=n;if(i){let e=o.includes("?")?"&":"?";o+=`${e}key=${i}`}return{uri:`/api/proxy-file?uri=${encodeURIComponent(o)}`,videoMetadata:r}}catch(e){throw e}},nZ=async(e,t,r={},n)=>{if(e.length<2)throw Error("At least 2 frames required for sequence generation");let i=[],o=e.length-1;for(let s=0;s<o;s++){let a=e[s],l=e[s+1];n&&n(s+1,o);let c=a.transition.prompt||"Maintain strict visual continuity and smooth motion between frames.",u=a.transition.duration||3;console.log(`Generating segment ${s+1}/${o}: ${c} (${u}s)`);try{let e=await nX(c,t,{...r,duration:u},a.src,void 0,void 0,l.src);if(e&&e.uri)i.push(e.uri);else if(console.error(`Segment ${s+1} generation failed: No URI returned`,e),e?.videoMetadata?.uri)i.push(e.videoMetadata.uri);else throw Error(`Segment ${s+1} failed to generate: No video returned`)}catch(e){throw console.error(`Error generating segment ${s+1}:`,e),e}}return i},nQ=async(e,t,r=[],n={})=>{let i=nz();if(!i)return await nF(e,t,r,n);let o=t||"gemini-3-pro-image-preview",s=r.map(e=>({inlineData:{data:nW(e),mimeType:"image/png"}}));s.push({text:e});let a=await i.models.generateContent({model:o,contents:{parts:s},config:{imageConfig:{aspectRatio:n.aspectRatio||"1:1",imageSize:n.resolution||"1K"}}}),l=[];if(a.candidates?.[0]?.content?.parts)for(let e of a.candidates[0].content.parts)e.inlineData?.data&&l.push(`data:${e.inlineData.mimeType||"image/png"};base64,${e.inlineData.data}`);return l},n0=async(e,t,r)=>{let n=nz();if(!n)throw Error("Video Analysis requires a configured API Key in Settings.");let i=e.match(/^data:(video\/\w+);base64,/)?.[1]||"video/mp4";return(await n.models.generateContent({model:r||"gemini-3-flash-preview",contents:{parts:[{inlineData:{mimeType:i,data:nW(e)}},{text:t}]}})).text||""},n1=async(e,t,r)=>{let n=nz();if(!n)return await nq(e,t);let i=`
    Role: Professional Screenwriter & World Builder.
    Task: Create a comprehensive script package based on the user's story idea/theme.
    
    Input Story/Theme: """${e}"""
    User Requirements: """${t}"""
    
    Output Format (Strictly follow this structure):
    1. **World View & Setting**: Describe the rules, atmosphere, time period, and location.
    2. **Core Values & Themes**: The central message or philosophical conflict.
    3. **Character Profiles**:
       - Name, Age, Role
       - Personality & Backstory
       - Visual Features (for casting/generation)
    4. **Scene Breakdown**:
       - Write key scenes in standard screenplay format (Slugline, Action, Dialogue).
       - Ensure scenes are descriptive enough to be split into individual storyboard shots later.
    
    Tone: Professional, cinematic, and ready for production.
    `,o=r||"gemini-3-pro-preview",s=o.includes("pro");return(await n.models.generateContent({model:o,contents:i,config:s?{thinkingConfig:{thinkingBudget:16e3}}:void 0})).text||""},n2=async(e,t,r,n)=>{let i=nz();if(!i)return await nB(e,t,r);let o=`
    Role: Expert Script Doctor & Adaptation Specialist.
    Task: Analyze the input text (novel/script) and rewrite/adapt it based on instructions.
    
    Input Text: """${e}"""
    ${t?`Reference Video Analysis: """${t}"""`:""}
    User Instructions: """${r}"""
    
    Process:
    1. **Analyze**: Understand the narrative arc, pacing, character motivations, and subtext of the input.
    2. **Adapt/Rewrite**: Rewrite the content into a polished Shooting Script format.
    3. **Visual Optimization**: Enhance visual descriptions in the Action lines to aid future visual generation.
    
    Output:
    - Provide the adapted script in standard format.
    - If requested, include notes on why specific changes were made (e.g., "Compressed dialogue for better pacing").
    `,s=n||"gemini-3-pro-preview",a=s.includes("pro");return(await i.models.generateContent({model:s,contents:o,config:a?{thinkingConfig:{thinkingBudget:32e3}}:void 0})).text||""},n4=async(e,t)=>{let r=nz();if(!r)return await nH(e);let n=`
    Role: Visionary Visual Director & Cinematographer.
    Task: Translate the script/scene description into a precise, high-fidelity visual prompt optimized for AI image generation.
    
    Input Script/Scene: """${e}"""
    
    Output Format:
    Please provide a cohesive, descriptive paragraph that integrates the following elements naturally:
    
    1. **Subject & Action**: What is happening, who is there.
    2. **Camera Language**: Shot type (Wide, Close-up), Angle (Low, High), Movement.
    3. **Lighting & Atmosphere**: Time of day, light source, mood (Cinematic, Ethereal, Gritty).
    4. **Art Direction**: Style (Photorealistic, Cyberpunk, Oil Painting), Color Palette.
    
    IMPORTANT: 
    - Output ONLY the final prompt text. 
    - Do not use markdown headers or bullet points. 
    - Write it as a single, rich, descriptive block of text that I can directly paste into an image generator.
    `;return(await r.models.generateContent({model:t||"gemini-3-pro-preview",contents:n})).text||""},n5=async(e,t,r)=>{let n=nz();if(!n)throw Error("Chat requires a configured API Key in Settings.");let i=r?.model||(r?.isThinkingMode?"gemini-3-pro-preview":"gemini-3-flash-preview"),o=i.includes("pro"),s=n.chats.create({model:i,config:{systemInstruction:"You are InkAI, a helpful multimedia expert.",...o&&r?.isThinkingMode?{thinkingConfig:{thinkingBudget:16e3}}:{}},history:e});return(await s.sendMessage({message:t})).text||""},n3=async e=>{try{let t=await fetch(e),r=await t.blob();return new Promise((e,t)=>{let n=new FileReader;n.onload=t=>e(n.result),n.onerror=t,n.readAsDataURL(r)})}catch(e){return""}},n6=e=>new Promise((e,t)=>{e("")}),n8=async(e,t,r={})=>{let n=nz();if(!n)return await nV(e,t,r);let i=await n.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:[{parts:[{text:e}]}],config:{responseModalities:[I.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Puck"}}}}});return`data:audio/pcm;base64,${i.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data}`},n7=async e=>{let t=nz();return t?(await t.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:nW(e),mimeType:e.match(/^data:([^;]+);base64,/)?.[1]||"audio/mp3"}},{text:"Transcribe the audio."}]}})).text||"":await nU(e)},n9=async(e,t)=>{let r=nz();if(!r)throw Error("Live Session requires a configured API Key in Settings.");return r.live.connect({model:"gemini-2.5-flash-native-audio-preview-12-2025",callbacks:{onopen:()=>console.debug("Live session started"),onmessage:async t=>{let r=t.serverContent?.modelTurn?.parts?.[0]?.inlineData?.data;r&&e(r)},onclose:e=>t(),onerror:e=>{console.error("Live session error:",e),t()}},config:{responseModalities:[I.AUDIO]}})}},95214:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,o=l(e),s=o[0],a=o[1],c=new i((s+a)*3/4-a),u=0,d=a>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===a&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===a&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(function(e,t,n){for(var i,o=[],s=t;s<n;s+=3)o.push(r[(i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return o.join("")}(e,s,s+16383>a?a:s+16383));return 1===i?o.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&o.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),o.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=o.length;s<a;++s)r[s]=o[s],n[o.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},86156:function(e,t,r){var n;!function(i){"use strict";var o,s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,l=Math.floor,c="[BigNumber Error] ",u=c+"Number primitive has more than 15 significant digits: ",d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13];function p(e){var t=0|e;return e>0||e===t?t:t-1}function h(e){for(var t,r,n=1,i=e.length,o=e[0]+"";n<i;){for(r=14-(t=e[n++]+"").length;r--;t="0"+t);o+=t}for(i=o.length;48===o.charCodeAt(--i););return o.slice(0,i+1||1)}function f(e,t){var r,n,i=e.c,o=t.c,s=e.s,a=t.s,l=e.e,c=t.e;if(!s||!a)return null;if(r=i&&!i[0],n=o&&!o[0],r||n)return r?n?0:-a:s;if(s!=a)return s;if(r=s<0,n=l==c,!i||!o)return n?0:!i^r?1:-1;if(!n)return l>c^r?1:-1;for(s=0,a=(l=i.length)<(c=o.length)?l:c;s<a;s++)if(i[s]!=o[s])return i[s]>o[s]^r?1:-1;return l==c?0:l>c^r?1:-1}function m(e,t,r,n){if(e<t||e>r||e!==l(e))throw Error(c+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function g(e){var t=e.c.length-1;return p(e.e/14)==t&&e.c[t]%2!=0}function y(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function v(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(n=e.length,++t>n){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}(o=function e(t){var r,n,i,o,b,_,E,w,x,S=L.prototype={constructor:L,toString:null,valueOf:null},T=new L(1),A=20,C=4,O=-7,I=21,N=-1e7,k=1e7,R=!1,P=1,j=0,M={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xa0",suffix:""},D="0123456789abcdefghijklmnopqrstuvwxyz",U=!0;function L(e,t){var r,n,i,o,a,c,d,p,h=this;if(!(h instanceof L))return new L(e,t);if(null==t){if(e&&!0===e._isBigNumber){h.s=e.s,!e.c||e.e>k?h.c=h.e=null:e.e<N?h.c=[h.e=0]:(h.e=e.e,h.c=e.c.slice());return}if((c="number"==typeof e)&&0*e==0){if(h.s=1/e<0?(e=-e,-1):1,e===~~e){for(o=0,a=e;a>=10;a/=10,o++);o>k?h.c=h.e=null:(h.e=o,h.c=[e]);return}p=String(e)}else{if(!s.test(p=String(e)))return x(h,p,c);h.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(o=p.indexOf("."))>-1&&(p=p.replace(".","")),(a=p.search(/e/i))>0?(o<0&&(o=a),o+=+p.slice(a+1),p=p.substring(0,a)):o<0&&(o=p.length)}else{if(m(t,2,D.length,"Base"),10==t&&U)return B(h=new L(e),A+h.e+1,C);if(p=String(e),c="number"==typeof e){if(0*e!=0)return x(h,p,c,t);if(h.s=1/e<0?(p=p.slice(1),-1):1,L.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(u+e)}else h.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(r=D.slice(0,t),o=a=0,d=p.length;a<d;a++)if(0>r.indexOf(n=p.charAt(a))){if("."==n){if(a>o){o=d;continue}}else if(!i&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){i=!0,a=-1,o=0;continue}return x(h,String(e),c,t)}c=!1,(o=(p=w(p,t,10,h.s)).indexOf("."))>-1?p=p.replace(".",""):o=p.length}for(a=0;48===p.charCodeAt(a);a++);for(d=p.length;48===p.charCodeAt(--d););if(p=p.slice(a,++d)){if(d-=a,c&&L.DEBUG&&d>15&&(e>9007199254740991||e!==l(e)))throw Error(u+h.s*e);if((o=o-a-1)>k)h.c=h.e=null;else if(o<N)h.c=[h.e=0];else{if(h.e=o,h.c=[],a=(o+1)%14,o<0&&(a+=14),a<d){for(a&&h.c.push(+p.slice(0,a)),d-=14;a<d;)h.c.push(+p.slice(a,a+=14));a=14-(p=p.slice(a)).length}else a-=d;for(;a--;p+="0");h.c.push(+p)}}else h.c=[h.e=0]}function G(e,t,r,n){var i,o,s,a,l;if(null==r?r=C:m(r,0,8),!e.c)return e.toString();if(i=e.c[0],s=e.e,null==t)l=h(e.c),l=1==n||2==n&&(s<=O||s>=I)?y(l,s):v(l,s,"0");else if(o=(e=B(new L(e),t,r)).e,a=(l=h(e.c)).length,1==n||2==n&&(t<=o||o<=O)){for(;a<t;l+="0",a++);l=y(l,o)}else if(t-=s+(2===n&&o>s),l=v(l,o,"0"),o+1>a){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=o-a)>0)for(o+1==a&&(l+=".");t--;l+="0");return e.s<0&&i?"-"+l:l}function F(e,t){for(var r,n,i=1,o=new L(e[0]);i<e.length;i++)(n=new L(e[i])).s&&(r=f(o,n))!==t&&(0!==r||o.s!==t)||(o=n);return o}function q(e,t,r){for(var n=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,n++);return(r=n+14*r-1)>k?e.c=e.e=null:r<N?e.c=[e.e=0]:(e.e=r,e.c=t),e}function B(e,t,r,n){var i,o,s,c,u,p,h,f=e.c;if(f){e:{for(i=1,c=f[0];c>=10;c/=10,i++);if((o=t-i)<0)o+=14,s=t,h=l((u=f[p=0])/d[i-s-1]%10);else if((p=a((o+1)/14))>=f.length){if(n){for(;f.length<=p;f.push(0));u=h=0,i=1,o%=14,s=o-14+1}else break e}else{for(i=1,u=c=f[p];c>=10;c/=10,i++);o%=14,h=(s=o-14+i)<0?0:l(u/d[i-s-1]%10)}if(n=n||t<0||null!=f[p+1]||(s<0?u:u%d[i-s-1]),n=r<4?(h||n)&&(0==r||r==(e.s<0?3:2)):h>5||5==h&&(4==r||n||6==r&&(o>0?s>0?u/d[i-s]:0:f[p-1])%10&1||r==(e.s<0?8:7)),t<1||!f[0])return f.length=0,n?(t-=e.e+1,f[0]=d[(14-t%14)%14],e.e=-t||0):f[0]=e.e=0,e;if(0==o?(f.length=p,c=1,p--):(f.length=p+1,c=d[14-o],f[p]=s>0?l(u/d[i-s]%d[s])*c:0),n)for(;;){if(0==p){for(o=1,s=f[0];s>=10;s/=10,o++);for(s=f[0]+=c,c=1;s>=10;s/=10,c++);o!=c&&(e.e++,1e14==f[0]&&(f[0]=1));break}if(f[p]+=c,1e14!=f[p])break;f[p--]=0,c=1}for(o=f.length;0===f[--o];f.pop());}e.e>k?e.c=e.e=null:e.e<N&&(e.c=[e.e=0])}return e}function H(e){var t,r=e.e;return null===r?e.toString():(t=h(e.c),t=r<=O||r>=I?y(t,r):v(t,r,"0"),e.s<0?"-"+t:t)}return L.clone=e,L.ROUND_UP=0,L.ROUND_DOWN=1,L.ROUND_CEIL=2,L.ROUND_FLOOR=3,L.ROUND_HALF_UP=4,L.ROUND_HALF_DOWN=5,L.ROUND_HALF_EVEN=6,L.ROUND_HALF_CEIL=7,L.ROUND_HALF_FLOOR=8,L.EUCLID=9,L.config=L.set=function(e){var t,r;if(null!=e){if("object"==typeof e){if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(m(r=e[t],0,1e9,t),A=r),e.hasOwnProperty(t="ROUNDING_MODE")&&(m(r=e[t],0,8,t),C=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?(m(r[0],-1e9,0,t),m(r[1],0,1e9,t),O=r[0],I=r[1]):(m(r,-1e9,1e9,t),O=-(I=r<0?-r:r))),e.hasOwnProperty(t="RANGE")){if((r=e[t])&&r.pop)m(r[0],-1e9,-1,t),m(r[1],1,1e9,t),N=r[0],k=r[1];else if(m(r,-1e9,1e9,t),r)N=-(k=r<0?-r:r);else throw Error(c+t+" cannot be zero: "+r)}if(e.hasOwnProperty(t="CRYPTO")){if(!!(r=e[t])===r){if(r){if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))R=r;else throw R=!r,Error(c+"crypto unavailable")}else R=r}else throw Error(c+t+" not true or false: "+r)}if(e.hasOwnProperty(t="MODULO_MODE")&&(m(r=e[t],0,9,t),P=r),e.hasOwnProperty(t="POW_PRECISION")&&(m(r=e[t],0,1e9,t),j=r),e.hasOwnProperty(t="FORMAT")){if("object"==typeof(r=e[t]))M=r;else throw Error(c+t+" not an object: "+r)}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(c+t+" invalid: "+r);U="0123456789"==r.slice(0,10),D=r}}else throw Error(c+"Object expected: "+e)}return{DECIMAL_PLACES:A,ROUNDING_MODE:C,EXPONENTIAL_AT:[O,I],RANGE:[N,k],CRYPTO:R,MODULO_MODE:P,POW_PRECISION:j,FORMAT:M,ALPHABET:D}},L.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!L.DEBUG)return!0;var t,r,n=e.c,i=e.e,o=e.s;e:if("[object Array]"==({}).toString.call(n)){if((1===o||-1===o)&&i>=-1e9&&i<=1e9&&i===l(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break e}if((t=(i+1)%14)<1&&(t+=14),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=1e14||r!==l(r))break e;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(c+"Invalid BigNumber: "+e)},L.maximum=L.max=function(){return F(arguments,-1)},L.minimum=L.min=function(){return F(arguments,1)},L.random=(r=9007199254740992*Math.random()&2097151?function(){return l(9007199254740992*Math.random())}:function(){return(1073741824*Math.random()|0)*8388608+(8388608*Math.random()|0)},function(e){var t,n,i,o,s,u=0,p=[],h=new L(T);if(null==e?e=A:m(e,0,1e9),o=a(e/14),R){if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(s=131072*t[u]+(t[u+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[u]=n[0],t[u+1]=n[1]):(p.push(s%1e14),u+=2);u=o/2}else if(crypto.randomBytes){for(t=crypto.randomBytes(o*=7);u<o;)(s=(31&t[u])*281474976710656+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(p.push(s%1e14),u+=7);u=o/7}else throw R=!1,Error(c+"crypto unavailable")}if(!R)for(;u<o;)(s=r())<9e15&&(p[u++]=s%1e14);for(o=p[--u],e%=14,o&&e&&(s=d[14-e],p[u]=l(o/s)*s);0===p[u];p.pop(),u--);if(u<0)p=[i=0];else{for(i=-1;0===p[0];p.splice(0,1),i-=14);for(u=1,s=p[0];s>=10;s/=10,u++);u<14&&(i-=14-u)}return h.e=i,h.c=p,h}),L.sum=function(){for(var e=1,t=arguments,r=new L(t[0]);e<t.length;)r=r.plus(t[e++]);return r},w=function(){var e="0123456789";function t(e,t,r,n){for(var i,o,s=[0],a=0,l=e.length;a<l;){for(o=s.length;o--;s[o]*=t);for(s[0]+=n.indexOf(e.charAt(a++)),i=0;i<s.length;i++)s[i]>r-1&&(null==s[i+1]&&(s[i+1]=0),s[i+1]+=s[i]/r|0,s[i]%=r)}return s.reverse()}return function(r,n,i,o,s){var a,l,c,u,d,p,f,m,g=r.indexOf("."),y=A,b=C;for(g>=0&&(u=j,j=0,r=r.replace(".",""),p=(m=new L(n)).pow(r.length-g),j=u,m.c=t(v(h(p.c),p.e,"0"),10,i,e),m.e=m.c.length),c=u=(f=t(r,n,i,s?(a=D,e):(a=e,D))).length;0==f[--u];f.pop());if(!f[0])return a.charAt(0);if(g<0?--c:(p.c=f,p.e=c,p.s=o,f=(p=E(p,m,y,b,i)).c,d=p.r,c=p.e),g=f[l=c+y+1],u=i/2,d=d||l<0||null!=f[l+1],d=b<4?(null!=g||d)&&(0==b||b==(p.s<0?3:2)):g>u||g==u&&(4==b||d||6==b&&1&f[l-1]||b==(p.s<0?8:7)),l<1||!f[0])r=d?v(a.charAt(1),-y,a.charAt(0)):a.charAt(0);else{if(f.length=l,d)for(--i;++f[--l]>i;)f[l]=0,l||(++c,f=[1].concat(f));for(u=f.length;!f[--u];);for(g=0,r="";g<=u;r+=a.charAt(f[g++]));r=v(r,c,a.charAt(0))}return r}}(),E=function(){function e(e,t,r){var n,i,o,s,a=0,l=e.length,c=t%1e7,u=t/1e7|0;for(e=e.slice();l--;)n=u*(o=e[l]%1e7)+(s=e[l]/1e7|0)*c,a=((i=c*o+n%1e7*1e7+a)/r|0)+(n/1e7|0)+u*s,e[l]=i%r;return a&&(e=[a].concat(e)),e}function t(e,t,r,n){var i,o;if(r!=n)o=r>n?1:-1;else for(i=o=0;i<r;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,i,o,s,a){var c,u,d,h,f,m,g,y,v,b,_,E,w,x,S,T,A,C=n.s==i.s?1:-1,O=n.c,I=i.c;if(!O||!O[0]||!I||!I[0])return new L(n.s&&i.s&&(O?!I||O[0]!=I[0]:I)?O&&0==O[0]||!I?0*C:C/0:NaN);for(v=(y=new L(C)).c=[],C=o+(u=n.e-i.e)+1,a||(a=1e14,u=p(n.e/14)-p(i.e/14),C=C/14|0),d=0;I[d]==(O[d]||0);d++);if(I[d]>(O[d]||0)&&u--,C<0)v.push(1),h=!0;else{for(x=O.length,T=I.length,d=0,C+=2,(f=l(a/(I[0]+1)))>1&&(I=e(I,f,a),O=e(O,f,a),T=I.length,x=O.length),w=T,_=(b=O.slice(0,T)).length;_<T;b[_++]=0);A=[0].concat(A=I.slice()),S=I[0],I[1]>=a/2&&S++;do{if(f=0,(c=t(I,b,T,_))<0){if(E=b[0],T!=_&&(E=E*a+(b[1]||0)),(f=l(E/S))>1)for(f>=a&&(f=a-1),g=(m=e(I,f,a)).length,_=b.length;1==t(m,b,g,_);)f--,r(m,T<g?A:I,g,a),g=m.length,c=1;else 0==f&&(c=f=1),g=(m=I.slice()).length;if(g<_&&(m=[0].concat(m)),r(b,m,_,a),_=b.length,-1==c)for(;1>t(I,b,T,_);)f++,r(b,T<_?A:I,_,a),_=b.length}else 0===c&&(f++,b=[0]);v[d++]=f,b[0]?b[_++]=O[w]||0:(b=[O[w]],_=1)}while((w++<x||null!=b[0])&&C--);h=null!=b[0],v[0]||v.splice(0,1)}if(1e14==a){for(d=1,C=v[0];C>=10;C/=10,d++);B(y,o+(y.e=d+14*u-1)+1,s,h)}else y.e=u,y.r=+h;return y}}(),n=/^(-?)0([xbo])(?=\w[\w.]*$)/i,i=/^([^.]+)\.$/,o=/^\.([^.]+)$/,b=/^-?(Infinity|NaN)$/,_=/^\s*\+(?=[\w.])|^\s+|\s+$/g,x=function(e,t,r,s){var a,l=r?t:t.replace(_,"");if(b.test(l))e.s=isNaN(l)?null:l<0?-1:1;else{if(!r&&(l=l.replace(n,function(e,t,r){return a="x"==(r=r.toLowerCase())?16:"b"==r?2:8,s&&s!=a?e:t}),s&&(a=s,l=l.replace(i,"$1").replace(o,"0.$1")),t!=l))return new L(l,a);if(L.DEBUG)throw Error(c+"Not a"+(s?" base "+s:"")+" number: "+t);e.s=null}e.c=e.e=null},S.absoluteValue=S.abs=function(){var e=new L(this);return e.s<0&&(e.s=1),e},S.comparedTo=function(e,t){return f(this,new L(e,t))},S.decimalPlaces=S.dp=function(e,t){var r,n,i;if(null!=e)return m(e,0,1e9),null==t?t=C:m(t,0,8),B(new L(this),e+this.e+1,t);if(!(r=this.c))return null;if(n=((i=r.length-1)-p(this.e/14))*14,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},S.dividedBy=S.div=function(e,t){return E(this,new L(e,t),A,C)},S.dividedToIntegerBy=S.idiv=function(e,t){return E(this,new L(e,t),0,1)},S.exponentiatedBy=S.pow=function(e,t){var r,n,i,o,s,u,d,p,h,f=this;if((e=new L(e)).c&&!e.isInteger())throw Error(c+"Exponent not an integer: "+H(e));if(null!=t&&(t=new L(t)),u=e.e>14,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return h=new L(Math.pow(+H(f),u?e.s*(2-g(e)):+H(e))),t?h.mod(t):h;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new L(NaN);(n=!d&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(e.e>9&&(f.e>0||f.e<-1||(0==f.e?f.c[0]>1||u&&f.c[1]>=24e7:f.c[0]<8e13||u&&f.c[0]<=9999975e7)))return o=f.s<0&&g(e)?-0:0,f.e>-1&&(o=1/o),new L(d?1/o:o);j&&(o=a(j/14+2))}for(u?(r=new L(.5),d&&(e.s=1),p=g(e)):p=(i=Math.abs(+H(e)))%2,h=new L(T);;){if(p){if(!(h=h.times(f)).c)break;o?h.c.length>o&&(h.c.length=o):n&&(h=h.mod(t))}if(i){if(0===(i=l(i/2)))break;p=i%2}else if(B(e=e.times(r),e.e+1,1),e.e>14)p=g(e);else{if(0==(i=+H(e)))break;p=i%2}f=f.times(f),o?f.c&&f.c.length>o&&(f.c.length=o):n&&(f=f.mod(t))}return n?h:(d&&(h=T.div(h)),t?h.mod(t):o?B(h,j,C,s):h)},S.integerValue=function(e){var t=new L(this);return null==e?e=C:m(e,0,8),B(t,t.e+1,e)},S.isEqualTo=S.eq=function(e,t){return 0===f(this,new L(e,t))},S.isFinite=function(){return!!this.c},S.isGreaterThan=S.gt=function(e,t){return f(this,new L(e,t))>0},S.isGreaterThanOrEqualTo=S.gte=function(e,t){return 1===(t=f(this,new L(e,t)))||0===t},S.isInteger=function(){return!!this.c&&p(this.e/14)>this.c.length-2},S.isLessThan=S.lt=function(e,t){return 0>f(this,new L(e,t))},S.isLessThanOrEqualTo=S.lte=function(e,t){return -1===(t=f(this,new L(e,t)))||0===t},S.isNaN=function(){return!this.s},S.isNegative=function(){return this.s<0},S.isPositive=function(){return this.s>0},S.isZero=function(){return!!this.c&&0==this.c[0]},S.minus=function(e,t){var r,n,i,o,s=this.s;if(t=(e=new L(e,t)).s,!s||!t)return new L(NaN);if(s!=t)return e.s=-t,this.plus(e);var a=this.e/14,l=e.e/14,c=this.c,u=e.c;if(!a||!l){if(!c||!u)return c?(e.s=-t,e):new L(u?this:NaN);if(!c[0]||!u[0])return u[0]?(e.s=-t,e):new L(c[0]?this:3==C?-0:0)}if(a=p(a),l=p(l),c=c.slice(),s=a-l){for((o=s<0)?(s=-s,i=c):(l=a,i=u),i.reverse(),t=s;t--;i.push(0));i.reverse()}else for(n=(o=(s=c.length)<(t=u.length))?s:t,s=t=0;t<n;t++)if(c[t]!=u[t]){o=c[t]<u[t];break}if(o&&(i=c,c=u,u=i,e.s=-e.s),(t=(n=u.length)-(r=c.length))>0)for(;t--;c[r++]=0);for(t=1e14-1;n>s;){if(c[--n]<u[n]){for(r=n;r&&!c[--r];c[r]=t);--c[r],c[n]+=1e14}c[n]-=u[n]}for(;0==c[0];c.splice(0,1),--l);return c[0]?q(e,c,l):(e.s=3==C?-1:1,e.c=[e.e=0],e)},S.modulo=S.mod=function(e,t){var r,n;return(e=new L(e,t),this.c&&e.s&&(!e.c||e.c[0]))?e.c&&(!this.c||this.c[0])?(9==P?(n=e.s,e.s=1,r=E(this,e,0,3),e.s=n,r.s*=n):r=E(this,e,0,P),(e=this.minus(r.times(e))).c[0]||1!=P||(e.s=this.s),e):new L(this):new L(NaN)},S.multipliedBy=S.times=function(e,t){var r,n,i,o,s,a,l,c,u,d,h,f,m,g=this.c,y=(e=new L(e,t)).c;if(!g||!y||!g[0]||!y[0])return this.s&&e.s&&(!g||g[0]||y)&&(!y||y[0]||g)?(e.s*=this.s,g&&y?(e.c=[0],e.e=0):e.c=e.e=null):e.c=e.e=e.s=null,e;for(n=p(this.e/14)+p(e.e/14),e.s*=this.s,(l=g.length)<(d=y.length)&&(m=g,g=y,y=m,i=l,l=d,d=i),i=l+d,m=[];i--;m.push(0));for(i=d;--i>=0;){for(r=0,h=y[i]%1e7,f=y[i]/1e7|0,o=i+(s=l);o>i;)a=f*(c=g[--s]%1e7)+(u=g[s]/1e7|0)*h,r=((c=h*c+a%1e7*1e7+m[o]+r)/1e14|0)+(a/1e7|0)+f*u,m[o--]=c%1e14;m[o]=r}return r?++n:m.splice(0,1),q(e,m,n)},S.negated=function(){var e=new L(this);return e.s=-e.s||null,e},S.plus=function(e,t){var r,n=this.s;if(t=(e=new L(e,t)).s,!n||!t)return new L(NaN);if(n!=t)return e.s=-t,this.minus(e);var i=this.e/14,o=e.e/14,s=this.c,a=e.c;if(!i||!o){if(!s||!a)return new L(n/0);if(!s[0]||!a[0])return a[0]?e:new L(s[0]?this:0*n)}if(i=p(i),o=p(o),s=s.slice(),n=i-o){for(n>0?(o=i,r=a):(n=-n,r=s),r.reverse();n--;r.push(0));r.reverse()}for((n=s.length)-(t=a.length)<0&&(r=a,a=s,s=r,t=n),n=0;t;)n=(s[--t]=s[t]+a[t]+n)/1e14|0,s[t]=1e14===s[t]?0:s[t]%1e14;return n&&(s=[n].concat(s),++o),q(e,s,o)},S.precision=S.sd=function(e,t){var r,n,i;if(null!=e&&!!e!==e)return m(e,1,1e9),null==t?t=C:m(t,0,8),B(new L(this),e,t);if(!(r=this.c))return null;if(n=14*(i=r.length-1)+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return e&&this.e+1>n&&(n=this.e+1),n},S.shiftedBy=function(e){return m(e,-9007199254740991,9007199254740991),this.times("1e"+e)},S.squareRoot=S.sqrt=function(){var e,t,r,n,i,o=this.c,s=this.s,a=this.e,l=A+4,c=new L("0.5");if(1!==s||!o||!o[0])return new L(!s||s<0&&(!o||o[0])?NaN:o?this:1/0);if(0==(s=Math.sqrt(+H(this)))||s==1/0?(((t=h(o)).length+a)%2==0&&(t+="0"),s=Math.sqrt(+t),a=p((a+1)/2)-(a<0||a%2),r=new L(t=s==1/0?"5e"+a:(t=s.toExponential()).slice(0,t.indexOf("e")+1)+a)):r=new L(s+""),r.c[0]){for((s=(a=r.e)+l)<3&&(s=0);;)if(i=r,r=c.times(i.plus(E(this,i,l,1))),h(i.c).slice(0,s)===(t=h(r.c)).slice(0,s)){if(r.e<a&&--s,"9999"!=(t=t.slice(s-3,s+1))&&(n||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(B(r,r.e+A+2,1),e=!r.times(r).eq(this));break}if(!n&&(B(i,i.e+A+2,0),i.times(i).eq(this))){r=i;break}l+=4,s+=4,n=1}}return B(r,r.e+A+1,C,e)},S.toExponential=function(e,t){return null!=e&&(m(e,0,1e9),e++),G(this,e,t,1)},S.toFixed=function(e,t){return null!=e&&(m(e,0,1e9),e=e+this.e+1),G(this,e,t)},S.toFormat=function(e,t,r){var n;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=M;else if("object"!=typeof r)throw Error(c+"Argument not an object: "+r);if(n=this.toFixed(e,t),this.c){var i,o=n.split("."),s=+r.groupSize,a=+r.secondaryGroupSize,l=r.groupSeparator||"",u=o[0],d=o[1],p=this.s<0,h=p?u.slice(1):u,f=h.length;if(a&&(i=s,s=a,a=i,f-=i),s>0&&f>0){for(i=f%s||s,u=h.substr(0,i);i<f;i+=s)u+=l+h.substr(i,s);a>0&&(u+=l+h.slice(i)),p&&(u="-"+u)}n=d?u+(r.decimalSeparator||"")+((a=+r.fractionGroupSize)?d.replace(RegExp("\\d{"+a+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):d):u}return(r.prefix||"")+n+(r.suffix||"")},S.toFraction=function(e){var t,r,n,i,o,s,a,l,u,p,f,m,g=this.c;if(null!=e&&(!(a=new L(e)).isInteger()&&(a.c||1!==a.s)||a.lt(T)))throw Error(c+"Argument "+(a.isInteger()?"out of range: ":"not an integer: ")+H(a));if(!g)return new L(this);for(t=new L(T),u=r=new L(T),n=l=new L(T),m=h(g),o=t.e=m.length-this.e-1,t.c[0]=d[(s=o%14)<0?14+s:s],e=!e||a.comparedTo(t)>0?o>0?t:u:a,s=k,k=1/0,a=new L(m),l.c[0]=0;p=E(a,t,0,1),1!=(i=r.plus(p.times(n))).comparedTo(e);)r=n,n=i,u=l.plus(p.times(i=u)),l=i,t=a.minus(p.times(i=t)),a=i;return i=E(e.minus(r),n,0,1),l=l.plus(i.times(u)),r=r.plus(i.times(n)),l.s=u.s=this.s,o*=2,f=1>E(u,n,o,C).minus(this).abs().comparedTo(E(l,r,o,C).minus(this).abs())?[u,n]:[l,r],k=s,f},S.toNumber=function(){return+H(this)},S.toPrecision=function(e,t){return null!=e&&m(e,1,1e9),G(this,e,t,2)},S.toString=function(e){var t,r=this,n=r.s,i=r.e;return null===i?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=i<=O||i>=I?y(h(r.c),i):v(h(r.c),i,"0"):10===e&&U?t=v(h((r=B(new L(r),A+i+1,C)).c),r.e,"0"):(m(e,2,D.length,"Base"),t=w(v(h(r.c),i,"0"),10,e,n,!0)),n<0&&r.c[0]&&(t="-"+t)),t},S.valueOf=S.toJSON=function(){return H(this)},S._isBigNumber=!0,null!=t&&L.set(t),L}()).default=o.BigNumber=o,void 0!==(n=(function(){return o}).call(t,r,t,e))&&(e.exports=n)}(0)},6073:(e,t,r)=>{"use strict";var n=r(14300).Buffer,i=r(14300).SlowBuffer;function o(e,t){if(!n.isBuffer(e)||!n.isBuffer(t)||e.length!==t.length)return!1;for(var r=0,i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r}e.exports=o,o.install=function(){n.prototype.equal=i.prototype.equal=function(e){return o(this,e)}};var s=n.prototype.equal,a=i.prototype.equal;o.restore=function(){n.prototype.equal=s,i.prototype.equal=a}},88633:(e,t,r)=>{"use strict";var n=r(16496).Buffer,i=r(35521);function o(e){if(n.isBuffer(e))return e;if("string"==typeof e)return n.from(e,"base64");throw TypeError("ECDSA signature must be a Base64 string or a Buffer")}function s(e,t,r){for(var n=0;t+n<r&&0===e[t+n];)++n;return e[t+n]>=128&&--n,n}e.exports={derToJose:function(e,t){e=o(e);var r=i(t),s=r+1,a=e.length,l=0;if(48!==e[l++])throw Error('Could not find expected "seq"');var c=e[l++];if(129===c&&(c=e[l++]),a-l<c)throw Error('"seq" specified length of "'+c+'", only "'+(a-l)+'" remaining');if(2!==e[l++])throw Error('Could not find expected "int" for "r"');var u=e[l++];if(a-l-2<u)throw Error('"r" specified length of "'+u+'", only "'+(a-l-2)+'" available');if(s<u)throw Error('"r" specified length of "'+u+'", max of "'+s+'" is acceptable');var d=l;if(l+=u,2!==e[l++])throw Error('Could not find expected "int" for "s"');var p=e[l++];if(a-l!==p)throw Error('"s" specified length of "'+p+'", expected "'+(a-l)+'"');if(s<p)throw Error('"s" specified length of "'+p+'", max of "'+s+'" is acceptable');var h=l;if((l+=p)!==a)throw Error('Expected to consume entire buffer, but "'+(a-l)+'" bytes remain');var f=r-u,m=r-p,g=n.allocUnsafe(f+u+m+p);for(l=0;l<f;++l)g[l]=0;e.copy(g,l,d+Math.max(-f,0),d+u),l=r;for(var y=l;l<y+m;++l)g[l]=0;return e.copy(g,l,h+Math.max(-m,0),h+p),g=(g=g.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,t){e=o(e);var r=i(t),a=e.length;if(a!==2*r)throw TypeError('"'+t+'" signatures must be "'+2*r+'" bytes, saw "'+a+'"');var l=s(e,0,r),c=s(e,r,e.length),u=r-l,d=r-c,p=2+u+1+1+d,h=p<128,f=n.allocUnsafe((h?2:3)+p),m=0;return f[m++]=48,h?f[m++]=p:(f[m++]=129,f[m++]=255&p),f[m++]=2,f[m++]=u,l<0?(f[m++]=0,m+=e.copy(f,m,0,r)):m+=e.copy(f,m,l,r),f[m++]=2,f[m++]=d,c<0?(f[m++]=0,e.copy(f,m,r)):e.copy(f,m,r+c),f}}},35521:e=>{"use strict";function t(e){return(e/8|0)+(e%8==0?0:1)}var r={ES256:t(256),ES384:t(384),ES512:t(521)};e.exports=function(e){var t=r[e];if(t)return t;throw Error('Unknown algorithm "'+e+'"')}},62200:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===r.call(e)},s=function(e){if(!e||"[object Object]"!==r.call(e))return!1;var n,i=t.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&t.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!i&&!o)return!1;for(n in e);return void 0===n||t.call(e,n)},a=function(e,t){n&&"__proto__"===t.name?n(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},l=function(e,r){if("__proto__"===r){if(!t.call(e,r))return;if(i)return i(e,r).value}return e[r]};e.exports=function e(){var t,r,n,i,c,u,d=arguments[0],p=1,h=arguments.length,f=!1;for("boolean"==typeof d&&(f=d,d=arguments[1]||{},p=2),(null==d||"object"!=typeof d&&"function"!=typeof d)&&(d={});p<h;++p)if(t=arguments[p],null!=t)for(r in t)n=l(d,r),d!==(i=l(t,r))&&(f&&i&&(s(i)||(c=o(i)))?(c?(c=!1,u=n&&o(n)?n:[]):u=n&&s(n)?n:{},a(d,{name:r,newValue:e(f,u,i)})):void 0!==i&&a(d,{name:r,newValue:i}));return d}},87357:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosError=t.GAXIOS_ERROR_SYMBOL=void 0,t.defaultErrorRedactor=function e(t){let r="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function n(e){e&&e.forEach((t,n)=>{(/^authentication$/i.test(n)||/^authorization$/i.test(n)||/secret/i.test(n))&&e.set(n,r)})}function i(e,t){if("object"==typeof e&&null!==e&&"string"==typeof e[t]){let n=e[t];(/grant_type=/i.test(n)||/assertion=/i.test(n)||/secret/i.test(n))&&(e[t]=r)}}function o(e){e&&"object"==typeof e&&(e instanceof FormData||e instanceof URLSearchParams||"forEach"in e&&"set"in e?e.forEach((t,n)=>{(["grant_type","assertion"].includes(n)||/secret/.test(n))&&e.set(n,r)}):("grant_type"in e&&(e.grant_type=r),"assertion"in e&&(e.assertion=r),"client_secret"in e&&(e.client_secret=r)))}return t.config&&(n(t.config.headers),i(t.config,"data"),o(t.config.data),i(t.config,"body"),o(t.config.body),t.config.url.searchParams.has("token")&&t.config.url.searchParams.set("token",r),t.config.url.searchParams.has("client_secret")&&t.config.url.searchParams.set("client_secret",r)),t.response&&(e({config:t.response.config}),n(t.response.headers),t.response.bodyUsed&&(i(t.response,"data"),o(t.response.data))),t};let i=n(r(62200)),o=n(r(56647)).default.pkg;t.GAXIOS_ERROR_SYMBOL=Symbol.for(`${o.name}-gaxios-error`);class s extends Error{config;response;code;status;error;[t.GAXIOS_ERROR_SYMBOL]=o.version;static[Symbol.hasInstance](e){return!!e&&"object"==typeof e&&t.GAXIOS_ERROR_SYMBOL in e&&e[t.GAXIOS_ERROR_SYMBOL]===o.version||Function.prototype[Symbol.hasInstance].call(s,e)}constructor(e,t,r,n){if(super(e,{cause:n}),this.config=t,this.response=r,this.error=n instanceof Error?n:void 0,this.config=(0,i.default)(!0,{},t),this.response&&(this.response.config=(0,i.default)(!0,{},this.response.config)),this.response){try{this.response.data=function(e,t){switch(e){case"stream":default:return t;case"json":return JSON.parse(JSON.stringify(t));case"arraybuffer":return JSON.parse(Buffer.from(t).toString("utf8"));case"blob":return JSON.parse(t.text())}}(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}n instanceof DOMException?this.code=n.name:n&&"object"==typeof n&&"code"in n&&("string"==typeof n.code||"number"==typeof n.code)&&(this.code=n.code)}static extractAPIErrorFromResponse(e,t="The request failed"){let r=t;if("string"==typeof e.data&&(r=e.data),e.data&&"object"==typeof e.data&&"error"in e.data&&e.data.error&&!e.ok){if("string"==typeof e.data.error)return{message:e.data.error,code:e.status,status:e.statusText};if("object"==typeof e.data.error){r="message"in e.data.error&&"string"==typeof e.data.error.message?e.data.error.message:r;let t="status"in e.data.error&&"string"==typeof e.data.error.status?e.data.error.status:e.statusText,n="code"in e.data.error&&"number"==typeof e.data.error.code?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let i=[];for(let t of e.data.error.errors)"object"==typeof t&&"message"in t&&"string"==typeof t.message&&i.push(t.message);return Object.assign({message:i.join("\n")||r,code:n,status:t},e.data.error)}return Object.assign({message:r,code:n,status:t},e.data.error)}}return{message:r,code:e.status,status:e.statusText}}}t.GaxiosError=s},59226:function(e,t,r){"use strict";var n,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Gaxios=void 0;let o=i(r(62200)),s=r(95687),a=r(87357),l=r(1369),c=r(12781),u=r(87379),d=async()=>globalThis.crypto?.randomUUID()||(await Promise.resolve().then(r.t.bind(r,6113,23))).randomUUID();class p{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new u.GaxiosInterceptorManager,response:new u.GaxiosInterceptorManager}}fetch(...e){let t;let r=e[0],i=e[1],o=new Headers;return("string"==typeof r?t=new URL(r):r instanceof URL?t=r:r&&r.url&&(t=new URL(r.url)),r&&"object"==typeof r&&"headers"in r&&n.mergeHeaders(o,r.headers),i&&n.mergeHeaders(o,new Headers(i.headers)),"object"!=typeof r||r instanceof URL)?this.request({...i,headers:o,url:t}):this.request({...i,...r,headers:o,url:t})}async request(e={}){let t=await this.#e(e);return t=await this.#t(t),this.#r(this._request(t))}async _defaultAdapter(e){let t=e.fetchImplementation||this.defaults.fetchImplementation||await n.#n(),r={...e};delete r.data;let i=await t(e.url,r),o=await this.getResponseData(e,i);return Object.getOwnPropertyDescriptor(i,"data")?.configurable||Object.defineProperties(i,{data:{configurable:!0,writable:!0,enumerable:!0,value:o}}),Object.assign(i,{config:e,data:o})}async _request(e){try{let t;if(t=e.adapter?await e.adapter(e,this._defaultAdapter.bind(this)):await this._defaultAdapter(e),!e.validateStatus(t.status)){if("stream"===e.responseType){let e=[];for await(let r of t.data)e.push(r);t.data=e.toString()}let r=a.GaxiosError.extractAPIErrorFromResponse(t,`Request failed with status code ${t.status}`);throw new a.GaxiosError(r?.message,e,t,r)}return t}catch(i){let t;t=i instanceof a.GaxiosError?i:i instanceof Error?new a.GaxiosError(i.message,e,void 0,i):new a.GaxiosError("Unexpected Gaxios Error",e,void 0,i);let{shouldRetry:r,config:n}=await (0,l.getRetryConfig)(t);if(r&&n)return t.config.retryConfig.currentRetryAttempt=n.retryConfig.currentRetryAttempt,e.retryConfig=t.config?.retryConfig,this.#i(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(t),t}}async getResponseData(e,t){if(204===t.status)return"";if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(t.headers?.get("content-length")||""))throw new a.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":{let e=await t.text();try{return JSON.parse(e)}catch{return e}}case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}#o(e,t=[]){let r=new URL(e),n=[...t];for(let e of(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[])n.push(e.trim());for(let e of n)if(e instanceof RegExp){if(e.test(r.toString()))return!1}else if(e instanceof URL){if(e.origin===r.origin)return!1}else if(e.startsWith("*.")||e.startsWith(".")){let t=e.replace(/^\*\./,".");if(r.hostname.endsWith(t))return!1}else if(e===r.origin||e===r.hostname||e===r.href)return!1;return!0}async #t(e){let t=Promise.resolve(e);for(let e of this.interceptors.request.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #r(e){let t=Promise.resolve(e);for(let e of this.interceptors.response.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #e(e){let t=new Headers(this.defaults.headers);n.mergeHeaders(t,e.headers);let r=(0,o.default)(!0,{},this.defaults,e);if(!r.url)throw Error("URL is required.");if(r.baseURL&&(r.url=new URL(r.url,r.baseURL)),r.url=new URL(r.url),r.params){if(r.paramsSerializer){let e=r.paramsSerializer(r.params);e.startsWith("?")&&(e=e.slice(1));let t=r.url.toString().includes("?")?"&":"?";r.url=r.url+t+e}else{let e=r.url instanceof URL?r.url:new URL(r.url);for(let[t,n]of new URLSearchParams(r.params))e.searchParams.append(t,n);r.url=e}}"number"==typeof e.maxContentLength&&(r.size=e.maxContentLength),"number"==typeof e.maxRedirects&&(r.follow=e.maxRedirects);let i="string"==typeof r.data||r.data instanceof ArrayBuffer||r.data instanceof Blob||globalThis.File&&r.data instanceof File||r.data instanceof FormData||r.data instanceof c.Readable||r.data instanceof ReadableStream||r.data instanceof String||r.data instanceof URLSearchParams||ArrayBuffer.isView(r.data)||["Blob","File","FormData"].includes(r.data?.constructor?.name||"");if(r.multipart?.length){let e=await d();t.set("content-type",`multipart/related; boundary=${e}`),r.body=c.Readable.from(this.getMultipartRequest(r.multipart,e))}else i?r.body=r.data:"object"==typeof r.data?"application/x-www-form-urlencoded"===t.get("Content-Type")?r.body=r.paramsSerializer?r.paramsSerializer(r.data):new URLSearchParams(r.data):(t.has("content-type")||t.set("content-type","application/json"),r.body=JSON.stringify(r.data)):r.data&&(r.body=r.data);r.validateStatus=r.validateStatus||this.validateStatus,r.responseType=r.responseType||"unknown",t.has("accept")||"json"!==r.responseType||t.set("accept","application/json");let l=r.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(r.agent);else if(l&&this.#o(r.url,r.noProxy)){let e=await n.#s();this.agentCache.has(l)?r.agent=this.agentCache.get(l):(r.agent=new e(l,{cert:r.cert,key:r.key}),this.agentCache.set(l,r.agent))}else r.cert&&r.key&&(this.agentCache.has(r.key)?r.agent=this.agentCache.get(r.key):(r.agent=new s.Agent({cert:r.cert,key:r.key}),this.agentCache.set(r.key,r.agent)));return"function"!=typeof r.errorRedactor&&!1!==r.errorRedactor&&(r.errorRedactor=a.defaultErrorRedactor),!r.body||"duplex"in r||(r.duplex="half"),this.#i(r),Object.assign(r,{headers:t,url:r.url instanceof URL?r.url:new URL(r.url)})}#i(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(null===t)return e.text();if((t=t.toLowerCase()).includes("application/json")){let t=await e.text();try{t=JSON.parse(t)}catch{}return t}return t.match(/^text\//)?e.text():e.blob()}async *getMultipartRequest(e,t){let r=`--${t}--`;for(let r of e){let e=r.headers.get("Content-Type")||"application/octet-stream",n=`--${t}\r
Content-Type: ${e}\r
\r
`;yield n,"string"==typeof r.content?yield r.content:yield*r.content,yield"\r\n"}yield r}static #a;static #l;static async #s(){return this.#a||=(await r.e(173).then(r.t.bind(r,38173,23))).HttpsProxyAgent,this.#a}static async #n(){let e="undefined"!=typeof window&&!!window;return this.#l||=e?window.fetch:(await r.e(673).then(r.bind(r,16673))).default,this.#l}static mergeHeaders(e,...t){for(let r of(e=e instanceof Headers?e:new Headers(e),t))(r instanceof Headers?r:new Headers(r)).forEach((t,r)=>{"set-cookie"===r?e.append(r,t):e.set(r,t)});return e}}t.Gaxios=p,n=p},71903:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.instance=t.Gaxios=t.GaxiosError=void 0,t.request=a;let o=r(59226);Object.defineProperty(t,"Gaxios",{enumerable:!0,get:function(){return o.Gaxios}});var s=r(87357);async function a(e){return t.instance.request(e)}Object.defineProperty(t,"GaxiosError",{enumerable:!0,get:function(){return s.GaxiosError}}),i(r(87379),t),t.instance=new o.Gaxios},87379:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosInterceptorManager=void 0;class r extends Set{}t.GaxiosInterceptorManager=r},1369:(e,t)=>{"use strict";async function r(e){var t;let r=i(e);if(!e||!e.config||!r&&!e.config.retry)return{shouldRetry:!1};(r=r||{}).currentRetryAttempt=r.currentRetryAttempt||0,r.retry=void 0===r.retry||null===r.retry?3:r.retry,r.httpMethodsToRetry=r.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],r.noResponseRetries=void 0===r.noResponseRetries||null===r.noResponseRetries?2:r.noResponseRetries,r.retryDelayMultiplier=r.retryDelayMultiplier?r.retryDelayMultiplier:2,r.timeOfFirstRequest=r.timeOfFirstRequest?r.timeOfFirstRequest:Date.now(),r.totalTimeout=r.totalTimeout?r.totalTimeout:Number.MAX_SAFE_INTEGER,r.maxRetryDelay=r.maxRetryDelay?r.maxRetryDelay:Number.MAX_SAFE_INTEGER,r.statusCodesToRetry=r.statusCodesToRetry||[[100,199],[408,408],[429,429],[500,599]],e.config.retryConfig=r;let o=r.shouldRetry||n;if(!await o(e))return{shouldRetry:!1,config:e.config};let s=Math.min(((t=r).currentRetryAttempt?0:t.retryDelay??100)+(Math.pow(t.retryDelayMultiplier,t.currentRetryAttempt)-1)/2*1e3,t.totalTimeout-(Date.now()-t.timeOfFirstRequest),t.maxRetryDelay);e.config.retryConfig.currentRetryAttempt+=1;let a=r.retryBackoff?r.retryBackoff(e,s):new Promise(e=>{setTimeout(e,s)});return r.onRetryAttempt&&await r.onRetryAttempt(e),await a,{shouldRetry:!0,config:e.config}}function n(e){let t=i(e);if(e.config.signal?.aborted&&"TimeoutError"!==e.code||"AbortError"===e.code||!t||0===t.retry||!e.response&&(t.currentRetryAttempt||0)>=t.noResponseRetries||!t.httpMethodsToRetry||!t.httpMethodsToRetry.includes(e.config.method?.toUpperCase()||"GET"))return!1;if(e.response&&e.response.status){let r=!1;for(let[n,i]of t.statusCodesToRetry){let t=e.response.status;if(t>=n&&t<=i){r=!0;break}}if(!r)return!1}return t.currentRetryAttempt=t.currentRetryAttempt||0,!(t.currentRetryAttempt>=t.retry)}function i(e){if(e&&e.config&&e.config.retryConfig)return e.config.retryConfig}Object.defineProperty(t,"__esModule",{value:!0}),t.getRetryConfig=r},86190:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthClient=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=t.DEFAULT_UNIVERSE=void 0;let n=r(82361),i=r(71903),o=r(43197),s=r(36219),a=r(73662);t.DEFAULT_UNIVERSE="googleapis.com",t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=3e5;class l extends n.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=t.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();let r=(0,o.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=r.get("project_id")??null,this.quotaProjectId=r.get("quota_project_id"),this.credentials=r.get("credentials")??{},this.universeDomain=r.get("universe_domain")??t.DEFAULT_UNIVERSE,this.transporter=e.transporter??new i.Gaxios(e.transporterOptions),!1!==r.get("useAuthRequestParameters")&&(this.transporter.interceptors.request.add(l.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(l.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let t;let r=e[0],n=e[1],o=new Headers;return("string"==typeof r?t=new URL(r):r instanceof URL?t=r:r&&r.url&&(t=new URL(r.url)),r&&"object"==typeof r&&"headers"in r&&i.Gaxios.mergeHeaders(o,r.headers),n&&i.Gaxios.mergeHeaders(o,new Headers(n.headers)),"object"!=typeof r||r instanceof URL)?this.request({...n,headers:o,url:t}):this.request({...n,...r,headers:o,url:t})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,t){let r=t.get("x-goog-user-project"),n=t.get("authorization");return r&&e.set("x-goog-user-project",r),n&&e.set("authorization",n),e}static log=(0,s.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let t=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${t}`)}let t=e.headers.get("User-Agent");t?t.includes(`${a.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${t} ${a.USER_AGENT}`):e.headers.set("User-Agent",a.USER_AGENT);try{let t=e[l.RequestMethodNameSymbol],r=`${Math.floor(1e3*Math.random())}`;e[l.RequestLogIdSymbol]=r;let n={url:e.url,headers:e.headers};t?l.log.info("%s [%s] request %j",t,r,n):l.log.info("[%s] request %j",r,n)}catch(e){}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let t=e.config,r=t[l.RequestMethodNameSymbol],n=t[l.RequestLogIdSymbol];r?l.log.info("%s [%s] response %j",r,n,e.data):l.log.info("[%s] response %j",n,e.data)}catch(e){}return e},rejected:async e=>{try{let t=e.config,r=t[l.RequestMethodNameSymbol],n=t[l.RequestLogIdSymbol];r?l.log.info("%s [%s] error %j",r,n,e.response?.data):l.log.error("[%s] error %j",n,e.response?.data)}catch(e){}throw e}};static setMethodName(e,t){try{e[l.RequestMethodNameSymbol]=t}catch(e){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.AuthClient=l},76871:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsClient=void 0;let n=r(85225),i=r(10244),o=r(5534),s=r(43197),a=r(71903);class l extends i.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static #c="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);let t=(0,s.originalOrCamelOptions)(e),r=t.get("credential_source"),n=t.get("aws_security_credentials_supplier");if(!r&&!n)throw Error("A credential source or AWS security credentials supplier must be specified.");if(r&&n)throw Error("Only one of credential source or AWS security credentials supplier can be specified.");if(n)this.awsSecurityCredentialsSupplier=n,this.regionalCredVerificationUrl=l.#c,this.credentialSourceType="programmatic";else{let e=(0,s.originalOrCamelOptions)(r);this.environmentId=e.get("environment_id");let t=e.get("region_url"),n=e.get("url"),i=e.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new o.DefaultAwsSecurityCredentialsSupplier({regionUrl:t,securityCredentialsUrl:n,imdsV2SessionTokenUrl:i}),this.regionalCredVerificationUrl=e.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(e&&this.regionalCredVerificationUrl){if(1!==parseInt(e[2],10))throw Error(`aws version "${e[2]}" is not supported in the current build.`)}else throw Error('No valid AWS "credential_source" provided')}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new n.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...l.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[];return a.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((e,r)=>t.push({key:r,value:e})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}}t.AwsClient=l},85225:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsRequestSigner=void 0;let n=r(71903),i=r(30117),o="AWS4-HMAC-SHA256";class s{getCredentials;region;crypto;constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,i.createCrypto)()}async getRequestOptions(e){if(!e.url)throw RangeError('"url" is required in "amzOptions"');let t="object"==typeof e.data?JSON.stringify(e.data):e.data,r=e.url,i=e.method||"GET",o=e.body||t,s=e.headers,a=await this.getCredentials(),l=new URL(r);if("string"!=typeof o&&void 0!==o)throw TypeError(`'requestPayload' is expected to be a string if provided. Got: ${o}`);let u=await c({crypto:this.crypto,host:l.host,canonicalUri:l.pathname,canonicalQuerystring:l.search.slice(1),method:i,region:this.region,securityCredentials:a,requestPayload:o,additionalAmzHeaders:s}),d=n.Gaxios.mergeHeaders(u.amzDate?{"x-amz-date":u.amzDate}:{},{authorization:u.authorizationHeader,host:l.host},s||{});a.token&&n.Gaxios.mergeHeaders(d,{"x-amz-security-token":a.token});let p={url:r,method:i,headers:d};return void 0!==o&&(p.body=o),p}}async function a(e,t,r){return await e.signWithHmacSha256(t,r)}async function l(e,t,r,n,i){let o=await a(e,`AWS4${t}`,r),s=await a(e,o,n),l=await a(e,s,i);return await a(e,l,"aws4_request")}async function c(e){let t=n.Gaxios.mergeHeaders(e.additionalAmzHeaders),r=e.requestPayload||"",s=e.host.split(".")[0],c=new Date,u=c.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),d=c.toISOString().replace(/[-]/g,"").replace(/T.*/,"");e.securityCredentials.token&&t.set("x-amz-security-token",e.securityCredentials.token);let p=n.Gaxios.mergeHeaders({host:e.host},t.has("date")?{}:{"x-amz-date":u},t),h="",f=[...p.keys()].sort();f.forEach(e=>{h+=`${e}:${p.get(e)}
`});let m=f.join(";"),g=await e.crypto.sha256DigestHex(r),y=`${e.method.toUpperCase()}
${e.canonicalUri}
${e.canonicalQuerystring}
${h}
${m}
${g}`,v=`${d}/${e.region}/${s}/aws4_request`,b=`${o}
${u}
${v}
`+await e.crypto.sha256DigestHex(y),_=await l(e.crypto,e.securityCredentials.secretAccessKey,d,e.region,s),E=await a(e.crypto,_,b),w=`${o} Credential=${e.securityCredentials.accessKeyId}/${v}, SignedHeaders=${m}, Signature=${(0,i.fromArrayBufferToHex)(E)}`;return{amzDate:t.has("date")?void 0:u,authorizationHeader:w,canonicalQuerystring:e.canonicalQuerystring}}t.AwsRequestSigner=s},10244:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseExternalAccountClient=t.CLOUD_RESOURCE_MANAGER=t.EXTERNAL_ACCOUNT_TYPE=t.EXPIRATION_TIME_OFFSET=void 0;let n=r(71903),i=r(12781),o=r(86190),s=r(31070),a=r(43197),l=r(73662),c="https://www.googleapis.com/auth/cloud-platform";t.EXPIRATION_TIME_OFFSET=3e5,t.EXTERNAL_ACCOUNT_TYPE="external_account",t.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";class u extends o.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#u=null;constructor(e){super(e);let r=(0,a.originalOrCamelOptions)(e),n=r.get("type");if(n&&n!==t.EXTERNAL_ACCOUNT_TYPE)throw Error(`Expected "${t.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let i=r.get("client_id"),o=r.get("client_secret");this.tokenUrl=r.get("token_url")??"https://sts.{universeDomain}/v1/token".replace("{universeDomain}",this.universeDomain);let l=r.get("subject_token_type"),u=r.get("workforce_pool_user_project"),d=r.get("service_account_impersonation_url"),p=r.get("service_account_impersonation"),h=(0,a.originalOrCamelOptions)(p).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(r.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),i&&(this.clientAuth={confidentialClientType:"basic",clientId:i,clientSecret:o}),this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=r.get("scopes")||[c],this.cachedAccessToken=null,this.audience=r.get("audience"),this.subjectTokenType=l,this.workforcePoolUserProject=u;let f=RegExp("//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+");if(this.workforcePoolUserProject&&!this.audience.match(f))throw Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=d,this.serviceAccountImpersonationLifetime=h,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=3600),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let e=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return e?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),r={...u.RETRY_CONFIG,headers:t,url:`${this.cloudResourceManagerURL.toString()}${e}`};o.AuthClient.setMethodName(r,"getProjectId");let n=await this.transporter.request(r);return this.projectId=n.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let r;try{let t=await this.getRequestHeaders();e.headers=n.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),r=await this.transporter.request(e)}catch(n){let r=n.response;if(r){let n=r.status,o=r.config.data instanceof i.Readable;if(!t&&(401===n||403===n)&&!o&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw n}return r}async refreshAccessTokenAsync(){this.#u=this.#u||this.#d();try{return await this.#u}finally{this.#u=null}}async #d(){let e=await this.retrieveSubjectToken(),t={grantType:"urn:ietf:params:oauth:grant-type:token-exchange",audience:this.audience,requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[c]:this.getScopesArray()},r=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,n=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),i=await this.stsCredential.exchangeToken(t,n,r);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(i.access_token):i.expires_in?this.cachedAccessToken={access_token:i.access_token,expiry_date:new Date().getTime()+1e3*i.expires_in,res:i.res}:this.cachedAccessToken={access_token:i.access_token,res:i.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={...u.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};o.AuthClient.setMethodName(t,"getImpersonatedAccessToken");let r=await this.transporter.request(t),n=r.data;return{access_token:n.accessToken,expiry_date:new Date(n.expireTime).getTime(),res:r}}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}getScopesArray(){return"string"==typeof this.scopes?[this.scopes]:this.scopes||[c]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),t=void 0!==this.serviceAccountImpersonationUrl,r=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${l.pkg.version} google-byoid-sdk source/${r} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}}t.BaseExternalAccountClient=u},39938:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CertificateSubjectTokenSupplier=t.InvalidConfigurationError=t.CertificateSourceUnavailableError=t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;let n=r(43197),i=r(57147),o=r(6113),s=r(95687);t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";class a extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}}t.CertificateSourceUnavailableError=a;class l extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}}t.InvalidConfigurationError=l;class c{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new l("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new l("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new l("Cannot create mTLS Agent with missing certificate or key");return new s.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#p();let{certPath:e,keyPath:t}=await this.#h();return{cert:this.cert,key:this.key}=await this.#f(e,t),await this.#m(this.cert)}async #p(){let e=this.certificateConfigPath;if(e){if(await (0,n.isValidFile)(e))return e;throw new a(`Provided certificate config path is invalid: ${e}`)}let r=process.env[t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(r){if(await (0,n.isValidFile)(r))return r;throw new a(`Path from environment variable "${t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${r}`)}let i=(0,n.getWellKnownCertificateConfigFileLocation)();if(await (0,n.isValidFile)(i))return i;throw new a(`Could not find certificate configuration file. Searched override path, the "${t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${i}).`)}async #h(){let e;let t=this.certificateConfigPath;try{e=await i.promises.readFile(t,"utf8")}catch(e){throw new a(`Failed to read certificate config file at: ${t}`)}try{let r=JSON.parse(e),n=r?.cert_configs?.workload?.cert_path,i=r?.cert_configs?.workload?.key_path;if(!n||!i)throw new l(`Certificate config file (${t}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:n,keyPath:i}}catch(e){if(e instanceof l)throw e;throw new l(`Failed to parse certificate config from ${t}: ${e.message}`)}}async #f(e,t){let r,n;try{r=await i.promises.readFile(e),new o.X509Certificate(r)}catch(r){let t=r instanceof Error?r.message:String(r);throw new a(`Failed to read certificate file at ${e}: ${t}`)}try{n=await i.promises.readFile(t),(0,o.createPrivateKey)(n)}catch(r){let e=r instanceof Error?r.message:String(r);throw new a(`Failed to read private key file at ${t}: ${e}`)}return{cert:r,key:n}}async #m(e){let t=new o.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let e;let r=((await i.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((e,t)=>{try{return new o.X509Certificate(e)}catch(r){let e=r instanceof Error?r.message:String(r);throw new l(`Failed to parse certificate at index ${t} in trust chain file ${this.trustChainPath}: ${e}`)}}),n=r.findIndex(e=>t.raw.equals(e.raw));if(-1===n)e=[t,...r];else if(0===n)e=r;else throw new l(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${n}).`);return JSON.stringify(e.map(e=>e.raw.toString("base64")))}catch(t){if(t instanceof l)throw t;let e=t instanceof Error?t.message:String(t);throw new a(`Failed to process certificate chain from ${this.trustChainPath}: ${e}`)}}}t.CertificateSubjectTokenSupplier=c},69927:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Compute=void 0;let n=r(71903),i=r(61357),o=r(97196);class s extends o.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e;let t=`service-accounts/${this.serviceAccountEmail}/token`;try{let r={property:t};this.scopes.length>0&&(r.params={scopes:this.scopes.join(",")}),e=await i.instance(r)}catch(e){throw e instanceof n.GaxiosError&&(e.message=`Could not refresh access token: ${e.message}`,this.wrapError(e)),e}let r=e;return e&&e.expires_in&&(r.expiry_date=new Date().getTime()+1e3*e.expires_in,delete r.expires_in),this.emit("tokens",r),{tokens:r,res:null}}async fetchIdToken(e){let t;let r=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`;try{t=await i.instance({property:r})}catch(e){throw e instanceof Error&&(e.message=`Could not fetch ID token: ${e.message}`),e}return t}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,403===t.status?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:404===t.status&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}}t.Compute=s},5534:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultAwsSecurityCredentialsSupplier=void 0;let n=r(86190);class i{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#g)return this.#g;let t=new Headers;if(!this.#g&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#y(e.transporter)),!this.regionUrl)throw RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let r={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};n.AuthClient.setMethodName(r,"getAwsRegion");let i=await e.transporter.request(r);return i.data.substr(0,i.data.length-1)}async getAwsSecurityCredentials(e){if(this.#v)return this.#v;let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#y(e.transporter));let r=await this.#b(t,e.transporter),n=await this.#_(r,t,e.transporter);return{accessKeyId:n.AccessKeyId,secretAccessKey:n.SecretAccessKey,token:n.Token}}async #y(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return n.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data}async #b(e,t){if(!this.securityCredentialsUrl)throw Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let r={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return n.AuthClient.setMethodName(r,"#getAwsRoleName"),(await t.request(r)).data}async #_(e,t,r){let i={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return n.AuthClient.setMethodName(i,"#retrieveAwsSecurityCredentials"),(await r.request(i)).data}get #g(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get #v(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}}t.DefaultAwsSecurityCredentialsSupplier=i},76120:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownscopedClient=t.EXPIRATION_TIME_OFFSET=t.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;let n=r(71903),i=r(12781),o=r(86190),s=r(31070);t.MAX_ACCESS_BOUNDARY_RULES_COUNT=10,t.EXPIRATION_TIME_OFFSET=3e5;class a extends o.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,r={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof o.AuthClient?{}:e),e instanceof o.AuthClient?(this.authClient=e,this.credentialAccessBoundary=r):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),0===this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length)throw Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>t.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw Error(`The provided access boundary has more than ${t.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let e of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(0===e.availablePermissions.length)throw Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let r;try{let t=await this.getRequestHeaders();e.headers=n.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),r=await this.transporter.request(e)}catch(n){let r=n.response;if(r){let n=r.status,o=r.config.data instanceof i.Readable;if(!t&&(401===n||403===n)&&!o&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw n}return r}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,t=await this.stsCredential.exchangeToken({grantType:"urn:ietf:params:oauth:grant-type:token-exchange",requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:"urn:ietf:params:oauth:token-type:access_token"},void 0,this.credentialAccessBoundary),r=this.authClient.credentials?.expiry_date||null,n=t.expires_in?new Date().getTime()+1e3*t.expires_in:r;return this.cachedDownscopedAccessToken={access_token:t.access_token,expiry_date:n,res:t.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.DownscopedClient=a},55660:(e,t,r)=>{"use strict";var n;let i;Object.defineProperty(t,"__esModule",{value:!0}),t.GCPEnv=void 0,t.clear=function(){i=void 0},t.getEnv=s;let o=r(61357);async function s(){return i||(i=a())}async function a(){return n.NONE,process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME?n.APP_ENGINE:process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET?n.CLOUD_FUNCTIONS:await c()?await l()?n.KUBERNETES_ENGINE:process.env.K_CONFIGURATION?n.CLOUD_RUN:process.env.CLOUD_RUN_JOB?n.CLOUD_RUN_JOBS:n.COMPUTE_ENGINE:n.NONE}async function l(){try{return await o.instance("attributes/cluster-name"),!0}catch(e){return!1}}async function c(){return o.isAvailable()}!function(e){e.APP_ENGINE="APP_ENGINE",e.KUBERNETES_ENGINE="KUBERNETES_ENGINE",e.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",e.COMPUTE_ENGINE="COMPUTE_ENGINE",e.CLOUD_RUN="CLOUD_RUN",e.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",e.NONE="NONE"}(n||(t.GCPEnv=n={}))},11073:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidSubjectTokenError=t.InvalidMessageFieldError=t.InvalidCodeFieldError=t.InvalidTokenTypeFieldError=t.InvalidExpirationTimeFieldError=t.InvalidSuccessFieldError=t.InvalidVersionFieldError=t.ExecutableResponseError=t.ExecutableResponse=void 0;let r="urn:ietf:params:oauth:token-type:saml2",n="urn:ietf:params:oauth:token-type:id_token",i="urn:ietf:params:oauth:token-type:jwt";class o{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new a("Executable response must contain a 'version' field.");if(void 0===e.success)throw new l("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==r&&this.tokenType!==n&&this.tokenType!==i)throw new u(`Executable response must contain a 'token_type' field when successful and it must be one of ${n}, ${i}, or ${r}.`);if(this.tokenType===r){if(!e.saml_response)throw new h(`Executable response must contain a 'saml_response' field when token_type=${r}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new h(`Executable response must contain a 'id_token' field when token_type=${n} or ${i}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new d("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new p("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return void 0!==this.expirationTime&&this.expirationTime<Math.round(Date.now()/1e3)}}t.ExecutableResponse=o;class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableResponseError=s;class a extends s{}t.InvalidVersionFieldError=a;class l extends s{}t.InvalidSuccessFieldError=l;class c extends s{}t.InvalidExpirationTimeFieldError=c;class u extends s{}t.InvalidTokenTypeFieldError=u;class d extends s{}t.InvalidCodeFieldError=d;class p extends s{}t.InvalidMessageFieldError=p;class h extends s{}t.InvalidSubjectTokenError=h},12884:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountAuthorizedUserClient=t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;let n=r(86190),i=r(65851),o=r(71903),s=r(12781),a=r(10244);t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";class l extends i.OAuthClientAuthHandler{#E;constructor(e){super(e),this.#E=e.tokenRefreshEndpoint}async refreshToken(e,t){let r={...l.RETRY_CONFIG,url:this.#E,method:"POST",headers:t,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};n.AuthClient.setMethodName(r,"refreshToken"),this.applyClientAuthenticationOptions(r);try{let e=await this.transporter.request(r),t=e.data;return t.res=e,t}catch(e){if(e instanceof o.GaxiosError&&e.response)throw(0,i.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}class c extends n.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let t={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new l({tokenRefreshEndpoint:e.token_url??"https://sts.{universeDomain}/v1/oauthtoken".replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:t}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,"number"!=typeof e?.eagerRefreshThresholdMillis?this.eagerRefreshThresholdMillis=a.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let r;try{let t=await this.getRequestHeaders();e.headers=o.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),r=await this.transporter.request(e)}catch(n){let r=n.response;if(r){let n=r.status,i=r.config.data instanceof s.Readable;if(!t&&(401===n||403===n)&&!i&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw n}return r}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+1e3*e.expires_in,res:e.res},void 0!==e.refresh_token&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.ExternalAccountAuthorizedUserClient=c},44648:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountClient=void 0;let n=r(10244),i=r(49691),o=r(76871),s=r(97230);class a{constructor(){throw Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===n.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new o.AwsClient(e):e.credential_source?.executable?new s.PluggableAuthClient(e):new i.IdentityPoolClient(e):null}}t.ExternalAccountClient=a},75534:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSubjectTokenSupplier=void 0;let n=r(73837),i=r(57147),o=(0,n.promisify)(i.readFile??(()=>{})),s=(0,n.promisify)(i.realpath??(()=>{})),a=(0,n.promisify)(i.lstat??(()=>{}));class l{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e,t=this.filePath;try{if(t=await s(t),!(await a(t)).isFile())throw Error()}catch(e){throw e instanceof Error&&(e.message=`The file at ${t} does not exist, or it is not a file. ${e.message}`),e}let r=await o(t,{encoding:"utf8"});if("text"===this.formatType?e=r:"json"===this.formatType&&this.subjectTokenFieldName&&(e=JSON.parse(r)[this.subjectTokenFieldName]),!e)throw Error("Unable to parse the subject_token from the credential_source file");return e}}t.FileSubjectTokenSupplier=l},77879:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleAuth=t.GoogleAuthExceptionMessages=void 0;let n=r(32081),i=r(57147),o=r(71903),s=r(61357),a=r(22037),l=r(71017),c=r(30117),u=r(69927),d=r(40518),p=r(55660),h=r(51381),f=r(27871),m=r(37132),g=r(44648),y=r(10244),v=r(86190),b=r(12884),_=r(43197);t.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:"Unable to detect a Project Id in the current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_CREDENTIALS_FOUND:"Unable to find credentials in current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:"Unable to detect a Universe Domain in the current environment.\nTo learn more about Universe Domain retrieval, visit: \nhttps://cloud.google.com/compute/docs/metadata/predefined-metadata-keys"};class E{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#w=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw RangeError(t.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(!e)return this.getProjectIdAsync();this.getProjectIdAsync().then(t=>e(null,t),e)}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId())return this._cachedProjectId=e,e;throw Error(t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await s.universe("universe-domain"),e||=v.DEFAULT_UNIVERSE}catch(t){if(t&&t?.response?.status===404)e=v.DEFAULT_UNIVERSE;else throw t}return e}async getUniverseDomain(){let e=(0,_.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=v.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let r;if("function"==typeof e?t=e:r=e,!t)return this.getApplicationDefaultAsync(r);this.getApplicationDefaultAsync(r).then(e=>t(null,e.credential,e.projectId),t)}async getApplicationDefaultAsync(e={}){let r;if(this.cachedCredential)return await this.#x(this.cachedCredential,null);if((r=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e))||(r=await this._tryGetApplicationCredentialsFromWellKnownFile(e)))return r instanceof h.JWT?r.scopes=this.scopes:r instanceof y.BaseExternalAccountClient&&(r.scopes=this.getAnyScopes()),await this.#x(r);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#x(new u.Compute(e));throw Error(t.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async #x(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let r=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:r}}async _checkIsGCE(){return void 0===this.checkIsGCE&&(this.checkIsGCE=s.getGCPResidency()||await s.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||0===t.length)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(e){throw e instanceof Error&&(e.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${e.message}`),e}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let e=process.env.HOME;e&&(t=l.join(e,".config"))}return(t&&(t=l.join(t,"gcloud","application_default_credentials.json"),i.existsSync(t)||(t=null)),t)?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||0===e.length)throw Error("The file path is invalid.");try{if(e=i.realpathSync(e),!i.lstatSync(e).isFile())throw Error()}catch(t){throw t instanceof Error&&(t.message=`The file at ${e} does not exist, or it is not a file. ${t.message}`),t}let r=i.createReadStream(e);return this.fromStream(r,t)}fromImpersonatedJSON(e){if(!e)throw Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==m.IMPERSONATED_ACCOUNT_TYPE)throw Error(`The incoming JSON object does not have the "${m.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let r=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!r)throw RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let n=(this.scopes||e.scopes||this.defaultScopes)??[];return new m.Impersonated({...e,sourceClient:t,targetPrincipal:r,targetScopes:Array.isArray(n)?n:[n]})}fromJSON(e,t={}){let r;let n=(0,_.originalOrCamelOptions)(t).get("universe_domain");return e.type===f.USER_REFRESH_ACCOUNT_TYPE?(r=new f.UserRefreshClient(t)).fromJSON(e):e.type===m.IMPERSONATED_ACCOUNT_TYPE?r=this.fromImpersonatedJSON(e):e.type===y.EXTERNAL_ACCOUNT_TYPE?(r=g.ExternalAccountClient.fromJSON({...e,...t})).scopes=this.getAnyScopes():e.type===b.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?r=new b.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,r=new h.JWT(t),this.setGapicJWTValues(r),r.fromJSON(e)),n&&(r.universeDomain=n),r}_cacheClientFromJSON(e,t){let r=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=r,r}fromStream(e,t={},r){let n={};if("function"==typeof t?r=t:n=t,!r)return this.fromStreamAsync(e,n);this.fromStreamAsync(e,n).then(e=>r(null,e),r)}fromStreamAsync(e,t){return new Promise((r,n)=>{if(!e)throw Error("Must pass in a stream containing the Google auth settings.");let i=[];e.setEncoding("utf8").on("error",n).on("data",e=>i.push(e)).on("end",()=>{try{try{let e=JSON.parse(i.join("")),n=this._cacheClientFromJSON(e,t);return r(n)}catch(t){if(!this.keyFilename)throw t;let e=new h.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=e,this.setGapicJWTValues(e),r(e)}}catch(e){return n(e)}})})}fromAPIKey(e,t={}){return new h.JWT({...t,apiKey:e})}_isWindows(){let e=a.platform();return!!e&&e.length>=3&&"win"===e.substring(0,3).toLowerCase()}async getDefaultServiceProjectId(){return new Promise(e=>{(0,n.exec)("gcloud config config-helper --format json",(t,r)=>{if(!t&&r)try{let t=JSON.parse(r).configuration.properties.core.project;e(t);return}catch(e){}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let e=await this.getClient();if(e&&e.projectId)return e.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){if(!this.jsonContent||this.jsonContent.type!==y.EXTERNAL_ACCOUNT_TYPE)return null;let e=await this.getClient();return await e.getProjectId()}async getGCEProjectId(){try{return await s.project("project-id")}catch(e){return null}}getCredentials(e){if(!e)return this.getCredentialsAsync();this.getCredentialsAsync().then(t=>e(null,t),e)}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof m.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof y.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[e,t]=await Promise.all([s.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:e,universe_domain:t}}throw Error(t.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#w=this.#w||this.#S();try{return await this.#w}finally{this.#w=null}}async #S(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=l.resolve(this.keyFilename),t=i.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await this.#x(e);return t}{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new d.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){let e=await this.getClient();return(await e.getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,r=await this.getClient(),n=await r.getRequestHeaders(t);return e.headers=o.Gaxios.mergeHeaders(e.headers,n),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,p.getEnv)()}async sign(e,t){let r=await this.getClient(),n=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${n}/v1/projects/-/serviceAccounts/`,r instanceof m.Impersonated)return(await r.sign(e)).signedBlob;let i=(0,c.createCrypto)();if(r instanceof h.JWT&&r.key)return await i.sign(r.key,e);let o=await this.getCredentials();if(!o.client_email)throw Error("Cannot sign data without `client_email`.");return this.signBlob(i,o.client_email,e,t)}async signBlob(e,t,r,n){let i=new URL(n+`${t}:signBlob`);return(await this.request({method:"POST",url:i.href,data:{payload:e.encodeBase64StringUtf8(r)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}}t.GoogleAuth=E},2608:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IAMAuth=void 0;class r{selector;token;constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}}t.IAMAuth=r},49691:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityPoolClient=void 0;let n=r(10244),i=r(43197),o=r(75534),s=r(74674),a=r(39938),l=r(31070),c=r(71903);class u extends n.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);let t=(0,i.originalOrCamelOptions)(e),r=t.get("credential_source"),n=t.get("subject_token_supplier");if(!r&&!n)throw Error("A credential source or subject token supplier must be specified.");if(r&&n)throw Error("Only one of credential source or subject token supplier can be specified.");if(n)this.subjectTokenSupplier=n,this.credentialSourceType="programmatic";else{let e=(0,i.originalOrCamelOptions)(r),t=(0,i.originalOrCamelOptions)(e.get("format")),n=t.get("type")||"text",l=t.get("subject_token_field_name");if("json"!==n&&"text"!==n)throw Error(`Invalid credential_source format "${n}"`);if("json"===n&&!l)throw Error("Missing subject_token_field_name for JSON credential_source format");let c=e.get("file"),d=e.get("url"),p=e.get("certificate"),h=e.get("headers");if(c&&d||d&&p||c&&p)throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(c)this.credentialSourceType="file",this.subjectTokenSupplier=new o.FileSubjectTokenSupplier({filePath:c,formatType:n,subjectTokenFieldName:l});else if(d)this.credentialSourceType="url",this.subjectTokenSupplier=new s.UrlSubjectTokenSupplier({url:d,formatType:n,subjectTokenFieldName:l,headers:h,additionalGaxiosOptions:u.RETRY_CONFIG});else if(p){this.credentialSourceType="certificate";let e=new a.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:p.use_default_certificate_config,certificateConfigLocation:p.certificate_config_location,trustChainPath:p.trust_chain_path});this.subjectTokenSupplier=e}else throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof a.CertificateSubjectTokenSupplier){let e=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new l.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new c.Gaxios({agent:e})}),this.transporter=new c.Gaxios({...this.transporter.defaults||{},agent:e})}return e}}t.IdentityPoolClient=u},40518:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdTokenClient=void 0;let n=r(97196);class i extends n.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let e=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:e,expiry_date:this.getIdTokenExpiryDate(e)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return 1e3*JSON.parse(Buffer.from(t,"base64").toString("ascii")).exp}}t.IdTokenClient=i},37132:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Impersonated=t.IMPERSONATED_ACCOUNT_TYPE=void 0;let n=r(97196),i=r(71903),o=r(43197);t.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";class s extends n.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new n.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,(0,o.originalOrCamelOptions)(e).get("universe_domain")){if(this.sourceClient.universeDomain!==this.universeDomain)throw RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`)}else this.universeDomain=this.sourceClient.universeDomain;this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let t=`projects/-/serviceAccounts/${this.targetPrincipal}`,r=`${this.endpoint}/v1/${t}:signBlob`,n={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:r,data:n,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,t=`${this.endpoint}/v1/${e}:generateAccessToken`,r={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},n=await this.sourceClient.request({...s.RETRY_CONFIG,url:t,data:r,method:"POST"}),i=n.data;return this.credentials.access_token=i.accessToken,this.credentials.expiry_date=Date.parse(i.expireTime),{tokens:this.credentials,res:n}}catch(r){if(!(r instanceof Error))throw r;let e=0,t="";if(r instanceof i.GaxiosError&&(e=r?.response?.data?.error?.status,t=r?.response?.data?.error?.message),e&&t)throw r.message=`${e}: unable to impersonate: ${t}`,r;throw r.message=`unable to impersonate: ${r}`,r}}async fetchIdToken(e,t){await this.sourceClient.getAccessToken();let r=`projects/-/serviceAccounts/${this.targetPrincipal}`,n=`${this.endpoint}/v1/${r}:generateIdToken`,i={delegates:this.delegates,audience:e,includeEmail:t?.includeEmail??!0,useEmailAzp:t?.includeEmail??!0};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:n,data:i,method:"POST"})).data.token}}t.Impersonated=s},4465:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWTAccess=void 0;let n=r(90274),i=r(43197),o={alg:"RS256",typ:"JWT"};class s{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new i.LRUCache({capacity:500,maxAge:36e5});constructor(e,t,r,n){this.email=e,this.key=t,this.keyId=r,this.eagerRefreshThresholdMillis=n??3e5}getCachedKey(e,t){let r=e;if(t&&Array.isArray(t)&&t.length?r=e?`${e}_${t.join("_")}`:`${t.join("_")}`:"string"==typeof t&&(r=e?`${e}_${t}`:t),!r)throw Error("Scopes or url must be provided");return r}getRequestHeaders(e,t,r){let i;let a=this.getCachedKey(e,r),l=this.cache.get(a),c=Date.now();if(l&&l.expiration-c>this.eagerRefreshThresholdMillis)return new Headers(l.headers);let u=Math.floor(Date.now()/1e3),d=s.getExpirationTime(u);if(Array.isArray(r)&&(r=r.join(" ")),i=r?{iss:this.email,sub:this.email,scope:r,exp:d,iat:u}:{iss:this.email,sub:this.email,aud:e,exp:d,iat:u},t){for(let e in i)if(t[e])throw Error(`The '${e}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let p=this.keyId?{...o,kid:this.keyId}:o,h=Object.assign(i,t),f=n.sign({header:p,payload:h,secret:this.key}),m=new Headers({authorization:`Bearer ${f}`});return this.cache.set(a,{expiration:1e3*d,headers:m}),m}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,r)=>{e||r(Error("Must pass in a stream containing the service account auth settings."));let n="";e.setEncoding("utf8").on("data",e=>n+=e).on("error",r).on("end",()=>{try{let e=JSON.parse(n);this.fromJSON(e),t()}catch(e){r(e)}})})}}t.JWTAccess=s},51381:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWT=void 0;let n=r(6768),i=r(4465),o=r(97196),s=r(86190);class a extends o.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new a(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==s.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==s.DEFAULT_UNIVERSE)throw RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${s.DEFAULT_UNIVERSE}`);if(!this.apiKey&&t){if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:e}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${e.id_token}`}))}}{let t;this.access||(this.access=new i.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis)),this.hasUserScopes()?t=this.scopes:e||(t=this.defaultScopes);let r=this.useJWTAccessWithScope||this.universeDomain!==s.DEFAULT_UNIVERSE,n=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,r?t:void 0);return{headers:this.addSharedMetadataHeaders(n)}}}return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let t=new n.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return!!this.scopes&&this.scopes.length>0}hasAnyScopes(){return!!this.scopes&&this.scopes.length>0||!!this.defaultScopes&&this.defaultScopes.length>0}authorize(e){if(!e)return this.authorizeAsync();this.authorizeAsync().then(t=>e(null,t),e)}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),t={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",t),{res:null,tokens:t}}createGToken(){return this.gtoken||(this.gtoken=new n.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,r)=>{if(!e)throw Error("Must pass in a stream containing the service account auth settings.");let n="";e.setEncoding("utf8").on("error",r).on("data",e=>n+=e).on("end",()=>{try{let e=JSON.parse(n);this.fromJSON(e),t()}catch(e){r(e)}})})}fromAPIKey(e){if("string"!=typeof e)throw Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let e=this.createGToken(),t=await e.getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw Error("A key or a keyFile must be provided to getCredentials.")}}t.JWT=a},11052:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginTicket=void 0;class r{envelope;payload;constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}}t.LoginTicket=r},97196:(e,t,r)=>{"use strict";var n,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.OAuth2Client=t.ClientAuthentication=t.CertificateFormat=t.CodeChallengeMethod=void 0;let s=r(71903),a=r(63477),l=r(12781),c=r(88633),u=r(43197),d=r(30117),p=r(86190),h=r(11052);(function(e){e.Plain="plain",e.S256="S256"})(n||(t.CodeChallengeMethod=n={})),function(e){e.PEM="PEM",e.JWK="JWK"}(i||(t.CertificateFormat=i={})),function(e){e.ClientSecretPost="ClientSecretPost",e.ClientSecretBasic="ClientSecretBasic",e.None="None"}(o||(t.ClientAuthentication=o={}));class f extends p.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=i.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},t,r){super("object"==typeof e?e:{}),"object"!=typeof e&&(e={clientId:e,clientSecret:t,redirectUri:r}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||o.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+a.stringify(e)}generateCodeVerifier(){throw Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,d.createCrypto)(),t=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),r=(await e.sha256DigestBase64(t)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:t,codeChallenge:r}}getToken(e,t){let r="string"==typeof e?{code:e}:e;if(!t)return this.getTokenAsync(r);this.getTokenAsync(r).then(e=>t(null,e.tokens,e.res),e=>t(e,null,e.response))}async getTokenAsync(e){let t=this.endpoints.oauth2TokenUrl.toString(),r=new Headers,n={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===o.ClientSecretBasic){let e=Buffer.from(`${this._clientId}:${this._clientSecret}`);r.set("authorization",`Basic ${e.toString("base64")}`)}this.clientAuthentication===o.ClientSecretPost&&(n.client_secret=this._clientSecret);let i={...f.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,u.removeUndefinedValuesInObject)(n)),headers:r};p.AuthClient.setMethodName(i,"getTokenAsync");let s=await this.transporter.request(i),a=s.data;return s.data&&s.data.expires_in&&(a.expiry_date=new Date().getTime()+1e3*s.data.expires_in,delete a.expires_in),this.emit("tokens",a),{tokens:a,res:s}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(t=>(this.refreshTokenPromises.delete(e),t),t=>{throw this.refreshTokenPromises.delete(e),t});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){let t;if(!e)throw Error("No refresh token is set.");let r=this.endpoints.oauth2TokenUrl.toString(),n={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"};try{let e={...f.RETRY_CONFIG,method:"POST",url:r,data:new URLSearchParams((0,u.removeUndefinedValuesInObject)(n))};p.AuthClient.setMethodName(e,"refreshTokenNoCache"),t=await this.transporter.request(e)}catch(e){throw e instanceof s.GaxiosError&&"invalid_grant"===e.message&&e.response?.data&&/ReAuth/i.test(e.response.data.error_description)&&(e.message=JSON.stringify(e.response.data)),e}let i=t.data;return t.data&&t.data.expires_in&&(i.expiry_date=new Date().getTime()+1e3*t.data.expires_in,delete i.expires_in),this.emit("tokens",i),{tokens:i,res:t}}refreshAccessToken(e){if(!e)return this.refreshAccessTokenAsync();this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e)}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(!e)return this.getAccessTokenAsync();this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e)}async getAccessTokenAsync(){if(!(!this.credentials.access_token||this.isTokenExpiring()))return{token:this.credentials.access_token};{if(!this.credentials.refresh_token){if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token)return this.setCredentials(e),{token:this.credentials.access_token}}else throw Error("No refresh token or refresh handler callback is set.")}let e=await this.refreshAccessTokenAsync();if(!e.credentials||e.credentials&&!e.credentials.access_token)throw Error("Could not refresh access token.");return{token:e.credentials.access_token,res:e.res}}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let e=new Headers({authorization:t.token_type+" "+t.access_token});return{headers:this.addSharedMetadataHeaders(e)}}if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token){this.setCredentials(e);let t=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(t)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let r=null,n=null;try{n=(r=await this.refreshToken(t.refresh_token)).tokens}catch(e){throw e.response&&(403===e.response.status||404===e.response.status)&&(e.message=`Could not refresh access token: ${e.message}`),e}let i=this.credentials;i.token_type=i.token_type||"Bearer",n.refresh_token=i.refresh_token,this.credentials=n;let o=new Headers({authorization:i.token_type+" "+n.access_token});return{headers:this.addSharedMetadataHeaders(o),res:r.res}}static getRevokeTokenUrl(e){return new f().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let t=new URL(this.endpoints.oauth2RevokeUrl);return t.searchParams.append("token",e),t}revokeToken(e,t){let r={...f.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(p.AuthClient.setMethodName(r,"revokeToken"),!t)return this.transporter.request(r);this.transporter.request(r).then(e=>t(null,e),t)}revokeCredentials(e){if(!e)return this.revokeCredentialsAsync();this.revokeCredentialsAsync().then(t=>e(null,t),e)}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw Error("No access token to revoke.")}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){try{let t=await this.getRequestMetadataAsync();return e.headers=s.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(n){let r=n.response;if(r){let n=r.status,i=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),o=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,s=r.config.data instanceof l.Readable,a=401===n||403===n;if(!t&&a&&!s&&i)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&a&&!s&&o){let t=await this.processAndValidateRefreshHandler();return t?.access_token&&this.setCredentials(t),this.requestAsync(e,!0)}}throw n}}verifyIdToken(e,t){if(t&&"function"!=typeof t)throw Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(!t)return this.verifyIdTokenAsync(e);this.verifyIdTokenAsync(e).then(e=>t(null,e),t)}async verifyIdTokenAsync(e){if(!e.idToken)throw Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...f.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),r=Object.assign({expiry_date:new Date().getTime()+1e3*t.expires_in,scopes:t.scope.split(" ")},t);return delete r.expires_in,delete r.scope,r}getFederatedSignonCerts(e){if(!e)return this.getFederatedSignonCertsAsync();this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e)}async getFederatedSignonCertsAsync(){let e,t;let r=new Date().getTime(),n=(0,d.hasBrowserCrypto)()?i.JWK:i.PEM;if(this.certificateExpiry&&r<this.certificateExpiry.getTime()&&this.certificateCacheFormat===n)return{certs:this.certificateCache,format:n};switch(n){case i.PEM:t=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case i.JWK:t=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw Error(`Unsupported certificate format ${n}`)}try{let r={...f.RETRY_CONFIG,url:t};p.AuthClient.setMethodName(r,"getFederatedSignonCertsAsync"),e=await this.transporter.request(r)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}let o=e?.headers.get("cache-control"),s=-1;if(o){let e=/max-age=(?<maxAge>[0-9]+)/.exec(o)?.groups?.maxAge;e&&(s=1e3*Number(e))}let a={};switch(n){case i.PEM:a=e.data;break;case i.JWK:for(let t of e.data.keys)a[t.kid]=t;break;default:throw Error(`Unsupported certificate format ${n}`)}let l=new Date;return this.certificateExpiry=-1===s?null:new Date(l.getTime()+s),this.certificateCache=a,this.certificateCacheFormat=n,{certs:a,format:n,res:e}}getIapPublicKeys(e){if(!e)return this.getIapPublicKeysAsync();this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e)}async getIapPublicKeysAsync(){let e;let t=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let r={...f.RETRY_CONFIG,url:t};p.AuthClient.setMethodName(r,"getIapPublicKeysAsync"),e=await this.transporter.request(r)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,r,n,i){let o,s;let a=(0,d.createCrypto)();i||(i=f.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let l=e.split(".");if(3!==l.length)throw Error("Wrong number of segments in token: "+e);let u=l[0]+"."+l[1],p=l[2];try{o=JSON.parse(a.decodeBase64StringUtf8(l[0]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token envelope: ${l[0]}': ${e.message}`),e}if(!o)throw Error("Can't parse token envelope: "+l[0]);try{s=JSON.parse(a.decodeBase64StringUtf8(l[1]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token payload '${l[0]}`),e}if(!s)throw Error("Can't parse token payload: "+l[1]);if(!Object.prototype.hasOwnProperty.call(t,o.kid))throw Error("No pem found for envelope: "+JSON.stringify(o));let m=t[o.kid];if("ES256"===o.alg&&(p=c.joseToDer(p,"ES256").toString("base64")),!await a.verify(m,u,p))throw Error("Invalid token signature: "+e);if(!s.iat)throw Error("No issue time in token: "+JSON.stringify(s));if(!s.exp)throw Error("No expiration time in token: "+JSON.stringify(s));let g=Number(s.iat);if(isNaN(g))throw Error("iat field using invalid format");let y=Number(s.exp);if(isNaN(y))throw Error("exp field using invalid format");let v=new Date().getTime()/1e3;if(y>=v+i)throw Error("Expiration time too far in future: "+JSON.stringify(s));let b=g-f.CLOCK_SKEW_SECS_,_=y+f.CLOCK_SKEW_SECS_;if(v<b)throw Error("Token used too early, "+v+" < "+b+": "+JSON.stringify(s));if(v>_)throw Error("Token used too late, "+v+" > "+_+": "+JSON.stringify(s));if(n&&0>n.indexOf(s.iss))throw Error("Invalid issuer, expected one of ["+n+"], but got "+s.iss);if(null!=r){let e=s.aud;if(!(r.constructor===Array?r.indexOf(e)>-1:e===r))throw Error("Wrong recipient, payload audience != requiredAudience")}return new h.LoginTicket(o,s)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return!!e&&e<=new Date().getTime()+this.eagerRefreshThresholdMillis}}t.OAuth2Client=f},65851:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthClientAuthHandler=void 0,t.getErrorFromOAuthErrorResponse=function(e,t){let r=e.error,n=e.error_description,i=e.error_uri,o=`Error code ${r}`;void 0!==n&&(o+=`: ${n}`),void 0!==i&&(o+=` - ${i}`);let s=Error(o);if(t){let e=Object.keys(t);t.stack&&e.push("stack"),e.forEach(e=>{"message"!==e&&Object.defineProperty(s,e,{value:t[e],writable:!1,enumerable:!0})})}return s};let n=r(71903),i=r(30117),o=["PUT","POST","PATCH"];class s{#T=(0,i.createCrypto)();#A;transporter;constructor(e){e&&"clientId"in e?(this.#A=e,this.transporter=new n.Gaxios):(this.#A=e?.clientAuthentication,this.transporter=e?.transporter||new n.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=n.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){if(t)e.headers=n.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(this.#A?.confidentialClientType==="basic"){e.headers=n.Gaxios.mergeHeaders(e.headers);let t=this.#A.clientId,r=this.#A.clientSecret||"",i=this.#T.encodeBase64StringUtf8(`${t}:${r}`);n.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${i}`})}}injectAuthenticatedRequestBody(e){if(this.#A?.confidentialClientType==="request-body"){let t=(e.method||"GET").toUpperCase();if(!o.includes(t))throw Error(`${t} HTTP method does not support ${this.#A.confidentialClientType} client authentication`);let r=new Headers(e.headers).get("content-type");if(r?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let t=new URLSearchParams(e.data??"");t.append("client_id",this.#A.clientId),t.append("client_secret",this.#A.clientSecret||""),e.data=t}else if(r?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#A.clientId,client_secret:this.#A.clientSecret||""});else throw Error(`${r} content-types are not supported with ${this.#A.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.OAuthClientAuthHandler=s},54531:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PassThroughClient=void 0;let n=r(86190);class i extends n.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}}t.PassThroughClient=i},97230:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthClient=t.ExecutableError=void 0;let n=r(10244),i=r(11073),o=r(12053);var s=r(12053);Object.defineProperty(t,"ExecutableError",{enumerable:!0,get:function(){return s.ExecutableError}});class a extends n.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable||(this.command=e.credential_source.executable.command,!this.command))throw Error('No valid Pluggable Auth "credential_source" provided.');if(void 0===e.credential_source.executable.timeout_millis)this.timeoutMillis=3e4;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<5e3||this.timeoutMillis>12e4)throw Error("Timeout must be between 5000120000 milliseconds.");this.outputFile=e.credential_source.executable.output_file,this.handler=new o.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){let e;if("1"!==process.env.GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES)throw Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let r=this.getServiceAccountEmail();r&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",r),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>1)throw Error("Version of executable is not currently supported, maximum supported version is 1.");if(!e.success)throw new o.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new i.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw Error("Executable response is expired.");return e.subjectToken}}t.PluggableAuthClient=a},12053:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthHandler=t.ExecutableError=void 0;let n=r(11073),i=r(32081),o=r(57147);class s extends Error{code;constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableError=s;class a{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw Error("No command provided.");if(this.commandComponents=a.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,r)=>{let o=i.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),a="";o.stdout.on("data",e=>{a+=e}),o.stderr.on("data",e=>{a+=e});let l=setTimeout(()=>(o.removeAllListeners(),o.kill(),r(Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);o.on("close",e=>{if(clearTimeout(l),0!==e)return r(new s(a,e.toString()));try{let e=JSON.parse(a),r=new n.ExecutableResponse(e);return t(r)}catch(e){if(e instanceof n.ExecutableResponseError)return r(e);return r(new n.ExecutableResponseError(`The executable returned an invalid response: ${a}`))}})})}async retrieveCachedResponse(){let e;if(!this.outputFile||0===this.outputFile.length)return;try{e=await o.promises.realpath(this.outputFile)}catch{return}if(!(await o.promises.lstat(e)).isFile())return;let t=await o.promises.readFile(e,{encoding:"utf8"});if(""!==t)try{let e=JSON.parse(t);if(new n.ExecutableResponse(e).isValid())return new n.ExecutableResponse(e);return}catch(e){if(e instanceof n.ExecutableResponseError)throw e;throw new n.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw Error(`Provided command: "${e}" could not be parsed.`);for(let e=0;e<t.length;e++)'"'===t[e][0]&&'"'===t[e].slice(-1)&&(t[e]=t[e].slice(1,-1));return t}}t.PluggableAuthHandler=a},27871:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserRefreshClient=t.USER_REFRESH_ACCOUNT_TYPE=void 0;let n=r(97196),i=r(86190);t.USER_REFRESH_ACCOUNT_TYPE="authorized_user";class o extends n.OAuth2Client{_refreshToken;constructor(e,t,r,n,i){let o=e&&"object"==typeof e?e:{clientId:e,clientSecret:t,refreshToken:r,eagerRefreshThresholdMillis:n,forceRefreshOnFailure:i};super(o),this._refreshToken=o.refreshToken,this.credentials.refresh_token=o.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let t={...o.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return i.AuthClient.setMethodName(t,"fetchIdToken"),(await this.transporter.request(t)).data.id_token}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the user refresh token");if("authorized_user"!==e.type)throw Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}async fromStreamAsync(e){return new Promise((t,r)=>{if(!e)return r(Error("Must pass in a stream containing the user refresh token."));let n="";e.setEncoding("utf8").on("error",r).on("data",e=>n+=e).on("end",()=>{try{let e=JSON.parse(n);return this.fromJSON(e),t()}catch(e){return r(e)}})})}static fromJSON(e){let t=new o;return t.fromJSON(e),t}}t.UserRefreshClient=o},31070:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StsCredentials=void 0;let n=r(71903),i=r(86190),o=r(65851),s=r(43197);class a extends o.OAuthClientAuthHandler{#C;constructor(e={tokenExchangeEndpoint:""},t){("object"!=typeof e||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:t}),super(e),this.#C=e.tokenExchangeEndpoint}async exchangeToken(e,t,r){let l={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:r&&JSON.stringify(r)},c={...a.RETRY_CONFIG,url:this.#C.toString(),method:"POST",headers:t,data:new URLSearchParams((0,s.removeUndefinedValuesInObject)(l))};i.AuthClient.setMethodName(c,"exchangeToken"),this.applyClientAuthenticationOptions(c);try{let e=await this.transporter.request(c),t=e.data;return t.res=e,t}catch(e){if(e instanceof n.GaxiosError&&e.response)throw(0,o.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}t.StsCredentials=a},74674:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlSubjectTokenSupplier=void 0;let n=r(86190);class i{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t;let r={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};if(n.AuthClient.setMethodName(r,"getSubjectToken"),"text"===this.formatType?t=(await e.transporter.request(r)).data:"json"===this.formatType&&this.subjectTokenFieldName&&(t=(await e.transporter.request(r)).data[this.subjectTokenFieldName]),!t)throw Error("Unable to parse the subject_token from the credential_source URL");return t}}t.UrlSubjectTokenSupplier=i},28457:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserCrypto=void 0;let n=r(95214),i=r(22036);class o{constructor(){if("undefined"==typeof window||void 0===window.crypto||void 0===window.crypto.subtle)throw Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return n.fromByteArray(new Uint8Array(r))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),n.fromByteArray(t)}static padBase64(e){for(;e.length%4!=0;)e+="=";return e}async verify(e,t,r){let i={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(t),a=n.toByteArray(o.padBase64(r)),l=await window.crypto.subtle.importKey("jwk",e,i,!0,["verify"]);return await window.crypto.subtle.verify(i,l,a,s)}async sign(e,t){let r={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},i=new TextEncoder().encode(t),o=await window.crypto.subtle.importKey("jwk",e,r,!0,["sign"]),s=await window.crypto.subtle.sign(r,o,i);return n.fromByteArray(new Uint8Array(s))}decodeBase64StringUtf8(e){let t=n.toByteArray(o.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return n.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return(0,i.fromArrayBufferToHex)(r)}async signWithHmacSha256(e,t){let r="string"==typeof e?e:String.fromCharCode(...new Uint16Array(e)),n=new TextEncoder,i=await window.crypto.subtle.importKey("raw",n.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",i,n.encode(t))}}t.BrowserCrypto=o},30117:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.createCrypto=function(){return a()?new o.BrowserCrypto:new s.NodeCrypto},t.hasBrowserCrypto=a;let o=r(28457),s=r(19432);function a(){return"undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle}i(r(22036),t)},19432:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeCrypto=void 0;let n=r(6113);class i{async sha256DigestBase64(e){return n.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return n.randomBytes(e).toString("base64")}async verify(e,t,r){let i=n.createVerify("RSA-SHA256");return i.update(t),i.end(),i.verify(e,r,"base64")}async sign(e,t){let r=n.createSign("RSA-SHA256");return r.update(t),r.end(),r.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return n.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){var r;let i="string"==typeof e?e:Buffer.from(e);return(r=n.createHmac("sha256",i).update(t).digest()).buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}}t.NodeCrypto=i},22036:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromArrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}},45054:(e,t,r)=>{"use strict";t.GoogleAuth=void 0;let n=r(77879);Object.defineProperty(t,"GoogleAuth",{enumerable:!0,get:function(){return n.GoogleAuth}}),r(61357),r(71903),r(86190),r(69927),r(55660),r(2608),r(40518),r(4465),r(51381),r(37132),r(97196),r(11052),r(27871),r(76871),r(85225),r(49691),r(44648),r(10244),r(76120),r(97230),r(12884),r(54531),new n.GoogleAuth},43197:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=void 0,t.snakeToCamel=a,t.originalOrCamelOptions=function(e){return{get:function(t){let r=e||{};return r[t]??r[a(t)]}}},t.removeUndefinedValuesInObject=function(e){return Object.entries(e).forEach(([t,r])=>{(void 0===r||"undefined"===r)&&delete e[t]}),e},t.isValidFile=c,t.getWellKnownCertificateConfigFileLocation=function(){let e=process.env.CLOUDSDK_CONFIG||(i.platform().startsWith("win")?o.join(process.env.APPDATA||"",s):o.join(process.env.HOME||"",".config",s));return o.join(e,"certificate_config.json")};let n=r(57147),i=r(22037),o=r(71017),s="gcloud";function a(e){return e.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}class l{capacity;#O=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#I(e,t){this.#O.delete(e),this.#O.set(e,{value:t,lastAccessed:Date.now()})}set(e,t){this.#I(e,t),this.#N()}get(e){let t=this.#O.get(e);if(t)return this.#I(e,t.value),this.#N(),t.value}#N(){let e=this.maxAge?Date.now()-this.maxAge:0,t=this.#O.entries().next();for(;!t.done&&(this.#O.size>this.capacity||t.value[1].lastAccessed<e);)this.#O.delete(t.value[0]),t=this.#O.entries().next()}}async function c(e){try{return(await n.promises.lstat(e)).isFile()}catch(e){return!1}}t.LRUCache=l},27500:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Colours=void 0;class r{static isEnabled(e){return e&&e.isTTY&&("function"!=typeof e.getColorDepth||e.getColorDepth()>2)}static refresh(){r.enabled=r.isEnabled(null==process?void 0:process.stderr),this.enabled?(r.reset="\x1b[0m",r.bright="\x1b[1m",r.dim="\x1b[2m",r.red="\x1b[31m",r.green="\x1b[32m",r.yellow="\x1b[33m",r.blue="\x1b[34m",r.magenta="\x1b[35m",r.cyan="\x1b[36m",r.white="\x1b[37m",r.grey="\x1b[90m"):(r.reset="",r.bright="",r.dim="",r.red="",r.green="",r.yellow="",r.blue="",r.magenta="",r.cyan="",r.white="",r.grey="")}}t.Colours=r,r.enabled=!1,r.reset="",r.bright="",r.dim="",r.red="",r.green="",r.yellow="",r.blue="",r.magenta="",r.cyan="",r.white="",r.grey="",r.refresh()},36219:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(45690),t)},45690:function(e,t,r){"use strict";let n;var i,o,s,a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),c=this&&this.__importStar||(i=function(e){return(i=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=i(e),n=0;n<r.length;n++)"default"!==r[n]&&a(t,e,r[n]);return l(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.env=t.DebugLogBackendBase=t.placeholder=t.AdhocDebugLogger=t.LogSeverity=void 0,t.getNodeBackend=y,t.getDebugBackend=function(e){return new v(e)},t.getStructuredBackend=function(e){return new b(e)},t.setBackend=function(e){n=e,_.clear()},t.log=E;let u=r(82361),d=c(r(77282)),p=c(r(73837)),h=r(27500);(o=s||(t.LogSeverity=s={})).DEFAULT="DEFAULT",o.DEBUG="DEBUG",o.INFO="INFO",o.WARNING="WARNING",o.ERROR="ERROR";class f extends u.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(e,t)=>this.on(e,t)}),this.func.debug=(...e)=>this.invokeSeverity(s.DEBUG,...e),this.func.info=(...e)=>this.invokeSeverity(s.INFO,...e),this.func.warn=(...e)=>this.invokeSeverity(s.WARNING,...e),this.func.error=(...e)=>this.invokeSeverity(s.ERROR,...e),this.func.sublog=e=>E(e,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch(e){}try{this.emit("log",e,t)}catch(e){}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}}t.AdhocDebugLogger=f,t.placeholder=new f("",()=>{}).func;class m{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let r=null!==(e=d.env[t.env.nodeEnables])&&void 0!==e?e:"*";"all"===r&&(r="*"),this.filters=r.split(",")}log(e,t,...r){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let n=this.cached.get(e);n||(n=this.makeLogger(e),this.cached.set(e,n)),n(t,...r)}catch(e){console.error(e)}}}t.DebugLogBackendBase=m;class g extends m{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...r)=>{var n;let i;let o=`${h.Colours.green}${e}${h.Colours.reset}`,a=`${h.Colours.yellow}${d.pid}${h.Colours.reset}`;switch(t.severity){case s.ERROR:i=`${h.Colours.red}${t.severity}${h.Colours.reset}`;break;case s.INFO:i=`${h.Colours.magenta}${t.severity}${h.Colours.reset}`;break;case s.WARNING:i=`${h.Colours.yellow}${t.severity}${h.Colours.reset}`;break;default:i=null!==(n=t.severity)&&void 0!==n?n:s.DEFAULT}let l=p.formatWithOptions({colors:h.Colours.enabled},...r),c=Object.assign({},t);delete c.severity;let u=Object.getOwnPropertyNames(c).length?JSON.stringify(c):"",f=u?`${h.Colours.grey}${u}${h.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",a,o,i,l,u?` ${f}`:"")}:()=>{}}setFilters(){let e=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=RegExp(`^${e}$`,"i")}}function y(){return new g}class v extends m{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(e,...r)=>{t(r[0],...r.slice(1))}}setFilters(){var e;let t=null!==(e=d.env.NODE_DEBUG)&&void 0!==e?e:"";d.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}}class b extends m{constructor(e){super(),this.upstream=null!=e?e:void 0}makeLogger(e){var t;let r=null===(t=this.upstream)||void 0===t?void 0:t.makeLogger(e);return(e,...t)=>{var n;let i=JSON.stringify(Object.assign({severity:null!==(n=e.severity)&&void 0!==n?n:s.INFO,message:p.format(...t)},e));r?r(e,i):console.log("%s",i)}}setFilters(){var e;null===(e=this.upstream)||void 0===e||e.setFilters()}}t.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};let _=new Map;function E(e,r){let i;if(!n&&!d.env[t.env.nodeEnables]||!e)return t.placeholder;r&&(e=`${r.instance.namespace}:${e}`);let o=_.get(e);if(o)return o.func;if(null===n)return t.placeholder;void 0===n&&(n=y());let s=new f(e,(t,...r)=>{if(i!==n){if(null===n)return;void 0===n&&(n=y()),i=n}null==n||n.log(e,t,...r)});return _.set(e,s),s.func}},67301:(e,t,r)=>{var n=r(89077).stringify,i=r(90558);e.exports=function(e){return{parse:i(e),stringify:n}},e.exports.parse=i(),e.exports.stringify=n},90558:(e,t,r)=>{var n=null;let i=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,o=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;e.exports=function(e){"use strict";var t={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(null!=e){if(!0===e.strict&&(t.strict=!0),!0===e.storeAsString&&(t.storeAsString=!0),t.alwaysParseAsBig=!0===e.alwaysParseAsBig&&e.alwaysParseAsBig,t.useNativeBigInt=!0===e.useNativeBigInt&&e.useNativeBigInt,void 0!==e.constructorAction){if("error"===e.constructorAction||"ignore"===e.constructorAction||"preserve"===e.constructorAction)t.constructorAction=e.constructorAction;else throw Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${e.constructorAction}`)}if(void 0!==e.protoAction){if("error"===e.protoAction||"ignore"===e.protoAction||"preserve"===e.protoAction)t.protoAction=e.protoAction;else throw Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${e.protoAction}`)}}var s,a,l,c,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},d=function(e){throw{name:"SyntaxError",message:e,at:s,text:l}},p=function(e){return e&&e!==a&&d("Expected '"+e+"' instead of '"+a+"'"),a=l.charAt(s),s+=1,a},h=function(){var e,i="";for("-"===a&&(i="-",p("-"));a>="0"&&a<="9";)i+=a,p();if("."===a)for(i+=".";p()&&a>="0"&&a<="9";)i+=a;if("e"===a||"E"===a)for(i+=a,p(),("-"===a||"+"===a)&&(i+=a,p());a>="0"&&a<="9";)i+=a,p();if(isFinite(e=+i))return(null==n&&(n=r(86156)),i.length>15)?t.storeAsString?i:t.useNativeBigInt?BigInt(i):new n(i):t.alwaysParseAsBig?t.useNativeBigInt?BigInt(e):new n(e):e;d("Bad number")},f=function(){var e,t,r,n="";if('"'===a)for(var i=s;p();){if('"'===a)return s-1>i&&(n+=l.substring(i,s-1)),p(),n;if("\\"===a){if(s-1>i&&(n+=l.substring(i,s-1)),p(),"u"===a){for(t=0,r=0;t<4&&isFinite(e=parseInt(p(),16));t+=1)r=16*r+e;n+=String.fromCharCode(r)}else if("string"==typeof u[a])n+=u[a];else break;i=s}}d("Bad string")},m=function(){for(;a&&a<=" ";)p()},g=function(){switch(a){case"t":return p("t"),p("r"),p("u"),p("e"),!0;case"f":return p("f"),p("a"),p("l"),p("s"),p("e"),!1;case"n":return p("n"),p("u"),p("l"),p("l"),null}d("Unexpected '"+a+"'")},y=function(){var e=[];if("["===a){if(p("["),m(),"]"===a)return p("]"),e;for(;a;){if(e.push(c()),m(),"]"===a)return p("]"),e;p(","),m()}}d("Bad array")},v=function(){var e,r=Object.create(null);if("{"===a){if(p("{"),m(),"}"===a)return p("}"),r;for(;a;){if(e=f(),m(),p(":"),!0===t.strict&&Object.hasOwnProperty.call(r,e)&&d('Duplicate key "'+e+'"'),!0===i.test(e)?"error"===t.protoAction?d("Object contains forbidden prototype property"):"ignore"===t.protoAction?c():r[e]=c():!0===o.test(e)?"error"===t.constructorAction?d("Object contains forbidden constructor property"):"ignore"===t.constructorAction?c():r[e]=c():r[e]=c(),m(),"}"===a)return p("}"),r;p(","),m()}}d("Bad object")};return c=function(){switch(m(),a){case"{":return v();case"[":return y();case'"':return f();case"-":return h();default:return a>="0"&&a<="9"?h():g()}},function(e,t){var r;return l=e+"",s=0,a=" ",r=c(),m(),a&&d("Syntax error"),"function"==typeof t?function e(r,n){var i,o=r[n];return o&&"object"==typeof o&&Object.keys(o).forEach(function(t){void 0!==(i=e(o,t))?o[t]=i:delete o[t]}),t.call(r,n,o)}({"":r},""):r}}},89077:(e,t,r)=>{var n=r(86156),i=e.exports;!function(){"use strict";var e,t,r,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function a(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof i.stringify&&(i.stringify=function(i,o,s){var l;if(e="",t="","number"==typeof s)for(l=0;l<s;l+=1)t+=" ";else"string"==typeof s&&(t=s);if(r=o,o&&"function"!=typeof o&&("object"!=typeof o||"number"!=typeof o.length))throw Error("JSON.stringify");return function i(o,s){var l,c,u,d,p,h=e,f=s[o],m=null!=f&&(f instanceof n||n.isBigNumber(f));switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(o)),"function"==typeof r&&(f=r.call(s,o,f)),typeof f){case"string":if(m)return f;return a(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":case"bigint":return String(f);case"object":if(!f)return"null";if(e+=t,p=[],"[object Array]"===Object.prototype.toString.apply(f)){for(l=0,d=f.length;l<d;l+=1)p[l]=i(l,f)||"null";return u=0===p.length?"[]":e?"[\n"+e+p.join(",\n"+e)+"\n"+h+"]":"["+p.join(",")+"]",e=h,u}if(r&&"object"==typeof r)for(l=0,d=r.length;l<d;l+=1)"string"==typeof r[l]&&(u=i(c=r[l],f))&&p.push(a(c)+(e?": ":":")+u);else Object.keys(f).forEach(function(t){var r=i(t,f);r&&p.push(a(t)+(e?": ":":")+r)});return u=0===p.length?"{}":e?"{\n"+e+p.join(",\n"+e)+"\n"+h+"}":"{"+p.join(",")+"}",e=h,u}}("",{"":i})})}()},83589:(e,t,r)=>{var n,i=r(16496).Buffer,o=r(6113),s=r(88633),a=r(73837),l="secret must be a string or buffer",c="key must be a string or a buffer",u="function"==typeof o.createPublicKey;function d(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!u||"object"!=typeof e||"string"!=typeof e.type||"string"!=typeof e.asymmetricKeyType||"function"!=typeof e.export))throw m(c)}function p(e){if(!i.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw m("key must be a string, a buffer or an object")}function h(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function f(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var r=0;r<t;++r)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function m(e){var t=[].slice.call(arguments,1);return TypeError(a.format.bind(a,e).apply(null,t))}function g(e){var t;return t=e,i.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function y(e){return function(t,r){(function(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!u||"object"!=typeof e||"secret"!==e.type||"function"!=typeof e.export))throw m(l)})(r),t=g(t);var n=o.createHmac("sha"+e,r);return h((n.update(t),n.digest("base64")))}}u&&(c+=" or a KeyObject",l+="or a KeyObject");var v="timingSafeEqual"in o?function(e,t){return e.byteLength===t.byteLength&&o.timingSafeEqual(e,t)}:function(e,t){return n||(n=r(6073)),n(e,t)};function b(e){return function(t,r,n){var o=y(e)(t,n);return v(i.from(r),i.from(o))}}function _(e){return function(t,r){p(r),t=g(t);var n=o.createSign("RSA-SHA"+e);return h((n.update(t),n.sign(r,"base64")))}}function E(e){return function(t,r,n){d(n),t=g(t),r=f(r);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify(n,r,"base64")}}function w(e){return function(t,r){p(r),t=g(t);var n=o.createSign("RSA-SHA"+e);return h((n.update(t),n.sign({key:r,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function x(e){return function(t,r,n){d(n),t=g(t),r=f(r);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify({key:n,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function S(e){var t=_(e);return function(){var r=t.apply(null,arguments);return s.derToJose(r,"ES"+e)}}function T(e){var t=E(e);return function(r,n,i){return t(r,n=s.joseToDer(n,"ES"+e).toString("base64"),i)}}function A(){return function(){return""}}function C(){return function(e,t){return""===t}}e.exports=function(e){var t=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!t)throw m('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var r=(t[1]||t[3]).toLowerCase(),n=t[2];return{sign:({hs:y,rs:_,ps:w,es:S,none:A})[r](n),verify:({hs:b,rs:E,ps:x,es:T,none:C})[r](n)}}},90274:(e,t,r)=>{var n=r(71044),i=r(79078);t.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],t.sign=n.sign,t.verify=i.verify,t.decode=i.decode,t.isValid=i.isValid,t.createSign=function(e){return new n(e)},t.createVerify=function(e){return new i(e)}},33166:(e,t,r)=>{var n=r(16496).Buffer,i=r(12781);function o(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=n.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=n.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick((function(){this.emit("end",e),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof e+")")}r(73837).inherits(o,i),o.prototype.write=function(e){this.buffer=n.concat([this.buffer,n.from(e)]),this.emit("data",e)},o.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1},e.exports=o},71044:(e,t,r)=>{var n=r(16496).Buffer,i=r(33166),o=r(83589),s=r(12781),a=r(61927),l=r(73837);function c(e,t){return n.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function u(e){var t,r,n,i=e.header,s=e.payload,u=e.secret||e.privateKey,d=e.encoding,p=o(i.alg),h=(t=(t=d)||"utf8",r=c(a(i),"binary"),n=c(a(s),t),l.format("%s.%s",r,n)),f=p.sign(h,u);return l.format("%s.%s",h,f)}function d(e){var t=e.secret;if(t=null==(t=null==t?e.privateKey:t)?e.key:t,!0===/^hs/i.test(e.header.alg)&&null==t)throw TypeError("secret must be a string or buffer or a KeyObject");var r=new i(t);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=r,this.payload=new i(e.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}l.inherits(d,s),d.prototype.sign=function(){try{var e=u({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},d.sign=u,e.exports=d},61927:(e,t,r)=>{var n=r(14300).Buffer;e.exports=function(e){return"string"==typeof e?e:"number"==typeof e||n.isBuffer(e)?e.toString():JSON.stringify(e)}},79078:(e,t,r)=>{var n=r(16496).Buffer,i=r(33166),o=r(83589),s=r(12781),a=r(61927),l=r(73837),c=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function u(e){var t=e.split(".",1)[0];return function(e){if("[object Object]"===Object.prototype.toString.call(e))return e;try{return JSON.parse(e)}catch(e){return}}(n.from(t,"base64").toString("binary"))}function d(e){return e.split(".")[2]}function p(e){return c.test(e)&&!!u(e)}function h(e,t,r){if(!t){var n=Error("Missing algorithm parameter for jws.verify");throw n.code="MISSING_ALGORITHM",n}var i=d(e=a(e)),s=e.split(".",2).join(".");return o(t).verify(s,i,r)}function f(e,t){if(t=t||{},!p(e=a(e)))return null;var r,i,o=u(e);if(!o)return null;var s=(r=r||"utf8",i=e.split(".")[1],n.from(i,"base64").toString(r));return("JWT"===o.typ||t.json)&&(s=JSON.parse(s,t.encoding)),{header:o,payload:s,signature:d(e)}}function m(e){var t=(e=e||{}).secret;if(t=null==(t=null==t?e.publicKey:t)?e.key:t,!0===/^hs/i.test(e.algorithm)&&null==t)throw TypeError("secret must be a string or buffer or a KeyObject");var r=new i(t);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=r,this.signature=new i(e.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}l.inherits(m,s),m.prototype.verify=function(){try{var e=h(this.signature.buffer,this.algorithm,this.key.buffer),t=f(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},m.decode=f,m.isValid=p,m.verify=h,e.exports=m},85723:(e,t)=>{"use strict";function r(e){for(let t=0;t<e.length;t++){let r=e[t];if("function"!=typeof r)throw Error(`A "use server" file can only export async functions, found ${typeof r}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`)}}Object.defineProperty(t,"ensureServerEntryExports",{enumerable:!0,get:function(){return r}})},27745:(e,t,r)=>{"use strict";Object.defineProperty(t,"registerServerReference",{enumerable:!0,get:function(){return i}});let n=r(96012);function i(e,t){return(0,n.registerServerReference)(t,e,null)}},98601:e=>{(()=>{"use strict";var t={491:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextAPI=void 0;let n=r(223),i=r(172),o=r(930),s="context",a=new n.NoopContextManager;class l{constructor(){}static getInstance(){return this._instance||(this._instance=new l),this._instance}setGlobalContextManager(e){return(0,i.registerGlobal)(s,e,o.DiagAPI.instance())}active(){return this._getContextManager().active()}with(e,t,r,...n){return this._getContextManager().with(e,t,r,...n)}bind(e,t){return this._getContextManager().bind(e,t)}_getContextManager(){return(0,i.getGlobal)(s)||a}disable(){this._getContextManager().disable(),(0,i.unregisterGlobal)(s,o.DiagAPI.instance())}}t.ContextAPI=l},930:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagAPI=void 0;let n=r(56),i=r(912),o=r(957),s=r(172);class a{constructor(){function e(e){return function(...t){let r=(0,s.getGlobal)("diag");if(r)return r[e](...t)}}let t=this;t.setLogger=(e,r={logLevel:o.DiagLogLevel.INFO})=>{var n,a,l;if(e===t){let e=Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(n=e.stack)&&void 0!==n?n:e.message),!1}"number"==typeof r&&(r={logLevel:r});let c=(0,s.getGlobal)("diag"),u=(0,i.createLogLevelDiagLogger)(null!==(a=r.logLevel)&&void 0!==a?a:o.DiagLogLevel.INFO,e);if(c&&!r.suppressOverrideMessage){let e=null!==(l=Error().stack)&&void 0!==l?l:"<failed to generate stacktrace>";c.warn(`Current logger will be overwritten from ${e}`),u.warn(`Current logger will overwrite one already registered from ${e}`)}return(0,s.registerGlobal)("diag",u,t,!0)},t.disable=()=>{(0,s.unregisterGlobal)("diag",t)},t.createComponentLogger=e=>new n.DiagComponentLogger(e),t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}static instance(){return this._instance||(this._instance=new a),this._instance}}t.DiagAPI=a},653:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsAPI=void 0;let n=r(660),i=r(172),o=r(930),s="metrics";class a{constructor(){}static getInstance(){return this._instance||(this._instance=new a),this._instance}setGlobalMeterProvider(e){return(0,i.registerGlobal)(s,e,o.DiagAPI.instance())}getMeterProvider(){return(0,i.getGlobal)(s)||n.NOOP_METER_PROVIDER}getMeter(e,t,r){return this.getMeterProvider().getMeter(e,t,r)}disable(){(0,i.unregisterGlobal)(s,o.DiagAPI.instance())}}t.MetricsAPI=a},181:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropagationAPI=void 0;let n=r(172),i=r(874),o=r(194),s=r(277),a=r(369),l=r(930),c="propagation",u=new i.NoopTextMapPropagator;class d{constructor(){this.createBaggage=a.createBaggage,this.getBaggage=s.getBaggage,this.getActiveBaggage=s.getActiveBaggage,this.setBaggage=s.setBaggage,this.deleteBaggage=s.deleteBaggage}static getInstance(){return this._instance||(this._instance=new d),this._instance}setGlobalPropagator(e){return(0,n.registerGlobal)(c,e,l.DiagAPI.instance())}inject(e,t,r=o.defaultTextMapSetter){return this._getGlobalPropagator().inject(e,t,r)}extract(e,t,r=o.defaultTextMapGetter){return this._getGlobalPropagator().extract(e,t,r)}fields(){return this._getGlobalPropagator().fields()}disable(){(0,n.unregisterGlobal)(c,l.DiagAPI.instance())}_getGlobalPropagator(){return(0,n.getGlobal)(c)||u}}t.PropagationAPI=d},997:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceAPI=void 0;let n=r(172),i=r(846),o=r(139),s=r(607),a=r(930),l="trace";class c{constructor(){this._proxyTracerProvider=new i.ProxyTracerProvider,this.wrapSpanContext=o.wrapSpanContext,this.isSpanContextValid=o.isSpanContextValid,this.deleteSpan=s.deleteSpan,this.getSpan=s.getSpan,this.getActiveSpan=s.getActiveSpan,this.getSpanContext=s.getSpanContext,this.setSpan=s.setSpan,this.setSpanContext=s.setSpanContext}static getInstance(){return this._instance||(this._instance=new c),this._instance}setGlobalTracerProvider(e){let t=(0,n.registerGlobal)(l,this._proxyTracerProvider,a.DiagAPI.instance());return t&&this._proxyTracerProvider.setDelegate(e),t}getTracerProvider(){return(0,n.getGlobal)(l)||this._proxyTracerProvider}getTracer(e,t){return this.getTracerProvider().getTracer(e,t)}disable(){(0,n.unregisterGlobal)(l,a.DiagAPI.instance()),this._proxyTracerProvider=new i.ProxyTracerProvider}}t.TraceAPI=c},277:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteBaggage=t.setBaggage=t.getActiveBaggage=t.getBaggage=void 0;let n=r(491),i=(0,r(780).createContextKey)("OpenTelemetry Baggage Key");function o(e){return e.getValue(i)||void 0}t.getBaggage=o,t.getActiveBaggage=function(){return o(n.ContextAPI.getInstance().active())},t.setBaggage=function(e,t){return e.setValue(i,t)},t.deleteBaggage=function(e){return e.deleteValue(i)}},993:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaggageImpl=void 0;class r{constructor(e){this._entries=e?new Map(e):new Map}getEntry(e){let t=this._entries.get(e);if(t)return Object.assign({},t)}getAllEntries(){return Array.from(this._entries.entries()).map(([e,t])=>[e,t])}setEntry(e,t){let n=new r(this._entries);return n._entries.set(e,t),n}removeEntry(e){let t=new r(this._entries);return t._entries.delete(e),t}removeEntries(...e){let t=new r(this._entries);for(let r of e)t._entries.delete(r);return t}clear(){return new r}}t.BaggageImpl=r},830:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataSymbol=void 0,t.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")},369:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataFromString=t.createBaggage=void 0;let n=r(930),i=r(993),o=r(830),s=n.DiagAPI.instance();t.createBaggage=function(e={}){return new i.BaggageImpl(new Map(Object.entries(e)))},t.baggageEntryMetadataFromString=function(e){return"string"!=typeof e&&(s.error(`Cannot create baggage metadata from unknown type: ${typeof e}`),e=""),{__TYPE__:o.baggageEntryMetadataSymbol,toString:()=>e}}},67:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.context=void 0;let n=r(491);t.context=n.ContextAPI.getInstance()},223:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopContextManager=void 0;let n=r(780);class i{active(){return n.ROOT_CONTEXT}with(e,t,r,...n){return t.call(r,...n)}bind(e,t){return t}enable(){return this}disable(){return this}}t.NoopContextManager=i},780:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ROOT_CONTEXT=t.createContextKey=void 0,t.createContextKey=function(e){return Symbol.for(e)};class r{constructor(e){let t=this;t._currentContext=e?new Map(e):new Map,t.getValue=e=>t._currentContext.get(e),t.setValue=(e,n)=>{let i=new r(t._currentContext);return i._currentContext.set(e,n),i},t.deleteValue=e=>{let n=new r(t._currentContext);return n._currentContext.delete(e),n}}}t.ROOT_CONTEXT=new r},506:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diag=void 0;let n=r(930);t.diag=n.DiagAPI.instance()},56:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagComponentLogger=void 0;let n=r(172);class i{constructor(e){this._namespace=e.namespace||"DiagComponentLogger"}debug(...e){return o("debug",this._namespace,e)}error(...e){return o("error",this._namespace,e)}info(...e){return o("info",this._namespace,e)}warn(...e){return o("warn",this._namespace,e)}verbose(...e){return o("verbose",this._namespace,e)}}function o(e,t,r){let i=(0,n.getGlobal)("diag");if(i)return r.unshift(t),i[e](...r)}t.DiagComponentLogger=i},972:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagConsoleLogger=void 0;let r=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];class n{constructor(){for(let e=0;e<r.length;e++)this[r[e].n]=function(e){return function(...t){if(console){let r=console[e];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,t)}}}(r[e].c)}}t.DiagConsoleLogger=n},912:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLogLevelDiagLogger=void 0;let n=r(957);t.createLogLevelDiagLogger=function(e,t){function r(r,n){let i=t[r];return"function"==typeof i&&e>=n?i.bind(t):function(){}}return e<n.DiagLogLevel.NONE?e=n.DiagLogLevel.NONE:e>n.DiagLogLevel.ALL&&(e=n.DiagLogLevel.ALL),t=t||{},{error:r("error",n.DiagLogLevel.ERROR),warn:r("warn",n.DiagLogLevel.WARN),info:r("info",n.DiagLogLevel.INFO),debug:r("debug",n.DiagLogLevel.DEBUG),verbose:r("verbose",n.DiagLogLevel.VERBOSE)}}},957:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagLogLevel=void 0,function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(t.DiagLogLevel||(t.DiagLogLevel={}))},172:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unregisterGlobal=t.getGlobal=t.registerGlobal=void 0;let n=r(200),i=r(521),o=r(130),s=i.VERSION.split(".")[0],a=Symbol.for(`opentelemetry.js.api.${s}`),l=n._globalThis;t.registerGlobal=function(e,t,r,n=!1){var o;let s=l[a]=null!==(o=l[a])&&void 0!==o?o:{version:i.VERSION};if(!n&&s[e]){let t=Error(`@opentelemetry/api: Attempted duplicate registration of API: ${e}`);return r.error(t.stack||t.message),!1}if(s.version!==i.VERSION){let t=Error(`@opentelemetry/api: Registration of version v${s.version} for ${e} does not match previously registered API v${i.VERSION}`);return r.error(t.stack||t.message),!1}return s[e]=t,r.debug(`@opentelemetry/api: Registered a global for ${e} v${i.VERSION}.`),!0},t.getGlobal=function(e){var t,r;let n=null===(t=l[a])||void 0===t?void 0:t.version;if(n&&(0,o.isCompatible)(n))return null===(r=l[a])||void 0===r?void 0:r[e]},t.unregisterGlobal=function(e,t){t.debug(`@opentelemetry/api: Unregistering a global for ${e} v${i.VERSION}.`);let r=l[a];r&&delete r[e]}},130:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCompatible=t._makeCompatibilityCheck=void 0;let n=r(521),i=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function o(e){let t=new Set([e]),r=new Set,n=e.match(i);if(!n)return()=>!1;let o={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(null!=o.prerelease)return function(t){return t===e};function s(e){return r.add(e),!1}return function(e){if(t.has(e))return!0;if(r.has(e))return!1;let n=e.match(i);if(!n)return s(e);let a={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};return null!=a.prerelease||o.major!==a.major?s(e):0===o.major?o.minor===a.minor&&o.patch<=a.patch?(t.add(e),!0):s(e):o.minor<=a.minor?(t.add(e),!0):s(e)}}t._makeCompatibilityCheck=o,t.isCompatible=o(n.VERSION)},886:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.metrics=void 0;let n=r(653);t.metrics=n.MetricsAPI.getInstance()},901:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValueType=void 0,function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(t.ValueType||(t.ValueType={}))},102:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createNoopMeter=t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=t.NOOP_OBSERVABLE_GAUGE_METRIC=t.NOOP_OBSERVABLE_COUNTER_METRIC=t.NOOP_UP_DOWN_COUNTER_METRIC=t.NOOP_HISTOGRAM_METRIC=t.NOOP_COUNTER_METRIC=t.NOOP_METER=t.NoopObservableUpDownCounterMetric=t.NoopObservableGaugeMetric=t.NoopObservableCounterMetric=t.NoopObservableMetric=t.NoopHistogramMetric=t.NoopUpDownCounterMetric=t.NoopCounterMetric=t.NoopMetric=t.NoopMeter=void 0;class r{constructor(){}createHistogram(e,r){return t.NOOP_HISTOGRAM_METRIC}createCounter(e,r){return t.NOOP_COUNTER_METRIC}createUpDownCounter(e,r){return t.NOOP_UP_DOWN_COUNTER_METRIC}createObservableGauge(e,r){return t.NOOP_OBSERVABLE_GAUGE_METRIC}createObservableCounter(e,r){return t.NOOP_OBSERVABLE_COUNTER_METRIC}createObservableUpDownCounter(e,r){return t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC}addBatchObservableCallback(e,t){}removeBatchObservableCallback(e){}}t.NoopMeter=r;class n{}t.NoopMetric=n;class i extends n{add(e,t){}}t.NoopCounterMetric=i;class o extends n{add(e,t){}}t.NoopUpDownCounterMetric=o;class s extends n{record(e,t){}}t.NoopHistogramMetric=s;class a{addCallback(e){}removeCallback(e){}}t.NoopObservableMetric=a;class l extends a{}t.NoopObservableCounterMetric=l;class c extends a{}t.NoopObservableGaugeMetric=c;class u extends a{}t.NoopObservableUpDownCounterMetric=u,t.NOOP_METER=new r,t.NOOP_COUNTER_METRIC=new i,t.NOOP_HISTOGRAM_METRIC=new s,t.NOOP_UP_DOWN_COUNTER_METRIC=new o,t.NOOP_OBSERVABLE_COUNTER_METRIC=new l,t.NOOP_OBSERVABLE_GAUGE_METRIC=new c,t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new u,t.createNoopMeter=function(){return t.NOOP_METER}},660:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NOOP_METER_PROVIDER=t.NoopMeterProvider=void 0;let n=r(102);class i{getMeter(e,t,r){return n.NOOP_METER}}t.NoopMeterProvider=i,t.NOOP_METER_PROVIDER=new i},200:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(46),t)},651:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._globalThis=void 0,t._globalThis="object"==typeof globalThis?globalThis:global},46:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(651),t)},939:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.propagation=void 0;let n=r(181);t.propagation=n.PropagationAPI.getInstance()},874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTextMapPropagator=void 0;class r{inject(e,t){}extract(e,t){return e}fields(){return[]}}t.NoopTextMapPropagator=r},194:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTextMapSetter=t.defaultTextMapGetter=void 0,t.defaultTextMapGetter={get(e,t){if(null!=e)return e[t]},keys:e=>null==e?[]:Object.keys(e)},t.defaultTextMapSetter={set(e,t,r){null!=e&&(e[t]=r)}}},845:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trace=void 0;let n=r(997);t.trace=n.TraceAPI.getInstance()},403:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NonRecordingSpan=void 0;let n=r(476);class i{constructor(e=n.INVALID_SPAN_CONTEXT){this._spanContext=e}spanContext(){return this._spanContext}setAttribute(e,t){return this}setAttributes(e){return this}addEvent(e,t){return this}setStatus(e){return this}updateName(e){return this}end(e){}isRecording(){return!1}recordException(e,t){}}t.NonRecordingSpan=i},614:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracer=void 0;let n=r(491),i=r(607),o=r(403),s=r(139),a=n.ContextAPI.getInstance();class l{startSpan(e,t,r=a.active()){if(null==t?void 0:t.root)return new o.NonRecordingSpan;let n=r&&(0,i.getSpanContext)(r);return"object"==typeof n&&"string"==typeof n.spanId&&"string"==typeof n.traceId&&"number"==typeof n.traceFlags&&(0,s.isSpanContextValid)(n)?new o.NonRecordingSpan(n):new o.NonRecordingSpan}startActiveSpan(e,t,r,n){let o,s,l;if(arguments.length<2)return;2==arguments.length?l=t:3==arguments.length?(o=t,l=r):(o=t,s=r,l=n);let c=null!=s?s:a.active(),u=this.startSpan(e,o,c),d=(0,i.setSpan)(c,u);return a.with(d,l,void 0,u)}}t.NoopTracer=l},124:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracerProvider=void 0;let n=r(614);class i{getTracer(e,t,r){return new n.NoopTracer}}t.NoopTracerProvider=i},125:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracer=void 0;let n=new(r(614)).NoopTracer;class i{constructor(e,t,r,n){this._provider=e,this.name=t,this.version=r,this.options=n}startSpan(e,t,r){return this._getTracer().startSpan(e,t,r)}startActiveSpan(e,t,r,n){let i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)}_getTracer(){if(this._delegate)return this._delegate;let e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):n}}t.ProxyTracer=i},846:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracerProvider=void 0;let n=r(125),i=new(r(124)).NoopTracerProvider;class o{getTracer(e,t,r){var i;return null!==(i=this.getDelegateTracer(e,t,r))&&void 0!==i?i:new n.ProxyTracer(this,e,t,r)}getDelegate(){var e;return null!==(e=this._delegate)&&void 0!==e?e:i}setDelegate(e){this._delegate=e}getDelegateTracer(e,t,r){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getTracer(e,t,r)}}t.ProxyTracerProvider=o},996:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SamplingDecision=void 0,function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(t.SamplingDecision||(t.SamplingDecision={}))},607:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSpanContext=t.setSpanContext=t.deleteSpan=t.setSpan=t.getActiveSpan=t.getSpan=void 0;let n=r(780),i=r(403),o=r(491),s=(0,n.createContextKey)("OpenTelemetry Context Key SPAN");function a(e){return e.getValue(s)||void 0}function l(e,t){return e.setValue(s,t)}t.getSpan=a,t.getActiveSpan=function(){return a(o.ContextAPI.getInstance().active())},t.setSpan=l,t.deleteSpan=function(e){return e.deleteValue(s)},t.setSpanContext=function(e,t){return l(e,new i.NonRecordingSpan(t))},t.getSpanContext=function(e){var t;return null===(t=a(e))||void 0===t?void 0:t.spanContext()}},325:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceStateImpl=void 0;let n=r(564);class i{constructor(e){this._internalState=new Map,e&&this._parse(e)}set(e,t){let r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r}unset(e){let t=this._clone();return t._internalState.delete(e),t}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,t)=>(e.push(t+"="+this.get(t)),e),[]).join(",")}_parse(e){!(e.length>512)&&(this._internalState=e.split(",").reverse().reduce((e,t)=>{let r=t.trim(),i=r.indexOf("=");if(-1!==i){let o=r.slice(0,i),s=r.slice(i+1,t.length);(0,n.validateKey)(o)&&(0,n.validateValue)(s)&&e.set(o,s)}return e},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){let e=new i;return e._internalState=new Map(this._internalState),e}}t.TraceStateImpl=i},564:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateValue=t.validateKey=void 0;let r="[_0-9a-z-*/]",n=`[a-z]${r}{0,255}`,i=`[a-z0-9]${r}{0,240}@[a-z]${r}{0,13}`,o=RegExp(`^(?:${n}|${i})$`),s=/^[ -~]{0,255}[!-~]$/,a=/,|=/;t.validateKey=function(e){return o.test(e)},t.validateValue=function(e){return s.test(e)&&!a.test(e)}},98:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTraceState=void 0;let n=r(325);t.createTraceState=function(e){return new n.TraceStateImpl(e)}},476:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.INVALID_SPAN_CONTEXT=t.INVALID_TRACEID=t.INVALID_SPANID=void 0;let n=r(475);t.INVALID_SPANID="0000000000000000",t.INVALID_TRACEID="00000000000000000000000000000000",t.INVALID_SPAN_CONTEXT={traceId:t.INVALID_TRACEID,spanId:t.INVALID_SPANID,traceFlags:n.TraceFlags.NONE}},357:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpanKind=void 0,function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(t.SpanKind||(t.SpanKind={}))},139:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wrapSpanContext=t.isSpanContextValid=t.isValidSpanId=t.isValidTraceId=void 0;let n=r(476),i=r(403),o=/^([0-9a-f]{32})$/i,s=/^[0-9a-f]{16}$/i;function a(e){return o.test(e)&&e!==n.INVALID_TRACEID}function l(e){return s.test(e)&&e!==n.INVALID_SPANID}t.isValidTraceId=a,t.isValidSpanId=l,t.isSpanContextValid=function(e){return a(e.traceId)&&l(e.spanId)},t.wrapSpanContext=function(e){return new i.NonRecordingSpan(e)}},847:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpanStatusCode=void 0,function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(t.SpanStatusCode||(t.SpanStatusCode={}))},475:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceFlags=void 0,function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(t.TraceFlags||(t.TraceFlags={}))},521:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="1.6.0"}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var o=r[e]={exports:{}},s=!0;try{t[e].call(o.exports,o,o.exports,n),s=!1}finally{s&&delete r[e]}return o.exports}n.ab=__dirname+"/";var i={};(()=>{Object.defineProperty(i,"__esModule",{value:!0}),i.trace=i.propagation=i.metrics=i.diag=i.context=i.INVALID_SPAN_CONTEXT=i.INVALID_TRACEID=i.INVALID_SPANID=i.isValidSpanId=i.isValidTraceId=i.isSpanContextValid=i.createTraceState=i.TraceFlags=i.SpanStatusCode=i.SpanKind=i.SamplingDecision=i.ProxyTracerProvider=i.ProxyTracer=i.defaultTextMapSetter=i.defaultTextMapGetter=i.ValueType=i.createNoopMeter=i.DiagLogLevel=i.DiagConsoleLogger=i.ROOT_CONTEXT=i.createContextKey=i.baggageEntryMetadataFromString=void 0;var e=n(369);Object.defineProperty(i,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return e.baggageEntryMetadataFromString}});var t=n(780);Object.defineProperty(i,"createContextKey",{enumerable:!0,get:function(){return t.createContextKey}}),Object.defineProperty(i,"ROOT_CONTEXT",{enumerable:!0,get:function(){return t.ROOT_CONTEXT}});var r=n(972);Object.defineProperty(i,"DiagConsoleLogger",{enumerable:!0,get:function(){return r.DiagConsoleLogger}});var o=n(957);Object.defineProperty(i,"DiagLogLevel",{enumerable:!0,get:function(){return o.DiagLogLevel}});var s=n(102);Object.defineProperty(i,"createNoopMeter",{enumerable:!0,get:function(){return s.createNoopMeter}});var a=n(901);Object.defineProperty(i,"ValueType",{enumerable:!0,get:function(){return a.ValueType}});var l=n(194);Object.defineProperty(i,"defaultTextMapGetter",{enumerable:!0,get:function(){return l.defaultTextMapGetter}}),Object.defineProperty(i,"defaultTextMapSetter",{enumerable:!0,get:function(){return l.defaultTextMapSetter}});var c=n(125);Object.defineProperty(i,"ProxyTracer",{enumerable:!0,get:function(){return c.ProxyTracer}});var u=n(846);Object.defineProperty(i,"ProxyTracerProvider",{enumerable:!0,get:function(){return u.ProxyTracerProvider}});var d=n(996);Object.defineProperty(i,"SamplingDecision",{enumerable:!0,get:function(){return d.SamplingDecision}});var p=n(357);Object.defineProperty(i,"SpanKind",{enumerable:!0,get:function(){return p.SpanKind}});var h=n(847);Object.defineProperty(i,"SpanStatusCode",{enumerable:!0,get:function(){return h.SpanStatusCode}});var f=n(475);Object.defineProperty(i,"TraceFlags",{enumerable:!0,get:function(){return f.TraceFlags}});var m=n(98);Object.defineProperty(i,"createTraceState",{enumerable:!0,get:function(){return m.createTraceState}});var g=n(139);Object.defineProperty(i,"isSpanContextValid",{enumerable:!0,get:function(){return g.isSpanContextValid}}),Object.defineProperty(i,"isValidTraceId",{enumerable:!0,get:function(){return g.isValidTraceId}}),Object.defineProperty(i,"isValidSpanId",{enumerable:!0,get:function(){return g.isValidSpanId}});var y=n(476);Object.defineProperty(i,"INVALID_SPANID",{enumerable:!0,get:function(){return y.INVALID_SPANID}}),Object.defineProperty(i,"INVALID_TRACEID",{enumerable:!0,get:function(){return y.INVALID_TRACEID}}),Object.defineProperty(i,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return y.INVALID_SPAN_CONTEXT}});let v=n(67);Object.defineProperty(i,"context",{enumerable:!0,get:function(){return v.context}});let b=n(506);Object.defineProperty(i,"diag",{enumerable:!0,get:function(){return b.diag}});let _=n(886);Object.defineProperty(i,"metrics",{enumerable:!0,get:function(){return _.metrics}});let E=n(939);Object.defineProperty(i,"propagation",{enumerable:!0,get:function(){return E.propagation}});let w=n(845);Object.defineProperty(i,"trace",{enumerable:!0,get:function(){return w.trace}}),i.default={context:v.context,diag:b.diag,metrics:_.metrics,propagation:E.propagation,trace:w.trace}})(),e.exports=i})()},10189:(e,t,r)=>{"use strict";var n=r(49634),i={stream:!0},o=new Map;function s(e){var t=globalThis.__next_require__(e);return"function"!=typeof t.then||"fulfilled"===t.status?null:(t.then(function(e){t.status="fulfilled",t.value=e},function(e){t.status="rejected",t.reason=e}),t)}function a(){}var l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Dispatcher,c=Symbol.for("react.element"),u=Symbol.for("react.lazy"),d=Symbol.iterator,p=Array.isArray,h=Object.getPrototypeOf,f=Object.prototype,m=new WeakMap;function g(e,t,r,n){var i=1,o=0,s=null;e=JSON.stringify(e,function e(a,l){if(null===l)return null;if("object"==typeof l){if("function"==typeof l.then){null===s&&(s=new FormData),o++;var c,u,g=i++;return l.then(function(n){n=JSON.stringify(n,e);var i=s;i.append(t+g,n),0==--o&&r(i)},function(e){n(e)}),"$@"+g.toString(16)}if(p(l))return l;if(l instanceof FormData){null===s&&(s=new FormData);var y=s,v=t+(a=i++)+"_";return l.forEach(function(e,t){y.append(v+t,e)}),"$K"+a.toString(16)}if(l instanceof Map)return l=JSON.stringify(Array.from(l),e),null===s&&(s=new FormData),a=i++,s.append(t+a,l),"$Q"+a.toString(16);if(l instanceof Set)return l=JSON.stringify(Array.from(l),e),null===s&&(s=new FormData),a=i++,s.append(t+a,l),"$W"+a.toString(16);if(null===(u=l)||"object"!=typeof u?null:"function"==typeof(u=d&&u[d]||u["@@iterator"])?u:null)return Array.from(l);if((a=h(l))!==f&&(null===a||null!==h(a)))throw Error("Only plain objects, and a few built-ins, can be passed to Server Actions. Classes or null prototypes are not supported.");return l}if("string"==typeof l)return"Z"===l[l.length-1]&&this[a]instanceof Date?"$D"+l:l="$"===l[0]?"$"+l:l;if("boolean"==typeof l)return l;if("number"==typeof l)return Number.isFinite(c=l)?0===c&&-1/0==1/c?"$-0":c:1/0===c?"$Infinity":-1/0===c?"$-Infinity":"$NaN";if(void 0===l)return"$undefined";if("function"==typeof l){if(void 0!==(l=m.get(l)))return l=JSON.stringify(l,e),null===s&&(s=new FormData),a=i++,s.set(t+a,l),"$F"+a.toString(16);throw Error("Client Functions cannot be passed directly to Server Functions. Only Functions passed from the Server can be passed back again.")}if("symbol"==typeof l){if(Symbol.for(a=l.description)!==l)throw Error("Only global symbols received from Symbol.for(...) can be passed to Server Functions. The symbol Symbol.for("+l.description+") cannot be found among global symbols.");return"$S"+a}if("bigint"==typeof l)return"$n"+l.toString(10);throw Error("Type "+typeof l+" is not supported as an argument to a Server Function.")}),null===s?r(e):(s.set(t+"0",e),0===o&&r(s))}var y=new WeakMap;function v(e){var t=m.get(this);if(!t)throw Error("Tried to encode a Server Action from a different instance than the encoder is from. This is a bug in React.");var r=null;if(null!==t.bound){if((r=y.get(t))||(n=t,s=new Promise(function(e,t){i=e,o=t}),g(n,"",function(e){if("string"==typeof e){var t=new FormData;t.append("0",e),e=t}s.status="fulfilled",s.value=e,i(e)},function(e){s.status="rejected",s.reason=e,o(e)}),r=s,y.set(t,r)),"rejected"===r.status)throw r.reason;if("fulfilled"!==r.status)throw r;t=r.value;var n,i,o,s,a=new FormData;t.forEach(function(t,r){a.append("$ACTION_"+e+":"+r,t)}),r=a,t="$ACTION_REF_"+e}else t="$ACTION_ID_"+t.id;return{name:t,method:"POST",encType:"multipart/form-data",data:r}}function b(e,t){var r=m.get(this);if(!r)throw Error("Tried to encode a Server Action from a different instance than the encoder is from. This is a bug in React.");if(r.id!==e)return!1;var n=r.bound;if(null===n)return 0===t;switch(n.status){case"fulfilled":return n.value.length===t;case"pending":throw n;case"rejected":throw n.reason;default:throw"string"!=typeof n.status&&(n.status="pending",n.then(function(e){n.status="fulfilled",n.value=e},function(e){n.status="rejected",n.reason=e})),n}}function _(e,t,r){Object.defineProperties(e,{$$FORM_ACTION:{value:void 0===r?v:function(){var e=m.get(this);if(!e)throw Error("Tried to encode a Server Action from a different instance than the encoder is from. This is a bug in React.");var t=e.bound;return null===t&&(t=Promise.resolve([])),r(e.id,t)}},$$IS_SIGNATURE_EQUAL:{value:b},bind:{value:x}}),m.set(e,t)}var E=Function.prototype.bind,w=Array.prototype.slice;function x(){var e=E.apply(this,arguments),t=m.get(this);if(t){var r=w.call(arguments,1),n=null;n=null!==t.bound?Promise.resolve(t.bound).then(function(e){return e.concat(r)}):Promise.resolve(r),Object.defineProperties(e,{$$FORM_ACTION:{value:this.$$FORM_ACTION},$$IS_SIGNATURE_EQUAL:{value:b},bind:{value:x}}),m.set(e,{id:t.id,bound:n})}return e}function S(e,t,r,n){this.status=e,this.value=t,this.reason=r,this._response=n}function T(e){switch(e.status){case"resolved_model":R(e);break;case"resolved_module":P(e)}switch(e.status){case"fulfilled":return e.value;case"pending":case"blocked":case"cyclic":throw e;default:throw e.reason}}function A(e,t){for(var r=0;r<e.length;r++)(0,e[r])(t)}function C(e,t,r){switch(e.status){case"fulfilled":A(t,e.value);break;case"pending":case"blocked":case"cyclic":e.value=t,e.reason=r;break;case"rejected":r&&A(r,e.reason)}}function O(e,t){if("pending"===e.status||"blocked"===e.status){var r=e.reason;e.status="rejected",e.reason=t,null!==r&&A(r,t)}}function I(e,t){if("pending"===e.status||"blocked"===e.status){var r=e.value,n=e.reason;e.status="resolved_module",e.value=t,null!==r&&(P(e),C(e,r,n))}}S.prototype=Object.create(Promise.prototype),S.prototype.then=function(e,t){switch(this.status){case"resolved_model":R(this);break;case"resolved_module":P(this)}switch(this.status){case"fulfilled":e(this.value);break;case"pending":case"blocked":case"cyclic":e&&(null===this.value&&(this.value=[]),this.value.push(e)),t&&(null===this.reason&&(this.reason=[]),this.reason.push(t));break;default:t(this.reason)}};var N=null,k=null;function R(e){var t=N,r=k;N=e,k=null;var n=e.value;e.status="cyclic",e.value=null,e.reason=null;try{var i=JSON.parse(n,e._response._fromJSON);if(null!==k&&0<k.deps)k.value=i,e.status="blocked",e.value=null,e.reason=null;else{var o=e.value;e.status="fulfilled",e.value=i,null!==o&&A(o,i)}}catch(t){e.status="rejected",e.reason=t}finally{N=t,k=r}}function P(e){try{var t=e.value,r=globalThis.__next_require__(t[0]);if(4===t.length&&"function"==typeof r.then){if("fulfilled"===r.status)r=r.value;else throw r.reason}var n="*"===t[2]?r:""===t[2]?r.__esModule?r.default:r:r[t[2]];e.status="fulfilled",e.value=n}catch(t){e.status="rejected",e.reason=t}}function j(e,t){e._chunks.forEach(function(e){"pending"===e.status&&O(e,t)})}function M(e,t){var r=e._chunks,n=r.get(t);return n||(n=new S("pending",null,null,e),r.set(t,n)),n}function D(e,t){if("resolved_model"===(e=M(e,t)).status&&R(e),"fulfilled"===e.status)return e.value;throw e.reason}function U(){throw Error('Trying to call a function from "use server" but the callServer option was not implemented in your router runtime.')}function L(){throw Error("Server Functions cannot be called during initial render. This would create a fetch waterfall. Try to use a Server Component to pass data to Client Components instead.")}function G(e){var t,r=e.ssrManifest.moduleMap;return(r={_bundlerConfig:r,_moduleLoading:e.ssrManifest.moduleLoading,_callServer:void 0!==L?L:U,_encodeFormAction:e.encodeFormAction,_nonce:e="string"==typeof e.nonce?e.nonce:void 0,_chunks:new Map,_stringDecoder:new TextDecoder,_fromJSON:null,_rowState:0,_rowID:0,_rowTag:0,_rowLength:0,_buffer:[]})._fromJSON=(t=r,function(e,r){return"string"==typeof r?function(e,t,r,n){if("$"===n[0]){if("$"===n)return c;switch(n[1]){case"$":return n.slice(1);case"L":return{$$typeof:u,_payload:e=M(e,t=parseInt(n.slice(2),16)),_init:T};case"@":if(2===n.length)return new Promise(function(){});return M(e,t=parseInt(n.slice(2),16));case"S":return Symbol.for(n.slice(2));case"F":return t=D(e,t=parseInt(n.slice(2),16)),function(e,t){function r(){var e=Array.prototype.slice.call(arguments),r=t.bound;return r?"fulfilled"===r.status?n(t.id,r.value.concat(e)):Promise.resolve(r).then(function(r){return n(t.id,r.concat(e))}):n(t.id,e)}var n=e._callServer;return _(r,t,e._encodeFormAction),r}(e,t);case"Q":return new Map(e=D(e,t=parseInt(n.slice(2),16)));case"W":return new Set(e=D(e,t=parseInt(n.slice(2),16)));case"I":return 1/0;case"-":return"$-0"===n?-0:-1/0;case"N":return NaN;case"u":return;case"D":return new Date(Date.parse(n.slice(2)));case"n":return BigInt(n.slice(2));default:switch((e=M(e,n=parseInt(n.slice(1),16))).status){case"resolved_model":R(e);break;case"resolved_module":P(e)}switch(e.status){case"fulfilled":return e.value;case"pending":case"blocked":case"cyclic":var i;return n=N,e.then(function(e,t,r,n){if(k){var i=k;n||i.deps++}else i=k={deps:n?0:1,value:null};return function(n){t[r]=n,i.deps--,0===i.deps&&"blocked"===e.status&&(n=e.value,e.status="fulfilled",e.value=i.value,null!==n&&A(n,i.value))}}(n,t,r,"cyclic"===e.status),(i=n,function(e){return O(i,e)})),null;default:throw e.reason}}}return n}(t,this,e,r):"object"==typeof r&&null!==r?e=r[0]===c?{$$typeof:c,type:r[1],key:r[2],ref:null,props:r[3],_owner:null}:r:r}),r}function F(e,t){function n(t){j(e,t)}var c=t.getReader();c.read().then(function t(u){var d=u.value;if(u.done)j(e,Error("Connection closed."));else{var p=0,h=e._rowState,f=e._rowID,m=e._rowTag,g=e._rowLength;u=e._buffer;for(var y=d.length;p<y;){var v=-1;switch(h){case 0:58===(v=d[p++])?h=1:f=f<<4|(96<v?v-87:v-48);continue;case 1:84===(h=d[p])?(m=h,h=2,p++):64<h&&91>h?(m=h,h=3,p++):(m=0,h=3);continue;case 2:44===(v=d[p++])?h=4:g=g<<4|(96<v?v-87:v-48);continue;case 3:v=d.indexOf(10,p);break;case 4:(v=p+g)>d.length&&(v=-1)}var b=d.byteOffset+p;if(-1<v){p=new Uint8Array(d.buffer,b,v-p),g=e,b=m;var _=g._stringDecoder;m="";for(var E=0;E<u.length;E++)m+=_.decode(u[E],i);switch(m+=_.decode(p),b){case 73:!function(e,t,n){var i=e._chunks,c=i.get(t);n=JSON.parse(n,e._fromJSON);var u=function(e,t){if(e){var r=e[t[0]];if(e=r[t[2]])r=e.name;else{if(!(e=r["*"]))throw Error('Could not find the module "'+t[0]+'" in the React SSR Manifest. This is probably a bug in the React Server Components bundler.');r=t[2]}return 4===t.length?[e.id,e.chunks,r,1]:[e.id,e.chunks,r]}return t}(e._bundlerConfig,n);if(function(e,t,r){if(null!==e)for(var n=1;n<t.length;n+=2){var i=l.current;if(i){var o=i.preinitScript,s=e.prefix+t[n],a=e.crossOrigin;a="string"==typeof a?"use-credentials"===a?a:"":void 0,o.call(i,s,{crossOrigin:a,nonce:r})}}}(e._moduleLoading,n[1],e._nonce),n=function(e){for(var t=e[1],n=[],i=0;i<t.length;){var l=t[i++];t[i++];var c=o.get(l);if(void 0===c){c=r.e(l),n.push(c);var u=o.set.bind(o,l,null);c.then(u,a),o.set(l,c)}else null!==c&&n.push(c)}return 4===e.length?0===n.length?s(e[0]):Promise.all(n).then(function(){return s(e[0])}):0<n.length?Promise.all(n):null}(u)){if(c){var d=c;d.status="blocked"}else d=new S("blocked",null,null,e),i.set(t,d);n.then(function(){return I(d,u)},function(e){return O(d,e)})}else c?I(c,u):i.set(t,new S("resolved_module",u,null,e))}(g,f,m);break;case 72:if(f=m[0],g=JSON.parse(m=m.slice(1),g._fromJSON),m=l.current)switch(f){case"D":m.prefetchDNS(g);break;case"C":"string"==typeof g?m.preconnect(g):m.preconnect(g[0],g[1]);break;case"L":f=g[0],p=g[1],3===g.length?m.preload(f,p,g[2]):m.preload(f,p);break;case"m":"string"==typeof g?m.preloadModule(g):m.preloadModule(g[0],g[1]);break;case"S":"string"==typeof g?m.preinitStyle(g):m.preinitStyle(g[0],0===g[1]?void 0:g[1],3===g.length?g[2]:void 0);break;case"X":"string"==typeof g?m.preinitScript(g):m.preinitScript(g[0],g[1]);break;case"M":"string"==typeof g?m.preinitModuleScript(g):m.preinitModuleScript(g[0],g[1])}break;case 69:p=(m=JSON.parse(m)).digest,(m=Error("An error occurred in the Server Components render. The specific message is omitted in production builds to avoid leaking sensitive details. A digest property is included on this error instance which may provide additional details about the nature of the error.")).stack="Error: "+m.message,m.digest=p,(b=(p=g._chunks).get(f))?O(b,m):p.set(f,new S("rejected",null,m,g));break;case 84:g._chunks.set(f,new S("fulfilled",m,null,g));break;case 68:case 87:throw Error("Failed to read a RSC payload created by a development version of React on the server while using a production version on the client. Always use matching versions on the server and the client.");default:(b=(p=g._chunks).get(f))?(g=b,f=m,"pending"===g.status&&(m=g.value,p=g.reason,g.status="resolved_model",g.value=f,null!==m&&(R(g),C(g,m,p)))):p.set(f,new S("resolved_model",m,null,g))}p=v,3===h&&p++,g=f=m=h=0,u.length=0}else{d=new Uint8Array(d.buffer,b,d.byteLength-p),u.push(d),g-=d.byteLength;break}}return e._rowState=h,e._rowID=f,e._rowTag=m,e._rowLength=g,c.read().then(t).catch(n)}}).catch(n)}t.createFromFetch=function(e,t){var r=G(t);return e.then(function(e){F(r,e.body)},function(e){j(r,e)}),M(r,0)},t.createFromReadableStream=function(e,t){return F(t=G(t),e),M(t,0)},t.createServerReference=function(e){return function(e,t,r){function n(){var r=Array.prototype.slice.call(arguments);return t(e,r)}return _(n,{id:e,bound:null},r),n}(e,L)},t.encodeReply=function(e){return new Promise(function(t,r){g(e,"",t,r)})}},85668:(e,t,r)=>{"use strict";e.exports=r(10189)},83204:()=>{},808:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DetachedPromise",{enumerable:!0,get:function(){return r}});class r{constructor(){let e,t;this.promise=new Promise((r,n)=>{e=r,t=n}),this.resolve=e,this.reject=t}}},89061:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{atLeastOneTask:function(){return i},scheduleImmediate:function(){return n},scheduleOnNextTick:function(){return r}});let r=e=>{Promise.resolve().then(()=>{process.nextTick(e)})},n=e=>{setImmediate(e)};function i(){return new Promise(e=>n(e))}},49597:(e,t)=>{"use strict";let r,n;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{arrayBufferToString:function(){return o},decrypt:function(){return l},encrypt:function(){return a},generateEncryptionKeyBase64:function(){return c},getActionEncryptionKey:function(){return f},getClientReferenceManifestSingleton:function(){return h},getServerModuleMap:function(){return p},setReferenceManifestsSingleton:function(){return d},stringToUint8Array:function(){return s}});let i=null;function o(e){let t=new Uint8Array(e),r=t.byteLength;if(r<65535)return String.fromCharCode.apply(null,t);let n="";for(let e=0;e<r;e++)n+=String.fromCharCode(t[e]);return n}function s(e){let t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r}function a(e,t,r){return crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,r)}function l(e,t,r){return crypto.subtle.decrypt({name:"AES-GCM",iv:t},e,r)}async function c(e){if(e&&void 0!==n)return n;i||(i=new Promise(async(e,t)=>{try{let t=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),r=await crypto.subtle.exportKey("raw",t),n=btoa(o(r));e([t,n])}catch(e){t(e)}}));let[t,s]=await i;return r=t,e&&(n=s),s}let u=Symbol.for("next.server.action-manifests");function d({clientReferenceManifest:e,serverActionsManifest:t,serverModuleMap:r}){globalThis[u]={clientReferenceManifest:e,serverActionsManifest:t,serverModuleMap:r}}function p(){let e=globalThis[u];if(!e)throw Error("Missing manifest for Server Actions. This is a bug in Next.js");return e.serverModuleMap}function h(){let e=globalThis[u];if(!e)throw Error("Missing manifest for Server Actions. This is a bug in Next.js");return e.clientReferenceManifest}async function f(){if(r)return r;let e=globalThis[u];if(!e)throw Error("Missing manifest for Server Actions. This is a bug in Next.js");let t=process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY||e.serverActionsManifest.encryptionKey;if(void 0===t)throw Error("Missing encryption key for Server Actions");return r=await crypto.subtle.importKey("raw",s(atob(t)),"AES-GCM",!0,["encrypt","decrypt"])}},26461:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{decryptActionBoundArgs:function(){return p},encryptActionBoundArgs:function(){return d}}),r(83204);let n=r(96012),i=r(85668),o=r(43598),s=r(49597),a=new TextEncoder,l=new TextDecoder;async function c(e,t){let r=await (0,s.getActionEncryptionKey)();if(void 0===r)throw Error("Missing encryption key for Server Action. This is a bug in Next.js");let n=atob(t),i=n.slice(0,16),o=n.slice(16),a=l.decode(await (0,s.decrypt)(r,(0,s.stringToUint8Array)(i),(0,s.stringToUint8Array)(o)));if(!a.startsWith(e))throw Error("Invalid Server Action payload: failed to decrypt.");return a.slice(e.length)}async function u(e,t){let r=await (0,s.getActionEncryptionKey)();if(void 0===r)throw Error("Missing encryption key for Server Action. This is a bug in Next.js");let n=new Uint8Array(16);crypto.getRandomValues(n);let i=(0,s.arrayBufferToString)(n.buffer),o=await (0,s.encrypt)(r,n,a.encode(e+t));return btoa(i+(0,s.arrayBufferToString)(o))}async function d(e,t){let r=(0,s.getClientReferenceManifestSingleton)(),i=await (0,o.streamToString)((0,n.renderToReadableStream)(t,r.clientModules));return await u(e,i)}async function p(e,t){let r=await c(e,await t),o=await (0,i.createFromReadableStream)(new ReadableStream({start(e){e.enqueue(a.encode(r)),e.close()}}),{ssrManifest:{moduleLoading:{},moduleMap:{}}}),l=(0,s.getServerModuleMap)();return await (0,n.decodeReply)(await (0,i.encodeReply)(o),l)}},49634:(e,t,r)=>{"use strict";e.exports=r(23191).vendored["react-rsc"].ReactDOM},96012:(e,t,r)=>{"use strict";e.exports=r(23191).vendored["react-rsc"].ReactServerDOMWebpackServerEdge},98467:(e,t)=>{"use strict";var r,n,i,o,s,a,l,c,u,d,p,h;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{AppRenderSpan:function(){return l},AppRouteRouteHandlersSpan:function(){return d},BaseServerSpan:function(){return r},LoadComponentsSpan:function(){return n},LogSpanAllowList:function(){return m},MiddlewareSpan:function(){return h},NextNodeServerSpan:function(){return o},NextServerSpan:function(){return i},NextVanillaSpanAllowlist:function(){return f},NodeSpan:function(){return u},RenderSpan:function(){return a},ResolveMetadataSpan:function(){return p},RouterSpan:function(){return c},StartServerSpan:function(){return s}}),function(e){e.handleRequest="BaseServer.handleRequest",e.run="BaseServer.run",e.pipe="BaseServer.pipe",e.getStaticHTML="BaseServer.getStaticHTML",e.render="BaseServer.render",e.renderToResponseWithComponents="BaseServer.renderToResponseWithComponents",e.renderToResponse="BaseServer.renderToResponse",e.renderToHTML="BaseServer.renderToHTML",e.renderError="BaseServer.renderError",e.renderErrorToResponse="BaseServer.renderErrorToResponse",e.renderErrorToHTML="BaseServer.renderErrorToHTML",e.render404="BaseServer.render404"}(r||(r={})),function(e){e.loadDefaultErrorComponents="LoadComponents.loadDefaultErrorComponents",e.loadComponents="LoadComponents.loadComponents"}(n||(n={})),function(e){e.getRequestHandler="NextServer.getRequestHandler",e.getServer="NextServer.getServer",e.getServerRequestHandler="NextServer.getServerRequestHandler",e.createServer="createServer.createServer"}(i||(i={})),function(e){e.compression="NextNodeServer.compression",e.getBuildId="NextNodeServer.getBuildId",e.createComponentTree="NextNodeServer.createComponentTree",e.clientComponentLoading="NextNodeServer.clientComponentLoading",e.getLayoutOrPageModule="NextNodeServer.getLayoutOrPageModule",e.generateStaticRoutes="NextNodeServer.generateStaticRoutes",e.generateFsStaticRoutes="NextNodeServer.generateFsStaticRoutes",e.generatePublicRoutes="NextNodeServer.generatePublicRoutes",e.generateImageRoutes="NextNodeServer.generateImageRoutes.route",e.sendRenderResult="NextNodeServer.sendRenderResult",e.proxyRequest="NextNodeServer.proxyRequest",e.runApi="NextNodeServer.runApi",e.render="NextNodeServer.render",e.renderHTML="NextNodeServer.renderHTML",e.imageOptimizer="NextNodeServer.imageOptimizer",e.getPagePath="NextNodeServer.getPagePath",e.getRoutesManifest="NextNodeServer.getRoutesManifest",e.findPageComponents="NextNodeServer.findPageComponents",e.getFontManifest="NextNodeServer.getFontManifest",e.getServerComponentManifest="NextNodeServer.getServerComponentManifest",e.getRequestHandler="NextNodeServer.getRequestHandler",e.renderToHTML="NextNodeServer.renderToHTML",e.renderError="NextNodeServer.renderError",e.renderErrorToHTML="NextNodeServer.renderErrorToHTML",e.render404="NextNodeServer.render404",e.startResponse="NextNodeServer.startResponse",e.route="route",e.onProxyReq="onProxyReq",e.apiResolver="apiResolver",e.internalFetch="internalFetch"}(o||(o={})),(s||(s={})).startServer="startServer.startServer",function(e){e.getServerSideProps="Render.getServerSideProps",e.getStaticProps="Render.getStaticProps",e.renderToString="Render.renderToString",e.renderDocument="Render.renderDocument",e.createBodyResult="Render.createBodyResult"}(a||(a={})),function(e){e.renderToString="AppRender.renderToString",e.renderToReadableStream="AppRender.renderToReadableStream",e.getBodyResult="AppRender.getBodyResult",e.fetch="AppRender.fetch"}(l||(l={})),(c||(c={})).executeRoute="Router.executeRoute",(u||(u={})).runHandler="Node.runHandler",(d||(d={})).runHandler="AppRouteRouteHandlers.runHandler",function(e){e.generateMetadata="ResolveMetadata.generateMetadata",e.generateViewport="ResolveMetadata.generateViewport"}(p||(p={})),(h||(h={})).execute="Middleware.execute";let f=["Middleware.execute","BaseServer.handleRequest","Render.getServerSideProps","Render.getStaticProps","AppRender.fetch","AppRender.getBodyResult","Render.renderDocument","Node.runHandler","AppRouteRouteHandlers.runHandler","ResolveMetadata.generateMetadata","ResolveMetadata.generateViewport","NextNodeServer.createComponentTree","NextNodeServer.findPageComponents","NextNodeServer.getLayoutOrPageModule","NextNodeServer.startResponse","NextNodeServer.clientComponentLoading"],m=["NextNodeServer.findPageComponents","NextNodeServer.createComponentTree","NextNodeServer.clientComponentLoading"]},82755:(e,t,r)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{SpanKind:function(){return c},SpanStatusCode:function(){return l},getTracer:function(){return v}});let i=r(98467);try{n=r(98601)}catch(e){n=r(98601)}let{context:o,propagation:s,trace:a,SpanStatusCode:l,SpanKind:c,ROOT_CONTEXT:u}=n,d=e=>null!==e&&"object"==typeof e&&"function"==typeof e.then,p=(e,t)=>{(null==t?void 0:t.bubble)===!0?e.setAttribute("next.bubble",!0):(t&&e.recordException(t),e.setStatus({code:l.ERROR,message:null==t?void 0:t.message})),e.end()},h=new Map,f=n.createContextKey("next.rootSpanId"),m=0,g=()=>m++;class y{getTracerInstance(){return a.getTracer("next.js","0.0.1")}getContext(){return o}getActiveScopeSpan(){return a.getSpan(null==o?void 0:o.active())}withPropagatedContext(e,t,r){let n=o.active();if(a.getSpanContext(n))return t();let i=s.extract(n,e,r);return o.with(i,t)}trace(...e){var t;let[r,n,s]=e,{fn:l,options:c}="function"==typeof n?{fn:n,options:{}}:{fn:s,options:{...n}},m=c.spanName??r;if(!i.NextVanillaSpanAllowlist.includes(r)&&"1"!==process.env.NEXT_OTEL_VERBOSE||c.hideSpan)return l();let y=this.getSpanContext((null==c?void 0:c.parentSpan)??this.getActiveScopeSpan()),v=!1;y?(null==(t=a.getSpanContext(y))?void 0:t.isRemote)&&(v=!0):(y=(null==o?void 0:o.active())??u,v=!0);let b=g();return c.attributes={"next.span_name":m,"next.span_type":r,...c.attributes},o.with(y.setValue(f,b),()=>this.getTracerInstance().startActiveSpan(m,c,e=>{let t="performance"in globalThis?globalThis.performance.now():void 0,n=()=>{h.delete(b),t&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX&&i.LogSpanAllowList.includes(r||"")&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-${(r.split(".").pop()||"").replace(/[A-Z]/g,e=>"-"+e.toLowerCase())}`,{start:t,end:performance.now()})};v&&h.set(b,new Map(Object.entries(c.attributes??{})));try{if(l.length>1)return l(e,t=>p(e,t));let t=l(e);if(d(t))return t.then(t=>(e.end(),t)).catch(t=>{throw p(e,t),t}).finally(n);return e.end(),n(),t}catch(t){throw p(e,t),n(),t}}))}wrap(...e){let t=this,[r,n,s]=3===e.length?e:[e[0],{},e[1]];return i.NextVanillaSpanAllowlist.includes(r)||"1"===process.env.NEXT_OTEL_VERBOSE?function(){let e=n;"function"==typeof e&&"function"==typeof s&&(e=e.apply(this,arguments));let i=arguments.length-1,a=arguments[i];if("function"!=typeof a)return t.trace(r,e,()=>s.apply(this,arguments));{let n=t.getContext().bind(o.active(),a);return t.trace(r,e,(e,t)=>(arguments[i]=function(e){return null==t||t(e),n.apply(this,arguments)},s.apply(this,arguments)))}}:s}startSpan(...e){let[t,r]=e,n=this.getSpanContext((null==r?void 0:r.parentSpan)??this.getActiveScopeSpan());return this.getTracerInstance().startSpan(t,r,n)}getSpanContext(e){return e?a.setSpan(o.active(),e):void 0}getRootSpanAttributes(){let e=o.active().getValue(f);return h.get(e)}}let v=(()=>{let e=new y;return()=>e})()},42860:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ENCODED_TAGS",{enumerable:!0,get:function(){return r}});let r={OPENING:{HTML:new Uint8Array([60,104,116,109,108]),BODY:new Uint8Array([60,98,111,100,121])},CLOSED:{HEAD:new Uint8Array([60,47,104,101,97,100,62]),BODY:new Uint8Array([60,47,98,111,100,121,62]),HTML:new Uint8Array([60,47,104,116,109,108,62]),BODY_AND_HTML:new Uint8Array([60,47,98,111,100,121,62,60,47,104,116,109,108,62])}}},43598:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{chainStreams:function(){return d},continueDynamicDataResume:function(){return S},continueDynamicHTMLResume:function(){return x},continueDynamicPrerender:function(){return E},continueFizzStream:function(){return _},continueStaticPrerender:function(){return w},createBufferedTransformStream:function(){return f},createRootLayoutValidatorStream:function(){return b},renderToInitialFizzStream:function(){return m},streamFromString:function(){return p},streamToString:function(){return h}});let n=r(82755),i=r(98467),o=r(808),s=r(89061),a=r(42860),l=r(44192);function c(){}let u=new TextEncoder;function d(...e){if(0===e.length)throw Error("Invariant: chainStreams requires at least one stream");if(1===e.length)return e[0];let{readable:t,writable:r}=new TransformStream,n=e[0].pipeTo(r,{preventClose:!0}),i=1;for(;i<e.length-1;i++){let t=e[i];n=n.then(()=>t.pipeTo(r,{preventClose:!0}))}let o=e[i];return(n=n.then(()=>o.pipeTo(r))).catch(c),t}function p(e){return new ReadableStream({start(t){t.enqueue(u.encode(e)),t.close()}})}async function h(e){let t=new TextDecoder("utf-8",{fatal:!0}),r="";for await(let n of e)r+=t.decode(n,{stream:!0});return r+t.decode()}function f(){let e,t=[],r=0,n=n=>{if(e)return;let i=new o.DetachedPromise;e=i,(0,s.scheduleImmediate)(()=>{try{let e=new Uint8Array(r),i=0;for(let r=0;r<t.length;r++){let n=t[r];e.set(n,i),i+=n.byteLength}t.length=0,r=0,n.enqueue(e)}catch{}finally{e=void 0,i.resolve()}})};return new TransformStream({transform(e,i){t.push(e),r+=e.byteLength,n(i)},flush(){if(e)return e.promise}})}function m({ReactDOMServer:e,element:t,streamOptions:r}){return(0,n.getTracer)().trace(i.AppRenderSpan.renderToReadableStream,async()=>e.renderToReadableStream(t,r))}function g(e){let t=!1,r=!1,n=!1;return new TransformStream({async transform(i,o){if(n=!0,r){o.enqueue(i);return}let c=await e(),d=u.encode(c);if(t)o.enqueue(d),o.enqueue(i),r=!0;else{let e=(0,l.indexOfUint8Array)(i,a.ENCODED_TAGS.CLOSED.HEAD);if(-1!==e){let n=new Uint8Array(i.length+d.length);n.set(i.slice(0,e)),n.set(d,e),n.set(i.slice(e),e+d.length),o.enqueue(n),r=!0,t=!0}}t?(0,s.scheduleImmediate)(()=>{r=!1}):o.enqueue(i)},async flush(t){if(n){let r=await e();r&&t.enqueue(u.encode(r))}}})}function y(e){let t=null,r=!1;async function n(n){if(t)return;let i=e.getReader();await (0,s.atLeastOneTask)();try{for(;;){let{done:e,value:t}=await i.read();if(e){r=!0;return}n.enqueue(t)}}catch(e){n.error(e)}}return new TransformStream({transform(e,r){r.enqueue(e),t||(t=n(r))},flush(e){if(!r)return t||n(e)}})}function v(e){let t=!1,r=u.encode(e);return new TransformStream({transform(n,i){if(t)return i.enqueue(n);let o=(0,l.indexOfUint8Array)(n,r);if(o>-1){if(t=!0,n.length===e.length)return;let r=n.slice(0,o);if(i.enqueue(r),n.length>e.length+o){let t=n.slice(o+e.length);i.enqueue(t)}}else i.enqueue(n)},flush(e){e.enqueue(r)}})}function b(){let e=!1,t=!1;return new TransformStream({async transform(r,n){!e&&(0,l.indexOfUint8Array)(r,a.ENCODED_TAGS.OPENING.HTML)>-1&&(e=!0),!t&&(0,l.indexOfUint8Array)(r,a.ENCODED_TAGS.OPENING.BODY)>-1&&(t=!0),n.enqueue(r)},flush(r){let n=[];e||n.push("html"),t||n.push("body"),n.length&&r.enqueue(u.encode(`<script>self.__next_root_layout_missing_tags=${JSON.stringify(n)}</script>`))}})}async function _(e,{suffix:t,inlinedDataStream:r,isStaticGeneration:n,getServerInsertedHTML:i,serverInsertedHTMLToHead:a,validateRootLayout:l}){let c="</body></html>",d=t?t.split(c,1)[0]:null;return n&&"allReady"in e&&await e.allReady,function(e,t){let r=e;for(let e of t)e&&(r=r.pipeThrough(e));return r}(e,[f(),i&&!a?new TransformStream({transform:async(e,t)=>{let r=await i();r&&t.enqueue(u.encode(r)),t.enqueue(e)}}):null,null!=d&&d.length>0?function(e){let t,r=!1,n=r=>{let n=new o.DetachedPromise;t=n,(0,s.scheduleImmediate)(()=>{try{r.enqueue(u.encode(e))}catch{}finally{t=void 0,n.resolve()}})};return new TransformStream({transform(e,t){t.enqueue(e),r||(r=!0,n(t))},flush(n){if(t)return t.promise;r||n.enqueue(u.encode(e))}})}(d):null,r?y(r):null,l?b():null,v(c),i&&a?g(i):null])}async function E(e,{getServerInsertedHTML:t}){return e.pipeThrough(f()).pipeThrough(new TransformStream({transform(e,t){(0,l.isEquivalentUint8Arrays)(e,a.ENCODED_TAGS.CLOSED.BODY_AND_HTML)||(0,l.isEquivalentUint8Arrays)(e,a.ENCODED_TAGS.CLOSED.BODY)||(0,l.isEquivalentUint8Arrays)(e,a.ENCODED_TAGS.CLOSED.HTML)||(e=(0,l.removeFromUint8Array)(e,a.ENCODED_TAGS.CLOSED.BODY),e=(0,l.removeFromUint8Array)(e,a.ENCODED_TAGS.CLOSED.HTML),t.enqueue(e))}})).pipeThrough(g(t))}async function w(e,{inlinedDataStream:t,getServerInsertedHTML:r}){return e.pipeThrough(f()).pipeThrough(g(r)).pipeThrough(y(t)).pipeThrough(v("</body></html>"))}async function x(e,{inlinedDataStream:t,getServerInsertedHTML:r}){return e.pipeThrough(f()).pipeThrough(g(r)).pipeThrough(y(t)).pipeThrough(v("</body></html>"))}async function S(e,{inlinedDataStream:t}){return e.pipeThrough(y(t)).pipeThrough(v("</body></html>"))}},44192:(e,t)=>{"use strict";function r(e,t){if(0===t.length)return 0;if(0===e.length||t.length>e.length)return -1;for(let r=0;r<=e.length-t.length;r++){let n=!0;for(let i=0;i<t.length;i++)if(e[r+i]!==t[i]){n=!1;break}if(n)return r}return -1}function n(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function i(e,t){let n=r(e,t);if(0===n)return e.subarray(t.length);if(!(n>-1))return e;{let r=new Uint8Array(e.length-t.length);return r.set(e.slice(0,n)),r.set(e.slice(n+t.length),n),r}}Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{indexOfUint8Array:function(){return r},isEquivalentUint8Arrays:function(){return n},removeFromUint8Array:function(){return i}})},16496:(e,t,r)=>{/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var n=r(14300),i=n.Buffer;function o(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,r){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return n.SlowBuffer(e)}},58073:(e,t,r)=>{"use strict";let{EMPTY_BUFFER:n}=r(38668),i=Buffer[Symbol.species];function o(e,t,r,n,i){for(let o=0;o<i;o++)r[n+o]=e[o]^t[3&o]}function s(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}if(e.exports={concat:function(e,t){if(0===e.length)return n;if(1===e.length)return e[0];let r=Buffer.allocUnsafe(t),o=0;for(let t=0;t<e.length;t++){let n=e[t];r.set(n,o),o+=n.length}return o<t?new i(r.buffer,r.byteOffset,o):r},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){let r;return(e.readOnly=!0,Buffer.isBuffer(t))?t:(t instanceof ArrayBuffer?r=new i(t):ArrayBuffer.isView(t)?r=new i(t.buffer,t.byteOffset,t.byteLength):(r=Buffer.from(t),e.readOnly=!1),r)},unmask:s},!process.env.WS_NO_BUFFER_UTIL)try{let t=r(58359);e.exports.mask=function(e,r,n,i,s){s<48?o(e,r,n,i,s):t.mask(e,r,n,i,s)},e.exports.unmask=function(e,r){e.length<32?s(e,r):t.unmask(e,r)}}catch(e){}},38668:e=>{"use strict";let t=["nodebuffer","arraybuffer","fragments"],r="undefined"!=typeof Blob;r&&t.push("blob"),e.exports={BINARY_TYPES:t,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:r,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},68414:(e,t,r)=>{"use strict";let{kForOnEventAttribute:n,kListener:i}=r(38668),o=Symbol("kCode"),s=Symbol("kData"),a=Symbol("kError"),l=Symbol("kMessage"),c=Symbol("kReason"),u=Symbol("kTarget"),d=Symbol("kType"),p=Symbol("kWasClean");class h{constructor(e){this[u]=null,this[d]=e}get target(){return this[u]}get type(){return this[d]}}Object.defineProperty(h.prototype,"target",{enumerable:!0}),Object.defineProperty(h.prototype,"type",{enumerable:!0});class f extends h{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[c]=void 0===t.reason?"":t.reason,this[p]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[c]}get wasClean(){return this[p]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class m extends h{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[l]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[l]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class g extends h{constructor(e,t={}){super(e),this[s]=void 0===t.data?null:t.data}get data(){return this[s]}}function y(e,t,r){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}Object.defineProperty(g.prototype,"data",{enumerable:!0}),e.exports={CloseEvent:f,ErrorEvent:m,Event:h,EventTarget:{addEventListener(e,t,r={}){let o;for(let o of this.listeners(e))if(!r[n]&&o[i]===t&&!o[n])return;if("message"===e)o=function(e,r){let n=new g("message",{data:r?e:e.toString()});n[u]=this,y(t,this,n)};else if("close"===e)o=function(e,r){let n=new f("close",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});n[u]=this,y(t,this,n)};else if("error"===e)o=function(e){let r=new m("error",{error:e,message:e.message});r[u]=this,y(t,this,r)};else{if("open"!==e)return;o=function(){let e=new h("open");e[u]=this,y(t,this,e)}}o[n]=!!r[n],o[i]=t,r.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(let r of this.listeners(e))if(r[i]===t&&!r[n]){this.removeListener(e,r);break}}},MessageEvent:g}},76946:(e,t,r)=>{"use strict";let{tokenChars:n}=r(88631);function i(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}e.exports={format:function(e){return Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>[t].concat(Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,r;let o=Object.create(null),s=Object.create(null),a=!1,l=!1,c=!1,u=-1,d=-1,p=-1,h=0;for(;h<e.length;h++)if(d=e.charCodeAt(h),void 0===t){if(-1===p&&1===n[d])-1===u&&(u=h);else if(0!==h&&(32===d||9===d))-1===p&&-1!==u&&(p=h);else if(59===d||44===d){if(-1===u)throw SyntaxError(`Unexpected character at index ${h}`);-1===p&&(p=h);let r=e.slice(u,p);44===d?(i(o,r,s),s=Object.create(null)):t=r,u=p=-1}else throw SyntaxError(`Unexpected character at index ${h}`)}else if(void 0===r){if(-1===p&&1===n[d])-1===u&&(u=h);else if(32===d||9===d)-1===p&&-1!==u&&(p=h);else if(59===d||44===d){if(-1===u)throw SyntaxError(`Unexpected character at index ${h}`);-1===p&&(p=h),i(s,e.slice(u,p),!0),44===d&&(i(o,t,s),s=Object.create(null),t=void 0),u=p=-1}else if(61===d&&-1!==u&&-1===p)r=e.slice(u,h),u=p=-1;else throw SyntaxError(`Unexpected character at index ${h}`)}else if(l){if(1!==n[d])throw SyntaxError(`Unexpected character at index ${h}`);-1===u?u=h:a||(a=!0),l=!1}else if(c){if(1===n[d])-1===u&&(u=h);else if(34===d&&-1!==u)c=!1,p=h;else if(92===d)l=!0;else throw SyntaxError(`Unexpected character at index ${h}`)}else if(34===d&&61===e.charCodeAt(h-1))c=!0;else if(-1===p&&1===n[d])-1===u&&(u=h);else if(-1!==u&&(32===d||9===d))-1===p&&(p=h);else if(59===d||44===d){if(-1===u)throw SyntaxError(`Unexpected character at index ${h}`);-1===p&&(p=h);let n=e.slice(u,p);a&&(n=n.replace(/\\/g,""),a=!1),i(s,r,n),44===d&&(i(o,t,s),s=Object.create(null),t=void 0),r=void 0,u=p=-1}else throw SyntaxError(`Unexpected character at index ${h}`);if(-1===u||c||32===d||9===d)throw SyntaxError("Unexpected end of input");-1===p&&(p=h);let f=e.slice(u,p);return void 0===t?i(o,f,s):(void 0===r?i(s,f,!0):a?i(s,r,f.replace(/\\/g,"")):i(s,r,f),i(o,t,s)),o}}},2208:e=>{"use strict";let t=Symbol("kDone"),r=Symbol("kRun");class n{constructor(e){this[t]=()=>{this.pending--,this[r]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[r]()}[r](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[t])}}}e.exports=n},18847:(e,t,r)=>{"use strict";let n;let i=r(59796),o=r(58073),s=r(2208),{kStatusCode:a}=r(38668),l=Buffer[Symbol.species],c=Buffer.from([0,0,255,255]),u=Symbol("permessage-deflate"),d=Symbol("total-length"),p=Symbol("callback"),h=Symbol("buffers"),f=Symbol("error");class m{constructor(e,t,r){this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,n||(n=new s(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[p];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!r)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:(!0===r.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let r=e[t];if(r.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==r)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=r})}),e}decompress(e,t,r){n.add(n=>{this._decompress(e,t,(e,t)=>{n(),r(e,t)})})}compress(e,t,r){n.add(n=>{this._compress(e,t,(e,t)=>{n(),r(e,t)})})}_decompress(e,t,r){let n=this._isServer?"client":"server";if(!this._inflate){let e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[u]=this,this._inflate[d]=0,this._inflate[h]=[],this._inflate.on("error",v),this._inflate.on("data",y)}this._inflate[p]=r,this._inflate.write(e),t&&this._inflate.write(c),this._inflate.flush(()=>{let e=this._inflate[f];if(e){this._inflate.close(),this._inflate=null,r(e);return}let i=o.concat(this._inflate[h],this._inflate[d]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[d]=0,this._inflate[h]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,i)})}_compress(e,t,r){let n=this._isServer?"server":"client";if(!this._deflate){let e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[d]=0,this._deflate[h]=[],this._deflate.on("data",g)}this._deflate[p]=r,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=o.concat(this._deflate[h],this._deflate[d]);t&&(e=new l(e.buffer,e.byteOffset,e.length-4)),this._deflate[p]=null,this._deflate[d]=0,this._deflate[h]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,e)})}}function g(e){this[h].push(e),this[d]+=e.length}function y(e){if(this[d]+=e.length,this[u]._maxPayload<1||this[d]<=this[u]._maxPayload){this[h].push(e);return}this[f]=RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][a]=1009,this.removeListener("data",y),this.reset()}function v(e){if(this[u]._inflate=null,this[f]){this[p](this[f]);return}e[a]=1007,this[p](e)}e.exports=m},66322:(e,t,r)=>{"use strict";let{Writable:n}=r(12781),i=r(18847),{BINARY_TYPES:o,EMPTY_BUFFER:s,kStatusCode:a,kWebSocket:l}=r(38668),{concat:c,toArrayBuffer:u,unmask:d}=r(58073),{isValidStatusCode:p,isValidUTF8:h}=r(88631),f=Buffer[Symbol.species];class m extends n{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[l]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=new f(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0){e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));return}let r=(64&t[0])==64;if(r&&!this._extensions[i.extensionName]){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(r){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(!this._fragmented){e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));return}this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented){e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));return}if(r){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength){e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"));return}}else{e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));return}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked){e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"));return}}else if(this._masked){e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));return}126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);if(r>2097151){e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"));return}this._payloadLength=4294967296*r+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));return}this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=s;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&d(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0){t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));return}this._fragments.push(r)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let n;n="nodebuffer"===this._binaryType?c(r,t):"arraybuffer"===this._binaryType?u(c(r,t)):"blob"===this._binaryType?new Blob(r):r,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!0),this._state=0,this.startLoop(e)}))}else{let n=c(r,t);if(!this._skipUTF8Validation&&!h(n)){e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));return}5===this._state||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,s),this.end();else{let r=e.readUInt16BE(0);if(!p(r)){t(this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));return}let n=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!h(n)){t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));return}this._loop=!1,this.emit("conclude",r,n),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,r,n,i){this._loop=!1,this._errored=!0;let o=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[a]=n,o}}e.exports=m},5167:(e,t,r)=>{"use strict";let n;let{Duplex:i}=r(12781),{randomFillSync:o}=r(6113),s=r(18847),{EMPTY_BUFFER:a,kWebSocket:l,NOOP:c}=r(38668),{isBlob:u,isValidStatusCode:d}=r(88631),{mask:p,toBuffer:h}=r(58073),f=Symbol("kByteLength"),m=Buffer.alloc(4),g=8192;class y{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=c,this[l]=void 0}static frame(e,t){let r,i;let s=!1,a=2,l=!1;t.mask&&(r=t.maskBuffer||m,t.generateMask?t.generateMask(r):(8192===g&&(void 0===n&&(n=Buffer.alloc(8192)),o(n,0,8192),g=0),r[0]=n[g++],r[1]=n[g++],r[2]=n[g++],r[3]=n[g++]),l=(r[0]|r[1]|r[2]|r[3])==0,a=6),"string"==typeof e?i=(!t.mask||l)&&void 0!==t[f]?t[f]:(e=Buffer.from(e)).length:(i=e.length,s=t.mask&&t.readOnly&&!l);let c=i;i>=65536?(a+=8,c=127):i>125&&(a+=2,c=126);let u=Buffer.allocUnsafe(s?i+a:a);return(u[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(u[0]|=64),u[1]=c,126===c?u.writeUInt16BE(i,2):127===c&&(u[2]=u[3]=0,u.writeUIntBE(i,4,6)),t.mask)?(u[1]|=128,u[a-4]=r[0],u[a-3]=r[1],u[a-2]=r[2],u[a-1]=r[3],l)?[u,e]:s?(p(e,r,u,a,i),[u]):(p(e,r,e,0,i),[u,e]):[u,e]}close(e,t,r,n){let i;if(void 0===e)i=a;else if("number"==typeof e&&d(e)){if(void 0!==t&&t.length){let r=Buffer.byteLength(t);if(r>123)throw RangeError("The message must not be greater than 123 bytes");(i=Buffer.allocUnsafe(2+r)).writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else(i=Buffer.allocUnsafe(2)).writeUInt16BE(e,0)}else throw TypeError("First argument must be a valid error code number");let o={[f]:i.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(y.frame(i,o),n)}ping(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):u(e)?(n=e.size,i=!1):(n=(e=h(e)).length,i=h.readOnly),n>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};u(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):0!==this._state?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(y.frame(e,o),r)}pong(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):u(e)?(n=e.size,i=!1):(n=(e=h(e)).length,i=h.readOnly),n>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};u(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,r]):this.getBlobData(e,!1,o,r):0!==this._state?this.enqueue([this.dispatch,e,!1,o,r]):this.sendFrame(y.frame(e,o),r)}send(e,t,r){let n,i;let o=this._extensions[s.extensionName],a=t.binary?2:1,l=t.compress;"string"==typeof e?(n=Buffer.byteLength(e),i=!1):u(e)?(n=e.size,i=!1):(n=(e=h(e)).length,i=h.readOnly),this._firstFragment?(this._firstFragment=!1,l&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=n>=o._threshold),this._compress=l):(l=!1,a=0),t.fin&&(this._firstFragment=!0);let c={[f]:n,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:i,rsv1:l};u(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,c,r]):this.getBlobData(e,this._compress,c,r):0!==this._state?this.enqueue([this.dispatch,e,this._compress,c,r]):this.dispatch(e,this._compress,c,r)}getBlobData(e,t,r,n){this._bufferedBytes+=r[f],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(v,this,e,n);return}this._bufferedBytes-=r[f];let i=h(e);t?this.dispatch(i,t,r,n):(this._state=0,this.sendFrame(y.frame(i,r),n),this.dequeue())}).catch(e=>{process.nextTick(b,this,e,n)})}dispatch(e,t,r,n){if(!t){this.sendFrame(y.frame(e,r),n);return}let i=this._extensions[s.extensionName];this._bufferedBytes+=r[f],this._state=1,i.compress(e,r.fin,(e,t)=>{if(this._socket.destroyed){v(this,Error("The socket was closed while data was being compressed"),n);return}this._bufferedBytes-=r[f],this._state=0,r.readOnly=!1,this.sendFrame(y.frame(t,r),n),this.dequeue()})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][f],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][f],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function v(e,t,r){"function"==typeof r&&r(t);for(let r=0;r<e._queue.length;r++){let n=e._queue[r],i=n[n.length-1];"function"==typeof i&&i(t)}}function b(e,t,r){v(e,t,r),e.onerror(t)}e.exports=y},70013:(e,t,r)=>{"use strict";r(90286);let{Duplex:n}=r(12781);function i(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function s(e){this.removeListener("error",s),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let r=!0,a=new n({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,r){let n=!r&&a._readableState.objectMode?t.toString():t;a.push(n)||e.pause()}),e.once("error",function(e){a.destroyed||(r=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,n){if(e.readyState===e.CLOSED){n(t),process.nextTick(i,a);return}let o=!1;e.once("error",function(e){o=!0,n(e)}),e.once("close",function(){o||n(t),process.nextTick(i,a)}),r&&e.terminate()},a._final=function(t){if(e.readyState===e.CONNECTING){e.once("open",function(){a._final(t)});return}null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,r,n){if(e.readyState===e.CONNECTING){e.once("open",function(){a._write(t,r,n)});return}e.send(t,n)},a.on("end",o),a.on("error",s),a}},16882:(e,t,r)=>{"use strict";let{tokenChars:n}=r(88631);e.exports={parse:function(e){let t=new Set,r=-1,i=-1,o=0;for(;o<e.length;o++){let s=e.charCodeAt(o);if(-1===i&&1===n[s])-1===r&&(r=o);else if(0!==o&&(32===s||9===s))-1===i&&-1!==r&&(i=o);else if(44===s){if(-1===r)throw SyntaxError(`Unexpected character at index ${o}`);-1===i&&(i=o);let n=e.slice(r,i);if(t.has(n))throw SyntaxError(`The "${n}" subprotocol is duplicated`);t.add(n),r=i=-1}else throw SyntaxError(`Unexpected character at index ${o}`)}if(-1===r||-1!==i)throw SyntaxError("Unexpected end of input");let s=e.slice(r,o);if(t.has(s))throw SyntaxError(`The "${s}" subprotocol is duplicated`);return t.add(s),t}}},88631:(e,t,r)=>{"use strict";let{isUtf8:n}=r(14300),{hasBlob:i}=r(38668);function o(e){let t=e.length,r=0;for(;r<t;)if((128&e[r])==0)r++;else if((224&e[r])==192){if(r+1===t||(192&e[r+1])!=128||(254&e[r])==192)return!1;r+=2}else if((240&e[r])==224){if(r+2>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||224===e[r]&&(224&e[r+1])==128||237===e[r]&&(224&e[r+1])==160)return!1;r+=3}else{if((248&e[r])!=240||r+3>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||(192&e[r+3])!=128||240===e[r]&&(240&e[r+1])==128||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}if(e.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:o,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},n)e.exports.isValidUTF8=function(e){return e.length<24?o(e):n(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=r(93739);e.exports.isValidUTF8=function(e){return e.length<32?o(e):t(e)}}catch(e){}},11037:(e,t,r)=>{"use strict";let n=r(82361),i=r(13685),{Duplex:o}=r(12781),{createHash:s}=r(6113),a=r(76946),l=r(18847),c=r(16882),u=r(90286),{CLOSE_TIMEOUT:d,GUID:p,kWebSocket:h}=r(38668),f=/^[+/0-9A-Za-z]{22}==$/;class m extends n{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:d,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:u,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{let r=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":r.length,"Content-Type":"text/plain"}),t.end(r)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let r of Object.keys(t))e.on(r,t[r]);return function(){for(let r of Object.keys(t))e.removeListener(r,t[r])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,r,n)=>{this.handleUpgrade(t,r,n,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(g,this);return}if(e&&this.once("close",e),1!==this._state){if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(g,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{g(this)})}}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,n){t.on("error",y);let i=e.headers["sec-websocket-key"],o=e.headers.upgrade,s=+e.headers["sec-websocket-version"];if("GET"!==e.method){b(this,e,t,405,"Invalid HTTP method");return}if(void 0===o||"websocket"!==o.toLowerCase()){b(this,e,t,400,"Invalid Upgrade header");return}if(void 0===i||!f.test(i)){b(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(13!==s&&8!==s){b(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){v(t,400);return}let u=e.headers["sec-websocket-protocol"],d=new Set;if(void 0!==u)try{d=c.parse(u)}catch(r){b(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let p=e.headers["sec-websocket-extensions"],h={};if(this.options.perMessageDeflate&&void 0!==p){let r=new l(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=a.parse(p);e[l.extensionName]&&(r.accept(e[l.extensionName]),h[l.extensionName]=r)}catch(r){b(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let o={origin:e.headers[`${8===s?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length){this.options.verifyClient(o,(o,s,a,l)=>{if(!o)return v(t,s||401,a,l);this.completeUpgrade(h,i,d,e,t,r,n)});return}if(!this.options.verifyClient(o))return v(t,401)}this.completeUpgrade(h,i,d,e,t,r,n)}completeUpgrade(e,t,r,n,i,o,c){if(!i.readable||!i.writable)return i.destroy();if(i[h])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return v(i,503);let u=s("sha1").update(t+p).digest("base64"),d=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${u}`],f=new this.options.WebSocket(null,void 0,this.options);if(r.size){let e=this.options.handleProtocols?this.options.handleProtocols(r,n):r.values().next().value;e&&(d.push(`Sec-WebSocket-Protocol: ${e}`),f._protocol=e)}if(e[l.extensionName]){let t=e[l.extensionName].params,r=a.format({[l.extensionName]:[t]});d.push(`Sec-WebSocket-Extensions: ${r}`),f._extensions=e}this.emit("headers",d,n),i.write(d.concat("\r\n").join("\r\n")),i.removeListener("error",y),f.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(g,this)})),c(f,n)}}function g(e){e._state=2,e.emit("close")}function y(){this.destroy()}function v(e,t,r,n){r=r||i.STATUS_CODES[t],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r
`+Object.keys(n).map(e=>`${e}: ${n[e]}`).join("\r\n")+"\r\n\r\n"+r)}function b(e,t,r,n,i,o){if(e.listenerCount("wsClientError")){let n=Error(i);Error.captureStackTrace(n,b),e.emit("wsClientError",n,r,t)}else v(r,n,i,o)}e.exports=m},90286:(e,t,r)=>{"use strict";let n=r(82361),i=r(95687),o=r(13685),s=r(41808),a=r(24404),{randomBytes:l,createHash:c}=r(6113),{Duplex:u,Readable:d}=r(12781),{URL:p}=r(57310),h=r(18847),f=r(66322),m=r(5167),{isBlob:g}=r(88631),{BINARY_TYPES:y,CLOSE_TIMEOUT:v,EMPTY_BUFFER:b,GUID:_,kForOnEventAttribute:E,kListener:w,kStatusCode:x,kWebSocket:S,NOOP:T}=r(38668),{EventTarget:{addEventListener:A,removeEventListener:C}}=r(68414),{format:O,parse:I}=r(76946),{toBuffer:N}=r(58073),k=Symbol("kAborted"),R=[8,13],P=["CONNECTING","OPEN","CLOSING","CLOSED"],j=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class M extends n{constructor(e,t,r){super(),this._binaryType=y[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=b,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=M.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(r=t,t=[]):t=[t]),function e(t,r,n,s){let a,u,d,f;let m={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:v,protocolVersion:R[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=m.autoPong,t._closeTimeout=m.closeTimeout,!R.includes(m.protocolVersion))throw RangeError(`Unsupported protocol version: ${m.protocolVersion} (supported versions: ${R.join(", ")})`);if(r instanceof p)a=r;else try{a=new p(r)}catch(e){throw SyntaxError(`Invalid URL: ${r}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),t._url=a.href;let g="wss:"===a.protocol,y="ws+unix:"===a.protocol;if("ws:"===a.protocol||g||y?y&&!a.pathname?u="The URL's pathname is empty":a.hash&&(u="The URL contains a fragment identifier"):u='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',u){let e=SyntaxError(u);if(0===t._redirects)throw e;D(t,e);return}let b=g?443:80,E=l(16).toString("base64"),w=g?i.request:o.request,x=new Set;if(m.createConnection=m.createConnection||(g?L:U),m.defaultPort=m.defaultPort||b,m.port=a.port||b,m.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,m.headers={...m.headers,"Sec-WebSocket-Version":m.protocolVersion,"Sec-WebSocket-Key":E,Connection:"Upgrade",Upgrade:"websocket"},m.path=a.pathname+a.search,m.timeout=m.handshakeTimeout,m.perMessageDeflate&&(d=new h(!0!==m.perMessageDeflate?m.perMessageDeflate:{},!1,m.maxPayload),m.headers["Sec-WebSocket-Extensions"]=O({[h.extensionName]:d.offer()})),n.length){for(let e of n){if("string"!=typeof e||!j.test(e)||x.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");x.add(e)}m.headers["Sec-WebSocket-Protocol"]=n.join(",")}if(m.origin&&(m.protocolVersion<13?m.headers["Sec-WebSocket-Origin"]=m.origin:m.headers.Origin=m.origin),(a.username||a.password)&&(m.auth=`${a.username}:${a.password}`),y){let e=m.path.split(":");m.socketPath=e[0],m.path=e[1]}if(m.followRedirects){if(0===t._redirects){t._originalIpc=y,t._originalSecure=g,t._originalHostOrSocketPath=y?m.socketPath:a.host;let e=s&&s.headers;if(s={...s,headers:{}},e)for(let[t,r]of Object.entries(e))s.headers[t.toLowerCase()]=r}else if(0===t.listenerCount("redirect")){let e=y?!!t._originalIpc&&m.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&a.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||g)||(delete m.headers.authorization,delete m.headers.cookie,e||delete m.headers.host,m.auth=void 0)}m.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(m.auth).toString("base64")),f=t._req=w(m),t._redirects&&t.emit("redirect",t.url,f)}else f=t._req=w(m);m.timeout&&f.on("timeout",()=>{G(t,f,"Opening handshake has timed out")}),f.on("error",e=>{null===f||f[k]||(f=t._req=null,D(t,e))}),f.on("response",i=>{let o=i.headers.location,a=i.statusCode;if(o&&m.followRedirects&&a>=300&&a<400){let i;if(++t._redirects>m.maxRedirects){G(t,f,"Maximum redirects exceeded");return}f.abort();try{i=new p(o,r)}catch(e){D(t,SyntaxError(`Invalid URL: ${o}`));return}e(t,i,n,s)}else t.emit("unexpected-response",f,i)||G(t,f,`Unexpected server response: ${i.statusCode}`)}),f.on("upgrade",(e,r,n)=>{let i;if(t.emit("upgrade",e),t.readyState!==M.CONNECTING)return;f=t._req=null;let o=e.headers.upgrade;if(void 0===o||"websocket"!==o.toLowerCase()){G(t,r,"Invalid Upgrade header");return}let s=c("sha1").update(E+_).digest("base64");if(e.headers["sec-websocket-accept"]!==s){G(t,r,"Invalid Sec-WebSocket-Accept header");return}let a=e.headers["sec-websocket-protocol"];if(void 0!==a?x.size?x.has(a)||(i="Server sent an invalid subprotocol"):i="Server sent a subprotocol but none was requested":x.size&&(i="Server sent no subprotocol"),i){G(t,r,i);return}a&&(t._protocol=a);let l=e.headers["sec-websocket-extensions"];if(void 0!==l){let e;if(!d){G(t,r,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}try{e=I(l)}catch(e){G(t,r,"Invalid Sec-WebSocket-Extensions header");return}let n=Object.keys(e);if(1!==n.length||n[0]!==h.extensionName){G(t,r,"Server indicated an extension that was not requested");return}try{d.accept(e[h.extensionName])}catch(e){G(t,r,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[h.extensionName]=d}t.setSocket(r,n,{allowSynchronousEvents:m.allowSynchronousEvents,generateMask:m.generateMask,maxPayload:m.maxPayload,skipUTF8Validation:m.skipUTF8Validation})}),m.finishRequest?m.finishRequest(f,t):f.end()}(this,e,t,r)):(this._autoPong=r.autoPong,this._closeTimeout=r.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){y.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let n=new f({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),i=new m(e,this._extensions,r.generateMask);this._receiver=n,this._sender=i,this._socket=e,n[S]=this,i[S]=this,e[S]=this,n.on("conclude",q),n.on("drain",B),n.on("error",H),n.on("message",$),n.on("ping",z),n.on("pong",J),i.onerror=K,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",X),e.on("data",Z),e.on("end",Q),e.on("error",ee),this._readyState=M.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=M.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[h.extensionName]&&this._extensions[h.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=M.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==M.CLOSED){if(this.readyState===M.CONNECTING){G(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===M.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=M.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Y(this)}}pause(){this.readyState!==M.CONNECTING&&this.readyState!==M.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN){F(this,e,r);return}void 0===t&&(t=!this._isServer),this._sender.ping(e||b,t,r)}pong(e,t,r){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN){F(this,e,r);return}void 0===t&&(t=!this._isServer),this._sender.pong(e||b,t,r)}resume(){this.readyState!==M.CONNECTING&&this.readyState!==M.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===M.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==M.OPEN){F(this,e,r);return}let n={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[h.extensionName]||(n.compress=!1),this._sender.send(e||b,n,r)}terminate(){if(this.readyState!==M.CLOSED){if(this.readyState===M.CONNECTING){G(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=M.CLOSING,this._socket.destroy())}}}function D(e,t){e._readyState=M.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function U(e){return e.path=e.socketPath,s.connect(e)}function L(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=s.isIP(e.host)?"":e.host),a.connect(e)}function G(e,t,r){e._readyState=M.CLOSING;let n=Error(r);Error.captureStackTrace(n,G),t.setHeader?(t[k]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(D,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function F(e,t,r){if(t){let r=g(t)?t.size:N(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${P[e.readyState]})`);process.nextTick(r,t)}}function q(e,t){let r=this[S];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[S]&&(r._socket.removeListener("data",Z),process.nextTick(W,r._socket),1005===e?r.close():r.close(e,t))}function B(){let e=this[S];e.isPaused||e._socket.resume()}function H(e){let t=this[S];void 0!==t._socket[S]&&(t._socket.removeListener("data",Z),process.nextTick(W,t._socket),t.close(e[x])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function V(){this[S].emitClose()}function $(e,t){this[S].emit("message",e,t)}function z(e){let t=this[S];t._autoPong&&t.pong(e,!this._isServer,T),t.emit("ping",e)}function J(e){this[S].emit("pong",e)}function W(e){e.resume()}function K(e){let t=this[S];t.readyState===M.CLOSED||(t.readyState===M.OPEN&&(t._readyState=M.CLOSING,Y(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function Y(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),e._closeTimeout)}function X(){let e=this[S];if(this.removeListener("close",X),this.removeListener("data",Z),this.removeListener("end",Q),e._readyState=M.CLOSING,!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&0!==this._readableState.length){let t=this.read(this._readableState.length);e._receiver.write(t)}e._receiver.end(),this[S]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",V),e._receiver.on("finish",V))}function Z(e){this[S]._receiver.write(e)||this.pause()}function Q(){let e=this[S];e._readyState=M.CLOSING,e._receiver.end(),this.end()}function ee(){let e=this[S];this.removeListener("error",ee),this.on("error",T),e&&(e._readyState=M.CLOSING,this.destroy())}Object.defineProperty(M,"CONNECTING",{enumerable:!0,value:P.indexOf("CONNECTING")}),Object.defineProperty(M.prototype,"CONNECTING",{enumerable:!0,value:P.indexOf("CONNECTING")}),Object.defineProperty(M,"OPEN",{enumerable:!0,value:P.indexOf("OPEN")}),Object.defineProperty(M.prototype,"OPEN",{enumerable:!0,value:P.indexOf("OPEN")}),Object.defineProperty(M,"CLOSING",{enumerable:!0,value:P.indexOf("CLOSING")}),Object.defineProperty(M.prototype,"CLOSING",{enumerable:!0,value:P.indexOf("CLOSING")}),Object.defineProperty(M,"CLOSED",{enumerable:!0,value:P.indexOf("CLOSED")}),Object.defineProperty(M.prototype,"CLOSED",{enumerable:!0,value:P.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(M.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(M.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[E])return t[w];return null},set(t){for(let t of this.listeners(e))if(t[E]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[E]:!0})}})}),M.prototype.addEventListener=A,M.prototype.removeEventListener=C,e.exports=M},55949:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,metadata:()=>l});var n=r(19510),i=r(43800),o=r.n(i);r(5023);var s=r(3186),a=r(75031);let l={title:"InkAI",description:"AI Video Studio"};async function c({children:e,params:{locale:t}}){let r=await (0,a.Z)();return n.jsx("html",{lang:t,children:n.jsx("body",{className:o().className,children:n.jsx(s.Z,{messages:r,children:e})})})}},24943:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(19510),i=r(68570);let o=(0,i.createProxy)(String.raw`/Users/yangtao/Desktop/InkAI/InkAI/src/components/StudioEditor.tsx`),{__esModule:s,$$typeof:a}=o;o.default;let l=(0,i.createProxy)(String.raw`/Users/yangtao/Desktop/InkAI/InkAI/src/components/StudioEditor.tsx#default`);function c({params:e}){return n.jsx(l,{workflowId:e.workflowId})}},37258:(e,t,r)=>{"use strict";r.r(t),r.d(t,{adaptScriptProfessionalAction:()=>f,createScriptFromTextAction:()=>h,expandVisualDescriptionAction:()=>m,generateAudioAction:()=>g,generateImageFromTextAction:()=>p,generateVideoAction:()=>d,planStoryboardAction:()=>u,transcribeAudioAction:()=>y});var n=r(27745);r(26461);var i=r(27063),o=r(85723);let s=()=>{let e="PLACEHOLDER_API_KEY";if(!e)throw Error("Server API Key not configured");return new i.GoogleGenAI({apiKey:e})},a=e=>new Promise(t=>setTimeout(t,e)),l=e=>{if(!e)return"";let t=e.split(",");return t.length>1?t[1]:t[0]},c=e=>{let t=e.match(/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+);base64,/);return t?t[1]:"image/png"};async function u(e,t="V1",r){try{let n=s(),i="";i="V1"===t?`
            <instruction> Analyze the entire composition of the input image. Identify ALL key subjects present (whether it's a single person, a group/couple, a vehicle, or a specific object) and their spatial relationship/interaction.
            Generate a cohesive 3x3 grid "Cinematic Contact Sheet" featuring 9 distinct camera shots of exactly these subjects in the same environment.
            You must adapt the standard cinematic shot types to fit the content (e.g., if a group, keep the group together; if an object, frame the whole object):
            Row 1 (Establishing Context):
            1.Extreme Long Shot (ELS): The subject(s) are seen small within the vast environment.
            2.Long Shot (LS): The complete subject(s) or group is visible from top to bottom (head to toe / wheels to roof).
            3.Medium Long Shot (American/3-4): Framed from knees up (for people) or a 3/4 view (for objects).
            Row 2 (The Core Coverage): 4. Medium Shot (MS): Framed from the waist up (or the central core of the object). Focus on interaction/action. 5. Medium Close-Up (MCU): Framed from chest up. Intimate framing of the main subject(s). 6. Close-Up (CU): Tight framing on the face(s) or the "front" of the object.
            Row 3 (Details & Angles): 7. Extreme Close-Up (ECU): Macro detail focusing intensely on a key feature (eyes, hands, logo, texture). 8. Low Angle Shot (Worm's Eye): Looking up at the subject(s) from the ground (imposing/heroic). 9. High Angle Shot (Bird's Eye): Looking down on the subject(s) from above.
            Ensure strict consistency: The same people/objects, same clothes, and same lighting across all 9 panels. The depth of field should shift realistically (bokeh in close-ups). </instruction>
            A professional 3x3 cinematic storyboard grid containing 9 panels.
            The grid showcases the specific subject/scene from the input image in a comprehensive range of focal lengths.
            Top Row: Wide environmental shot, Full view, 3/4 cut.
            Middle Row: Waist-up view, Chest-up view, Face/Front close-up.
            Bottom Row: Macro detail, Low Angle, High Angle.
            All frames feature photorealistic textures, consistent cinematic color grading, and correct framing for the specific number of subjects or objects analyzed.
            
            OUTPUT REQUIREMENT: Return exactly a JSON array containing 9 strings, where each string describes one of the 9 panels defined above.
            `:"V2"===t?`
            <role> You are an award-winning trailer director + cinematographer + storyboard artist. Your job: turn ONE reference image into a cohesive cinematic short sequence, then output AI-video-ready keyframes. </role>
            <input> User provides: one reference image (image). </input>
            <non-negotiable rules - continuity & truthfulness>
            1.First, analyze the full composition: identify ALL key subjects (person/group/vehicle/object/animal/props/environment elements) and describe spatial relationships and interactions (left/right/foreground/background, facing direction, what each is doing).
            2.Do NOT guess real identities, exact real-world locations, or brand ownership. Stick to visible facts. Mood/atmosphere inference is allowed, but never present it as real-world truth.
            3.Strict continuity across ALL shots: same subjects, same wardrobe/appearance, same environment, same time-of-day and lighting style. Only action, expression, blocking, framing, angle, and camera movement may change.
            4.Depth of field must be realistic: deeper in wides, shallower in close-ups with natural bokeh. Keep ONE consistent cinematic color grade across the entire sequence.
            5.Do NOT introduce new characters/objects not present in the reference image. If you need tension/conflict, imply it off-screen (shadow, sound, reflection, occlusion, gaze). </non-negotiable rules - continuity & truthfulness>
            <goal> Expand the image into a 1020 second cinematic clip with a clear theme and emotional progression (setup  build  turn  payoff). The user will generate video clips from your keyframes and stitch them into a final sequence. </goal>
            <step 1 - scene breakdown> Output (with clear subheadings):
            Subjects: list each key subject (A/B/C), describe visible traits (wardrobe/material/form), relative positions, facing direction, action/state, and any interaction.
            Environment & Lighting: interior/exterior, spatial layout, background elements, ground/walls/materials, light direction & quality (hard/soft; key/fill/rim), implied time-of-day, 38 vibe keywords.
            Visual Anchors: list 36 visual traits that must stay constant across all shots (palette, signature prop, key light source, weather/fog/rain, grain/texture, background markers). </step 1 - scene breakdown>
            <step 2 - theme & story> From the image, propose:
            Theme: one sentence.
            Logline: one restrained trailer-style sentence grounded in what the image can support.
            Emotional Arc: 4 beats (setup/build/turn/payoff), one line each. </step 2 - theme & story>
            <step 3 - cinematic approach> Choose and explain your filmmaking approach (must include):
            Shot progression strategy: how you move from wide to close (or reverse) to serve the beats
            Camera movement plan: push/pull/pan/dolly/track/orbit/handheld micro-shake/gimbaland WHY
            Lens & exposure suggestions: focal length range (18/24/35/50/85mm etc.), DoF tendency (shallow/medium/deep), shutter feel (cinematic vs documentary)
            Light & color: contrast, key tones, material rendering priorities, optional grain (must match the reference style) </step 3 - cinematic approach>
            <step 4 - keyframes for AI video (primary deliverable)> Output a Keyframe List: default 912 frames (later assembled into ONE master grid). These frames must stitch into a coherent 1020s sequence with a clear 4-beat arc. Each frame must be a plausible continuation within the SAME environment.
            Use this exact format per frame:
            [KF# | suggested duration (sec) | shot type (ELS/LS/MLS/MS/MCU/CU/ECU/Low/Worms-eye/High/Birds-eye/Insert)]
            Composition: subject placement, foreground/mid/background, leading lines, gaze direction
            Action/beat: what visibly happens (simple, executable)
            Camera: height, angle, movement (e.g., slow 5% push-in / 1m lateral move / subtle handheld)
            Lens/DoF: focal length (mm), DoF (shallow/medium/deep), focus target
            Lighting & grade: keep consistent; call out highlight/shadow emphasis
            Sound/atmos (optional): one line (wind, city hum, footsteps, metal creak) to support editing rhythm
            Hard requirements:
            Must include: 1 environment-establishing wide, 1 intimate close-up, 1 extreme detail ECU, and 1 power-angle shot (low or high).
            Ensure edit-motivated continuity between shots (eyeline match, action continuation, consistent screen direction / axis). </step 4 - keyframes for AI video>
            
            OUTPUT REQUIREMENT: Based on the Keyframe List generated in Step 4, return exactly a JSON array containing 9 strings. Each string should be a full, detailed image prompt for one keyframe, incorporating all the visual anchors and continuity details to ensure character consistency.
            `:"V3"===t?`
            STORY-TO-STORYBOARD META-PROMPT
            IMPORTANT: Do not create the image, create the detailed prompt for the image.
            The image prompt must make reference to the story and reference image provided by user, the prompt must follow exactly the details of the image prompt
            When the user provides a short story synopsis, follow these steps:
            Analyze the synopsis and identify:
            The main subject(s) (person, pair, group, creature, vehicle, object)
            Their appearance and defining traits
            The environment and tone
            The emotional or narrative beat
            Lighting/mood implied by the story
            Create a full 3\xd73 cinematic storyboard grid with 9 distinct shots of the same subject(s) in the same environment, using consistent wardrobe, lighting, and atmosphere.
            
            OUTPUT FORMAT
            Cinematic 3\xd73 Storyboard Prompt
            Story Synopsis (interpreted):
            <one-sentence interpretation of the users synopsis>
            Create a professional 3\xd73 cinematic storyboard grid featuring the same subject(s) from the synopsis in the same environment.
            Maintain total consistency in appearance, clothing, lighting, mood, and environmental details.
            Each panel represents a distinct camera shot following cinematic conventions.
            Row 1  Establishing Context
            Extreme Long Shot (ELS):
            Full environment revealed, subject(s) small in frame. Match the storys setting, lighting, and mood.
            Long Shot (LS):
            Entire subject(s) visible head-to-toe (or full object/vehicle), standing naturally within the environment.
            Medium Long Shot (MLS / 3-4 / American Shot):
            Subject(s) framed from knees up (or 3/4 angle for objects), showing stance, posture, and core emotion.
            Row 2  Core Coverage
            Medium Shot (MS):
            Waist-up framing. Capture the key action, attitude, or emotional beat implied by the story.
            Medium Close-Up (MCU):
            Chest-up. Focus on emotion, expression, micro-interaction, or narrative tension.
            Close-Up (CU):
            Tight shot of the face (or front detail of an object). Cinematic depth of field, emotional clarity.
            Row 3  Details & Angles
            Extreme Close-Up (ECU):
            Macro detail: eyes, hands, symbolic object, texture, or a key story element.
            Low Angle Shot (Worms Eye):
            Camera looking up at the subject(s) from below. Dramatic, heroic, or imposing based on the storys tone.
            High Angle Shot (Birds Eye):
            Camera looking down from above. Spatial clarity, vulnerability, or overview of action.
            Global Requirements
            Same subject from image prompt(s) in all 9 frames
            Same clothing, hairstyle, props, weapons, or accessories
            Same lighting conditions and color grading
            Consistent environment and weather
            Correct realism and cinematic depth of field per shot
            Photorealistic textures
            Cinematic camera behavior and focal-length accuracy

            Example of How This Works with a Synopsis
            User input:
            A lone desert scout tracks a signal across a ruined canyon at sunset.
            Output (shortened example):
            Story Synopsis: A lone desert scout navigates a canyon wasteland at sunset while tracking a mysterious signal.
            ELS: small figure against vast ruined canyon
            LS: scout silhouetted in sunset light
            MLS: knees-up shot with gear visible
            MS: waist-up, scanning horizon
            MCU: chest-up, focused expression
            CU: dust-covered face, tracking device glow
            ECU: close-up of the device display
            Low Angle: heroic stance on canyon ridge
            High Angle: scout from above, canyon below

            OUTPUT REQUIREMENT: Return exactly a JSON array containing 9 strings. Each string must be the detailed visual description for one of the 9 frames (ELS, LS, MLS, MS, MCU, CU, ECU, Low Angle, High Angle), fully incorporating the character and environment details from the input story and reference image.
            `:`
            STORY-TO-STORYBOARD META-PROMPT. Create a full 3\xd73 cinematic storyboard grid with 9 distinct shots.
            OUTPUT REQUIREMENT: Return exactly a JSON array containing 9 strings.
            `;let o=[];r&&o.push({inlineData:{data:l(r),mimeType:"image/png"}}),o.push({text:`REFERENCE MATERIAL: """${e}"""

SYSTEM INSTRUCTION:
${i}`});let a=((await n.models.generateContent({model:"gemini-3-pro-preview",contents:{parts:o},config:{responseMimeType:"application/json"}})).text||"").replace(/```json|```/g,"").trim(),c=JSON.parse(a);return Array.isArray(c)?c.slice(0,9):[e]}catch(e){throw console.error("planStoryboardAction failed:",e),e}}async function d(e,t,r={},n,i,o,u){try{let o=s(),d={numberOfVideos:1,aspectRatio:r.aspectRatio||"16:9",resolution:r.resolution||"720p",duration:r.duration?`${r.duration}s`:void 0},p={prompt:e||"Cinematic video with professional lighting."};n&&(p.image={imageBytes:l(n),mimeType:c(n)}),u&&(d.lastFrame={imageBytes:l(u),mimeType:c(u)}),i&&(p.video=i);let h=await o.models.generateVideos({model:t||"veo-3.1-fast-generate-preview",...p,config:d});for(;!h.done;)await a(5e3),h=await o.operations.getVideosOperation({operation:h});if(h.error)throw Error(h.error.message);let f=h.response?.generatedVideos?.[0]?.video;if(!f)throw Error("Video generation failed: No video returned");return{uri:f.uri,videoMetadata:f}}catch(e){throw console.error("generateVideoAction failed:",e),e}}async function p(e,t,r=[],n={}){try{let i=s(),o=r.map(e=>({inlineData:{data:l(e),mimeType:"image/png"}}));o.push({text:e});let a=await i.models.generateContent({model:t||"gemini-3-pro-image-preview",contents:{parts:o},config:{imageConfig:{aspectRatio:n.aspectRatio||"1:1",imageSize:n.resolution||"1K"}}}),c=[];if(a.candidates?.[0]?.content?.parts)for(let e of a.candidates[0].content.parts)e.inlineData?.data&&c.push(`data:${e.inlineData.mimeType||"image/png"};base64,${e.inlineData.data}`);return c}catch(e){throw console.error("generateImageFromTextAction failed:",e),e}}async function h(e,t){try{let r=s();return(await r.models.generateContent({model:"gemini-3-pro-preview",contents:`"""${e}"""${t}`,config:{thinkingConfig:{thinkingBudget:16e3}}})).text||""}catch(e){throw console.error("createScriptFromTextAction failed:",e),e}}async function f(e,t,r){try{let n=s();return(await n.models.generateContent({model:"gemini-3-pro-preview",contents:`${e}${t}${r}`,config:{thinkingConfig:{thinkingBudget:32e3}}})).text||""}catch(e){throw console.error("adaptScriptProfessionalAction failed:",e),e}}async function m(e){try{let t=s();return(await t.models.generateContent({model:"gemini-3-pro-preview",contents:`"""${e}"""`})).text||""}catch(e){throw console.error("expandVisualDescriptionAction failed:",e),e}}async function g(e,t,r={}){try{let t=s(),r=await t.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:[{parts:[{text:e}]}],config:{responseModalities:[i.Modality.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Puck"}}}}});return`data:audio/pcm;base64,${r.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data}`}catch(e){throw console.error("generateAudioAction failed:",e),e}}async function y(e){try{let t=s();return(await t.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:l(e),mimeType:e.match(/^data:([^;]+);base64,/)?.[1]||"audio/mp3"}},{text:"Transcribe the audio."}]}})).text||""}catch(e){throw console.error("transcribeAudioAction failed:",e),e}}(0,o.ensureServerEntryExports)([u,d,p,h,f,m,g,y]),(0,n.registerServerReference)("eb151d3fd857512271a65ce58cdee5f0c1e7b492",u),(0,n.registerServerReference)("339fcfd5065a4751c35774d5057596578758eddb",d),(0,n.registerServerReference)("fce521ad3c90b3e771b86791ccd823b072aac3aa",p),(0,n.registerServerReference)("dccf7eab92aa7700d0bfbb18afb2b6f9bff04cb8",h),(0,n.registerServerReference)("1d6c83ceea59af419a9339e920af96f843ae4931",f),(0,n.registerServerReference)("a78d6bd7ccacd86d81fd5dfaacb074eca54b8ecd",m),(0,n.registerServerReference)("6e4f4bd43c5cc2f1c37851bff4349970904bddc6",g),(0,n.registerServerReference)("10ee66149d7292c70664a2b6fcd7f7a70d2c3076",y)},32029:(e,t,r)=>{"use strict";function n({children:e}){return e}r.r(t),r.d(t,{default:()=>n})},4288:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(58585),i=r(30107);let o=["en","zh"],s=(0,i.Z)(async({locale:e})=>(o.includes(e)||(0,n.notFound)(),{locale:e,messages:(await r(77039)(`./${e}.json`)).default}))},5023:()=>{},15506:(e,t,r)=>{"use strict";let n=r(83674);e.exports={pkg:n}},41324:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GCE_LINUX_BIOS_PATHS=void 0,t.isGoogleCloudServerless=s,t.isGoogleComputeEngineLinux=a,t.isGoogleComputeEngineMACAddress=l,t.isGoogleComputeEngine=c,t.detectGCPResidency=function(){return s()||c()};let n=r(57147),i=r(22037);t.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};let o=/^42:01/;function s(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function a(){if("linux"!==(0,i.platform)())return!1;try{(0,n.statSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let e=(0,n.readFileSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(e)}catch{return!1}}function l(){for(let e of Object.values((0,i.networkInterfaces)()))if(e){for(let{mac:t}of e)if(o.test(t))return!0}return!1}function c(){return a()||l()}},80759:function(e,t,r){"use strict";let n;var i,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(i=function(e){return(i=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=i(e),n=0;n<r.length;n++)"default"!==r[n]&&o(t,e,r[n]);return s(t,e),t}),l=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.gcpResidencyCache=t.METADATA_SERVER_DETECTION=t.HEADERS=t.HEADER_VALUE=t.HEADER_NAME=t.SECONDARY_HOST_ADDRESS=t.HOST_ADDRESS=t.BASE_PATH=void 0,t.instance=function(e){return m("instance",e)},t.project=function(e){return m("project",e)},t.universe=function(e){return m("universe",e)},t.bulk=y,t.isAvailable=v,t.resetIsAvailableCache=function(){n=void 0},t.getGCPResidency=b,t.setGCPResidency=_,t.requestTimeout=E;let c=r(90206),u=r(99361),d=r(41324),p=a(r(15348));t.BASE_PATH="/computeMetadata/v1",t.HOST_ADDRESS="http://169.254.169.254",t.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.",t.HEADER_NAME="Metadata-Flavor",t.HEADER_VALUE="Google",t.HEADERS=Object.freeze({[t.HEADER_NAME]:t.HEADER_VALUE});let h=p.log("gcp-metadata");function f(e){return e||(e=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||t.HOST_ADDRESS),/^https?:\/\//.test(e)||(e=`http://${e}`),new URL(t.BASE_PATH,e).href}async function m(e,r={},n=3,i=!1){let o=new Headers(t.HEADERS),s="",a={};"object"==typeof e?(new Headers(e.headers).forEach((e,t)=>o.set(t,e)),s=e.metadataKey,a=e.params||a,n=e.noResponseRetries||n,i=e.fastFail||i):s=e,"string"==typeof r?s+=`/${r}`:(function(e){Object.keys(e).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw Error(`'${e}' is not a valid configuration option.`)}})}(r),r.property&&(s+=`/${r.property}`),new Headers(r.headers).forEach((e,t)=>o.set(t,e)),a=r.params||a);let l=i?g:c.request,d={url:`${f()}/${s}`,headers:o,retryConfig:{noResponseRetries:n},params:a,responseType:"text",timeout:E()};h.info("instance request %j",d);let p=await l(d);h.info("instance metadata is %s",p.data);let m=p.headers.get(t.HEADER_NAME);if(m!==t.HEADER_VALUE)throw RangeError(`Invalid response from metadata service: incorrect ${t.HEADER_NAME} header. Expected '${t.HEADER_VALUE}', got ${m?`'${m}'`:"no header"}`);if("string"==typeof p.data)try{return u.parse(p.data)}catch{}return p.data}async function g(e){let r={...e,url:e.url?.toString().replace(f(),f(t.SECONDARY_HOST_ADDRESS))};return Promise.any([(0,c.request)(e),(0,c.request)(r)])}async function y(e){let t={};return await Promise.all(e.map(e=>(async()=>{let r=await m(e);t[e.metadataKey]=r})())),t}async function v(){if(process.env.METADATA_SERVER_DETECTION){let e=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(e in t.METADATA_SERVER_DETECTION))throw RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${e}\`, but it should be \`${Object.keys(t.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(e){case"assume-present":return!0;case"none":return!1;case"bios-only":return b()}}try{return void 0===n&&(n=m("instance",void 0,process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0,!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await n,!0}catch(e){if(process.env.DEBUG_AUTH&&console.info(e),"request-timeout"===e.type||e.response&&404===e.response.status)return!1;if(!(e.response&&404===e.response.status)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function b(){return null===t.gcpResidencyCache&&_(),t.gcpResidencyCache}function _(e=null){t.gcpResidencyCache=null!==e?e:(0,d.detectGCPResidency)()}function E(){return b()?0:3e3}t.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"}),t.gcpResidencyCache=null,l(r(41324),t)},14574:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USER_AGENT=t.PRODUCT_NAME=t.pkg=void 0;let n=r(99830);t.pkg=n;let i="google-api-nodejs-client";t.PRODUCT_NAME=i;let o=`${i}/${n.version}`;t.USER_AGENT=o},1838:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleToken=void 0;var n=l(r(57147)),i=r(90206),o=l(r(8287)),s=l(r(71017)),a=r(73837);function l(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(l=function(e,t){if(!t&&e&&e.__esModule)return e;var i,o,s={__proto__:null,default:e};if(null===e||"object"!=c(e)&&"function"!=typeof e)return s;if(i=t?n:r){if(i.has(e))return i.get(e);i.set(e,s)}for(var a in e)"default"!==a&&({}).hasOwnProperty.call(e,a)&&((o=(i=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,a))&&(o.get||o.set)?i(s,a,o):s[a]=e[a]);return s})(e,t)}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function d(e,t,r){return e.set(p(e,t),r),r}function p(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw TypeError("Private element is not present on this object")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,E(n.key),n)}}function f(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function g(e){var t="function"==typeof Map?new Map:void 0;return(g=function(e){if(null===e||!function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(y())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&v(i,r.prototype),i}(e,arguments,b(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,e)})(e)}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}function v(e,t){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t,r){return(t=E(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=c(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==c(t)?t:t+""}function w(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,n,i,o){var l=Object.create((n&&n.prototype instanceof a?n:a).prototype);return x(l,"_invoke",function(r,n,i){var o,a,l,c=0,u=i||[],d=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,r){return o=t,a=0,l=e,p.n=r,s}};function h(r,n){for(a=r,l=n,t=0;!d&&c&&!i&&t<u.length;t++){var i,o=u[t],h=p.p,f=o[2];r>3?(i=f===n)&&(l=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=h&&((i=r<2&&h<o[1])?(a=0,p.v=n,p.n=o[1]):h<f&&(i=r<3||o[0]>n||n>f)&&(o[4]=r,o[5]=n,p.n=f,a=0))}if(i||r>1)return s;throw d=!0,n}return function(i,u,f){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,f),a=u,l=f;(t=a<2?e:l)||!d;){o||(a?a<3?(a>1&&(p.n=-1),h(a,l)):p.n=l:p.v=l);try{if(c=2,o){if(a||(i="next"),t=o[i]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,a<2&&(a=0)}else 1===a&&(t=o.return)&&t.call(o),a<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((t=(d=p.n<0)?l:r.call(n,p))!==s)break}catch(t){o=e,a=1,l=t}finally{c=1}}return{value:t,done:d}}}(r,i,o),!0),l}var s={};function a(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(x(t={},n,function(){return this}),t),d=c.prototype=a.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,x(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,x(d,"constructor",c),x(c,"constructor",l),l.displayName="GeneratorFunction",x(c,i,"GeneratorFunction"),x(d),x(d,i,"Generator"),x(d,n,function(){return this}),x(d,"toString",function(){return"[object Generator]"}),(w=function(){return{w:o,m:p}})()}function x(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(x=function(e,t,r,n){if(t)i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{var o=function(t,r){x(e,t,function(e){return this._invoke(t,r,e)})};o("next",0),o("throw",1),o("return",2)}})(e,t,r,n)}function S(e,t,r,n,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function T(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function s(e){S(o,n,i,s,a,"next",e)}function a(e){S(o,n,i,s,a,"throw",e)}s(void 0)})}}var A=n.readFile?(0,a.promisify)(n.readFile):T(w().m(function e(){return w().w(function(e){for(;;)switch(e.n){case 0:throw new O("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},e)})),C="https://oauth2.googleapis.com/token",O=function(e){function t(e,r){var n,i,o;return m(this,t),i=t,o=[e],i=b(i),_(n=function(e,t){if(t&&("object"==c(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,y()?Reflect.construct(i,o||[],b(this).constructor):i.apply(this,o)),"code",void 0),n.code=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(t,e),f(t)}(g(Error)),I=new WeakMap,N=new WeakSet;function k(e){return R.apply(this,arguments)}function R(){return(R=T(w().m(function e(t){return w().w(function(e){for(;;)switch(e.n){case 0:if(!I.get(p(I,this))||t.forceRefresh){e.n=1;break}return e.a(2,I.get(p(I,this)));case 1:return e.p=1,e.n=2,d(I,this,p(N,this,P).call(this,t));case 2:return e.a(2,e.v);case 3:return e.p=3,d(I,this,void 0),e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])}))).apply(this,arguments)}function P(e){return j.apply(this,arguments)}function j(){return(j=T(w().m(function e(t){var r;return w().w(function(e){for(;;)switch(e.n){case 0:if(!(!1===this.isTokenExpiring()&&!1===t.forceRefresh)){e.n=1;break}return e.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){e.n=2;break}throw Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){e.n=4;break}return e.n=3,this.getCredentials(this.keyFile);case 3:r=e.v,this.key=r.privateKey,this.iss=r.clientEmail||this.iss,r.clientEmail||p(N,this,M).call(this);case 4:return e.a(2,p(N,this,G).call(this))}},e,this)}))).apply(this,arguments)}function M(){if(!this.iss)throw new O("email is required.","MISSING_CREDENTIALS")}function D(){return U.apply(this,arguments)}function U(){return(U=T(w().m(function e(){var t;return w().w(function(e){for(;;)switch(e.n){case 0:if(this.accessToken){e.n=1;break}throw Error("No token to revoke.");case 1:return t="https://oauth2.googleapis.com/revoke?token="+this.accessToken,e.n=2,this.transporter.request({url:t,retry:!0});case 2:p(N,this,L).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return e.a(2)}},e,this)}))).apply(this,arguments)}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.keyFile=e.keyFile,this.key=e.key,this.rawToken=void 0,this.iss=e.email||e.iss,this.sub=e.sub,this.additionalClaims=e.additionalClaims,"object"===c(e.scope)?this.scope=e.scope.join(" "):this.scope=e.scope,this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,e.transporter&&(this.transporter=e.transporter)}function G(){return F.apply(this,arguments)}function F(){return(F=T(w().m(function e(){var t,r,n,i,s,a,l,c,u,d;return w().w(function(e){for(;;)switch(e.n){case 0:return t=Math.floor(new Date().getTime()/1e3),r=this.additionalClaims||{},n=Object.assign({iss:this.iss,scope:this.scope,aud:C,exp:t+3600,iat:t,sub:this.sub},r),i=o.sign({header:{alg:"RS256"},payload:n,secret:this.key}),e.p=1,e.n=2,this.transporter.request({method:"POST",url:C,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:i}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return s=e.v,this.rawToken=s.data,this.expiresAt=null===s.data.expires_in||void 0===s.data.expires_in?void 0:(t+s.data.expires_in)*1e3,e.a(2,this.rawToken);case 3:throw e.p=3,d=e.v,this.rawToken=void 0,this.tokenExpires=void 0,(c=d.response&&null!==(a=d.response)&&void 0!==a&&a.data?null===(l=d.response)||void 0===l?void 0:l.data:{}).error&&(u=c.error_description?": ".concat(c.error_description):"",d.message="".concat(c.error).concat(u)),d;case 4:return e.a(2)}},e,this,[[1,3]])}))).apply(this,arguments)}t.GoogleToken=function(){var e;return f(function e(t){var r;m(this,e),u(this,N),N.add(this),_(this,"expiresAt",void 0),_(this,"key",void 0),_(this,"keyFile",void 0),_(this,"iss",void 0),_(this,"sub",void 0),_(this,"scope",void 0),_(this,"rawToken",void 0),_(this,"tokenExpires",void 0),_(this,"email",void 0),_(this,"additionalClaims",void 0),_(this,"eagerRefreshThresholdMillis",void 0),_(this,"transporter",{request:function(e){return(0,i.request)(e)}}),r=void 0,u(this,I),I.set(this,r),p(N,this,L).call(this,t)},[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var e=new Date().getTime();return!this.rawToken||!this.expiresAt||e>=this.expiresAt}},{key:"isTokenExpiring",value:function(){var e,t=new Date().getTime(),r=null!==(e=this.eagerRefreshThresholdMillis)&&void 0!==e?e:0;return!this.rawToken||!this.expiresAt||this.expiresAt<=t+r}},{key:"getToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"===c(e)&&(t=e,e=void 0),t=Object.assign({forceRefresh:!1},t),e){var r=e;p(N,this,k).call(this,t).then(function(e){return r(null,e)},e);return}return p(N,this,k).call(this,t)}},{key:"getCredentials",value:(e=T(w().m(function e(t){var r,n,i,o,a;return w().w(function(e){for(;;)switch(e.n){case 0:a=s.extname(t),e.n=".json"===a?1:".der"===a?4:".crt"===a?4:".pem"===a?4:".p12"===a?6:".pfx"===a?6:7;break;case 1:return e.n=2,A(t,"utf8");case 2:if(n=(r=JSON.parse(e.v)).private_key,i=r.client_email,!(!n||!i)){e.n=3;break}throw new O("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return e.a(2,{privateKey:n,clientEmail:i});case 4:return e.n=5,A(t,"utf8");case 5:return o=e.v,e.a(2,{privateKey:o});case 6:throw new O("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new O("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return e.a(2)}},e)})),function(t){return e.apply(this,arguments)})},{key:"revokeToken",value:function(e){if(e){p(N,this,D).call(this).then(function(){return e()},e);return}return p(N,this,D).call(this)}}])}()},56647:(e,t,r)=>{"use strict";let n=r(64965);e.exports={pkg:n}},36537:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GCE_LINUX_BIOS_PATHS=void 0,t.isGoogleCloudServerless=s,t.isGoogleComputeEngineLinux=a,t.isGoogleComputeEngineMACAddress=l,t.isGoogleComputeEngine=c,t.detectGCPResidency=function(){return s()||c()};let n=r(57147),i=r(22037);t.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};let o=/^42:01/;function s(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function a(){if("linux"!==(0,i.platform)())return!1;try{(0,n.statSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let e=(0,n.readFileSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(e)}catch{return!1}}function l(){for(let e of Object.values((0,i.networkInterfaces)()))if(e){for(let{mac:t}of e)if(o.test(t))return!0}return!1}function c(){return a()||l()}},61357:function(e,t,r){"use strict";let n;var i,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(i=function(e){return(i=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=i(e),n=0;n<r.length;n++)"default"!==r[n]&&o(t,e,r[n]);return s(t,e),t}),l=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.gcpResidencyCache=t.METADATA_SERVER_DETECTION=t.HEADERS=t.HEADER_VALUE=t.HEADER_NAME=t.SECONDARY_HOST_ADDRESS=t.HOST_ADDRESS=t.BASE_PATH=void 0,t.instance=function(e){return m("instance",e)},t.project=function(e){return m("project",e)},t.universe=function(e){return m("universe",e)},t.bulk=y,t.isAvailable=v,t.resetIsAvailableCache=function(){n=void 0},t.getGCPResidency=b,t.setGCPResidency=_,t.requestTimeout=E;let c=r(71903),u=r(67301),d=r(36537),p=a(r(36219));t.BASE_PATH="/computeMetadata/v1",t.HOST_ADDRESS="http://169.254.169.254",t.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.",t.HEADER_NAME="Metadata-Flavor",t.HEADER_VALUE="Google",t.HEADERS=Object.freeze({[t.HEADER_NAME]:t.HEADER_VALUE});let h=p.log("gcp-metadata");function f(e){return e||(e=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||t.HOST_ADDRESS),/^https?:\/\//.test(e)||(e=`http://${e}`),new URL(t.BASE_PATH,e).href}async function m(e,r={},n=3,i=!1){let o=new Headers(t.HEADERS),s="",a={};"object"==typeof e?(new Headers(e.headers).forEach((e,t)=>o.set(t,e)),s=e.metadataKey,a=e.params||a,n=e.noResponseRetries||n,i=e.fastFail||i):s=e,"string"==typeof r?s+=`/${r}`:(function(e){Object.keys(e).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw Error(`'${e}' is not a valid configuration option.`)}})}(r),r.property&&(s+=`/${r.property}`),new Headers(r.headers).forEach((e,t)=>o.set(t,e)),a=r.params||a);let l=i?g:c.request,d={url:`${f()}/${s}`,headers:o,retryConfig:{noResponseRetries:n},params:a,responseType:"text",timeout:E()};h.info("instance request %j",d);let p=await l(d);h.info("instance metadata is %s",p.data);let m=p.headers.get(t.HEADER_NAME);if(m!==t.HEADER_VALUE)throw RangeError(`Invalid response from metadata service: incorrect ${t.HEADER_NAME} header. Expected '${t.HEADER_VALUE}', got ${m?`'${m}'`:"no header"}`);if("string"==typeof p.data)try{return u.parse(p.data)}catch{}return p.data}async function g(e){let r={...e,url:e.url?.toString().replace(f(),f(t.SECONDARY_HOST_ADDRESS))};return Promise.any([(0,c.request)(e),(0,c.request)(r)])}async function y(e){let t={};return await Promise.all(e.map(e=>(async()=>{let r=await m(e);t[e.metadataKey]=r})())),t}async function v(){if(process.env.METADATA_SERVER_DETECTION){let e=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(e in t.METADATA_SERVER_DETECTION))throw RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${e}\`, but it should be \`${Object.keys(t.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(e){case"assume-present":return!0;case"none":return!1;case"bios-only":return b()}}try{return void 0===n&&(n=m("instance",void 0,process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0,!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await n,!0}catch(e){if(process.env.DEBUG_AUTH&&console.info(e),"request-timeout"===e.type||e.response&&404===e.response.status)return!1;if(!(e.response&&404===e.response.status)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function b(){return null===t.gcpResidencyCache&&_(),t.gcpResidencyCache}function _(e=null){t.gcpResidencyCache=null!==e?e:(0,d.detectGCPResidency)()}function E(){return b()?0:3e3}t.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"}),t.gcpResidencyCache=null,l(r(36537),t)},73662:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USER_AGENT=t.PRODUCT_NAME=t.pkg=void 0;let n=r(8417);t.pkg=n;let i="google-api-nodejs-client";t.PRODUCT_NAME=i;let o=`${i}/${n.version}`;t.USER_AGENT=o},6768:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleToken=void 0;var n=l(r(57147)),i=r(71903),o=l(r(90274)),s=l(r(71017)),a=r(73837);function l(e,t){if("function"==typeof WeakMap)var r=new WeakMap,n=new WeakMap;return(l=function(e,t){if(!t&&e&&e.__esModule)return e;var i,o,s={__proto__:null,default:e};if(null===e||"object"!=c(e)&&"function"!=typeof e)return s;if(i=t?n:r){if(i.has(e))return i.get(e);i.set(e,s)}for(var a in e)"default"!==a&&({}).hasOwnProperty.call(e,a)&&((o=(i=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,a))&&(o.get||o.set)?i(s,a,o):s[a]=e[a]);return s})(e,t)}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function d(e,t,r){return e.set(p(e,t),r),r}function p(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw TypeError("Private element is not present on this object")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,E(n.key),n)}}function f(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function g(e){var t="function"==typeof Map?new Map:void 0;return(g=function(e){if(null===e||!function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(y())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&v(i,r.prototype),i}(e,arguments,b(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,e)})(e)}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}function v(e,t){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t,r){return(t=E(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=c(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==c(t)?t:t+""}function w(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,n,i,o){var l=Object.create((n&&n.prototype instanceof a?n:a).prototype);return x(l,"_invoke",function(r,n,i){var o,a,l,c=0,u=i||[],d=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,r){return o=t,a=0,l=e,p.n=r,s}};function h(r,n){for(a=r,l=n,t=0;!d&&c&&!i&&t<u.length;t++){var i,o=u[t],h=p.p,f=o[2];r>3?(i=f===n)&&(l=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=h&&((i=r<2&&h<o[1])?(a=0,p.v=n,p.n=o[1]):h<f&&(i=r<3||o[0]>n||n>f)&&(o[4]=r,o[5]=n,p.n=f,a=0))}if(i||r>1)return s;throw d=!0,n}return function(i,u,f){if(c>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,f),a=u,l=f;(t=a<2?e:l)||!d;){o||(a?a<3?(a>1&&(p.n=-1),h(a,l)):p.n=l:p.v=l);try{if(c=2,o){if(a||(i="next"),t=o[i]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,a<2&&(a=0)}else 1===a&&(t=o.return)&&t.call(o),a<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((t=(d=p.n<0)?l:r.call(n,p))!==s)break}catch(t){o=e,a=1,l=t}finally{c=1}}return{value:t,done:d}}}(r,i,o),!0),l}var s={};function a(){}function l(){}function c(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(x(t={},n,function(){return this}),t),d=c.prototype=a.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,x(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=c,x(d,"constructor",c),x(c,"constructor",l),l.displayName="GeneratorFunction",x(c,i,"GeneratorFunction"),x(d),x(d,i,"Generator"),x(d,n,function(){return this}),x(d,"toString",function(){return"[object Generator]"}),(w=function(){return{w:o,m:p}})()}function x(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(x=function(e,t,r,n){if(t)i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{var o=function(t,r){x(e,t,function(e){return this._invoke(t,r,e)})};o("next",0),o("throw",1),o("return",2)}})(e,t,r,n)}function S(e,t,r,n,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(n,i)}function T(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function s(e){S(o,n,i,s,a,"next",e)}function a(e){S(o,n,i,s,a,"throw",e)}s(void 0)})}}var A=n.readFile?(0,a.promisify)(n.readFile):T(w().m(function e(){return w().w(function(e){for(;;)switch(e.n){case 0:throw new O("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},e)})),C="https://oauth2.googleapis.com/token",O=function(e){function t(e,r){var n,i,o;return m(this,t),i=t,o=[e],i=b(i),_(n=function(e,t){if(t&&("object"==c(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,y()?Reflect.construct(i,o||[],b(this).constructor):i.apply(this,o)),"code",void 0),n.code=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(t,e),f(t)}(g(Error)),I=new WeakMap,N=new WeakSet;function k(e){return R.apply(this,arguments)}function R(){return(R=T(w().m(function e(t){return w().w(function(e){for(;;)switch(e.n){case 0:if(!I.get(p(I,this))||t.forceRefresh){e.n=1;break}return e.a(2,I.get(p(I,this)));case 1:return e.p=1,e.n=2,d(I,this,p(N,this,P).call(this,t));case 2:return e.a(2,e.v);case 3:return e.p=3,d(I,this,void 0),e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])}))).apply(this,arguments)}function P(e){return j.apply(this,arguments)}function j(){return(j=T(w().m(function e(t){var r;return w().w(function(e){for(;;)switch(e.n){case 0:if(!(!1===this.isTokenExpiring()&&!1===t.forceRefresh)){e.n=1;break}return e.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){e.n=2;break}throw Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){e.n=4;break}return e.n=3,this.getCredentials(this.keyFile);case 3:r=e.v,this.key=r.privateKey,this.iss=r.clientEmail||this.iss,r.clientEmail||p(N,this,M).call(this);case 4:return e.a(2,p(N,this,G).call(this))}},e,this)}))).apply(this,arguments)}function M(){if(!this.iss)throw new O("email is required.","MISSING_CREDENTIALS")}function D(){return U.apply(this,arguments)}function U(){return(U=T(w().m(function e(){var t;return w().w(function(e){for(;;)switch(e.n){case 0:if(this.accessToken){e.n=1;break}throw Error("No token to revoke.");case 1:return t="https://oauth2.googleapis.com/revoke?token="+this.accessToken,e.n=2,this.transporter.request({url:t,retry:!0});case 2:p(N,this,L).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return e.a(2)}},e,this)}))).apply(this,arguments)}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.keyFile=e.keyFile,this.key=e.key,this.rawToken=void 0,this.iss=e.email||e.iss,this.sub=e.sub,this.additionalClaims=e.additionalClaims,"object"===c(e.scope)?this.scope=e.scope.join(" "):this.scope=e.scope,this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,e.transporter&&(this.transporter=e.transporter)}function G(){return F.apply(this,arguments)}function F(){return(F=T(w().m(function e(){var t,r,n,i,s,a,l,c,u,d;return w().w(function(e){for(;;)switch(e.n){case 0:return t=Math.floor(new Date().getTime()/1e3),r=this.additionalClaims||{},n=Object.assign({iss:this.iss,scope:this.scope,aud:C,exp:t+3600,iat:t,sub:this.sub},r),i=o.sign({header:{alg:"RS256"},payload:n,secret:this.key}),e.p=1,e.n=2,this.transporter.request({method:"POST",url:C,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:i}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return s=e.v,this.rawToken=s.data,this.expiresAt=null===s.data.expires_in||void 0===s.data.expires_in?void 0:(t+s.data.expires_in)*1e3,e.a(2,this.rawToken);case 3:throw e.p=3,d=e.v,this.rawToken=void 0,this.tokenExpires=void 0,(c=d.response&&null!==(a=d.response)&&void 0!==a&&a.data?null===(l=d.response)||void 0===l?void 0:l.data:{}).error&&(u=c.error_description?": ".concat(c.error_description):"",d.message="".concat(c.error).concat(u)),d;case 4:return e.a(2)}},e,this,[[1,3]])}))).apply(this,arguments)}t.GoogleToken=function(){var e;return f(function e(t){var r;m(this,e),u(this,N),N.add(this),_(this,"expiresAt",void 0),_(this,"key",void 0),_(this,"keyFile",void 0),_(this,"iss",void 0),_(this,"sub",void 0),_(this,"scope",void 0),_(this,"rawToken",void 0),_(this,"tokenExpires",void 0),_(this,"email",void 0),_(this,"additionalClaims",void 0),_(this,"eagerRefreshThresholdMillis",void 0),_(this,"transporter",{request:function(e){return(0,i.request)(e)}}),r=void 0,u(this,I),I.set(this,r),p(N,this,L).call(this,t)},[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var e=new Date().getTime();return!this.rawToken||!this.expiresAt||e>=this.expiresAt}},{key:"isTokenExpiring",value:function(){var e,t=new Date().getTime(),r=null!==(e=this.eagerRefreshThresholdMillis)&&void 0!==e?e:0;return!this.rawToken||!this.expiresAt||this.expiresAt<=t+r}},{key:"getToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"===c(e)&&(t=e,e=void 0),t=Object.assign({forceRefresh:!1},t),e){var r=e;p(N,this,k).call(this,t).then(function(e){return r(null,e)},e);return}return p(N,this,k).call(this,t)}},{key:"getCredentials",value:(e=T(w().m(function e(t){var r,n,i,o,a;return w().w(function(e){for(;;)switch(e.n){case 0:a=s.extname(t),e.n=".json"===a?1:".der"===a?4:".crt"===a?4:".pem"===a?4:".p12"===a?6:".pfx"===a?6:7;break;case 1:return e.n=2,A(t,"utf8");case 2:if(n=(r=JSON.parse(e.v)).private_key,i=r.client_email,!(!n||!i)){e.n=3;break}throw new O("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return e.a(2,{privateKey:n,clientEmail:i});case 4:return e.n=5,A(t,"utf8");case 5:return o=e.v,e.a(2,{privateKey:o});case 6:throw new O("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new O("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return e.a(2)}},e)})),function(t){return e.apply(this,arguments)})},{key:"revokeToken",value:function(e){if(e){p(N,this,D).call(this).then(function(){return e()},e);return}return p(N,this,D).call(this)}}])}()},27063:(e,t,r)=>{"use strict";let n,i,o,s,a;r.d(t,{GoogleGenAI:()=>nj,Modality:()=>I});var l,c,u,d,p,h,f,m,g,y,v,b,_,E,w,x,S,T,A,C,O,I,N,k,R,P,j,M,D,U,L,G,F,q,B,H,V,$,z,J,W,K,Y,X,Z,Q,ee,et,er,en,ei,eo,es,ea,el,ec,eu,ed,ep=r(45054),eh=r(57147),ef=r(73292),em=r(84492),eg=r(76402),ey=r(87768),ev=r(71017);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class eb{}function e_(e,t){return e.replace(/\{([^}]+)\}/g,(e,r)=>{if(Object.prototype.hasOwnProperty.call(t,r)){let e=t[r];return null!=e?String(e):""}throw Error(`Key '${r}' not found in valueMap.`)})}function eE(e,t,r){for(let n=0;n<t.length-1;n++){let i=t[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e)){if(Array.isArray(r))e[o]=Array.from({length:r.length},()=>({}));else throw Error(`Value must be a list given an array path ${i}`)}if(Array.isArray(e[o])){let i=e[o];if(Array.isArray(r))for(let e=0;e<i.length;e++)eE(i[e],t.slice(n+1),r[e]);else for(let e of i)eE(e,t.slice(n+1),r)}return}if(i.endsWith("[0]")){let o=i.slice(0,-3);o in e||(e[o]=[{}]),eE(e[o][0],t.slice(n+1),r);return}e[i]&&"object"==typeof e[i]||(e[i]={}),e=e[i]}let n=t[t.length-1],i=e[n];if(void 0!==i){if(!r||"object"==typeof r&&0===Object.keys(r).length||r===i)return;if("object"==typeof i&&"object"==typeof r&&null!==i&&null!==r)Object.assign(i,r);else throw Error(`Cannot set value for an existing key. Key: ${n}`)}else"_self"!==n||"object"!=typeof r||null===r||Array.isArray(r)?e[n]=r:Object.assign(e,r)}function ew(e,t,r){try{if(1===t.length&&"_self"===t[0])return e;for(let n=0;n<t.length;n++){if("object"!=typeof e||null===e)return r;let i=t[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e))return r;{let i=e[o];if(!Array.isArray(i))return r;return i.map(e=>ew(e,t.slice(n+1),r))}}e=e[i]}return e}catch(e){if(e instanceof TypeError)return r;throw e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ex(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}function eS(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["parent"]);null!=n&&eE(t,["parent"],n);let i=ew(e,["documentName"]);return null!=i&&eE(t,["documentName"],i),t}(s)),t}(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(l||(l={})),function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"}(c||(c={})),function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"}(u||(u={})),function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"}(d||(d={})),function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"}(p||(p={})),function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"}(h||(h={})),function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"}(f||(f={})),function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"}(m||(m={})),function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"}(g||(g={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(y||(y={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"}(v||(v={})),function(e){e.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.MINIMAL="MINIMAL"}(b||(b={})),function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"}(_||(_={})),function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"}(E||(E={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"}(w||(w={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE",e.IMAGE_RECITATION="IMAGE_RECITATION",e.IMAGE_OTHER="IMAGE_OTHER"}(x||(x={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(S||(S={})),function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"}(T||(T={})),function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"}(A||(A={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"}(C||(C={})),function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"}(O||(O={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"}(I||(I={})),function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"}(N||(N={})),function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"}(k||(k={})),function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"}(R||(R={})),function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"}(P||(P={})),function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"}(j||(j={})),function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",e.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"}(M||(M={})),(D||(D={})).COLLECTION="COLLECTION",function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"}(U||(U={})),function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"}(L||(L={})),function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(G||(G={})),function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"}(F||(F={})),function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"}(q||(q={})),function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"}(B||(B={})),function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"}(H||(H={})),function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"}(V||(V={})),function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"}($||($={})),function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"}(z||(z={})),function(e){e.ASSET="ASSET",e.STYLE="STYLE"}(J||(J={})),function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"}(W||(W={})),function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"}(K||(K={})),function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING"}(Y||(Y={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"}(X||(X={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"}(Z||(Z={})),function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED",e.REGISTERED="REGISTERED"}(Q||(Q={})),function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"}(ee||(ee={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"}(et||(et={})),function(e){e.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",e.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",e.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"}(er||(er={})),function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.ACTIVITY_START="ACTIVITY_START",e.ACTIVITY_END="ACTIVITY_END"}(en||(en={})),function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"}(ei||(ei={})),function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"}(eo||(eo={})),function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"}(es||(es={})),function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"}(ea||(ea={})),function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"}(el||(el={})),function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"}(ec||(ec={})),function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"}(eu||(eu={}));class eT{constructor(e){let t={};for(let r of e.headers.entries())t[r[0]]=r[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class eA{get text(){var e,t,r,n,i,o,s,a;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",c=!1,u=[];for(let e of null!==(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(let[t,r]of Object.entries(e))"text"!==t&&"thought"!==t&&"thoughtSignature"!==t&&(null!==r||void 0!==r)&&u.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;c=!0,l+=e.text}}return u.length>0&&console.warn(`there are non-text parts ${u} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),c?l:void 0}get data(){var e,t,r,n,i,o,s,a;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="",c=[];for(let e of null!==(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(let[t,r]of Object.entries(e))"inlineData"!==t&&(null!==r||void 0!==r)&&c.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(l+=atob(e.inlineData.data))}return c.length>0&&console.warn(`there are non-data parts ${c} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var e,t,r,n,i,o,s,a;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let l=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==l?void 0:l.length)!==0)return l}get executableCode(){var e,t,r,n,i,o,s,a,l;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let c=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==c?void 0:c.length)!==0)return null===(l=null==c?void 0:c[0])||void 0===l?void 0:l.code}get codeExecutionResult(){var e,t,r,n,i,o,s,a,l;if((null===(n=null===(r=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===r?void 0:r.parts)||void 0===n?void 0:n.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let c=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==c?void 0:c.length)!==0)return null===(l=null==c?void 0:c[0])||void 0===l?void 0:l.output}}class eC{}class eO{}class eI{}class eN{}class ek{}class eR{}class eP{}class ej{}class eM{}class eD{}class eU{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new eU;return Object.assign(r,t?function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["videos"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["_self"]);return null!=r&&eE(t,["video"],function(e){let t={},r=ew(e,["gcsUri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["bytesBase64Encoded"]);null!=n&&eE(t,["videoBytes"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}(r)),t})(e))),eE(t,["generatedVideos"],e)}let n=ew(e,["raiMediaFilteredCount"]);null!=n&&eE(t,["raiMediaFilteredCount"],n);let i=ew(e,["raiMediaFilteredReasons"]);return null!=i&&eE(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e):function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response","generateVideoResponse"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["generatedSamples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["video"]);return null!=r&&eE(t,["video"],function(e){let t={},r=ew(e,["uri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["encodedVideo"]);null!=n&&eE(t,["videoBytes"],ex(n));let i=ew(e,["encoding"]);return null!=i&&eE(t,["mimeType"],i),t}(r)),t})(e))),eE(t,["generatedVideos"],e)}let n=ew(e,["raiMediaFilteredCount"]);null!=n&&eE(t,["raiMediaFilteredCount"],n);let i=ew(e,["raiMediaFilteredReasons"]);return null!=i&&eE(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e)),r}}class eL{}class eG{}class eF{}class eq{}class eB{}class eH{}class eV{}class e${_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new e$;return Object.assign(r,function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["parent"]);null!=n&&eE(t,["parent"],n);let i=ew(e,["documentName"]);return null!=i&&eE(t,["documentName"],i),t}(s)),t}(e)),r}}class ez{}class eJ{}class eW{}class eK{}class eY{get text(){var e,t,r;let n="",i=!1,o=[];for(let s of null!==(r=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==r?r:[]){for(let[e,t]of Object.entries(s))"text"!==e&&"thought"!==e&&null!==t&&o.push(e);if("string"==typeof s.text){if("boolean"==typeof s.thought&&s.thought)continue;i=!0,n+=s.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?n:void 0}get data(){var e,t,r;let n="",i=[];for(let o of null!==(r=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==r?r:[]){for(let[e,t]of Object.entries(o))"inlineData"!==e&&null!==t&&i.push(e);o.inlineData&&"string"==typeof o.inlineData.data&&(n+=atob(o.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),n.length>0?btoa(n):void 0}}class eX{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class eZ{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new eZ;return Object.assign(r,eS(e)),r}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function eQ(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;{let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function e0(e,t){let r=eQ(e,t);return r?r.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${r}`:r.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${r}`:r:""}function e1(e){return Array.isArray(e)?e.map(e=>e2(e)):[e2(e)]}function e2(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function e4(e){let t=e2(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function e5(e){let t=e2(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function e3(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function e6(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>e3(e)):[e3(e)]}function e8(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function e7(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function e9(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function te(e){if(null==e)throw Error("ContentUnion is required");return e8(e)?e:{role:"user",parts:e6(e)}}function tt(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=te(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=te(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>te(e)):[te(t)]}function tr(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(e7(e)||e9(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[te(e)]}let t=[],r=[],n=e8(e[0]);for(let i of e){let e=e8(i);if(e!=n)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(i);else if(e7(i)||e9(i))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else r.push(i)}return n||t.push({role:"user",parts:e6(r)}),t}function tn(e){let t={},r=["items"],n=["anyOf"],i=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let o=e.anyOf;for(let[s,a]of(null!=o&&2==o.length&&("null"===o[0].type?(t.nullable=!0,e=o[1]):"null"===o[1].type&&(t.nullable=!0,e=o[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let r=e.filter(e=>"null"!==e);if(1===r.length)t.type=Object.values(d).includes(r[0].toUpperCase())?r[0].toUpperCase():d.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],r))t.anyOf.push({type:Object.values(d).includes(e.toUpperCase())?e.toUpperCase():d.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=a){if("type"==s){if("null"===a)throw Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(d).includes(a.toUpperCase())?a.toUpperCase():d.TYPE_UNSPECIFIED}else if(r.includes(s))t[s]=tn(a);else if(n.includes(s)){let e=[];for(let r of a){if("null"==r.type){t.nullable=!0;continue}e.push(tn(r))}t[s]=e}else if(i.includes(s)){let e={};for(let[t,r]of Object.entries(a))e[t]=tn(r);t[s]=e}else{if("additionalProperties"===s)continue;t[s]=a}}return t}function ti(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function to(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function ts(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=tn(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=tn(t.response));return e}function ta(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let r of e)t.push(r);return t}function tl(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,r,n=1){let i=!t.startsWith(`${r}/`)&&t.split("/").length===n;if(e.isVertexAI())return t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${r}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:i?`projects/${e.getProject()}/locations/${e.getLocation()}/${r}/${t}`:t;return i?`${r}/${t}`:t}(e,t,"cachedContents")}function tc(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function tu(e){return null!=e&&"object"==typeof e&&"video"in e}function td(e){return null!=e&&"object"==typeof e&&"uri"in e}function tp(e){var t;let r;if(null!=e&&"object"==typeof e&&"name"in e&&(r=e.name),!(td(e)&&void 0===(r=e.uri)||tu(e)&&void 0===(r=null===(t=e.video)||void 0===t?void 0:t.uri))){if("string"==typeof e&&(r=e),void 0===r)throw Error("Could not extract file name from the provided input.");if(r.startsWith("https://")){let e=r.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${r}`);r=e[0]}else r.startsWith("files/")&&(r=r.split("files/")[1]);return r}}function th(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function tf(e){for(let t of["models","tunedModels","publisherModels"]){if(null!==e&&"object"==typeof e&&t in e)return e[t]}return[]}function tm(e,t){let r;if("string"==typeof t){if(e.isVertexAI()){if(t.startsWith("gs://"))r={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))r={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`)}else if(t.startsWith("files/"))r={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`)}else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");r={inlinedRequests:t}}else r=t;let n=[r.gcsUri,r.bigqueryUri].filter(Boolean).length,i=[r.inlinedRequests,r.fileName].filter(Boolean).length;if(e.isVertexAI()){if(i>0||1!==n)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||1!==i)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return r}function tg(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let r=t.inlinedResponses;if(!Array.isArray(r)||0===r.length)return e;let n=!1;for(let e of r){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){n=!0;break}}return n&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function ty(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function tv(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function tb(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata","displayName"]);null!=n&&eE(t,["displayName"],n);let i=ew(e,["metadata","state"]);null!=i&&eE(t,["state"],tv(i));let o=ew(e,["metadata","createTime"]);null!=o&&eE(t,["createTime"],o);let s=ew(e,["metadata","endTime"]);null!=s&&eE(t,["endTime"],s);let a=ew(e,["metadata","updateTime"]);null!=a&&eE(t,["updateTime"],a);let l=ew(e,["metadata","model"]);null!=l&&eE(t,["model"],l);let c=ew(e,["metadata","output"]);return null!=c&&eE(t,["dest"],/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["responsesFile"]);null!=r&&eE(t,["fileName"],r);let n=ew(e,["inlinedResponses","inlinedResponses"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["response"]);null!=r&&eE(t,["response"],function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["candidates"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["content"]);null!=r&&eE(t,["content"],r);let n=ew(e,["citationMetadata"]);null!=n&&eE(t,["citationMetadata"],function(e){let t={},r=ew(e,["citationSources"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["citations"],e)}return t}(n));let i=ew(e,["tokenCount"]);null!=i&&eE(t,["tokenCount"],i);let o=ew(e,["finishReason"]);null!=o&&eE(t,["finishReason"],o);let s=ew(e,["avgLogprobs"]);null!=s&&eE(t,["avgLogprobs"],s);let a=ew(e,["groundingMetadata"]);null!=a&&eE(t,["groundingMetadata"],a);let l=ew(e,["index"]);null!=l&&eE(t,["index"],l);let c=ew(e,["logprobsResult"]);null!=c&&eE(t,["logprobsResult"],c);let u=ew(e,["safetyRatings"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["safetyRatings"],e)}let d=ew(e,["urlContextMetadata"]);return null!=d&&eE(t,["urlContextMetadata"],d),t})(e))),eE(t,["candidates"],e)}let i=ew(e,["modelVersion"]);null!=i&&eE(t,["modelVersion"],i);let o=ew(e,["promptFeedback"]);null!=o&&eE(t,["promptFeedback"],o);let s=ew(e,["responseId"]);null!=s&&eE(t,["responseId"],s);let a=ew(e,["usageMetadata"]);return null!=a&&eE(t,["usageMetadata"],a),t}(r));let n=ew(e,["error"]);return null!=n&&eE(t,["error"],n),t})(e))),eE(t,["inlinedResponses"],e)}let i=ew(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["inlinedEmbedContentResponses"],e)}return t}(tg(c))),t}function t_(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["displayName"]);null!=n&&eE(t,["displayName"],n);let i=ew(e,["state"]);null!=i&&eE(t,["state"],tv(i));let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["createTime"]);null!=s&&eE(t,["createTime"],s);let a=ew(e,["startTime"]);null!=a&&eE(t,["startTime"],a);let l=ew(e,["endTime"]);null!=l&&eE(t,["endTime"],l);let c=ew(e,["updateTime"]);null!=c&&eE(t,["updateTime"],c);let u=ew(e,["model"]);null!=u&&eE(t,["model"],u);let d=ew(e,["inputConfig"]);null!=d&&eE(t,["src"],function(e){let t={},r=ew(e,["instancesFormat"]);null!=r&&eE(t,["format"],r);let n=ew(e,["gcsSource","uris"]);null!=n&&eE(t,["gcsUri"],n);let i=ew(e,["bigquerySource","inputUri"]);return null!=i&&eE(t,["bigqueryUri"],i),t}(d));let p=ew(e,["outputConfig"]);null!=p&&eE(t,["dest"],function(e){let t={},r=ew(e,["predictionsFormat"]);null!=r&&eE(t,["format"],r);let n=ew(e,["gcsDestination","outputUriPrefix"]);null!=n&&eE(t,["gcsUri"],n);let i=ew(e,["bigqueryDestination","outputUri"]);return null!=i&&eE(t,["bigqueryUri"],i),t}(tg(p)));let h=ew(e,["completionStats"]);return null!=h&&eE(t,["completionStats"],h),t}function tE(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],function(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}function tw(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["src"]);null!=i&&eE(r,["batch","inputConfig"],function(e,t){let r={};if(void 0!==ew(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==ew(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==ew(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let n=ew(t,["fileName"]);null!=n&&eE(r,["fileName"],n);let i=ew(t,["inlinedRequests"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["request","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>tE(e))),eE(r,["request","contents"],e)}let o=ew(t,["metadata"]);null!=o&&eE(r,["metadata"],o);let s=ew(t,["config"]);return null!=s&&eE(r,["request","generationConfig"],function(e,t,r){let n={},i=ew(t,["systemInstruction"]);void 0!==r&&null!=i&&eE(r,["systemInstruction"],tE(te(i)));let o=ew(t,["temperature"]);null!=o&&eE(n,["temperature"],o);let s=ew(t,["topP"]);null!=s&&eE(n,["topP"],s);let a=ew(t,["topK"]);null!=a&&eE(n,["topK"],a);let l=ew(t,["candidateCount"]);null!=l&&eE(n,["candidateCount"],l);let c=ew(t,["maxOutputTokens"]);null!=c&&eE(n,["maxOutputTokens"],c);let u=ew(t,["stopSequences"]);null!=u&&eE(n,["stopSequences"],u);let d=ew(t,["responseLogprobs"]);null!=d&&eE(n,["responseLogprobs"],d);let p=ew(t,["logprobs"]);null!=p&&eE(n,["logprobs"],p);let h=ew(t,["presencePenalty"]);null!=h&&eE(n,["presencePenalty"],h);let f=ew(t,["frequencyPenalty"]);null!=f&&eE(n,["frequencyPenalty"],f);let m=ew(t,["seed"]);null!=m&&eE(n,["seed"],m);let g=ew(t,["responseMimeType"]);null!=g&&eE(n,["responseMimeType"],g);let y=ew(t,["responseSchema"]);null!=y&&eE(n,["responseSchema"],tn(y));let v=ew(t,["responseJsonSchema"]);if(null!=v&&eE(n,["responseJsonSchema"],v),void 0!==ew(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==ew(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let b=ew(t,["safetySettings"]);if(void 0!==r&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["category"]);if(null!=r&&eE(t,["category"],r),void 0!==ew(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=ew(e,["threshold"]);return null!=n&&eE(t,["threshold"],n),t})(e))),eE(r,["safetySettings"],e)}let _=ew(t,["tools"]);if(void 0!==r&&null!=_){let e=ta(_);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(ts(e)))),eE(r,["tools"],e)}let E=ew(t,["toolConfig"]);if(void 0!==r&&null!=E&&eE(r,["toolConfig"],function(e){let t={},r=ew(e,["retrievalConfig"]);null!=r&&eE(t,["retrievalConfig"],r);let n=ew(e,["functionCallingConfig"]);return null!=n&&eE(t,["functionCallingConfig"],function(e){let t={},r=ew(e,["allowedFunctionNames"]);null!=r&&eE(t,["allowedFunctionNames"],r);let n=ew(e,["mode"]);if(null!=n&&eE(t,["mode"],n),void 0!==ew(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(n)),t}(E)),void 0!==ew(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let w=ew(t,["cachedContent"]);void 0!==r&&null!=w&&eE(r,["cachedContent"],tl(e,w));let x=ew(t,["responseModalities"]);null!=x&&eE(n,["responseModalities"],x);let S=ew(t,["mediaResolution"]);null!=S&&eE(n,["mediaResolution"],S);let T=ew(t,["speechConfig"]);if(null!=T&&eE(n,["speechConfig"],ti(T)),void 0!==ew(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let A=ew(t,["thinkingConfig"]);null!=A&&eE(n,["thinkingConfig"],A);let C=ew(t,["imageConfig"]);null!=C&&eE(n,["imageConfig"],function(e){let t={},r=ew(e,["aspectRatio"]);null!=r&&eE(t,["aspectRatio"],r);let n=ew(e,["imageSize"]);if(null!=n&&eE(t,["imageSize"],n),void 0!==ew(e,["personGeneration"]))throw Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==ew(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==ew(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(C));let O=ew(t,["enableEnhancedCivicAnswers"]);if(null!=O&&eE(n,["enableEnhancedCivicAnswers"],O),void 0!==ew(t,["modelArmorConfig"]))throw Error("modelArmorConfig parameter is not supported in Gemini API.");return n}(e,s,ew(r,["request"],{}))),r})(e,t))),eE(r,["requests","requests"],t)}return r}(e,tm(e,i)));let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["displayName"]);if(void 0!==t&&null!=r&&eE(t,["batch","displayName"],r),void 0!==ew(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(o,r),r}!function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"}(ed||(ed={}));class tx{constructor(e,t,r,n){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,r,n)}init(e,t,r){var n,i;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};(o=r&&0!==Object.keys(r).length?"object"==typeof r?Object.assign({},r):r:{config:{}}).config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=null!==(i=null===(n=o.config)||void 0===n?void 0:n.pageSize)&&void 0!==i?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength){if(!this.hasNextPage())return{value:void 0,done:!0};await this.nextPage()}let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null===(e=this.params.config)||void 0===e?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tS extends eb{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tx(ed.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)}}createInlinedGenerateContentRequest(e){let t=tw(this.apiClient,e),r=e_("{model}:batchGenerateContent",t._url),n=t.batch.inputConfig.requests,i=n.requests,o=[];for(let e of i){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let r=t.request;r.systemInstruction=e,t.request=r}o.push(t)}return n.requests=o,delete t.config,delete t._url,delete t._query,{path:r,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let r=t?Object.assign({},t):{},n=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${n}`),void 0===r.dest){let t=this.getGcsUri(e),i=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?r.dest=`${t.slice(0,-6)}/dest`:r.dest=`${t}_dest_${n}`;else if(i)r.dest=`${i}_dest_${n}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["model"],eQ(e,n));let i=ew(t,["src"]);null!=i&&eE(r,["inputConfig"],function(e){let t={},r=ew(e,["format"]);null!=r&&eE(t,["instancesFormat"],r);let n=ew(e,["gcsUri"]);null!=n&&eE(t,["gcsSource","uris"],n);let i=ew(e,["bigqueryUri"]);if(null!=i&&eE(t,["bigquerySource","inputUri"],i),void 0!==ew(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==ew(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(tm(e,i)));let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["displayName"],r);let n=ew(e,["dest"]);void 0!==t&&null!=n&&eE(t,["outputConfig"],function(e){let t={},r=ew(e,["format"]);null!=r&&eE(t,["predictionsFormat"],r);let n=ew(e,["gcsUri"]);null!=n&&eE(t,["gcsDestination","outputUriPrefix"],n);let i=ew(e,["bigqueryUri"]);if(null!=i&&eE(t,["bigqueryDestination","outputUri"],i),void 0!==ew(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==ew(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==ew(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(n)))}(o,r),r}(this.apiClient,e);return o=e_("batchPredictionJobs",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>t_(e))}{let t=tw(this.apiClient,e);return o=e_("{model}:batchGenerateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tb(e))}}async createEmbeddingsInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["src"]);null!=i&&eE(r,["batch","inputConfig"],function(e,t){let r={},n=ew(t,["fileName"]);null!=n&&eE(r,["file_name"],n);let i=ew(t,["inlinedRequests"]);return null!=i&&eE(r,["requests"],function(e,t){let r={},n=ew(t,["contents"]);if(null!=n){let t=tt(e,n);Array.isArray(t)&&(t=t.map(e=>e)),eE(r,["requests[]","request","content"],t)}let i=ew(t,["config"]);return null!=i&&(eE(r,["_self"],function(e,t){let r=ew(e,["taskType"]);void 0!==t&&null!=r&&eE(t,["requests[]","taskType"],r);let n=ew(e,["title"]);void 0!==t&&null!=n&&eE(t,["requests[]","title"],n);let i=ew(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&eE(t,["requests[]","outputDimensionality"],i),void 0!==ew(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==ew(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(i,r)),function(e,t){for(let[r,n]of Object.entries(t)){let t=r.split("."),i=n.split("."),o=new Set,s=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){s=e;break}if(-1!==s&&i.length>s)for(let e=s;e<i.length;e++){let t=i[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||o.add(t)}(function e(t,r,n,i,o){if(i>=r.length||"object"!=typeof t||null===t)return;let s=r[i];if(s.endsWith("[]")){let a=s.slice(0,-2);if(a in t&&Array.isArray(t[a]))for(let s of t[a])e(s,r,n,i+1,o)}else if("*"===s){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!o.has(e)),r={};for(let n of e)r[n]=t[n];for(let[e,o]of Object.entries(r)){let r=[];for(let t of n.slice(i))"*"===t?r.push(e):r.push(t);eE(t,r,o)}for(let r of e)delete t[r]}}else s in t&&e(t[s],r,n,i+1,o)})(e,t,i,0,o)}}(r,{"requests[].*":"requests[].request.*"})),r}(e,i)),r}(e,i));let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["batch","displayName"],r)}(o,r),r}(this.apiClient,e);return n=e_("{model}:asyncBatchEmbedContent",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>tb(e))}}async get(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);return o=e_("batchPredictionJobs/{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>t_(e))}{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);return o=e_("batches/{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tb(e))}}async cancel(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);o=e_("batchPredictionJobs/{name}:cancel",n._url),s=n._query,delete n._url,delete n._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal})}else{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);o=e_("batches/{name}:cancel",t._url),s=t._query,delete t._url,delete t._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal})}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n);let i=ew(e,["filter"]);void 0!==t&&null!=i&&eE(t,["_query","filter"],i)}(r,t),t}(e);return o=e_("batchPredictionJobs",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["batchPredictionJobs"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>t_(e))),eE(t,["batchJobs"],e)}return t}(e),r=new eK;return Object.assign(r,t),r})}{let t=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);if(void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n),void 0!==ew(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(r,t),t}(e);return o=e_("batches",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["operations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>tb(e))),eE(t,["batchJobs"],e)}return t}(e),r=new eK;return Object.assign(r,t),r})}}async delete(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);return o=e_("batchPredictionJobs/{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);return null!=o&&eE(t,["error"],o),t})(e))}{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],ty(e,n)),r}(this.apiClient,e);return o=e_("batches/{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);return null!=o&&eE(t,["error"],o),t})(e))}}}function tT(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tA extends eb{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tx(ed.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["model"],e0(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["ttl"]);void 0!==t&&null!=r&&eE(t,["ttl"],r);let n=ew(e,["expireTime"]);void 0!==t&&null!=n&&eE(t,["expireTime"],n);let i=ew(e,["displayName"]);void 0!==t&&null!=i&&eE(t,["displayName"],i);let o=ew(e,["contents"]);if(void 0!==t&&null!=o){let e=tr(o);Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["contents"],e)}let s=ew(e,["systemInstruction"]);void 0!==t&&null!=s&&eE(t,["systemInstruction"],te(s));let a=ew(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["retrieval"]);null!=r&&eE(t,["retrieval"],r);let n=ew(e,["computerUse"]);if(null!=n&&eE(t,["computerUse"],n),void 0!==ew(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let i=ew(e,["codeExecution"]);null!=i&&eE(t,["codeExecution"],i);let o=ew(e,["enterpriseWebSearch"]);null!=o&&eE(t,["enterpriseWebSearch"],o);let s=ew(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["description"]);null!=r&&eE(t,["description"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["parameters"]);null!=i&&eE(t,["parameters"],i);let o=ew(e,["parametersJsonSchema"]);null!=o&&eE(t,["parametersJsonSchema"],o);let s=ew(e,["response"]);null!=s&&eE(t,["response"],s);let a=ew(e,["responseJsonSchema"]);if(null!=a&&eE(t,["responseJsonSchema"],a),void 0!==ew(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),eE(t,["functionDeclarations"],e)}let a=ew(e,["googleMaps"]);null!=a&&eE(t,["googleMaps"],a);let l=ew(e,["googleSearch"]);null!=l&&eE(t,["googleSearch"],l);let c=ew(e,["googleSearchRetrieval"]);null!=c&&eE(t,["googleSearchRetrieval"],c);let u=ew(e,["urlContext"]);return null!=u&&eE(t,["urlContext"],u),t})(e))),eE(t,["tools"],e)}let l=ew(e,["toolConfig"]);void 0!==t&&null!=l&&eE(t,["toolConfig"],l);let c=ew(e,["kmsKeyName"]);void 0!==t&&null!=c&&eE(t,["encryption_spec","kmsKeyName"],c)}(i,r),r}(this.apiClient,e);return o=e_("cachedContents",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["model"],e0(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["ttl"]);void 0!==t&&null!=r&&eE(t,["ttl"],r);let n=ew(e,["expireTime"]);void 0!==t&&null!=n&&eE(t,["expireTime"],n);let i=ew(e,["displayName"]);void 0!==t&&null!=i&&eE(t,["displayName"],i);let o=ew(e,["contents"]);if(void 0!==t&&null!=o){let e=tr(o);Array.isArray(e)&&(e=e.map(e=>tT(e))),eE(t,["contents"],e)}let s=ew(e,["systemInstruction"]);void 0!==t&&null!=s&&eE(t,["systemInstruction"],tT(te(s)));let a=ew(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(e))),eE(t,["tools"],e)}let l=ew(e,["toolConfig"]);if(void 0!==t&&null!=l&&eE(t,["toolConfig"],function(e){let t={},r=ew(e,["retrievalConfig"]);null!=r&&eE(t,["retrievalConfig"],r);let n=ew(e,["functionCallingConfig"]);return null!=n&&eE(t,["functionCallingConfig"],function(e){let t={},r=ew(e,["allowedFunctionNames"]);null!=r&&eE(t,["allowedFunctionNames"],r);let n=ew(e,["mode"]);if(null!=n&&eE(t,["mode"],n),void 0!==ew(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(n)),t}(l)),void 0!==ew(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(i,r),r}(this.apiClient,e);return o=e_("cachedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],tl(e,n)),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],tl(e,n)),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],tl(e,n)),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eF;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["name"]);return null!=n&&eE(r,["_url","name"],tl(e,n)),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eF;return Object.assign(r,t),r})}}async update(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["name"]);null!=n&&eE(r,["_url","name"],tl(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["ttl"]);void 0!==t&&null!=r&&eE(t,["ttl"],r);let n=ew(e,["expireTime"]);void 0!==t&&null!=n&&eE(t,["expireTime"],n)}(i,r),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let r={},n=ew(t,["name"]);null!=n&&eE(r,["_url","name"],tl(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["ttl"]);void 0!==t&&null!=r&&eE(t,["ttl"],r);let n=ew(e,["expireTime"]);void 0!==t&&null!=n&&eE(t,["expireTime"],n)}(i,r),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(r,t),t}(e);return o=e_("cachedContents",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["cachedContents"],e)}return t}(e),r=new eq;return Object.assign(r,t),r})}{let t=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(r,t),t}(e);return o=e_("cachedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["cachedContents"],e)}return t}(e),r=new eq;return Object.assign(r,t),r})}}}function tC(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function tO(e){return this instanceof tO?(this.v=e,this):new tO(e)}function tI(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),n[Symbol.asyncIterator]=function(){return this},n;function s(e,t){i[e]&&(n[e]=function(t){return new Promise(function(r,n){o.push([e,t,r,n])>1||a(e,t)})},t&&(n[e]=t(n[e])))}function a(e,t){try{var r;(r=i[e](t)).value instanceof tO?Promise.resolve(r.value.v).then(l,c):u(o[0][2],r)}catch(e){u(o[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function u(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function tN(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,i,(t=e[r](t)).done,t.value)})}}}function tk(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function tR(e){if(void 0===e||0===e.length)return[];let t=[],r=e.length,n=0;for(;n<r;)if("user"===e[n].role)t.push(e[n]),n++;else{let i=[],o=!0;for(;n<r&&"model"===e[n].role;)i.push(e[n]),o&&!tk(e[n])&&(o=!1),n++;o?t.push(...i):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class tP{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new tj(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class tj{constructor(e,t,r,n={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=r,this.config=n,this.history=i,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(i)}async sendMessage(e){var t;await this.sendPromise;let r=te(e.message),n=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:null!==(t=e.config)&&void 0!==t?t:this.config});return this.sendPromise=(async()=>{var e,t,i;let o=await n,s=null===(t=null===(e=o.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content,a=o.automaticFunctionCallingHistory,l=this.getHistory(!0).length,c=[];null!=a&&(c=null!==(i=a.slice(l))&&void 0!==i?i:[]),this.recordHistory(r,s?[s]:[],c)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),n}async sendMessageStream(e){var t;await this.sendPromise;let r=te(e.message),n=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:null!==(t=e.config)&&void 0!==t?t:this.config});this.sendPromise=n.then(()=>void 0).catch(()=>void 0);let i=await n;return this.processStreamResponse(i,r)}getHistory(e=!1){return structuredClone(e?tR(this.history):this.history)}processStreamResponse(e,t){return tI(this,arguments,function*(){let r=[];try{for(var n,i,o,s,a,l,c,u=!0,d=tN(e);!(n=(c=yield tO(d.next())).done);u=!0){if(s=c.value,u=!1,/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let r=null===(t=e.candidates[0])||void 0===t?void 0:t.content;return void 0!==r&&tk(r)}(s)){let e=null===(l=null===(a=s.candidates)||void 0===a?void 0:a[0])||void 0===l?void 0:l.content;void 0!==e&&r.push(e)}yield yield tO(s)}}catch(e){i={error:e}}finally{try{!u&&!n&&(o=d.return)&&(yield tO(o.call(d)))}finally{if(i)throw i.error}}this.recordHistory(t,r)})}recordHistory(e,t,r){let n=[];t.length>0&&t.every(e=>void 0!==e.role)?n=t:n.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...tR(r)):this.history.push(e),this.history.push(...n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tM extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,tM.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tD extends eb{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tx(ed.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(r,t),t}(e);return n=e_("files",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["files"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["files"],e)}return t}(e),r=new ez;return Object.assign(r,t),r})}}async createInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["file"]);return null!=r&&eE(t,["file"],r),t}(e);return n=e_("upload/v1beta/files",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eJ;return Object.assign(r,t),r})}}async get(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);return null!=r&&eE(t,["_url","file"],tp(r)),t}(e);return n=e_("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);return null!=r&&eE(t,["_url","file"],tp(r)),t}(e);return n=e_("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eW;return Object.assign(r,t),r})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tU(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}function tL(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}function tG(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>tL(e))),eE(r,["contents"],e)}let o=ew(t,["config"]);return null!=o&&eE(r,["generationConfig"],function(e,t,r){let n={},i=ew(t,["systemInstruction"]);void 0!==r&&null!=i&&eE(r,["systemInstruction"],tL(te(i)));let o=ew(t,["temperature"]);null!=o&&eE(n,["temperature"],o);let s=ew(t,["topP"]);null!=s&&eE(n,["topP"],s);let a=ew(t,["topK"]);null!=a&&eE(n,["topK"],a);let l=ew(t,["candidateCount"]);null!=l&&eE(n,["candidateCount"],l);let c=ew(t,["maxOutputTokens"]);null!=c&&eE(n,["maxOutputTokens"],c);let u=ew(t,["stopSequences"]);null!=u&&eE(n,["stopSequences"],u);let d=ew(t,["responseLogprobs"]);null!=d&&eE(n,["responseLogprobs"],d);let p=ew(t,["logprobs"]);null!=p&&eE(n,["logprobs"],p);let h=ew(t,["presencePenalty"]);null!=h&&eE(n,["presencePenalty"],h);let f=ew(t,["frequencyPenalty"]);null!=f&&eE(n,["frequencyPenalty"],f);let m=ew(t,["seed"]);null!=m&&eE(n,["seed"],m);let g=ew(t,["responseMimeType"]);null!=g&&eE(n,["responseMimeType"],g);let y=ew(t,["responseSchema"]);null!=y&&eE(n,["responseSchema"],tn(y));let v=ew(t,["responseJsonSchema"]);if(null!=v&&eE(n,["responseJsonSchema"],v),void 0!==ew(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==ew(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let b=ew(t,["safetySettings"]);if(void 0!==r&&null!=b){let e=b;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["category"]);if(null!=r&&eE(t,["category"],r),void 0!==ew(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let n=ew(e,["threshold"]);return null!=n&&eE(t,["threshold"],n),t})(e))),eE(r,["safetySettings"],e)}let _=ew(t,["tools"]);if(void 0!==r&&null!=_){let e=ta(_);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(ts(e)))),eE(r,["tools"],e)}let E=ew(t,["toolConfig"]);if(void 0!==r&&null!=E&&eE(r,["toolConfig"],function(e){let t={},r=ew(e,["retrievalConfig"]);null!=r&&eE(t,["retrievalConfig"],r);let n=ew(e,["functionCallingConfig"]);return null!=n&&eE(t,["functionCallingConfig"],function(e){let t={},r=ew(e,["allowedFunctionNames"]);null!=r&&eE(t,["allowedFunctionNames"],r);let n=ew(e,["mode"]);if(null!=n&&eE(t,["mode"],n),void 0!==ew(e,["streamFunctionCallArguments"]))throw Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}(n)),t}(E)),void 0!==ew(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let w=ew(t,["cachedContent"]);void 0!==r&&null!=w&&eE(r,["cachedContent"],tl(e,w));let x=ew(t,["responseModalities"]);null!=x&&eE(n,["responseModalities"],x);let S=ew(t,["mediaResolution"]);null!=S&&eE(n,["mediaResolution"],S);let T=ew(t,["speechConfig"]);if(null!=T&&eE(n,["speechConfig"],ti(T)),void 0!==ew(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let A=ew(t,["thinkingConfig"]);null!=A&&eE(n,["thinkingConfig"],A);let C=ew(t,["imageConfig"]);null!=C&&eE(n,["imageConfig"],function(e){let t={},r=ew(e,["aspectRatio"]);null!=r&&eE(t,["aspectRatio"],r);let n=ew(e,["imageSize"]);if(null!=n&&eE(t,["imageSize"],n),void 0!==ew(e,["personGeneration"]))throw Error("personGeneration parameter is not supported in Gemini API.");if(void 0!==ew(e,["outputMimeType"]))throw Error("outputMimeType parameter is not supported in Gemini API.");if(void 0!==ew(e,["outputCompressionQuality"]))throw Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}(C));let O=ew(t,["enableEnhancedCivicAnswers"]);if(null!=O&&eE(n,["enableEnhancedCivicAnswers"],O),void 0!==ew(t,["modelArmorConfig"]))throw Error("modelArmorConfig parameter is not supported in Gemini API.");return n}(e,o,r)),r}function tF(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>e)),eE(r,["contents"],e)}let o=ew(t,["config"]);return null!=o&&eE(r,["generationConfig"],function(e,t,r){let n={},i=ew(t,["systemInstruction"]);void 0!==r&&null!=i&&eE(r,["systemInstruction"],te(i));let o=ew(t,["temperature"]);null!=o&&eE(n,["temperature"],o);let s=ew(t,["topP"]);null!=s&&eE(n,["topP"],s);let a=ew(t,["topK"]);null!=a&&eE(n,["topK"],a);let l=ew(t,["candidateCount"]);null!=l&&eE(n,["candidateCount"],l);let c=ew(t,["maxOutputTokens"]);null!=c&&eE(n,["maxOutputTokens"],c);let u=ew(t,["stopSequences"]);null!=u&&eE(n,["stopSequences"],u);let d=ew(t,["responseLogprobs"]);null!=d&&eE(n,["responseLogprobs"],d);let p=ew(t,["logprobs"]);null!=p&&eE(n,["logprobs"],p);let h=ew(t,["presencePenalty"]);null!=h&&eE(n,["presencePenalty"],h);let f=ew(t,["frequencyPenalty"]);null!=f&&eE(n,["frequencyPenalty"],f);let m=ew(t,["seed"]);null!=m&&eE(n,["seed"],m);let g=ew(t,["responseMimeType"]);null!=g&&eE(n,["responseMimeType"],g);let y=ew(t,["responseSchema"]);null!=y&&eE(n,["responseSchema"],tn(y));let v=ew(t,["responseJsonSchema"]);null!=v&&eE(n,["responseJsonSchema"],v);let b=ew(t,["routingConfig"]);null!=b&&eE(n,["routingConfig"],b);let _=ew(t,["modelSelectionConfig"]);null!=_&&eE(n,["modelConfig"],_);let E=ew(t,["safetySettings"]);if(void 0!==r&&null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>e)),eE(r,["safetySettings"],e)}let w=ew(t,["tools"]);if(void 0!==r&&null!=w){let e=ta(w);Array.isArray(e)&&(e=e.map(e=>tX(ts(e)))),eE(r,["tools"],e)}let x=ew(t,["toolConfig"]);void 0!==r&&null!=x&&eE(r,["toolConfig"],x);let S=ew(t,["labels"]);void 0!==r&&null!=S&&eE(r,["labels"],S);let T=ew(t,["cachedContent"]);void 0!==r&&null!=T&&eE(r,["cachedContent"],tl(e,T));let A=ew(t,["responseModalities"]);null!=A&&eE(n,["responseModalities"],A);let C=ew(t,["mediaResolution"]);null!=C&&eE(n,["mediaResolution"],C);let O=ew(t,["speechConfig"]);null!=O&&eE(n,["speechConfig"],ti(O));let I=ew(t,["audioTimestamp"]);null!=I&&eE(n,["audioTimestamp"],I);let N=ew(t,["thinkingConfig"]);null!=N&&eE(n,["thinkingConfig"],N);let k=ew(t,["imageConfig"]);if(null!=k&&eE(n,["imageConfig"],function(e){let t={},r=ew(e,["aspectRatio"]);null!=r&&eE(t,["aspectRatio"],r);let n=ew(e,["imageSize"]);null!=n&&eE(t,["imageSize"],n);let i=ew(e,["personGeneration"]);null!=i&&eE(t,["personGeneration"],i);let o=ew(e,["outputMimeType"]);null!=o&&eE(t,["imageOutputOptions","mimeType"],o);let s=ew(e,["outputCompressionQuality"]);return null!=s&&eE(t,["imageOutputOptions","compressionQuality"],s),t}(k)),void 0!==ew(t,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");let R=ew(t,["modelArmorConfig"]);return void 0!==r&&null!=R&&eE(r,["modelArmorConfig"],R),n}(e,o,r)),r}function tq(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["candidates"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["content"]);null!=r&&eE(t,["content"],r);let n=ew(e,["citationMetadata"]);null!=n&&eE(t,["citationMetadata"],function(e){let t={},r=ew(e,["citationSources"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["citations"],e)}return t}(n));let i=ew(e,["tokenCount"]);null!=i&&eE(t,["tokenCount"],i);let o=ew(e,["finishReason"]);null!=o&&eE(t,["finishReason"],o);let s=ew(e,["avgLogprobs"]);null!=s&&eE(t,["avgLogprobs"],s);let a=ew(e,["groundingMetadata"]);null!=a&&eE(t,["groundingMetadata"],a);let l=ew(e,["index"]);null!=l&&eE(t,["index"],l);let c=ew(e,["logprobsResult"]);null!=c&&eE(t,["logprobsResult"],c);let u=ew(e,["safetyRatings"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["safetyRatings"],e)}let d=ew(e,["urlContextMetadata"]);return null!=d&&eE(t,["urlContextMetadata"],d),t})(e))),eE(t,["candidates"],e)}let i=ew(e,["modelVersion"]);null!=i&&eE(t,["modelVersion"],i);let o=ew(e,["promptFeedback"]);null!=o&&eE(t,["promptFeedback"],o);let s=ew(e,["responseId"]);null!=s&&eE(t,["responseId"],s);let a=ew(e,["usageMetadata"]);return null!=a&&eE(t,["usageMetadata"],a),t}function tB(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["candidates"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["candidates"],e)}let i=ew(e,["createTime"]);null!=i&&eE(t,["createTime"],i);let o=ew(e,["modelVersion"]);null!=o&&eE(t,["modelVersion"],o);let s=ew(e,["promptFeedback"]);null!=s&&eE(t,["promptFeedback"],s);let a=ew(e,["responseId"]);null!=a&&eE(t,["responseId"],a);let l=ew(e,["usageMetadata"]);return null!=l&&eE(t,["usageMetadata"],l),t}function tH(e){let t={},r=ew(e,["_self"]);null!=r&&eE(t,["image"],tV(r));let n=ew(e,["raiFilteredReason"]);null!=n&&eE(t,["raiFilteredReason"],n);let i=ew(e,["_self"]);null!=i&&eE(t,["safetyAttributes"],tY(i));let o=ew(e,["prompt"]);return null!=o&&eE(t,["enhancedPrompt"],o),t}function tV(e){let t={},r=ew(e,["gcsUri"]);null!=r&&eE(t,["gcsUri"],r);let n=ew(e,["bytesBase64Encoded"]);null!=n&&eE(t,["imageBytes"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}function t$(e){let t={};if(void 0!==ew(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let r=ew(e,["imageBytes"]);null!=r&&eE(t,["bytesBase64Encoded"],ex(r));let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}function tz(e){let t={},r=ew(e,["gcsUri"]);null!=r&&eE(t,["gcsUri"],r);let n=ew(e,["imageBytes"]);null!=n&&eE(t,["bytesBase64Encoded"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}function tJ(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["displayName"]);null!=n&&eE(t,["displayName"],n);let i=ew(e,["description"]);null!=i&&eE(t,["description"],i);let o=ew(e,["version"]);null!=o&&eE(t,["version"],o);let s=ew(e,["_self"]);null!=s&&eE(t,["tunedModelInfo"],function(e){let t={},r=ew(e,["baseModel"]);null!=r&&eE(t,["baseModel"],r);let n=ew(e,["createTime"]);null!=n&&eE(t,["createTime"],n);let i=ew(e,["updateTime"]);return null!=i&&eE(t,["updateTime"],i),t}(s));let a=ew(e,["inputTokenLimit"]);null!=a&&eE(t,["inputTokenLimit"],a);let l=ew(e,["outputTokenLimit"]);null!=l&&eE(t,["outputTokenLimit"],l);let c=ew(e,["supportedGenerationMethods"]);null!=c&&eE(t,["supportedActions"],c);let u=ew(e,["temperature"]);null!=u&&eE(t,["temperature"],u);let d=ew(e,["maxTemperature"]);null!=d&&eE(t,["maxTemperature"],d);let p=ew(e,["topP"]);null!=p&&eE(t,["topP"],p);let h=ew(e,["topK"]);null!=h&&eE(t,["topK"],h);let f=ew(e,["thinking"]);return null!=f&&eE(t,["thinking"],f),t}function tW(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["displayName"]);null!=n&&eE(t,["displayName"],n);let i=ew(e,["description"]);null!=i&&eE(t,["description"],i);let o=ew(e,["versionId"]);null!=o&&eE(t,["version"],o);let s=ew(e,["deployedModels"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["endpoint"]);null!=r&&eE(t,["name"],r);let n=ew(e,["deployedModelId"]);return null!=n&&eE(t,["deployedModelId"],n),t})(e))),eE(t,["endpoints"],e)}let a=ew(e,["labels"]);null!=a&&eE(t,["labels"],a);let l=ew(e,["_self"]);null!=l&&eE(t,["tunedModelInfo"],function(e){let t={},r=ew(e,["labels","google-vertex-llm-tuning-base-model-id"]);null!=r&&eE(t,["baseModel"],r);let n=ew(e,["createTime"]);null!=n&&eE(t,["createTime"],n);let i=ew(e,["updateTime"]);return null!=i&&eE(t,["updateTime"],i),t}(l));let c=ew(e,["defaultCheckpointId"]);null!=c&&eE(t,["defaultCheckpointId"],c);let u=ew(e,["checkpoints"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["checkpoints"],e)}return t}function tK(e){let t={},r=ew(e,["safetyAttributes","categories"]);null!=r&&eE(t,["categories"],r);let n=ew(e,["safetyAttributes","scores"]);null!=n&&eE(t,["scores"],n);let i=ew(e,["contentType"]);return null!=i&&eE(t,["contentType"],i),t}function tY(e){let t={},r=ew(e,["safetyAttributes","categories"]);null!=r&&eE(t,["categories"],r);let n=ew(e,["safetyAttributes","scores"]);null!=n&&eE(t,["scores"],n);let i=ew(e,["contentType"]);return null!=i&&eE(t,["contentType"],i),t}function tX(e){let t={},r=ew(e,["retrieval"]);null!=r&&eE(t,["retrieval"],r);let n=ew(e,["computerUse"]);if(null!=n&&eE(t,["computerUse"],n),void 0!==ew(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let i=ew(e,["codeExecution"]);null!=i&&eE(t,["codeExecution"],i);let o=ew(e,["enterpriseWebSearch"]);null!=o&&eE(t,["enterpriseWebSearch"],o);let s=ew(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["description"]);null!=r&&eE(t,["description"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["parameters"]);null!=i&&eE(t,["parameters"],i);let o=ew(e,["parametersJsonSchema"]);null!=o&&eE(t,["parametersJsonSchema"],o);let s=ew(e,["response"]);null!=s&&eE(t,["response"],s);let a=ew(e,["responseJsonSchema"]);if(null!=a&&eE(t,["responseJsonSchema"],a),void 0!==ew(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),eE(t,["functionDeclarations"],e)}let a=ew(e,["googleMaps"]);null!=a&&eE(t,["googleMaps"],a);let l=ew(e,["googleSearch"]);null!=l&&eE(t,["googleSearch"],l);let c=ew(e,["googleSearchRetrieval"]);null!=c&&eE(t,["googleSearchRetrieval"],c);let u=ew(e,["urlContext"]);return null!=u&&eE(t,["urlContext"],u),t}function tZ(e){let t={},r=ew(e,["uri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["videoBytes"]);null!=n&&eE(t,["encodedVideo"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["encoding"],i),t}function tQ(e){let t={},r=ew(e,["uri"]);null!=r&&eE(t,["gcsUri"],r);let n=ew(e,["videoBytes"]);null!=n&&eE(t,["bytesBase64Encoded"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}function t0(e,t){let r=ew(e,["mimeType"]);void 0!==t&&null!=r&&eE(t,["mimeType"],r);let n=ew(e,["displayName"]);void 0!==t&&null!=n&&eE(t,["displayName"],n);let i=ew(e,["customMetadata"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["customMetadata"],e)}let o=ew(e,["chunkingConfig"]);return void 0!==t&&null!=o&&eE(t,["chunkingConfig"],o),{}}let t1="x-goog-api-client";class t2{constructor(e){var t,r,n;this.clientOptions=Object.assign({},e),this.customBaseUrl=null===(t=e.httpOptions)||void 0===t?void 0:t.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));let i={};if(this.clientOptions.vertexai){if(this.clientOptions.location||this.clientOptions.apiKey||this.customBaseUrl||(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");let t=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!t?(i.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||"global"===this.clientOptions.location?i.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(i.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),i.apiVersion=null!==(r=this.clientOptions.apiVersion)&&void 0!==r?r:"v1beta1"}else{if(!this.clientOptions.apiKey)throw new tM({message:"API key must be set when using the Gemini API.",status:403});i.apiVersion=null!==(n=this.clientOptions.apiVersion)&&void 0!==n?n:"v1beta",i.baseUrl="https://generativelanguage.googleapis.com/"}i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}isVertexAI(){var e;return null!==(e=this.clientOptions.vertexai)&&void 0!==e&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){let e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,r){let n=[this.getRequestUrlInternal(t)];return r&&n.push(this.getBaseResourcePath()),""!==e&&n.push(e),new URL(`${n.join("/")}`)}shouldPrependVertexProjectPath(e,t){return!(t.baseUrl&&t.baseUrlResourceScope===D.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e,t),n=this.constructUrl(e.path,t,r);if(e.queryParams)for(let[t,r]of Object.entries(e.queryParams))n.searchParams.append(t,String(r));let i={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,n.toString(),e.abortSignal),this.unaryApiCall(n,i,e.httpMethod)}patchHttpOptions(e,t){let r=JSON.parse(JSON.stringify(e));for(let[e,n]of Object.entries(t))"object"==typeof n?r[e]=Object.assign(Object.assign({},r[e]),n):void 0!==n&&(r[e]=n);return r}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e,t),n=this.constructUrl(e.path,t,r);n.searchParams.has("alt")&&"sse"===n.searchParams.get("alt")||n.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,n.toString(),e.abortSignal),this.streamApiCall(n,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,r,n){if(t&&t.timeout||n){let r=new AbortController,i=r.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>r.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}n&&n.addEventListener("abort",()=>{r.abort()}),e.signal=i}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let r={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t)){console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}r=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}let n=function e(t,r){let n=Object.assign({},t);for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)){let i=r[t],o=n[t];i&&"object"==typeof i&&!Array.isArray(i)&&o&&"object"==typeof o&&!Array.isArray(o)?n[t]=e(o,i):(o&&i&&typeof o!=typeof i&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof o}, New type: ${typeof i}. Overwriting.`),n[t]=i)}return n}(r,t);e.body=JSON.stringify(n)}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,r),e}async unaryApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async e=>(await t4(e),new eT(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async e=>(await t4(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){return tI(this,arguments,function*(){var t;let r=null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.getReader(),n=new TextDecoder("utf-8");if(!r)throw Error("Response body is empty");try{let t="",i="data:",o=["\n\n","\r\r","\r\n\r\n"];for(;;){let{done:s,value:a}=yield tO(r.read());if(s){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let l=n.decode(a,{stream:!0});try{let e=JSON.parse(l);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),r=t.status,n=t.code,i=`got status: ${r}. ${JSON.stringify(e)}`;if(n>=400&&n<600)throw new tM({message:i,status:n})}}catch(e){if("ApiError"===e.name)throw e}t+=l;let c=-1,u=0;for(;;){for(let e of(c=-1,u=0,o)){let r=t.indexOf(e);-1!==r&&(-1===c||r<c)&&(c=r,u=e.length)}if(-1===c)break;let r=t.substring(0,c);t=t.substring(c+u);let n=r.trim();if(n.startsWith(i)){let t=n.substring(i.length).trim();try{let r=new Response(t,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield tO(new eT(r))}catch(e){throw Error(`exception parsing stream chunk ${t}. ${e}`)}}}}}finally{r.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.38.0 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[t1]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let r=new Headers;if(e&&e.headers){for(let[t,n]of Object.entries(e.headers))r.append(t,n);e.timeout&&e.timeout>0&&r.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,t),r}getFileName(e){var t;let r="";return"string"==typeof e&&(r=null!==(t=(r=e.replace(/[/\\]+$/,"")).split(/[/\\]/).pop())&&void 0!==t?t:""),r}async uploadFile(e,t){var r;let n={};null!=t&&(n.mimeType=t.mimeType,n.name=t.name,n.displayName=t.displayName),n.name&&!n.name.startsWith("files/")&&(n.name=`files/${n.name}`);let i=this.clientOptions.uploader,o=await i.stat(e);n.sizeBytes=String(o.size);let s=null!==(r=null==t?void 0:t.mimeType)&&void 0!==r?r:o.type;if(void 0===s||""===s)throw Error("Can not determine mimeType. Please provide mimeType in the config.");n.mimeType=s;let a={file:n},l=this.getFileName(e),c=e_("upload/v1beta/files",a._url),u=await this.fetchUploadUrl(c,n.sizeBytes,n.mimeType,l,a,null==t?void 0:t.httpOptions);return i.upload(e,u,this)}async uploadFileToFileSearchStore(e,t,r){var n;let i=this.clientOptions.uploader,o=await i.stat(t),s=String(o.size),a=null!==(n=null==r?void 0:r.mimeType)&&void 0!==n?n:o.type;if(void 0===a||""===a)throw Error("Can not determine mimeType. Please provide mimeType in the config.");let l=`upload/v1beta/${e}:uploadToFileSearchStore`,c=this.getFileName(t),u={};null!=r&&t0(r,u);let d=await this.fetchUploadUrl(l,s,a,c,u,null==r?void 0:r.httpOptions);return i.uploadToFileSearchStore(t,d,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t,r,n,i,o){var s;let a={};a=o||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${r}`},n?{"X-Goog-Upload-File-Name":n}:{})};let l=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:a});if(!l||!(null==l?void 0:l.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let c=null===(s=null==l?void 0:l.headers)||void 0===s?void 0:s["x-goog-upload-url"];if(void 0===c)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function t4(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let r=e.status,n=JSON.stringify((null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(r>=400&&r<600)throw new tM({message:n,status:r});throw Error(n)}}function t5(e){for(let t of e){if(null!==t&&"object"==typeof t&&t instanceof t6||"object"==typeof t&&"inputSchema"in t)return!0}return!1}function t3(e){var t;let r=null!==(t=e[t1])&&void 0!==t?t:"";e[t1]=(r+" mcp_used/unknown").trimStart()}class t6{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new t6(e,t)}async initialize(){var e,t,r,n;if(this.mcpTools.length>0)return;let i={},o=[];for(let c of this.mcpClients)try{for(var s,a=!0,l=(t=void 0,tN(function(e){return tI(this,arguments,function*(e,t=100){let r;let n=0;for(;n<t;){let t=yield tO(e.listTools({cursor:r}));for(let e of t.tools)yield yield tO(e),n++;if(!t.nextCursor)break;r=t.nextCursor}})}(c)));!(e=(s=await l.next()).done);a=!0){n=s.value,a=!1,o.push(n);let e=n.name;if(i[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i[e]=c}}catch(e){t={error:e}}finally{try{!a&&!e&&(r=l.return)&&await r.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),function(e,t={}){let r=[],n=new Set;for(let i of e){let e=i.name;if(n.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);n.add(e);let o=function(e,t={}){let r={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(r.responseJsonSchema=e.outputSchema),t.behavior&&(r.behavior=t.behavior),{functionDeclarations:[r]}}(i,t);o.functionDeclarations&&r.push(...o.functionDeclarations)}return{functionDeclarations:r}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let r of e)if(r.name in this.functionNameToMcpClient){let e;let n=this.functionNameToMcpClient[r.name];this.config.timeout&&(e={timeout:this.config.timeout});let i=await n.callTool({name:r.name,arguments:r.args},void 0,e);t.push({functionResponse:{name:r.name,response:i.isError?{error:i}:i}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function t8(e,t,r){let n;let i=new eX;r.data instanceof Blob?n=JSON.parse(await r.data.text()):n=JSON.parse(r.data),Object.assign(i,n),t(i)}class t7{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r}async connect(e){var t,r;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let n=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),o=function(e){let t=new Headers;for(let[r,n]of Object.entries(e))t.append(r,n);return t}(this.apiClient.getDefaultHeaders()),s=this.apiClient.getApiKey(),a=`${n}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${s}`,l=()=>{},c=new Promise(e=>{l=e}),u=e.callbacks,d=this.apiClient,p={onopen:function(){l({})},onmessage:e=>{t8(d,u.onmessage,e)},onerror:null!==(t=null==u?void 0:u.onerror)&&void 0!==t?t:function(e){},onclose:null!==(r=null==u?void 0:u.onclose)&&void 0!==r?r:function(e){}},h=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,r)=>{t[r]=e}),t}(o),p);h.connect(),await c;let f=eQ(this.apiClient,e.model);return h.send(JSON.stringify({setup:{model:f}})),new t9(h,this.apiClient)}}class t9{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},r=ew(e,["weightedPrompts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=function(e){let t={},r=ew(e,["musicGenerationConfig"]);return null!=r&&eE(t,["musicGenerationConfig"],r),t}(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(eu.PLAY)}pause(){this.sendPlaybackControl(eu.PAUSE)}stop(){this.sendPlaybackControl(eu.STOP)}resetContext(){this.sendPlaybackControl(eu.RESET_CONTEXT)}close(){this.conn.close()}}async function re(e,t,r){let n;let i=new eY;r.data instanceof Blob?n=await r.data.text():n=r.data instanceof ArrayBuffer?new TextDecoder().decode(r.data):r.data;let o=JSON.parse(n);e.isVertexAI()?Object.assign(i,function(e){let t={},r=ew(e,["setupComplete"]);null!=r&&eE(t,["setupComplete"],r);let n=ew(e,["serverContent"]);null!=n&&eE(t,["serverContent"],n);let i=ew(e,["toolCall"]);null!=i&&eE(t,["toolCall"],i);let o=ew(e,["toolCallCancellation"]);null!=o&&eE(t,["toolCallCancellation"],o);let s=ew(e,["usageMetadata"]);null!=s&&eE(t,["usageMetadata"],function(e){let t={},r=ew(e,["promptTokenCount"]);null!=r&&eE(t,["promptTokenCount"],r);let n=ew(e,["cachedContentTokenCount"]);null!=n&&eE(t,["cachedContentTokenCount"],n);let i=ew(e,["candidatesTokenCount"]);null!=i&&eE(t,["responseTokenCount"],i);let o=ew(e,["toolUsePromptTokenCount"]);null!=o&&eE(t,["toolUsePromptTokenCount"],o);let s=ew(e,["thoughtsTokenCount"]);null!=s&&eE(t,["thoughtsTokenCount"],s);let a=ew(e,["totalTokenCount"]);null!=a&&eE(t,["totalTokenCount"],a);let l=ew(e,["promptTokensDetails"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["promptTokensDetails"],e)}let c=ew(e,["cacheTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["cacheTokensDetails"],e)}let u=ew(e,["candidatesTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["responseTokensDetails"],e)}let d=ew(e,["toolUsePromptTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["toolUsePromptTokensDetails"],e)}let p=ew(e,["trafficType"]);return null!=p&&eE(t,["trafficType"],p),t}(s));let a=ew(e,["goAway"]);null!=a&&eE(t,["goAway"],a);let l=ew(e,["sessionResumptionUpdate"]);null!=l&&eE(t,["sessionResumptionUpdate"],l);let c=ew(e,["voiceActivityDetectionSignal"]);null!=c&&eE(t,["voiceActivityDetectionSignal"],c);let u=ew(e,["voiceActivity"]);return null!=u&&eE(t,["voiceActivity"],function(e){let t={},r=ew(e,["type"]);return null!=r&&eE(t,["voiceActivityType"],r),t}(u)),t}(o)):Object.assign(i,o),t(i)}class rt{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r,this.music=new t7(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,r,n,i,o,s;let a;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),u=this.apiClient.getHeaders();e.config&&e.config.tools&&t5(e.config.tools)&&t3(u);let d=function(e){let t=new Headers;for(let[r,n]of Object.entries(e))t.append(r,n);return t}(u);if(this.apiClient.isVertexAI()){let e=this.apiClient.getProject(),t=this.apiClient.getLocation(),r=this.apiClient.getApiKey();this.apiClient.getCustomBaseUrl()&&!(e&&t||r)?a=l:(a=`${l}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(d,a))}else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",r="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==c&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",r="access_token"),a=`${l}/ws/google.ai.generativelanguage.${c}.GenerativeService.${t}?${r}=${e}`}let p=()=>{},h=new Promise(e=>{p=e}),f=e.callbacks,m=this.apiClient,g={onopen:function(){var e;null===(e=null==f?void 0:f.onopen)||void 0===e||e.call(f),p({})},onmessage:e=>{re(m,f.onmessage,e)},onerror:null!==(t=null==f?void 0:f.onerror)&&void 0!==t?t:function(e){},onclose:null!==(r=null==f?void 0:f.onclose)&&void 0!==r?r:function(e){}},y=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,r)=>{t[r]=e}),t}(d),g);y.connect(),await h;let v=eQ(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&v.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();e&&t&&(v=`projects/${e}/locations/${t}/`+v)}let b={};this.apiClient.isVertexAI()&&(null===(n=e.config)||void 0===n?void 0:n.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[I.AUDIO]}:e.config.responseModalities=[I.AUDIO]),(null===(i=e.config)||void 0===i?void 0:i.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let _=null!==(s=null===(o=e.config)||void 0===o?void 0:o.tools)&&void 0!==s?s:[],E=[];for(let e of _)this.isCallableTool(e)?E.push(await e.tool()):E.push(e);E.length>0&&(e.config.tools=E);let w={model:v,config:e.config,callbacks:e.callbacks};return b=this.apiClient.isVertexAI()?function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["setup","model"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&eE(r,["config"],function(e,t){let r=ew(e,["generationConfig"]);void 0!==t&&null!=r&&eE(t,["setup","generationConfig"],function(e){let t={},r=ew(e,["modelSelectionConfig"]);null!=r&&eE(t,["modelConfig"],r);let n=ew(e,["responseJsonSchema"]);null!=n&&eE(t,["responseJsonSchema"],n);let i=ew(e,["audioTimestamp"]);null!=i&&eE(t,["audioTimestamp"],i);let o=ew(e,["candidateCount"]);null!=o&&eE(t,["candidateCount"],o);let s=ew(e,["enableAffectiveDialog"]);null!=s&&eE(t,["enableAffectiveDialog"],s);let a=ew(e,["frequencyPenalty"]);null!=a&&eE(t,["frequencyPenalty"],a);let l=ew(e,["logprobs"]);null!=l&&eE(t,["logprobs"],l);let c=ew(e,["maxOutputTokens"]);null!=c&&eE(t,["maxOutputTokens"],c);let u=ew(e,["mediaResolution"]);null!=u&&eE(t,["mediaResolution"],u);let d=ew(e,["presencePenalty"]);null!=d&&eE(t,["presencePenalty"],d);let p=ew(e,["responseLogprobs"]);null!=p&&eE(t,["responseLogprobs"],p);let h=ew(e,["responseMimeType"]);null!=h&&eE(t,["responseMimeType"],h);let f=ew(e,["responseModalities"]);null!=f&&eE(t,["responseModalities"],f);let m=ew(e,["responseSchema"]);null!=m&&eE(t,["responseSchema"],m);let g=ew(e,["routingConfig"]);null!=g&&eE(t,["routingConfig"],g);let y=ew(e,["seed"]);null!=y&&eE(t,["seed"],y);let v=ew(e,["speechConfig"]);null!=v&&eE(t,["speechConfig"],v);let b=ew(e,["stopSequences"]);null!=b&&eE(t,["stopSequences"],b);let _=ew(e,["temperature"]);null!=_&&eE(t,["temperature"],_);let E=ew(e,["thinkingConfig"]);null!=E&&eE(t,["thinkingConfig"],E);let w=ew(e,["topK"]);null!=w&&eE(t,["topK"],w);let x=ew(e,["topP"]);if(null!=x&&eE(t,["topP"],x),void 0!==ew(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(r));let n=ew(e,["responseModalities"]);void 0!==t&&null!=n&&eE(t,["setup","generationConfig","responseModalities"],n);let i=ew(e,["temperature"]);void 0!==t&&null!=i&&eE(t,["setup","generationConfig","temperature"],i);let o=ew(e,["topP"]);void 0!==t&&null!=o&&eE(t,["setup","generationConfig","topP"],o);let s=ew(e,["topK"]);void 0!==t&&null!=s&&eE(t,["setup","generationConfig","topK"],s);let a=ew(e,["maxOutputTokens"]);void 0!==t&&null!=a&&eE(t,["setup","generationConfig","maxOutputTokens"],a);let l=ew(e,["mediaResolution"]);void 0!==t&&null!=l&&eE(t,["setup","generationConfig","mediaResolution"],l);let c=ew(e,["seed"]);void 0!==t&&null!=c&&eE(t,["setup","generationConfig","seed"],c);let u=ew(e,["speechConfig"]);void 0!==t&&null!=u&&eE(t,["setup","generationConfig","speechConfig"],to(u));let d=ew(e,["thinkingConfig"]);void 0!==t&&null!=d&&eE(t,["setup","generationConfig","thinkingConfig"],d);let p=ew(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&eE(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=ew(e,["systemInstruction"]);void 0!==t&&null!=h&&eE(t,["setup","systemInstruction"],te(h));let f=ew(e,["tools"]);if(void 0!==t&&null!=f){let e=ta(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["retrieval"]);null!=r&&eE(t,["retrieval"],r);let n=ew(e,["computerUse"]);if(null!=n&&eE(t,["computerUse"],n),void 0!==ew(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let i=ew(e,["codeExecution"]);null!=i&&eE(t,["codeExecution"],i);let o=ew(e,["enterpriseWebSearch"]);null!=o&&eE(t,["enterpriseWebSearch"],o);let s=ew(e,["functionDeclarations"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["description"]);null!=r&&eE(t,["description"],r);let n=ew(e,["name"]);null!=n&&eE(t,["name"],n);let i=ew(e,["parameters"]);null!=i&&eE(t,["parameters"],i);let o=ew(e,["parametersJsonSchema"]);null!=o&&eE(t,["parametersJsonSchema"],o);let s=ew(e,["response"]);null!=s&&eE(t,["response"],s);let a=ew(e,["responseJsonSchema"]);if(null!=a&&eE(t,["responseJsonSchema"],a),void 0!==ew(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");return t})(e))),eE(t,["functionDeclarations"],e)}let a=ew(e,["googleMaps"]);null!=a&&eE(t,["googleMaps"],a);let l=ew(e,["googleSearch"]);null!=l&&eE(t,["googleSearch"],l);let c=ew(e,["googleSearchRetrieval"]);null!=c&&eE(t,["googleSearchRetrieval"],c);let u=ew(e,["urlContext"]);return null!=u&&eE(t,["urlContext"],u),t})(ts(e)))),eE(t,["setup","tools"],e)}let m=ew(e,["sessionResumption"]);void 0!==t&&null!=m&&eE(t,["setup","sessionResumption"],m);let g=ew(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&eE(t,["setup","inputAudioTranscription"],g);let y=ew(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&eE(t,["setup","outputAudioTranscription"],y);let v=ew(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&eE(t,["setup","realtimeInputConfig"],v);let b=ew(e,["contextWindowCompression"]);void 0!==t&&null!=b&&eE(t,["setup","contextWindowCompression"],b);let _=ew(e,["proactivity"]);void 0!==t&&null!=_&&eE(t,["setup","proactivity"],_);let E=ew(e,["explicitVadSignal"]);return void 0!==t&&null!=E&&eE(t,["setup","explicitVadSignal"],E),{}}(i,r)),r}(this.apiClient,w):function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["setup","model"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&eE(r,["config"],function(e,t){let r=ew(e,["generationConfig"]);void 0!==t&&null!=r&&eE(t,["setup","generationConfig"],r);let n=ew(e,["responseModalities"]);void 0!==t&&null!=n&&eE(t,["setup","generationConfig","responseModalities"],n);let i=ew(e,["temperature"]);void 0!==t&&null!=i&&eE(t,["setup","generationConfig","temperature"],i);let o=ew(e,["topP"]);void 0!==t&&null!=o&&eE(t,["setup","generationConfig","topP"],o);let s=ew(e,["topK"]);void 0!==t&&null!=s&&eE(t,["setup","generationConfig","topK"],s);let a=ew(e,["maxOutputTokens"]);void 0!==t&&null!=a&&eE(t,["setup","generationConfig","maxOutputTokens"],a);let l=ew(e,["mediaResolution"]);void 0!==t&&null!=l&&eE(t,["setup","generationConfig","mediaResolution"],l);let c=ew(e,["seed"]);void 0!==t&&null!=c&&eE(t,["setup","generationConfig","seed"],c);let u=ew(e,["speechConfig"]);void 0!==t&&null!=u&&eE(t,["setup","generationConfig","speechConfig"],to(u));let d=ew(e,["thinkingConfig"]);void 0!==t&&null!=d&&eE(t,["setup","generationConfig","thinkingConfig"],d);let p=ew(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&eE(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=ew(e,["systemInstruction"]);void 0!==t&&null!=h&&eE(t,["setup","systemInstruction"],function(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],tU(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}(te(h)));let f=ew(e,["tools"]);if(void 0!==t&&null!=f){let e=ta(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(ts(e)))),eE(t,["setup","tools"],e)}let m=ew(e,["sessionResumption"]);void 0!==t&&null!=m&&eE(t,["setup","sessionResumption"],function(e){let t={},r=ew(e,["handle"]);if(null!=r&&eE(t,["handle"],r),void 0!==ew(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=ew(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&eE(t,["setup","inputAudioTranscription"],g);let y=ew(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&eE(t,["setup","outputAudioTranscription"],y);let v=ew(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&eE(t,["setup","realtimeInputConfig"],v);let b=ew(e,["contextWindowCompression"]);void 0!==t&&null!=b&&eE(t,["setup","contextWindowCompression"],b);let _=ew(e,["proactivity"]);if(void 0!==t&&null!=_&&eE(t,["setup","proactivity"],_),void 0!==ew(e,["explicitVadSignal"]))throw Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}(i,r)),r}(this.apiClient,w),delete b.config,y.send(JSON.stringify(b)),new rn(y,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let rr={turnComplete:!0};class rn{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let r=[];try{r=tr(t.turns),e.isVertexAI()||(r=r.map(e=>tL(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:r,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let r=[];if(null==t.functionResponses||0===(r=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of r){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},rr),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},r=ew(e,["media"]);if(null!=r){let e=e1(r);Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["mediaChunks"],e)}let n=ew(e,["audio"]);null!=n&&eE(t,["audio"],e5(n));let i=ew(e,["audioStreamEnd"]);null!=i&&eE(t,["audioStreamEnd"],i);let o=ew(e,["video"]);null!=o&&eE(t,["video"],e4(o));let s=ew(e,["text"]);null!=s&&eE(t,["text"],s);let a=ew(e,["activityStart"]);null!=a&&eE(t,["activityStart"],a);let l=ew(e,["activityEnd"]);return null!=l&&eE(t,["activityEnd"],l),t}(e)}:{realtimeInput:function(e){let t={},r=ew(e,["media"]);if(null!=r){let e=e1(r);Array.isArray(e)&&(e=e.map(e=>tU(e))),eE(t,["mediaChunks"],e)}let n=ew(e,["audio"]);null!=n&&eE(t,["audio"],tU(e5(n)));let i=ew(e,["audioStreamEnd"]);null!=i&&eE(t,["audioStreamEnd"],i);let o=ew(e,["video"]);null!=o&&eE(t,["video"],tU(e4(o)));let s=ew(e,["text"]);null!=s&&eE(t,["text"],s);let a=ew(e,["activityStart"]);null!=a&&eE(t,["activityStart"],a);let l=ew(e,["activityEnd"]);return null!=l&&eE(t,["activityEnd"],l),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function ri(e){var t,r,n;if(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.disable)return!0;let i=!1;for(let t of null!==(r=null==e?void 0:e.tools)&&void 0!==r?r:[])if(ro(t)){i=!0;break}if(!i)return!0;let o=null===(n=null==e?void 0:e.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls;return(!!o&&(o<0||!Number.isInteger(o))||0==o)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0)}function ro(e){return"callTool"in e&&"function"==typeof e.callTool}function rs(e){var t;let r=[];return(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.tools)&&e.config.tools.forEach((e,t)=>{!ro(e)&&e.functionDeclarations&&e.functionDeclarations.length>0&&r.push(t)}),r}function ra(e){var t;return!(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rl extends eb{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,r,n,i,o;let s,a;let l=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!function(e){var t,r,n;return null!==(n=null===(r=null===(t=e.config)||void 0===t?void 0:t.tools)||void 0===r?void 0:r.some(e=>ro(e)))&&void 0!==n&&n}(e)||ri(e.config))return await this.generateContentInternal(l);let c=rs(e);if(c.length>0){let e=c.map(e=>`tools[${e}]`).join(", ");throw Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let u=tr(l.contents),d=null!==(n=null===(r=null===(t=l.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===r?void 0:r.maximumRemoteCalls)&&void 0!==n?n:10,p=0;for(;p<d&&(s=await this.generateContentInternal(l)).functionCalls&&0!==s.functionCalls.length;){let t=s.candidates[0].content,r=[];for(let t of null!==(o=null===(i=e.config)||void 0===i?void 0:i.tools)&&void 0!==o?o:[])if(ro(t)){let e=await t.callTool(s.functionCalls);r.push(...e)}p++,a={role:"user",parts:r},l.contents=tr(l.contents),l.contents.push(t),l.contents.push(a),ra(l.config)&&(u.push(t),u.push(a))}return ra(l.config)&&(s.automaticFunctionCallingHistory=u),s},this.generateContentStream=async e=>{var t,r,n,i,o;if(this.maybeMoveToResponseJsonSchem(e),ri(e.config)){let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}let s=rs(e);if(s.length>0){let e=s.map(e=>`tools[${e}]`).join(", ");throw Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}let a=null===(n=null===(r=null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.toolConfig)||void 0===r?void 0:r.functionCallingConfig)||void 0===n?void 0:n.streamFunctionCallArguments,l=null===(o=null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.automaticFunctionCalling)||void 0===o?void 0:o.disable;if(a&&!l)throw Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let r;let n=[];if(null==e?void 0:e.generatedImages)for(let i of e.generatedImages)i&&(null==i?void 0:i.safetyAttributes)&&(null===(t=null==i?void 0:i.safetyAttributes)||void 0===t?void 0:t.contentType)==="Positive Prompt"?r=null==i?void 0:i.safetyAttributes:n.push(i);return r?{generatedImages:n,positivePromptSafetyAttributes:r,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:n,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let r={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!r.config.queryBase){if(null===(t=r.config)||void 0===t?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");r.config.filter="labels.tune-type:*"}return new tx(ed.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(r),r)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let r={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(r)},this.generateVideos=async e=>{var t,r,n,i,o,s;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null===(t=e.video)||void 0===t?void 0:t.uri)&&(null===(r=e.video)||void 0===r?void 0:r.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null===(i=null===(n=e.source)||void 0===n?void 0:n.video)||void 0===i?void 0:i.uri)&&(null===(s=null===(o=e.source)||void 0===o?void 0:o.video)||void 0===s?void 0:s.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,r,n;let i=null===(t=e.config)||void 0===t?void 0:t.tools;if(!i)return e;let o=await Promise.all(i.map(async e=>ro(e)?await e.tool():e)),s={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(s.config.tools=o,e.config&&e.config.tools&&t5(e.config.tools)){let t=Object.assign({},null!==(n=null===(r=e.config.httpOptions)||void 0===r?void 0:r.headers)&&void 0!==n?n:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),t3(t),s.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return s}async initAfcToolsMap(e){var t,r,n;let i=new Map;for(let o of null!==(r=null===(t=e.config)||void 0===t?void 0:t.tools)&&void 0!==r?r:[])if(ro(o))for(let e of null!==(n=(await o.tool()).functionDeclarations)&&void 0!==n?n:[]){if(!e.name)throw Error("Function declaration name is required.");if(i.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);i.set(e.name,o)}return i}async processAfcStream(e){var t,r,n;let i=null!==(n=null===(r=null===(t=e.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===r?void 0:r.maximumRemoteCalls)&&void 0!==n?n:10,o=!1,s=0;return function(e,t,r){return tI(this,arguments,function*(){for(;s<i;){o&&(s++,o=!1);let m=yield tO(e.processParamsMaybeAddMcpUsage(r)),g=yield tO(e.generateContentStreamInternal(m)),y=[],v=[];try{for(var n,a,l,c,u,d,p,h=!0,f=(a=void 0,tN(g));!(n=(p=yield tO(f.next())).done);h=!0)if(c=p.value,h=!1,yield yield tO(c),c.candidates&&(null===(u=c.candidates[0])||void 0===u?void 0:u.content)){for(let e of(v.push(c.candidates[0].content),null!==(d=c.candidates[0].content.parts)&&void 0!==d?d:[]))if(s<i&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let r=yield tO(t.get(e.functionCall.name).callTool([e.functionCall]));y.push(...r)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){a={error:e}}finally{try{!h&&!n&&(l=f.return)&&(yield tO(l.call(f)))}finally{if(a)throw a.error}}if(y.length>0){o=!0;let e=new eA;e.candidates=[{content:{role:"user",parts:y}}],yield yield tO(e);let t=[];t.push(...v),t.push({role:"user",parts:y});let n=tr(r.contents).concat(t);r.contents=n}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=tF(this.apiClient,e);return o=e_("{model}:generateContent",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=tB(e),r=new eA;return Object.assign(r,t),r})}{let t=tG(this.apiClient,e);return o=e_("{model}:generateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=tq(e),r=new eA;return Object.assign(r,t),r})}}async generateContentStreamInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=tF(this.apiClient,e);return o=e_("{model}:streamGenerateContent?alt=sse",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(function(e){return tI(this,arguments,function*(){var t,r,n,i;try{for(var o,s=!0,a=tN(e);!(t=(o=yield tO(a.next())).done);s=!0){i=o.value,s=!1;let e=tB((yield tO(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new eA;Object.assign(t,e),yield yield tO(t)}}catch(e){r={error:e}}finally{try{!s&&!t&&(n=a.return)&&(yield tO(n.call(a)))}finally{if(r)throw r.error}}})})}{let t=tG(this.apiClient,e);return o=e_("{model}:streamGenerateContent?alt=sse",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(function(e){return tI(this,arguments,function*(){var t,r,n,i;try{for(var o,s=!0,a=tN(e);!(t=(o=yield tO(a.next())).done);s=!0){i=o.value,s=!1;let e=tq((yield tO(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new eA;Object.assign(t,e),yield yield tO(t)}}catch(e){r={error:e}}finally{try{!s&&!t&&(n=a.return)&&(yield tO(n.call(a)))}finally{if(r)throw r.error}}})})}}async embedContent(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let t=tt(e,i);Array.isArray(t)&&(t=t.map(e=>e)),eE(r,["instances[]","content"],t)}let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["taskType"]);void 0!==t&&null!=r&&eE(t,["instances[]","task_type"],r);let n=ew(e,["title"]);void 0!==t&&null!=n&&eE(t,["instances[]","title"],n);let i=ew(e,["outputDimensionality"]);void 0!==t&&null!=i&&eE(t,["parameters","outputDimensionality"],i);let o=ew(e,["mimeType"]);void 0!==t&&null!=o&&eE(t,["instances[]","mimeType"],o);let s=ew(e,["autoTruncate"]);void 0!==t&&null!=s&&eE(t,["parameters","autoTruncate"],s)}(o,r),r}(this.apiClient,e);return o=e_("{model}:predict",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions[]","embeddings"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["values"]);null!=r&&eE(t,["values"],r);let n=ew(e,["statistics"]);return null!=n&&eE(t,["statistics"],function(e){let t={},r=ew(e,["truncated"]);null!=r&&eE(t,["truncated"],r);let n=ew(e,["token_count"]);return null!=n&&eE(t,["tokenCount"],n),t}(n)),t})(e))),eE(t,["embeddings"],e)}let i=ew(e,["metadata"]);return null!=i&&eE(t,["metadata"],i),t}(e),r=new eC;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let t=tt(e,i);Array.isArray(t)&&(t=t.map(e=>e)),eE(r,["requests[]","content"],t)}let o=ew(t,["config"]);null!=o&&function(e,t){let r=ew(e,["taskType"]);void 0!==t&&null!=r&&eE(t,["requests[]","taskType"],r);let n=ew(e,["title"]);void 0!==t&&null!=n&&eE(t,["requests[]","title"],n);let i=ew(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&eE(t,["requests[]","outputDimensionality"],i),void 0!==ew(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==ew(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(o,r);let s=ew(t,["model"]);return void 0!==s&&eE(r,["requests[]","model"],eQ(e,s)),r}(this.apiClient,e);return o=e_("{model}:batchEmbedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["embeddings"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["embeddings"],e)}let i=ew(e,["metadata"]);return null!=i&&eE(t,["metadata"],i),t}(e),r=new eC;return Object.assign(r,t),r})}}async generateImagesInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["outputGcsUri"]);void 0!==t&&null!=r&&eE(t,["parameters","storageUri"],r);let n=ew(e,["negativePrompt"]);void 0!==t&&null!=n&&eE(t,["parameters","negativePrompt"],n);let i=ew(e,["numberOfImages"]);void 0!==t&&null!=i&&eE(t,["parameters","sampleCount"],i);let o=ew(e,["aspectRatio"]);void 0!==t&&null!=o&&eE(t,["parameters","aspectRatio"],o);let s=ew(e,["guidanceScale"]);void 0!==t&&null!=s&&eE(t,["parameters","guidanceScale"],s);let a=ew(e,["seed"]);void 0!==t&&null!=a&&eE(t,["parameters","seed"],a);let l=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&eE(t,["parameters","safetySetting"],l);let c=ew(e,["personGeneration"]);void 0!==t&&null!=c&&eE(t,["parameters","personGeneration"],c);let u=ew(e,["includeSafetyAttributes"]);void 0!==t&&null!=u&&eE(t,["parameters","includeSafetyAttributes"],u);let d=ew(e,["includeRaiReason"]);void 0!==t&&null!=d&&eE(t,["parameters","includeRaiReason"],d);let p=ew(e,["language"]);void 0!==t&&null!=p&&eE(t,["parameters","language"],p);let h=ew(e,["outputMimeType"]);void 0!==t&&null!=h&&eE(t,["parameters","outputOptions","mimeType"],h);let f=ew(e,["outputCompressionQuality"]);void 0!==t&&null!=f&&eE(t,["parameters","outputOptions","compressionQuality"],f);let m=ew(e,["addWatermark"]);void 0!==t&&null!=m&&eE(t,["parameters","addWatermark"],m);let g=ew(e,["labels"]);void 0!==t&&null!=g&&eE(t,["labels"],g);let y=ew(e,["imageSize"]);void 0!==t&&null!=y&&eE(t,["parameters","sampleImageSize"],y);let v=ew(e,["enhancePrompt"]);void 0!==t&&null!=v&&eE(t,["parameters","enhancePrompt"],v)}(o,r),r}(this.apiClient,e);return o=e_("{model}:predict",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>tH(e))),eE(t,["generatedImages"],e)}let i=ew(e,["positivePromptSafetyAttributes"]);return null!=i&&eE(t,["positivePromptSafetyAttributes"],tY(i)),t}(e),r=new eO;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["config"]);return null!=o&&function(e,t){if(void 0!==ew(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==ew(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let r=ew(e,["numberOfImages"]);void 0!==t&&null!=r&&eE(t,["parameters","sampleCount"],r);let n=ew(e,["aspectRatio"]);void 0!==t&&null!=n&&eE(t,["parameters","aspectRatio"],n);let i=ew(e,["guidanceScale"]);if(void 0!==t&&null!=i&&eE(t,["parameters","guidanceScale"],i),void 0!==ew(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let o=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=o&&eE(t,["parameters","safetySetting"],o);let s=ew(e,["personGeneration"]);void 0!==t&&null!=s&&eE(t,["parameters","personGeneration"],s);let a=ew(e,["includeSafetyAttributes"]);void 0!==t&&null!=a&&eE(t,["parameters","includeSafetyAttributes"],a);let l=ew(e,["includeRaiReason"]);void 0!==t&&null!=l&&eE(t,["parameters","includeRaiReason"],l);let c=ew(e,["language"]);void 0!==t&&null!=c&&eE(t,["parameters","language"],c);let u=ew(e,["outputMimeType"]);void 0!==t&&null!=u&&eE(t,["parameters","outputOptions","mimeType"],u);let d=ew(e,["outputCompressionQuality"]);if(void 0!==t&&null!=d&&eE(t,["parameters","outputOptions","compressionQuality"],d),void 0!==ew(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==ew(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let p=ew(e,["imageSize"]);if(void 0!==t&&null!=p&&eE(t,["parameters","sampleImageSize"],p),void 0!==ew(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(o,r),r}(this.apiClient,e);return o=e_("{model}:predict",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["_self"]);null!=r&&eE(t,["image"],function(e){let t={},r=ew(e,["bytesBase64Encoded"]);null!=r&&eE(t,["imageBytes"],ex(r));let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(r));let n=ew(e,["raiFilteredReason"]);null!=n&&eE(t,["raiFilteredReason"],n);let i=ew(e,["_self"]);return null!=i&&eE(t,["safetyAttributes"],tK(i)),t})(e))),eE(t,["generatedImages"],e)}let i=ew(e,["positivePromptSafetyAttributes"]);return null!=i&&eE(t,["positivePromptSafetyAttributes"],tK(i)),t}(e),r=new eO;return Object.assign(r,t),r})}}async editImageInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["referenceImages"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["referenceImage"]);null!=r&&eE(t,["referenceImage"],tz(r));let n=ew(e,["referenceId"]);null!=n&&eE(t,["referenceId"],n);let i=ew(e,["referenceType"]);null!=i&&eE(t,["referenceType"],i);let o=ew(e,["maskImageConfig"]);null!=o&&eE(t,["maskImageConfig"],function(e){let t={},r=ew(e,["maskMode"]);null!=r&&eE(t,["maskMode"],r);let n=ew(e,["segmentationClasses"]);null!=n&&eE(t,["maskClasses"],n);let i=ew(e,["maskDilation"]);return null!=i&&eE(t,["dilation"],i),t}(o));let s=ew(e,["controlImageConfig"]);null!=s&&eE(t,["controlImageConfig"],function(e){let t={},r=ew(e,["controlType"]);null!=r&&eE(t,["controlType"],r);let n=ew(e,["enableControlImageComputation"]);return null!=n&&eE(t,["computeControl"],n),t}(s));let a=ew(e,["styleImageConfig"]);null!=a&&eE(t,["styleImageConfig"],a);let l=ew(e,["subjectImageConfig"]);return null!=l&&eE(t,["subjectImageConfig"],l),t})(e))),eE(r,["instances[0]","referenceImages"],e)}let s=ew(t,["config"]);return null!=s&&function(e,t){let r=ew(e,["outputGcsUri"]);void 0!==t&&null!=r&&eE(t,["parameters","storageUri"],r);let n=ew(e,["negativePrompt"]);void 0!==t&&null!=n&&eE(t,["parameters","negativePrompt"],n);let i=ew(e,["numberOfImages"]);void 0!==t&&null!=i&&eE(t,["parameters","sampleCount"],i);let o=ew(e,["aspectRatio"]);void 0!==t&&null!=o&&eE(t,["parameters","aspectRatio"],o);let s=ew(e,["guidanceScale"]);void 0!==t&&null!=s&&eE(t,["parameters","guidanceScale"],s);let a=ew(e,["seed"]);void 0!==t&&null!=a&&eE(t,["parameters","seed"],a);let l=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&eE(t,["parameters","safetySetting"],l);let c=ew(e,["personGeneration"]);void 0!==t&&null!=c&&eE(t,["parameters","personGeneration"],c);let u=ew(e,["includeSafetyAttributes"]);void 0!==t&&null!=u&&eE(t,["parameters","includeSafetyAttributes"],u);let d=ew(e,["includeRaiReason"]);void 0!==t&&null!=d&&eE(t,["parameters","includeRaiReason"],d);let p=ew(e,["language"]);void 0!==t&&null!=p&&eE(t,["parameters","language"],p);let h=ew(e,["outputMimeType"]);void 0!==t&&null!=h&&eE(t,["parameters","outputOptions","mimeType"],h);let f=ew(e,["outputCompressionQuality"]);void 0!==t&&null!=f&&eE(t,["parameters","outputOptions","compressionQuality"],f);let m=ew(e,["addWatermark"]);void 0!==t&&null!=m&&eE(t,["parameters","addWatermark"],m);let g=ew(e,["labels"]);void 0!==t&&null!=g&&eE(t,["labels"],g);let y=ew(e,["editMode"]);void 0!==t&&null!=y&&eE(t,["parameters","editMode"],y);let v=ew(e,["baseSteps"]);void 0!==t&&null!=v&&eE(t,["parameters","editConfig","baseSteps"],v)}(s,r),r}(this.apiClient,e);return n=e_("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>tH(e))),eE(t,["generatedImages"],e)}return t}(e),r=new eI;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["image"]);null!=i&&eE(r,["instances[0]","image"],tz(i));let o=ew(t,["upscaleFactor"]);null!=o&&eE(r,["parameters","upscaleConfig","upscaleFactor"],o);let s=ew(t,["config"]);return null!=s&&function(e,t){let r=ew(e,["outputGcsUri"]);void 0!==t&&null!=r&&eE(t,["parameters","storageUri"],r);let n=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=n&&eE(t,["parameters","safetySetting"],n);let i=ew(e,["personGeneration"]);void 0!==t&&null!=i&&eE(t,["parameters","personGeneration"],i);let o=ew(e,["includeRaiReason"]);void 0!==t&&null!=o&&eE(t,["parameters","includeRaiReason"],o);let s=ew(e,["outputMimeType"]);void 0!==t&&null!=s&&eE(t,["parameters","outputOptions","mimeType"],s);let a=ew(e,["outputCompressionQuality"]);void 0!==t&&null!=a&&eE(t,["parameters","outputOptions","compressionQuality"],a);let l=ew(e,["enhanceInputImage"]);void 0!==t&&null!=l&&eE(t,["parameters","upscaleConfig","enhanceInputImage"],l);let c=ew(e,["imagePreservationFactor"]);void 0!==t&&null!=c&&eE(t,["parameters","upscaleConfig","imagePreservationFactor"],c);let u=ew(e,["labels"]);void 0!==t&&null!=u&&eE(t,["labels"],u);let d=ew(e,["numberOfImages"]);void 0!==t&&null!=d&&eE(t,["parameters","sampleCount"],d);let p=ew(e,["mode"]);void 0!==t&&null!=p&&eE(t,["parameters","mode"],p)}(s,r),r}(this.apiClient,e);return n=e_("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>tH(e))),eE(t,["generatedImages"],e)}return t}(e),r=new eN;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["source"]);null!=i&&function(e,t){let r=ew(e,["prompt"]);void 0!==t&&null!=r&&eE(t,["instances[0]","prompt"],r);let n=ew(e,["personImage"]);void 0!==t&&null!=n&&eE(t,["instances[0]","personImage","image"],tz(n));let i=ew(e,["productImages"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["productImage"]);return null!=r&&eE(t,["image"],tz(r)),t})(e))),eE(t,["instances[0]","productImages"],e)}}(i,r);let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["numberOfImages"]);void 0!==t&&null!=r&&eE(t,["parameters","sampleCount"],r);let n=ew(e,["baseSteps"]);void 0!==t&&null!=n&&eE(t,["parameters","baseSteps"],n);let i=ew(e,["outputGcsUri"]);void 0!==t&&null!=i&&eE(t,["parameters","storageUri"],i);let o=ew(e,["seed"]);void 0!==t&&null!=o&&eE(t,["parameters","seed"],o);let s=ew(e,["safetyFilterLevel"]);void 0!==t&&null!=s&&eE(t,["parameters","safetySetting"],s);let a=ew(e,["personGeneration"]);void 0!==t&&null!=a&&eE(t,["parameters","personGeneration"],a);let l=ew(e,["addWatermark"]);void 0!==t&&null!=l&&eE(t,["parameters","addWatermark"],l);let c=ew(e,["outputMimeType"]);void 0!==t&&null!=c&&eE(t,["parameters","outputOptions","mimeType"],c);let u=ew(e,["outputCompressionQuality"]);void 0!==t&&null!=u&&eE(t,["parameters","outputOptions","compressionQuality"],u);let d=ew(e,["enhancePrompt"]);void 0!==t&&null!=d&&eE(t,["parameters","enhancePrompt"],d);let p=ew(e,["labels"]);void 0!==t&&null!=p&&eE(t,["labels"],p)}(o,r),r}(this.apiClient,e);return n=e_("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>tH(e))),eE(t,["generatedImages"],e)}return t}(e),r=new ek;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["source"]);null!=i&&function(e,t){let r=ew(e,["prompt"]);void 0!==t&&null!=r&&eE(t,["instances[0]","prompt"],r);let n=ew(e,["image"]);void 0!==t&&null!=n&&eE(t,["instances[0]","image"],tz(n));let i=ew(e,["scribbleImage"]);void 0!==t&&null!=i&&eE(t,["instances[0]","scribble"],function(e){let t={},r=ew(e,["image"]);return null!=r&&eE(t,["image"],tz(r)),t}(i))}(i,r);let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["mode"]);void 0!==t&&null!=r&&eE(t,["parameters","mode"],r);let n=ew(e,["maxPredictions"]);void 0!==t&&null!=n&&eE(t,["parameters","maxPredictions"],n);let i=ew(e,["confidenceThreshold"]);void 0!==t&&null!=i&&eE(t,["parameters","confidenceThreshold"],i);let o=ew(e,["maskDilation"]);void 0!==t&&null!=o&&eE(t,["parameters","maskDilation"],o);let s=ew(e,["binaryColorThreshold"]);void 0!==t&&null!=s&&eE(t,["parameters","binaryColorThreshold"],s);let a=ew(e,["labels"]);void 0!==t&&null!=a&&eE(t,["labels"],a)}(o,r),r}(this.apiClient,e);return n=e_("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["_self"]);null!=r&&eE(t,["mask"],tV(r));let n=ew(e,["labels"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["labels"],e)}return t})(e))),eE(t,["generatedMasks"],e)}return t}(e),r=new eR;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);return null!=n&&eE(r,["_url","name"],eQ(e,n)),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>tW(e))}{let t=function(e,t){let r={},n=ew(t,["model"]);return null!=n&&eE(r,["_url","name"],eQ(e,n)),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tJ(e))}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["config"]);return null!=n&&function(e,t,r){let n=ew(t,["pageSize"]);void 0!==r&&null!=n&&eE(r,["_query","pageSize"],n);let i=ew(t,["pageToken"]);void 0!==r&&null!=i&&eE(r,["_query","pageToken"],i);let o=ew(t,["filter"]);void 0!==r&&null!=o&&eE(r,["_query","filter"],o);let s=ew(t,["queryBase"]);void 0!==r&&null!=s&&eE(r,["_url","models_url"],th(e,s))}(e,n,r),r}(this.apiClient,e);return o=e_("{models_url}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["_self"]);if(null!=i){let e=tf(i);Array.isArray(e)&&(e=e.map(e=>tW(e))),eE(t,["models"],e)}return t}(e),r=new eP;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["config"]);return null!=n&&function(e,t,r){let n=ew(t,["pageSize"]);void 0!==r&&null!=n&&eE(r,["_query","pageSize"],n);let i=ew(t,["pageToken"]);void 0!==r&&null!=i&&eE(r,["_query","pageToken"],i);let o=ew(t,["filter"]);void 0!==r&&null!=o&&eE(r,["_query","filter"],o);let s=ew(t,["queryBase"]);void 0!==r&&null!=s&&eE(r,["_url","models_url"],th(e,s))}(e,n,r),r}(this.apiClient,e);return o=e_("{models_url}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["_self"]);if(null!=i){let e=tf(i);Array.isArray(e)&&(e=e.map(e=>tJ(e))),eE(t,["models"],e)}return t}(e),r=new eP;return Object.assign(r,t),r})}}async update(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["displayName"],r);let n=ew(e,["description"]);void 0!==t&&null!=n&&eE(t,["description"],n);let i=ew(e,["defaultCheckpointId"]);void 0!==t&&null!=i&&eE(t,["defaultCheckpointId"],i)}(i,r),r}(this.apiClient,e);return o=e_("{model}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>tW(e))}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","name"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["displayName"],r);let n=ew(e,["description"]);void 0!==t&&null!=n&&eE(t,["description"],n);let i=ew(e,["defaultCheckpointId"]);void 0!==t&&null!=i&&eE(t,["defaultCheckpointId"],i)}(i,r),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tJ(e))}}async delete(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);return null!=n&&eE(r,["_url","name"],eQ(e,n)),r}(this.apiClient,e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new ej;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);return null!=n&&eE(r,["_url","name"],eQ(e,n)),r}(this.apiClient,e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new ej;return Object.assign(r,t),r})}}async countTokens(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>e)),eE(r,["contents"],e)}let o=ew(t,["config"]);return null!=o&&function(e,t){let r=ew(e,["systemInstruction"]);void 0!==t&&null!=r&&eE(t,["systemInstruction"],te(r));let n=ew(e,["tools"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>tX(e))),eE(t,["tools"],e)}let i=ew(e,["generationConfig"]);void 0!==t&&null!=i&&eE(t,["generationConfig"],function(e){let t={},r=ew(e,["modelSelectionConfig"]);null!=r&&eE(t,["modelConfig"],r);let n=ew(e,["responseJsonSchema"]);null!=n&&eE(t,["responseJsonSchema"],n);let i=ew(e,["audioTimestamp"]);null!=i&&eE(t,["audioTimestamp"],i);let o=ew(e,["candidateCount"]);null!=o&&eE(t,["candidateCount"],o);let s=ew(e,["enableAffectiveDialog"]);null!=s&&eE(t,["enableAffectiveDialog"],s);let a=ew(e,["frequencyPenalty"]);null!=a&&eE(t,["frequencyPenalty"],a);let l=ew(e,["logprobs"]);null!=l&&eE(t,["logprobs"],l);let c=ew(e,["maxOutputTokens"]);null!=c&&eE(t,["maxOutputTokens"],c);let u=ew(e,["mediaResolution"]);null!=u&&eE(t,["mediaResolution"],u);let d=ew(e,["presencePenalty"]);null!=d&&eE(t,["presencePenalty"],d);let p=ew(e,["responseLogprobs"]);null!=p&&eE(t,["responseLogprobs"],p);let h=ew(e,["responseMimeType"]);null!=h&&eE(t,["responseMimeType"],h);let f=ew(e,["responseModalities"]);null!=f&&eE(t,["responseModalities"],f);let m=ew(e,["responseSchema"]);null!=m&&eE(t,["responseSchema"],m);let g=ew(e,["routingConfig"]);null!=g&&eE(t,["routingConfig"],g);let y=ew(e,["seed"]);null!=y&&eE(t,["seed"],y);let v=ew(e,["speechConfig"]);null!=v&&eE(t,["speechConfig"],v);let b=ew(e,["stopSequences"]);null!=b&&eE(t,["stopSequences"],b);let _=ew(e,["temperature"]);null!=_&&eE(t,["temperature"],_);let E=ew(e,["thinkingConfig"]);null!=E&&eE(t,["thinkingConfig"],E);let w=ew(e,["topK"]);null!=w&&eE(t,["topK"],w);let x=ew(e,["topP"]);if(null!=x&&eE(t,["topP"],x),void 0!==ew(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(i))}(o,r),r}(this.apiClient,e);return o=e_("{model}:countTokens",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["totalTokens"]);return null!=n&&eE(t,["totalTokens"],n),t}(e),r=new eM;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>tL(e))),eE(r,["contents"],e)}let o=ew(t,["config"]);return null!=o&&function(e){if(void 0!==ew(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==ew(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==ew(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(o),r}(this.apiClient,e);return o=e_("{model}:countTokens",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["totalTokens"]);null!=n&&eE(t,["totalTokens"],n);let i=ew(e,["cachedContentTokenCount"]);return null!=i&&eE(t,["cachedContentTokenCount"],i),t}(e),r=new eM;return Object.assign(r,t),r})}}async computeTokens(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["contents"]);if(null!=i){let e=tr(i);Array.isArray(e)&&(e=e.map(e=>e)),eE(r,["contents"],e)}return r}(this.apiClient,e);return n=e_("{model}:computeTokens",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["tokensInfo"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["tokensInfo"],e)}return t}(e),r=new eD;return Object.assign(r,t),r})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["image"]);null!=o&&eE(r,["instances[0]","image"],tz(o));let s=ew(t,["video"]);null!=s&&eE(r,["instances[0]","video"],tQ(s));let a=ew(t,["source"]);null!=a&&function(e,t){let r=ew(e,["prompt"]);void 0!==t&&null!=r&&eE(t,["instances[0]","prompt"],r);let n=ew(e,["image"]);void 0!==t&&null!=n&&eE(t,["instances[0]","image"],tz(n));let i=ew(e,["video"]);void 0!==t&&null!=i&&eE(t,["instances[0]","video"],tQ(i))}(a,r);let l=ew(t,["config"]);return null!=l&&function(e,t){let r=ew(e,["numberOfVideos"]);void 0!==t&&null!=r&&eE(t,["parameters","sampleCount"],r);let n=ew(e,["outputGcsUri"]);void 0!==t&&null!=n&&eE(t,["parameters","storageUri"],n);let i=ew(e,["fps"]);void 0!==t&&null!=i&&eE(t,["parameters","fps"],i);let o=ew(e,["durationSeconds"]);void 0!==t&&null!=o&&eE(t,["parameters","durationSeconds"],o);let s=ew(e,["seed"]);void 0!==t&&null!=s&&eE(t,["parameters","seed"],s);let a=ew(e,["aspectRatio"]);void 0!==t&&null!=a&&eE(t,["parameters","aspectRatio"],a);let l=ew(e,["resolution"]);void 0!==t&&null!=l&&eE(t,["parameters","resolution"],l);let c=ew(e,["personGeneration"]);void 0!==t&&null!=c&&eE(t,["parameters","personGeneration"],c);let u=ew(e,["pubsubTopic"]);void 0!==t&&null!=u&&eE(t,["parameters","pubsubTopic"],u);let d=ew(e,["negativePrompt"]);void 0!==t&&null!=d&&eE(t,["parameters","negativePrompt"],d);let p=ew(e,["enhancePrompt"]);void 0!==t&&null!=p&&eE(t,["parameters","enhancePrompt"],p);let h=ew(e,["generateAudio"]);void 0!==t&&null!=h&&eE(t,["parameters","generateAudio"],h);let f=ew(e,["lastFrame"]);void 0!==t&&null!=f&&eE(t,["instances[0]","lastFrame"],tz(f));let m=ew(e,["referenceImages"]);if(void 0!==t&&null!=m){let e=m;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["image"]);null!=r&&eE(t,["image"],tz(r));let n=ew(e,["referenceType"]);return null!=n&&eE(t,["referenceType"],n),t})(e))),eE(t,["instances[0]","referenceImages"],e)}let g=ew(e,["mask"]);void 0!==t&&null!=g&&eE(t,["instances[0]","mask"],function(e){let t={},r=ew(e,["image"]);null!=r&&eE(t,["_self"],tz(r));let n=ew(e,["maskMode"]);return null!=n&&eE(t,["maskMode"],n),t}(g));let y=ew(e,["compressionQuality"]);void 0!==t&&null!=y&&eE(t,["parameters","compressionQuality"],y)}(l,r),r}(this.apiClient,e);return o=e_("{model}:predictLongRunning",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["videos"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["_self"]);return null!=r&&eE(t,["video"],function(e){let t={},r=ew(e,["gcsUri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["bytesBase64Encoded"]);null!=n&&eE(t,["videoBytes"],ex(n));let i=ew(e,["mimeType"]);return null!=i&&eE(t,["mimeType"],i),t}(r)),t})(e))),eE(t,["generatedVideos"],e)}let n=ew(e,["raiMediaFilteredCount"]);null!=n&&eE(t,["raiMediaFilteredCount"],n);let i=ew(e,["raiMediaFilteredReasons"]);return null!=i&&eE(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e),r=new eU;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["_url","model"],eQ(e,n));let i=ew(t,["prompt"]);null!=i&&eE(r,["instances[0]","prompt"],i);let o=ew(t,["image"]);null!=o&&eE(r,["instances[0]","image"],t$(o));let s=ew(t,["video"]);null!=s&&eE(r,["instances[0]","video"],tZ(s));let a=ew(t,["source"]);null!=a&&function(e,t){let r=ew(e,["prompt"]);void 0!==t&&null!=r&&eE(t,["instances[0]","prompt"],r);let n=ew(e,["image"]);void 0!==t&&null!=n&&eE(t,["instances[0]","image"],t$(n));let i=ew(e,["video"]);void 0!==t&&null!=i&&eE(t,["instances[0]","video"],tZ(i))}(a,r);let l=ew(t,["config"]);return null!=l&&function(e,t){let r=ew(e,["numberOfVideos"]);if(void 0!==t&&null!=r&&eE(t,["parameters","sampleCount"],r),void 0!==ew(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==ew(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let n=ew(e,["durationSeconds"]);if(void 0!==t&&null!=n&&eE(t,["parameters","durationSeconds"],n),void 0!==ew(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let i=ew(e,["aspectRatio"]);void 0!==t&&null!=i&&eE(t,["parameters","aspectRatio"],i);let o=ew(e,["resolution"]);void 0!==t&&null!=o&&eE(t,["parameters","resolution"],o);let s=ew(e,["personGeneration"]);if(void 0!==t&&null!=s&&eE(t,["parameters","personGeneration"],s),void 0!==ew(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let a=ew(e,["negativePrompt"]);void 0!==t&&null!=a&&eE(t,["parameters","negativePrompt"],a);let l=ew(e,["enhancePrompt"]);if(void 0!==t&&null!=l&&eE(t,["parameters","enhancePrompt"],l),void 0!==ew(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let c=ew(e,["lastFrame"]);void 0!==t&&null!=c&&eE(t,["instances[0]","lastFrame"],t$(c));let u=ew(e,["referenceImages"]);if(void 0!==t&&null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["image"]);null!=r&&eE(t,["image"],t$(r));let n=ew(e,["referenceType"]);return null!=n&&eE(t,["referenceType"],n),t})(e))),eE(t,["instances[0]","referenceImages"],e)}if(void 0!==ew(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==ew(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(l,r),r}(this.apiClient,e);return o=e_("{model}:predictLongRunning",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response","generateVideoResponse"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["generatedSamples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["video"]);return null!=r&&eE(t,["video"],function(e){let t={},r=ew(e,["uri"]);null!=r&&eE(t,["uri"],r);let n=ew(e,["encodedVideo"]);null!=n&&eE(t,["videoBytes"],ex(n));let i=ew(e,["encoding"]);return null!=i&&eE(t,["mimeType"],i),t}(r)),t})(e))),eE(t,["generatedVideos"],e)}let n=ew(e,["raiMediaFilteredCount"]);null!=n&&eE(t,["raiMediaFilteredCount"],n);let i=ew(e,["raiMediaFilteredReasons"]);return null!=i&&eE(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e),r=new eU;return Object.assign(r,t),r})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rc extends eb{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,r=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e;let n=t.name.split("/operations/")[0];r&&"httpOptions"in r&&(e=r.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:n,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){let t=e.operation,r=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e;let n=t.name.split("/operations/")[0];r&&"httpOptions"in r&&(e=r.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:n,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e){let t={},r=ew(e,["operationName"]);return null!=r&&eE(t,["_url","operationName"],r),t}(e);return o=e_("{operationName}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json())}{let t=function(e){let t={},r=ew(e,["operationName"]);return null!=r&&eE(t,["_url","operationName"],r),t}(e);return o=e_("{operationName}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["operationName"]);null!=r&&eE(t,["operationName"],r);let n=ew(e,["resourceName"]);return null!=n&&eE(t,["_url","resourceName"],n),t}(e);return n=e_("{resourceName}:fetchPredictOperation",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class ru extends eb{constructor(e){super(),this.apiClient=e}async create(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let o=function(e,t){let r={},n=ew(t,["config"]);return null!=n&&eE(r,["config"],function(e,t,r){let n=ew(t,["expireTime"]);void 0!==r&&null!=n&&eE(r,["expireTime"],n);let i=ew(t,["newSessionExpireTime"]);void 0!==r&&null!=i&&eE(r,["newSessionExpireTime"],i);let o=ew(t,["uses"]);void 0!==r&&null!=o&&eE(r,["uses"],o);let s=ew(t,["liveConnectConstraints"]);void 0!==r&&null!=s&&eE(r,["bidiGenerateContentSetup"],function(e,t){let r={},n=ew(t,["model"]);null!=n&&eE(r,["setup","model"],eQ(e,n));let i=ew(t,["config"]);return null!=i&&eE(r,["config"],function(e,t){let r=ew(e,["generationConfig"]);void 0!==t&&null!=r&&eE(t,["setup","generationConfig"],r);let n=ew(e,["responseModalities"]);void 0!==t&&null!=n&&eE(t,["setup","generationConfig","responseModalities"],n);let i=ew(e,["temperature"]);void 0!==t&&null!=i&&eE(t,["setup","generationConfig","temperature"],i);let o=ew(e,["topP"]);void 0!==t&&null!=o&&eE(t,["setup","generationConfig","topP"],o);let s=ew(e,["topK"]);void 0!==t&&null!=s&&eE(t,["setup","generationConfig","topK"],s);let a=ew(e,["maxOutputTokens"]);void 0!==t&&null!=a&&eE(t,["setup","generationConfig","maxOutputTokens"],a);let l=ew(e,["mediaResolution"]);void 0!==t&&null!=l&&eE(t,["setup","generationConfig","mediaResolution"],l);let c=ew(e,["seed"]);void 0!==t&&null!=c&&eE(t,["setup","generationConfig","seed"],c);let u=ew(e,["speechConfig"]);void 0!==t&&null!=u&&eE(t,["setup","generationConfig","speechConfig"],to(u));let d=ew(e,["thinkingConfig"]);void 0!==t&&null!=d&&eE(t,["setup","generationConfig","thinkingConfig"],d);let p=ew(e,["enableAffectiveDialog"]);void 0!==t&&null!=p&&eE(t,["setup","generationConfig","enableAffectiveDialog"],p);let h=ew(e,["systemInstruction"]);void 0!==t&&null!=h&&eE(t,["setup","systemInstruction"],function(e){let t={},r=ew(e,["parts"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},r=ew(e,["mediaResolution"]);null!=r&&eE(t,["mediaResolution"],r);let n=ew(e,["codeExecutionResult"]);null!=n&&eE(t,["codeExecutionResult"],n);let i=ew(e,["executableCode"]);null!=i&&eE(t,["executableCode"],i);let o=ew(e,["fileData"]);null!=o&&eE(t,["fileData"],function(e){let t={};if(void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=ew(e,["fileUri"]);null!=r&&eE(t,["fileUri"],r);let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(o));let s=ew(e,["functionCall"]);null!=s&&eE(t,["functionCall"],function(e){let t={},r=ew(e,["id"]);null!=r&&eE(t,["id"],r);let n=ew(e,["args"]);null!=n&&eE(t,["args"],n);let i=ew(e,["name"]);if(null!=i&&eE(t,["name"],i),void 0!==ew(e,["partialArgs"]))throw Error("partialArgs parameter is not supported in Gemini API.");if(void 0!==ew(e,["willContinue"]))throw Error("willContinue parameter is not supported in Gemini API.");return t}(s));let a=ew(e,["functionResponse"]);null!=a&&eE(t,["functionResponse"],a);let l=ew(e,["inlineData"]);null!=l&&eE(t,["inlineData"],/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t={},r=ew(e,["data"]);if(null!=r&&eE(t,["data"],r),void 0!==ew(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=ew(e,["mimeType"]);return null!=n&&eE(t,["mimeType"],n),t}(l));let c=ew(e,["text"]);null!=c&&eE(t,["text"],c);let u=ew(e,["thought"]);null!=u&&eE(t,["thought"],u);let d=ew(e,["thoughtSignature"]);null!=d&&eE(t,["thoughtSignature"],d);let p=ew(e,["videoMetadata"]);return null!=p&&eE(t,["videoMetadata"],p),t})(e))),eE(t,["parts"],e)}let n=ew(e,["role"]);return null!=n&&eE(t,["role"],n),t}(te(h)));let f=ew(e,["tools"]);if(void 0!==t&&null!=f){let e=ta(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==ew(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=ew(e,["computerUse"]);null!=r&&eE(t,["computerUse"],r);let n=ew(e,["fileSearch"]);null!=n&&eE(t,["fileSearch"],n);let i=ew(e,["codeExecution"]);if(null!=i&&eE(t,["codeExecution"],i),void 0!==ew(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let o=ew(e,["functionDeclarations"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["functionDeclarations"],e)}let s=ew(e,["googleMaps"]);null!=s&&eE(t,["googleMaps"],function(e){let t={};if(void 0!==ew(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let r=ew(e,["enableWidget"]);return null!=r&&eE(t,["enableWidget"],r),t}(s));let a=ew(e,["googleSearch"]);null!=a&&eE(t,["googleSearch"],function(e){let t={};if(void 0!==ew(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==ew(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let r=ew(e,["timeRangeFilter"]);return null!=r&&eE(t,["timeRangeFilter"],r),t}(a));let l=ew(e,["googleSearchRetrieval"]);null!=l&&eE(t,["googleSearchRetrieval"],l);let c=ew(e,["urlContext"]);return null!=c&&eE(t,["urlContext"],c),t})(ts(e)))),eE(t,["setup","tools"],e)}let m=ew(e,["sessionResumption"]);void 0!==t&&null!=m&&eE(t,["setup","sessionResumption"],function(e){let t={},r=ew(e,["handle"]);if(null!=r&&eE(t,["handle"],r),void 0!==ew(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=ew(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&eE(t,["setup","inputAudioTranscription"],g);let y=ew(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&eE(t,["setup","outputAudioTranscription"],y);let v=ew(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&eE(t,["setup","realtimeInputConfig"],v);let b=ew(e,["contextWindowCompression"]);void 0!==t&&null!=b&&eE(t,["setup","contextWindowCompression"],b);let _=ew(e,["proactivity"]);if(void 0!==t&&null!=_&&eE(t,["setup","proactivity"],_),void 0!==ew(e,["explicitVadSignal"]))throw Error("explicitVadSignal parameter is not supported in Gemini API.");return{}}(i,r)),r}(e,s));let a=ew(t,["lockAdditionalFields"]);return void 0!==r&&null!=a&&eE(r,["fieldMask"],a),{}}(e,n,r)),r}(this.apiClient,e);n=e_("auth_tokens",o._url),i=o._query,delete o.config,delete o._url,delete o._query;let s=function(e,t){let r=null,n=e.bidiGenerateContentSetup;if("object"==typeof n&&null!==n&&"setup"in n){let t=n.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,r=t):delete e.bidiGenerateContentSetup}else void 0!==n&&delete e.bidiGenerateContentSetup;let i=e.fieldMask;if(r){let n=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t=[];for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r];if("object"==typeof n&&null!=n&&Object.keys(n).length>0){let e=Object.keys(n).map(e=>`${r}.${e}`);t.push(...e)}else t.push(r)}return t.join(",")}(r);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)n?e.fieldMask=n:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==i&&Array.isArray(i)&&i.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],r=[];i.length>0&&(r=i.map(e=>t.includes(e)?`generationConfig.${e}`:e));let o=[];n&&o.push(n),r.length>0&&o.push(...r),o.length>0?e.fieldMask=o.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==i&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(","):delete e.fieldMask;return e}(o,e.config);return this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rd extends eb{constructor(e){super(),this.apiClient=e,this.list=async e=>new tx(ed.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);return null!=r&&eE(t,["_url","name"],r),t}(e);return n=e_("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["_url","name"],r);let n=ew(e,["config"]);return null!=n&&/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e,t){let r=ew(e,["force"]);void 0!==t&&null!=r&&eE(t,["_query","force"],r)}(n,t),t}(e);n=e_("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal})}}async listInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["parent"]);null!=r&&eE(t,["_url","parent"],r);let n=ew(e,["config"]);return null!=n&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(n,t),t}(e);return n=e_("{parent}/documents",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["documents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["documents"],e)}return t}(e),r=new eB;return Object.assign(r,t),r})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rp extends eb{constructor(e,t=new rd(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new tx(ed.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["config"]);return null!=r&&/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e,t){let r=ew(e,["displayName"]);void 0!==t&&null!=r&&eE(t,["displayName"],r)}(r,t),t}(e);return n=e_("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);return null!=r&&eE(t,["_url","name"],r),t}(e);return n=e_("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["_url","name"],r);let n=ew(e,["config"]);return null!=n&&function(e,t){let r=ew(e,["force"]);void 0!==t&&null!=r&&eE(t,["_query","force"],r)}(n,t),t}(e);n=e_("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal})}}async listInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["config"]);return null!=r&&function(e,t){let r=ew(e,["pageSize"]);void 0!==t&&null!=r&&eE(t,["_query","pageSize"],r);let n=ew(e,["pageToken"]);void 0!==t&&null!=n&&eE(t,["_query","pageToken"],n)}(r,t),t}(e);return n=e_("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["nextPageToken"]);null!=n&&eE(t,["nextPageToken"],n);let i=ew(e,["fileSearchStores"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["fileSearchStores"],e)}return t}(e),r=new eH;return Object.assign(r,t),r})}}async uploadToFileSearchStoreInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["fileSearchStoreName"]);null!=r&&eE(t,["_url","file_search_store_name"],r);let n=ew(e,["config"]);return null!=n&&t0(n,t),t}(e);return n=e_("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["sdkHttpResponse"]);return null!=r&&eE(t,["sdkHttpResponse"],r),t}(e),r=new eV;return Object.assign(r,t),r})}}async importFile(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},r=ew(e,["fileSearchStoreName"]);null!=r&&eE(t,["_url","file_search_store_name"],r);let n=ew(e,["fileName"]);null!=n&&eE(t,["fileName"],n);let i=ew(e,["config"]);return null!=i&&function(e,t){let r=ew(e,["customMetadata"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE(t,["customMetadata"],e)}let n=ew(e,["chunkingConfig"]);void 0!==t&&null!=n&&eE(t,["chunkingConfig"],n)}(i,t),t}(e);return n=e_("{file_search_store_name}:importFile",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},r=ew(e,["name"]);null!=r&&eE(t,["name"],r);let n=ew(e,["metadata"]);null!=n&&eE(t,["metadata"],n);let i=ew(e,["done"]);null!=i&&eE(t,["done"],i);let o=ew(e,["error"]);null!=o&&eE(t,["error"],o);let s=ew(e,["response"]);return null!=s&&eE(t,["response"],function(e){let t={},r=ew(e,["sdkHttpResponse"]);null!=r&&eE(t,["sdkHttpResponse"],r);let n=ew(e,["parent"]);null!=n&&eE(t,["parent"],n);let i=ew(e,["documentName"]);return null!=i&&eE(t,["documentName"],i),t}(s)),t}(e),r=new e$;return Object.assign(r,t),r})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let rh=function(){let{crypto:e}=globalThis;if(null==e?void 0:e.randomUUID)return rh=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^r()&15>>+e/4).toString(16))},rf=()=>rh();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function rm(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let rg=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch(e){}try{return Error(JSON.stringify(e))}catch(e){}}return Error(e)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ry extends Error{}class rv extends ry{constructor(e,t,r,n){super(`${rv.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.error=t}static makeMessage(e,t,r){let n=(null==t?void 0:t.message)?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){return e&&n?400===e?new rw(e,t,r,n):401===e?new rx(e,t,r,n):403===e?new rS(e,t,r,n):404===e?new rT(e,t,r,n):409===e?new rA(e,t,r,n):422===e?new rC(e,t,r,n):429===e?new rO(e,t,r,n):e>=500?new rI(e,t,r,n):new rv(e,t,r,n):new r_({message:r,cause:rg(t)})}}class rb extends rv{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class r_ extends rv{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class rE extends r_{constructor({message:e}={}){super({message:null!=e?e:"Request timed out."})}}class rw extends rv{}class rx extends rv{}class rS extends rv{}class rT extends rv{}class rA extends rv{}class rC extends rv{}class rO extends rv{}class rI extends rv{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let rN=/^[a-z][a-z0-9+.-]*:/i,rk=e=>rN.test(e),rR=e=>(rR=Array.isArray)(e),rP=rR,rj=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new ry(`${e} must be an integer`);if(t<0)throw new ry(`${e} must be a positive integer`);return t},rM=e=>{try{return JSON.parse(e)}catch(e){return}},rD=e=>new Promise(t=>setTimeout(t,e)),rU="0.0.1",rL=()=>{var e,t,r,n,i;let o="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":rF(Deno.build.os),"X-Stainless-Arch":rG(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:null!==(t=null===(e=Deno.version)||void 0===e?void 0:e.deno)&&void 0!==t?t:"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===o)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":rF(null!==(r=globalThis.process.platform)&&void 0!==r?r:"unknown"),"X-Stainless-Arch":rG(null!==(n=globalThis.process.arch)&&void 0!==n?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":null!==(i=globalThis.process.version)&&void 0!==i?i:"unknown"};let s=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,n=r[2]||0,i=r[3]||0;return{browser:e,version:`${t}.${n}.${i}`}}}return null}();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},rG=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",rF=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",rq=()=>null!=n?n:n=rL();function rB(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function rH(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return(null==e?void 0:e.done)&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function rV(e){var t,r;if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await (null===(r=(t=e[Symbol.asyncIterator]()).return)||void 0===r?void 0:r.call(t));return}let n=e.getReader(),i=n.cancel();n.releaseLock(),await i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let r$=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),rz=()=>{var e;if("undefined"==typeof File){let{process:t}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof(null===(e=null==t?void 0:t.versions)||void 0===e?void 0:e.node)&&20>parseInt(t.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function rJ(e,t,r){return rz(),new File(e,null!=t?t:"unknown_file",r)}let rW=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],rK=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,rY=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&rK(e),rX=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function rZ(e,t,r){var n;if(rz(),rY(e=await e))return e instanceof File?e:rJ([await e.arrayBuffer()],e.name);if(rX(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),rJ(await rQ(n),t,r)}let i=await rQ(e);if(t||(t=("object"==typeof(n=e)&&null!==n&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0),!(null==r?void 0:r.type)){let e=i.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(r=Object.assign(Object.assign({},r),{type:e}))}return rJ(i,t,r)}async function rQ(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(rK(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(rW(e))try{for(var r,n,i,o,s,a,l=!0,c=tN(e);!(r=(a=await c.next()).done);l=!0)o=a.value,l=!1,t.push(...await rQ(o))}catch(e){n={error:e}}finally{try{!l&&!r&&(i=c.return)&&await i.call(c)}finally{if(n)throw n.error}}else{let t=null===(s=null==e?void 0:e.constructor)||void 0===s?void 0:s.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class r0{constructor(e){this._client=e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function r1(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}r0._key=[];let r2=Object.freeze(Object.create(null)),r4=((e=r1)=>function(t,...r){let n;if(1===t.length)return t[0];let i=!1,o=[],s=t.reduce((t,n,s)=>{var a,l,c;/[?#]/.test(n)&&(i=!0);let u=r[s],d=(i?encodeURIComponent:e)(""+u);return s!==r.length&&(null==u||"object"==typeof u&&u.toString===(null===(c=Object.getPrototypeOf(null!==(l=Object.getPrototypeOf(null!==(a=u.hasOwnProperty)&&void 0!==a?a:r2))&&void 0!==l?l:r2))||void 0===c?void 0:c.toString))&&(d=u+"",o.push({start:t.length+n.length,length:d.length,error:`Value of type ${Object.prototype.toString.call(u).slice(8,-1)} is not a valid path parameter`})),t+n+(s===r.length?"":d)},""),a=s.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(a));)o.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(o.sort((e,t)=>e.start-t.start),o.length>0){let e=0,t=o.reduce((t,r)=>{let n=" ".repeat(r.start-e),i="^".repeat(r.length);return e=r.start+r.length,t+n+i},"");throw new ry(`Path parameters result in path with invalid segments:
${o.map(e=>e.error).join("\n")}
${s}
${t}`)}return s})(r1);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class r5 extends r0{create(e,t){var r;let{api_version:n=this._client.apiVersion}=e,i=tC(e,["api_version"]);if("model"in i&&"agent_config"in i)throw new ry("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in i&&"generation_config"in i)throw new ry("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(r4`/${n}/interactions`,Object.assign(Object.assign({body:i},t),{stream:null!==(r=e.stream)&&void 0!==r&&r}))}delete(e,t={},r){let{api_version:n=this._client.apiVersion}=null!=t?t:{};return this._client.delete(r4`/${n}/interactions/${e}`,r)}cancel(e,t={},r){let{api_version:n=this._client.apiVersion}=null!=t?t:{};return this._client.post(r4`/${n}/interactions/${e}/cancel`,r)}get(e,t={},r){var n;let i=null!=t?t:{},{api_version:o=this._client.apiVersion}=i,s=tC(i,["api_version"]);return this._client.get(r4`/${o}/interactions/${e}`,Object.assign(Object.assign({query:s},r),{stream:null!==(n=null==t?void 0:t.stream)&&void 0!==n&&n}))}}r5._key=Object.freeze(["interactions"]);class r3 extends r5{}function r6(e){let t;return(null!=i?i:i=(t=new globalThis.TextEncoder).encode.bind(t))(e)}function r8(e){let t;return(null!=o?o:o=(t=new globalThis.TextDecoder).decode.bind(t))(e)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class r7{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?r6(e):e;this.buffer=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e){let t=0;for(let r of e)t+=r.length;let r=new Uint8Array(t),n=0;for(let t of e)r.set(t,n),n+=t.length;return r}([this.buffer,r]);let n=[];for(;null!=(t=function(e,t){for(let r=null!=t?t:0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(this.buffer,this.carriageReturnIndex));){if(t.carriage&&null==this.carriageReturnIndex){this.carriageReturnIndex=t.index;continue}if(null!=this.carriageReturnIndex&&(t.index!==this.carriageReturnIndex+1||t.carriage)){n.push(r8(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}let e=null!==this.carriageReturnIndex?t.preceding-1:t.preceding,r=r8(this.buffer.subarray(0,e));n.push(r),this.buffer=this.buffer.subarray(t.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode("\n"):[]}}r7.NEWLINE_CHARS=new Set(["\n","\r"]),r7.NEWLINE_REGEXP=/\r\n|[\n\r]/g;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let r9={off:0,error:200,warn:300,info:400,debug:500},ne=(e,t,r)=>{if(e){if(Object.prototype.hasOwnProperty.call(r9,e))return e;no(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(r9))}`)}};function nt(){}function nr(e,t,r){return!t||r9[e]>r9[r]?nt:t[e].bind(t)}let nn={error:nt,warn:nt,info:nt,debug:nt},ni=new WeakMap;function no(e){var t;let r=e.logger,n=null!==(t=e.logLevel)&&void 0!==t?t:"off";if(!r)return nn;let i=ni.get(r);if(i&&i[0]===n)return i[1];let o={error:nr("error",r,n),warn:nr("warn",r,n),info:nr("info",r,n),debug:nr("debug",r,n)};return ni.set(r,[n,o]),o}let ns=e=>(e.options&&(e.options=Object.assign({},e.options),delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-goog-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class na{constructor(e,t,r){this.iterator=e,this.controller=t,this.client=r}static fromSSEResponse(e,t,r){let n=!1,i=r?no(r):console;return new na(function(){return tI(this,arguments,function*(){var r,o,s,a;if(n)throw new ry("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let l=!1;try{try{for(var c,u=!0,d=tN(function(e,t){return tI(this,arguments,function*(){var r,n,i,o;if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new ry("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new ry("Attempted to iterate over a response with no body")}let s=new nl,a=new r7,l=rH(e.body);try{for(var c,u=!0,d=tN(function(e){return tI(this,arguments,function*(){var t,r,n,i;let o=new Uint8Array;try{for(var s,a=!0,l=tN(e);!(t=(s=yield tO(l.next())).done);a=!0){let e;if(i=s.value,a=!1,null==i)continue;let t=i instanceof ArrayBuffer?new Uint8Array(i):"string"==typeof i?r6(i):i,r=new Uint8Array(o.length+t.length);for(r.set(o),r.set(t,o.length),o=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(o));)yield yield tO(o.slice(0,e)),o=o.slice(e)}}catch(e){r={error:e}}finally{try{!a&&!t&&(n=l.return)&&(yield tO(n.call(l)))}finally{if(r)throw r.error}}o.length>0&&(yield yield tO(o))})}(l));!(r=(c=yield tO(d.next())).done);u=!0)for(let e of(o=c.value,u=!1,a.decode(o))){let t=s.decode(e);t&&(yield yield tO(t))}}catch(e){n={error:e}}finally{try{!u&&!r&&(i=d.return)&&(yield tO(i.call(d)))}finally{if(n)throw n.error}}for(let e of a.flush()){let t=s.decode(e);t&&(yield yield tO(t))}})}(e,t));!(r=(c=yield tO(d.next())).done);u=!0)if(a=c.value,u=!1,!l){if(a.data.startsWith("[DONE]")){l=!0;continue}try{yield yield tO(JSON.parse(a.data))}catch(e){throw i.error("Could not parse message into JSON:",a.data),i.error("From chunk:",a.raw),e}}}catch(e){o={error:e}}finally{try{!u&&!r&&(s=d.return)&&(yield tO(s.call(d)))}finally{if(o)throw o.error}}l=!0}catch(e){if(rm(e))return yield tO(void 0);throw e}finally{l||t.abort()}})},t,r)}static fromReadableStream(e,t,r){let n=!1;return new na(function(){return tI(this,arguments,function*(){var r,i,o,s;if(n)throw new ry("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{try{for(var l,c=!0,u=tN(function(){return tI(this,arguments,function*(){var t,r,n,i;let o=new r7,s=rH(e);try{for(var a,l=!0,c=tN(s);!(t=(a=yield tO(c.next())).done);l=!0)for(let e of(i=a.value,l=!1,o.decode(i)))yield yield tO(e)}catch(e){r={error:e}}finally{try{!l&&!t&&(n=c.return)&&(yield tO(n.call(c)))}finally{if(r)throw r.error}}for(let e of o.flush())yield yield tO(e)})}());!(r=(l=yield tO(u.next())).done);c=!0)s=l.value,c=!1,!a&&s&&(yield yield tO(JSON.parse(s)))}catch(e){i={error:e}}finally{try{!c&&!r&&(o=u.return)&&(yield tO(o.call(u)))}finally{if(i)throw i.error}}a=!0}catch(e){if(rm(e))return yield tO(void 0);throw e}finally{a||t.abort()}})},t,r)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new na(()=>n(e),this.controller,this.client),new na(()=>n(t),this.controller,this.client)]}toReadableStream(){let e;let t=this;return rB({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:r,done:n}=await e.next();if(n)return t.close();let i=r6(JSON.stringify(r)+"\n");t.enqueue(i)}catch(e){t.error(e)}},async cancel(){var t;await (null===(t=e.return)||void 0===t?void 0:t.call(e))}})}}class nl{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){let r=e.indexOf(":");return -1!==r?[e.substring(0,r),":",e.substring(r+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function nc(e,t){let{response:r,requestLogID:n,retryOfRequestLogID:i,startTime:o}=t,s=await (async()=>{var n;if(t.options.stream)return(no(e).debug("response",r.status,r.url,r.headers,r.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(r,t.controller,e):na.fromSSEResponse(r,t.controller,e);if(204===r.status)return null;if(t.options.__binaryResponse)return r;let i=r.headers.get("content-type"),o=null===(n=null==i?void 0:i.split(";")[0])||void 0===n?void 0:n.trim();return(null==o?void 0:o.includes("application/json"))||(null==o?void 0:o.endsWith("+json"))?await r.json():await r.text()})();return no(e).debug(`[${n}] response parsed`,ns({retryOfRequestLogID:i,url:r.url,status:r.status,body:s,durationMs:Date.now()-o})),s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nu extends Promise{constructor(e,t,r=nc){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=r,this.client=e}_thenUnwrap(e){return new nu(this.client,this.responsePromise,async(t,r)=>e(await this.parseResponse(t,r),r))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let nd=Symbol("brand.privateNullableHeaders"),np=e=>{let t=new Headers,r=new Set;for(let n of e){let e=new Set;for(let[i,o]of function*(e){let t;if(!e)return;if(nd in e){let{values:t,nulls:r}=e;for(let e of(yield*t.entries(),r))yield[e,null];return}let r=!1;for(let n of(e instanceof Headers?t=e.entries():rP(e)?t=e:(r=!0,t=Object.entries(null!=e?e:{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=rP(n[1])?n[1]:[n[1]],i=!1;for(let n of t)void 0!==n&&(r&&!i&&(i=!0,yield[e,null]),yield[e,n])}}(n)){let n=i.toLowerCase();e.has(n)||(t.delete(i),e.add(n)),null===o?(t.delete(i),r.add(n)):(t.append(i,o),r.delete(n))}}return{[nd]:!0,values:t,nulls:r}},nh=e=>{var t,r,n,i,o,s;return void 0!==globalThis.process?null!==(n=null===(r=null===(t=globalThis.process.env)||void 0===t?void 0:t[e])||void 0===r?void 0:r.trim())&&void 0!==n?n:void 0:void 0!==globalThis.Deno?null===(s=null===(o=null===(i=globalThis.Deno.env)||void 0===i?void 0:i.get)||void 0===o?void 0:o.call(i,e))||void 0===s?void 0:s.trim():void 0};class nf{constructor(e){var t,r,n,i,o,s,a,{baseURL:l=nh("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:c=null!==(t=nh("GEMINI_API_KEY"))&&void 0!==t?t:null,apiVersion:u="v1beta"}=e;let d=Object.assign(Object.assign({apiKey:c,apiVersion:u},tC(e,["baseURL","apiKey","apiVersion"])),{baseURL:l||"https://generativelanguage.googleapis.com"});this.baseURL=d.baseURL,this.timeout=null!==(r=d.timeout)&&void 0!==r?r:nf.DEFAULT_TIMEOUT,this.logger=null!==(n=d.logger)&&void 0!==n?n:console;let p="warn";this.logLevel=p,this.logLevel=null!==(o=null!==(i=ne(d.logLevel,"ClientOptions.logLevel",this))&&void 0!==i?i:ne(nh("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))&&void 0!==o?o:p,this.fetchOptions=d.fetchOptions,this.maxRetries=null!==(s=d.maxRetries)&&void 0!==s?s:2,this.fetch=null!==(a=d.fetch)&&void 0!==a?a:/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),this.encoder=r$,this._options=d,this.apiKey=c,this.apiVersion=u,this.clientAdapter=d.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return"https://generativelanguage.googleapis.com"!==this.baseURL}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key")||this.apiKey&&e.get("x-goog-api-key")||t.has("x-goog-api-key")))throw Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){let t=np([e.headers]);return t.values.has("authorization")||t.values.has("x-goog-api-key")?void 0:this.apiKey?np([{"x-goog-api-key":this.apiKey}]):this.clientAdapter.isVertexAI()?np([await this.clientAdapter.getAuthHeaders()]):void 0}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new ry(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${rU}`}defaultIdempotencyKey(){return`stainless-node-retry-${rf()}`}makeStatusError(e,t,r,n){return rv.generate(e,t,r,n)}buildURL(e,t,r){let n=!this.baseURLOverridden()&&r||this.baseURL,i=new URL(rk(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(o)&&(t=Object.assign(Object.assign({},o),t)),"object"==typeof t&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){let t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>Object.assign({method:e,path:t},r)))}request(e,t=null){return new nu(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){var n,i,o;let s=await e,a=null!==(n=s.maxRetries)&&void 0!==n?n:this.maxRetries;null==t&&(t=a),await this.prepareOptions(s);let{req:l,url:c,timeout:u}=await this.buildRequest(s,{retryCount:a-t});await this.prepareRequest(l,{url:c,options:s});let d="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),p=void 0===r?"":`, retryOf: ${r}`,h=Date.now();if(no(this).debug(`[${d}] sending request`,ns({retryOfRequestLogID:r,method:s.method,url:c,options:s,headers:l.headers})),null===(i=s.signal)||void 0===i?void 0:i.aborted)throw new rb;let f=new AbortController,m=await this.fetchWithTimeout(c,l,u,f).catch(rg),g=Date.now();if(m instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(null===(o=s.signal)||void 0===o?void 0:o.aborted)throw new rb;let n=rm(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(t)return no(this).info(`[${d}] connection ${n?"timed out":"failed"} - ${e}`),no(this).debug(`[${d}] connection ${n?"timed out":"failed"} (${e})`,ns({retryOfRequestLogID:r,url:c,durationMs:g-h,message:m.message})),this.retryRequest(s,t,null!=r?r:d);if(no(this).info(`[${d}] connection ${n?"timed out":"failed"} - error; no more retries left`),no(this).debug(`[${d}] connection ${n?"timed out":"failed"} (error; no more retries left)`,ns({retryOfRequestLogID:r,url:c,durationMs:g-h,message:m.message})),n)throw new rE;throw new r_({cause:m})}let y=`[${d}${p}] ${l.method} ${c} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${g-h}ms`;if(!m.ok){let e=await this.shouldRetry(m);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await rV(m.body),no(this).info(`${y} - ${e}`),no(this).debug(`[${d}] response error (${e})`,ns({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,durationMs:g-h})),this.retryRequest(s,t,null!=r?r:d,m.headers)}let n=e?"error; no more retries left":"error; not retryable";no(this).info(`${y} - ${n}`);let i=await m.text().catch(e=>rg(e).message),o=rM(i),a=o?void 0:i;throw no(this).debug(`[${d}] response error (${n})`,ns({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,message:a,durationMs:Date.now()-h})),this.makeStatusError(m.status,o,a,m.headers)}return no(this).info(y),no(this).debug(`[${d}] response start`,ns({retryOfRequestLogID:r,url:m.url,status:m.status,headers:m.headers,durationMs:g-h})),{response:m,options:s,controller:f,requestLogID:d,retryOfRequestLogID:r,startTime:h}}async fetchWithTimeout(e,t,r,n){let i=t||{},{signal:o,method:s}=i,a=tC(i,["signal","method"]);o&&o.addEventListener("abort",()=>n.abort());let l=setTimeout(()=>n.abort(),r),c=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,u=Object.assign(Object.assign(Object.assign({signal:n.signal},c?{duplex:"half"}:{}),{method:"GET"}),a);s&&(u.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,u)}finally{clearTimeout(l)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r,n){var i;let o;let s=null==n?void 0:n.get("retry-after-ms");if(s){let e=parseFloat(s);Number.isNaN(e)||(o=e)}let a=null==n?void 0:n.get("retry-after");if(a&&!o){let e=parseFloat(a);o=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(o&&0<=o&&o<6e4)){let r=null!==(i=e.maxRetries)&&void 0!==i?i:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,r)}return await rD(o),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){var r,n,i;let o=Object.assign({},e),{method:s,path:a,query:l,defaultBaseURL:c}=o,u=this.buildURL(a,l,c);"timeout"in o&&rj("timeout",o.timeout),o.timeout=null!==(r=o.timeout)&&void 0!==r?r:this.timeout;let{bodyHeaders:d,body:p}=this.buildBody({options:o}),h=await this.buildHeaders({options:e,method:s,bodyHeaders:d,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:s,headers:h},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&p instanceof globalThis.ReadableStream&&{duplex:"half"}),p&&{body:p}),null!==(n=this.fetchOptions)&&void 0!==n?n:{}),null!==(i=o.fetchOptions)&&void 0!==i?i:{}),url:u,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:n}){let i={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let o=await this.authHeaders(e),s=np([i,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),rq()),this._options.defaultHeaders,r,e.headers,o]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=np([t]);if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream)return{bodyHeaders:void 0,body:e};if("object"!=typeof e||!(Symbol.asyncIterator in e)&&(!(Symbol.iterator in e)||!("next"in e)||"function"!=typeof e.next))return this.encoder({body:e,headers:r});{let t;return{bodyHeaders:void 0,body:(t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator](),rB({start(){},async pull(e){let{done:r,value:n}=await t.next();r?e.close():e.enqueue(n)},async cancel(){var e;await (null===(e=t.return)||void 0===e?void 0:e.call(t))}}))}}}}nf.DEFAULT_TIMEOUT=6e4;class nm extends nf{constructor(){super(...arguments),this.interactions=new r3(this)}}nm.GeminiNextGenAPIClient=nm,nm.GeminiNextGenAPIClientError=ry,nm.APIError=rv,nm.APIConnectionError=r_,nm.APIConnectionTimeoutError=rE,nm.APIUserAbortError=rb,nm.NotFoundError=rT,nm.ConflictError=rA,nm.RateLimitError=rO,nm.BadRequestError=rw,nm.AuthenticationError=rx,nm.InternalServerError=rI,nm.PermissionDeniedError=rS,nm.UnprocessableEntityError=rC,nm.toFile=rZ,nm.Interactions=r3;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let ng="x-goog-api-key",ny="https://www.googleapis.com/auth/cloud-platform";class nv{constructor(e){if(void 0!==e.apiKey){this.apiKey=e.apiKey;return}let t=function(e){if(!e)return{scopes:[ny]};if(e.scopes){if("string"==typeof e.scopes&&e.scopes!==ny||Array.isArray(e.scopes)&&0>e.scopes.indexOf(ny))throw Error(`Invalid auth scopes. Scopes must include: ${ny}`)}else e.scopes=[ny];return e}(e.googleAuthOptions);this.googleAuth=new ep.GoogleAuth(t)}async addAuthHeaders(e,t){if(void 0!==this.apiKey){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,t)}addKeyHeader(e){if(null===e.get(ng)){if(void 0===this.apiKey)throw Error("Trying to set API key header but apiKey is not set");e.append(ng,this.apiKey)}}async addGoogleAuthHeaders(e,t){if(void 0===this.googleAuth)throw Error("Trying to set google-auth headers but googleAuth is unset");for(let[r,n]of(await this.googleAuth.getRequestHeaders(t)))null===e.get(r)&&e.append(r,n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nb{async download(e,t){if(e.downloadPath){let r=await n_(e,t);if(r instanceof eT){let t=(0,eh.createWriteStream)(e.downloadPath);em.Readable.fromWeb(r.responseInternal.body).pipe(t),await (0,eg.finished)(t)}else try{await (0,ef.writeFile)(e.downloadPath,r,{encoding:"base64"})}catch(t){throw Error(`Failed to write file to ${e.downloadPath}: ${t}`)}}}}async function n_(e,t){var r,n,i;let o=tp(e.file);if(void 0!==o)return await t.request({path:`files/${o}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal});if(tu(e.file)){let t=null===(i=e.file.video)||void 0===i?void 0:i.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download generated video, Uri or videoBytes not found.")}if(td(e.file)){let t=e.file.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download video, Uri or videoBytes not found.")}throw Error("Unsupported file type")}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nE{create(e,t,r){return new nw(e,t,r)}}class nw{constructor(e,t,r){this.url=e,this.headers=t,this.callbacks=r}connect(){this.ws=new ey.WebSocket(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}function nx(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["name"]);null!=i&&eE(r,["name"],i);let o=ew(e,["state"]);null!=o&&eE(r,["state"],tc(o));let s=ew(e,["createTime"]);null!=s&&eE(r,["createTime"],s);let a=ew(e,["tuningTask","startTime"]);null!=a&&eE(r,["startTime"],a);let l=ew(e,["tuningTask","completeTime"]);null!=l&&eE(r,["endTime"],l);let c=ew(e,["updateTime"]);null!=c&&eE(r,["updateTime"],c);let u=ew(e,["description"]);null!=u&&eE(r,["description"],u);let d=ew(e,["baseModel"]);null!=d&&eE(r,["baseModel"],d);let p=ew(e,["_self"]);return null!=p&&eE(r,["tunedModel"],function(e,t){let r={},n=ew(e,["name"]);null!=n&&eE(r,["model"],n);let i=ew(e,["name"]);return null!=i&&eE(r,["endpoint"],i),r}(p)),r}function nS(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["name"]);null!=i&&eE(r,["name"],i);let o=ew(e,["state"]);null!=o&&eE(r,["state"],tc(o));let s=ew(e,["createTime"]);null!=s&&eE(r,["createTime"],s);let a=ew(e,["startTime"]);null!=a&&eE(r,["startTime"],a);let l=ew(e,["endTime"]);null!=l&&eE(r,["endTime"],l);let c=ew(e,["updateTime"]);null!=c&&eE(r,["updateTime"],c);let u=ew(e,["error"]);null!=u&&eE(r,["error"],u);let d=ew(e,["description"]);null!=d&&eE(r,["description"],d);let p=ew(e,["baseModel"]);null!=p&&eE(r,["baseModel"],p);let h=ew(e,["tunedModel"]);null!=h&&eE(r,["tunedModel"],h);let f=ew(e,["preTunedModel"]);null!=f&&eE(r,["preTunedModel"],f);let m=ew(e,["supervisedTuningSpec"]);null!=m&&eE(r,["supervisedTuningSpec"],m);let g=ew(e,["preferenceOptimizationSpec"]);null!=g&&eE(r,["preferenceOptimizationSpec"],g);let y=ew(e,["tuningDataStats"]);null!=y&&eE(r,["tuningDataStats"],y);let v=ew(e,["encryptionSpec"]);null!=v&&eE(r,["encryptionSpec"],v);let b=ew(e,["partnerModelTuningSpec"]);null!=b&&eE(r,["partnerModelTuningSpec"],b);let _=ew(e,["customBaseModel"]);null!=_&&eE(r,["customBaseModel"],_);let E=ew(e,["experiment"]);null!=E&&eE(r,["experiment"],E);let w=ew(e,["labels"]);null!=w&&eE(r,["labels"],w);let x=ew(e,["outputUri"]);null!=x&&eE(r,["outputUri"],x);let S=ew(e,["pipelineJob"]);null!=S&&eE(r,["pipelineJob"],S);let T=ew(e,["serviceAccount"]);null!=T&&eE(r,["serviceAccount"],T);let A=ew(e,["tunedModelDisplayName"]);null!=A&&eE(r,["tunedModelDisplayName"],A);let C=ew(e,["veoTuningSpec"]);return null!=C&&eE(r,["veoTuningSpec"],C),r}function nT(e,t){let r={},n=ew(e,["gcsUri"]);null!=n&&eE(r,["validationDatasetUri"],n);let i=ew(e,["vertexDatasetResource"]);return null!=i&&eE(r,["validationDatasetUri"],i),r}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nA extends eb{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tx(ed.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.get=async e=>await this.getInternal(e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI()){if(e.baseModel.startsWith("projects/")){let r={tunedModelName:e.baseModel};(null===(t=e.config)||void 0===t?void 0:t.preTunedModelCheckpointId)&&(r.checkpointId=e.config.preTunedModelCheckpointId);let n=Object.assign(Object.assign({},e),{preTunedModel:r});return n.baseModel=void 0,await this.tuneInternal(n)}{let t=Object.assign({},e);return await this.tuneInternal(t)}}{let t=Object.assign({},e),r=await this.tuneMldevInternal(t),n="";return void 0!==r.metadata&&void 0!==r.metadata.tunedModel?n=r.metadata.tunedModel:void 0!==r.name&&r.name.includes("/operations/")&&(n=r.name.split("/operations/")[0]),{name:n,state:P.JOB_STATE_QUEUED}}}}async getInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(e,["name"]);return null!=n&&eE(r,["_url","name"],n),r}(e);return o=e_("{name}",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nS(e))}{let t=function(e,t){let r={},n=ew(e,["name"]);return null!=n&&eE(r,["_url","name"],n),r}(e);return o=e_("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nx(e))}}async listInternal(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(e,["config"]);return null!=n&&function(e,t,r){let n=ew(e,["pageSize"]);void 0!==t&&null!=n&&eE(t,["_query","pageSize"],n);let i=ew(e,["pageToken"]);void 0!==t&&null!=i&&eE(t,["_query","pageToken"],i);let o=ew(e,["filter"]);void 0!==t&&null!=o&&eE(t,["_query","filter"],o)}(n,r),r}(e);return o=e_("tuningJobs",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["nextPageToken"]);null!=i&&eE(r,["nextPageToken"],i);let o=ew(e,["tuningJobs"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>nS(e))),eE(r,["tuningJobs"],e)}return r}(e),r=new eL;return Object.assign(r,t),r})}{let t=function(e,t){let r={},n=ew(e,["config"]);return null!=n&&function(e,t,r){let n=ew(e,["pageSize"]);void 0!==t&&null!=n&&eE(t,["_query","pageSize"],n);let i=ew(e,["pageToken"]);void 0!==t&&null!=i&&eE(t,["_query","pageToken"],i);let o=ew(e,["filter"]);void 0!==t&&null!=o&&eE(t,["_query","filter"],o)}(n,r),r}(e);return o=e_("tunedModels",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["nextPageToken"]);null!=i&&eE(r,["nextPageToken"],i);let o=ew(e,["tunedModels"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>nx(e))),eE(r,["tuningJobs"],e)}return r}(e),r=new eL;return Object.assign(r,t),r})}}async cancel(e){var t,r,n,i;let o="",s={};if(this.apiClient.isVertexAI()){let n=function(e,t){let r={},n=ew(e,["name"]);return null!=n&&eE(r,["_url","name"],n),r}(e);return o=e_("{name}:cancel",n._url),s=n._query,delete n._url,delete n._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);return null!=n&&eE(r,["sdkHttpResponse"],n),r}(e),r=new eG;return Object.assign(r,t),r})}{let t=/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function(e,t){let r={},n=ew(e,["name"]);return null!=n&&eE(r,["_url","name"],n),r}(e);return o=e_("{name}:cancel",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);return null!=n&&eE(r,["sdkHttpResponse"],n),r}(e),r=new eG;return Object.assign(r,t),r})}}async tuneInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let r={},n=ew(e,["baseModel"]);null!=n&&eE(r,["baseModel"],n);let i=ew(e,["preTunedModel"]);null!=i&&eE(r,["preTunedModel"],i);let o=ew(e,["trainingDataset"]);null!=o&&function(e,t,r){let n=ew(r,["config","method"]);if(void 0===n&&(n="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===n){let r=ew(e,["gcsUri"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","trainingDatasetUri"],r)}else if("PREFERENCE_TUNING"===n){let r=ew(e,["gcsUri"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","trainingDatasetUri"],r)}let i=ew(r,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let r=ew(e,["vertexDatasetResource"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","trainingDatasetUri"],r)}else if("PREFERENCE_TUNING"===i){let r=ew(e,["vertexDatasetResource"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","trainingDatasetUri"],r)}if(void 0!==ew(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(o,r,t);let s=ew(e,["config"]);return null!=s&&function(e,t,r){let n=ew(r,["config","method"]);if(void 0===n&&(n="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===n){let r=ew(e,["validationDataset"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec"],nT(r))}else if("PREFERENCE_TUNING"===n){let r=ew(e,["validationDataset"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec"],nT(r))}let i=ew(e,["tunedModelDisplayName"]);void 0!==t&&null!=i&&eE(t,["tunedModelDisplayName"],i);let o=ew(e,["description"]);void 0!==t&&null!=o&&eE(t,["description"],o);let s=ew(r,["config","method"]);if(void 0===s&&(s="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===s){let r=ew(e,["epochCount"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","hyperParameters","epochCount"],r)}else if("PREFERENCE_TUNING"===s){let r=ew(e,["epochCount"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],r)}let a=ew(r,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){let r=ew(e,["learningRateMultiplier"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],r)}else if("PREFERENCE_TUNING"===a){let r=ew(e,["learningRateMultiplier"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],r)}let l=ew(r,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){let r=ew(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","exportLastCheckpointOnly"],r)}else if("PREFERENCE_TUNING"===l){let r=ew(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],r)}let c=ew(r,["config","method"]);if(void 0===c&&(c="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===c){let r=ew(e,["adapterSize"]);void 0!==t&&null!=r&&eE(t,["supervisedTuningSpec","hyperParameters","adapterSize"],r)}else if("PREFERENCE_TUNING"===c){let r=ew(e,["adapterSize"]);void 0!==t&&null!=r&&eE(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],r)}if(void 0!==ew(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==ew(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let u=ew(e,["labels"]);void 0!==t&&null!=u&&eE(t,["labels"],u);let d=ew(e,["beta"]);void 0!==t&&null!=d&&eE(t,["preferenceOptimizationSpec","hyperParameters","beta"],d)}(s,r,t),r}(e,e);return n=e_("tuningJobs",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nS(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,r;let n="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e,t){let r={},n=ew(e,["baseModel"]);null!=n&&eE(r,["baseModel"],n);let i=ew(e,["preTunedModel"]);null!=i&&eE(r,["preTunedModel"],i);let o=ew(e,["trainingDataset"]);null!=o&&function(e,t){if(void 0!==ew(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==ew(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let r=ew(e,["examples"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),eE({},["examples","examples"],e)}}(o);let s=ew(e,["config"]);return null!=s&&function(e,t,r){if(void 0!==ew(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let n=ew(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=n&&eE(t,["displayName"],n),void 0!==ew(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let i=ew(e,["epochCount"]);void 0!==t&&null!=i&&eE(t,["tuningTask","hyperparameters","epochCount"],i);let o=ew(e,["learningRateMultiplier"]);if(null!=o&&eE({},["tuningTask","hyperparameters","learningRateMultiplier"],o),void 0!==ew(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==ew(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==ew(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let s=ew(e,["batchSize"]);void 0!==t&&null!=s&&eE(t,["tuningTask","hyperparameters","batchSize"],s);let a=ew(e,["learningRate"]);if(void 0!==t&&null!=a&&eE(t,["tuningTask","hyperparameters","learningRate"],a),void 0!==ew(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");if(void 0!==ew(e,["beta"]))throw Error("beta parameter is not supported in Gemini API.")}(s,r),r}(e);return n=e_("tunedModels",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:n,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e,t){let r={},n=ew(e,["sdkHttpResponse"]);null!=n&&eE(r,["sdkHttpResponse"],n);let i=ew(e,["name"]);null!=i&&eE(r,["name"],i);let o=ew(e,["metadata"]);null!=o&&eE(r,["metadata"],o);let s=ew(e,["done"]);null!=s&&eE(r,["done"],s);let a=ew(e,["error"]);return null!=a&&eE(r,["error"],a),r})(e))}}}let nC="x-goog-upload-status";async function nO(e,t,r){var n;let i=await nN(e,t,r),o=await (null==i?void 0:i.json());if((null===(n=null==i?void 0:i.headers)||void 0===n?void 0:n[nC])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return o.file}async function nI(e,t,r){var n;let i=await nN(e,t,r),o=await (null==i?void 0:i.json());if((null===(n=null==i?void 0:i.headers)||void 0===n?void 0:n[nC])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let s=eS(o),a=new eZ;return Object.assign(a,s),a}async function nN(e,t,r){var n,i;let o=0,s=0,a=new eT(new Response),l="upload";for(o=e.size;s<o;){let c=Math.min(8388608,o-s),u=e.slice(s,s+c);s+c>=o&&(l+=", finalize");let d=0,p=1e3;for(;d<3&&(null===(n=null==(a=await r.request({path:"",body:u,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(s),"Content-Length":String(c)}}}))?void 0:a.headers)||void 0===n||!n[nC]);)d++,await nR(p),p*=2;if(s+=c,(null===(i=null==a?void 0:a.headers)||void 0===i?void 0:i[nC])!=="active")break;if(o<=s)throw Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function nk(e){return{size:e.size,type:e.type}}function nR(e){return new Promise(t=>setTimeout(t,e))}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nP{async stat(e){let t={size:0,type:void 0};if("string"!=typeof e)return await nk(e);{let r=await ef.stat(e);return t.size=r.size,t.type=this.inferMimeType(e),t}}async upload(e,t,r){return"string"==typeof e?await this.uploadFileFromPath(e,t,r):nO(e,t,r)}async uploadToFileSearchStore(e,t,r){return"string"==typeof e?await this.uploadFileToFileSearchStoreFromPath(e,t,r):nI(e,t,r)}inferMimeType(e){return({aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"})[e.slice(e.lastIndexOf(".")+1).toLowerCase()]}async uploadFileFromPath(e,t,r){var n;let i=await this.uploadFileFromPathInternal(e,t,r),o=await (null==i?void 0:i.json());if((null===(n=null==i?void 0:i.headers)||void 0===n?void 0:n[nC])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return o.file}async uploadFileToFileSearchStoreFromPath(e,t,r){var n;let i=await this.uploadFileFromPathInternal(e,t,r),o=await (null==i?void 0:i.json());if((null===(n=null==i?void 0:i.headers)||void 0===n?void 0:n[nC])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let s=eS(o),a=new eZ;return Object.assign(a,s),a}async uploadFileFromPathInternal(e,t,r){var n,i;let o;let s=0,a=0,l=new eT(new Response),c="upload",u=ev.basename(e);try{if(!(o=await ef.open(e,"r")))throw Error("Failed to open file");for(s=(await o.stat()).size;a<s;){let e=Math.min(8388608,s-a);a+e>=s&&(c+=", finalize");let d=new Uint8Array(e),{bytesRead:p}=await o.read(d,0,e,a);if(p!==e)throw Error(`Failed to read ${e} bytes from file at offset ${a}. bytes actually read: ${p}`);let h=new Blob([d]),f=0,m=1e3;for(;f<3&&(l=await r.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(a),"Content-Length":String(p),"X-Goog-Upload-File-Name":u}}}),null===(n=null==l?void 0:l.headers)||void 0===n||!n[nC]);)f++,await nR(m),m*=2;if(a+=p,(null===(i=null==l?void 0:l.headers)||void 0===i?void 0:i[nC])!=="active")break;if(s<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}return l}finally{o&&await o.close()}}}class nj{get interactions(){if(void 0!==this._interactions)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");let e=this.httpOptions;(null==e?void 0:e.extraBody)&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");let t=new nm({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:null==e?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t,r,n,i,o,l;if((e.project||e.location)&&e.apiKey)throw Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=null!==(r=null!==(t=e.vertexai)&&void 0!==t?t:function(e){var t;return void 0!==(t=nM(e))&&"true"===t.toLowerCase()}("GOOGLE_GENAI_USE_VERTEXAI"))&&void 0!==r&&r;let c=function(){let e=nM("GOOGLE_API_KEY"),t=nM("GEMINI_API_KEY");return e&&t&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),e||t||void 0}(),u=nM("GOOGLE_CLOUD_PROJECT"),d=nM("GOOGLE_CLOUD_LOCATION");if(this.apiKey=null!==(n=e.apiKey)&&void 0!==n?n:c,this.project=null!==(i=e.project)&&void 0!==i?i:u,this.location=null!==(o=e.location)&&void 0!==o?o:d,!this.vertexai&&!this.apiKey)throw Error("API key must be set when using the Gemini API.");!e.vertexai||((null===(l=e.googleAuthOptions)||void 0===l?void 0:l.credentials)&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(u||d)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&c?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(u||d)&&c&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0),this.location||this.apiKey||(this.location="global"));let p=function(e,t,r,n){var i,o;if(!(null==e?void 0:e.baseUrl)){let e={geminiUrl:s,vertexUrl:a};return t?null!==(i=e.vertexUrl)&&void 0!==i?i:r:null!==(o=e.geminiUrl)&&void 0!==o?o:n}return e.baseUrl}(e.httpOptions,e.vertexai,nM("GOOGLE_VERTEX_BASE_URL"),nM("GOOGLE_GEMINI_BASE_URL"));p&&(e.httpOptions?e.httpOptions.baseUrl=p:e.httpOptions={baseUrl:p}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;let h=new nv({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new t2({auth:h,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:"gl-node/"+process.version,uploader:new nP,downloader:new nb}),this.models=new rl(this.apiClient),this.live=new rt(this.apiClient,h,new nE),this.batches=new tS(this.apiClient),this.chats=new tP(this.models,this.apiClient),this.caches=new tA(this.apiClient),this.files=new tD(this.apiClient),this.operations=new rc(this.apiClient),this.authTokens=new ru(this.apiClient),this.tunings=new nA(this.apiClient),this.fileSearchStores=new rp(this.apiClient)}}function nM(e){var t,r,n;return null!==(n=null===(r=null===(t=null==process?void 0:process.env)||void 0===t?void 0:t[e])||void 0===r?void 0:r.trim())&&void 0!==n?n:void 0}},87768:(e,t,r)=>{"use strict";r.d(t,{WebSocket:()=>n}),r(70013),r(66322),r(5167);var n=r(90286);r(11037)},64965:e=>{"use strict";e.exports=JSON.parse('{"name":"gaxios","version":"7.1.3","description":"A simple common HTTP client specifically for Google APIs and services.","main":"build/cjs/src/index.js","types":"build/cjs/src/index.d.ts","files":["build/"],"exports":{".":{"import":{"types":"./build/esm/src/index.d.ts","default":"./build/esm/src/index.js"},"require":{"types":"./build/cjs/src/index.d.ts","default":"./build/cjs/src/index.js"}}},"scripts":{"lint":"gts check --no-inline-config","test":"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000","compile":"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs","fix":"gts fix","prepare":"npm run compile","pretest":"npm run compile","webpack":"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js","docs":"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","prelint":"cd samples; npm link ../; npm install","clean":"gts clean"},"repository":{"type":"git","directory":"packages/gaxios","url":"https://github.com/googleapis/google-cloud-node-core.git"},"keywords":["google"],"engines":{"node":">=18"},"author":"Google, LLC","license":"Apache-2.0","devDependencies":{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6","assert":"^2.0.0","browserify":"^17.0.0","c8":"^10.0.0","cors":"^2.8.5","express":"^5.0.0","gts":"^6.0.0","is-docker":"^3.0.0","jsdoc":"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1","linkinator":"^6.1.2","mocha":"^11.1.0","multiparty":"^4.2.1","mv":"^2.1.1","ncp":"^2.0.0","nock":"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0","puppeteer":"^24.0.0","sinon":"^21.0.0","stream-browserify":"^3.0.0","tmp":"0.2.5","ts-loader":"^9.5.2","typescript":"^5.8.3","webpack":"^5.35.0","webpack-cli":"^6.0.1"},"dependencies":{"extend":"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2","rimraf":"^5.0.1"},"homepage":"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"}')},83674:e=>{"use strict";e.exports=JSON.parse('{"name":"gaxios","version":"7.1.3","description":"A simple common HTTP client specifically for Google APIs and services.","main":"build/cjs/src/index.js","types":"build/cjs/src/index.d.ts","files":["build/"],"exports":{".":{"import":{"types":"./build/esm/src/index.d.ts","default":"./build/esm/src/index.js"},"require":{"types":"./build/cjs/src/index.d.ts","default":"./build/cjs/src/index.js"}}},"scripts":{"lint":"gts check --no-inline-config","test":"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000","compile":"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs","fix":"gts fix","prepare":"npm run compile","pretest":"npm run compile","webpack":"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js","docs":"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","prelint":"cd samples; npm link ../; npm install","clean":"gts clean"},"repository":{"type":"git","directory":"packages/gaxios","url":"https://github.com/googleapis/google-cloud-node-core.git"},"keywords":["google"],"engines":{"node":">=18"},"author":"Google, LLC","license":"Apache-2.0","devDependencies":{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6","assert":"^2.0.0","browserify":"^17.0.0","c8":"^10.0.0","cors":"^2.8.5","express":"^5.0.0","gts":"^6.0.0","is-docker":"^3.0.0","jsdoc":"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1","linkinator":"^6.1.2","mocha":"^11.1.0","multiparty":"^4.2.1","mv":"^2.1.1","ncp":"^2.0.0","nock":"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0","puppeteer":"^24.0.0","sinon":"^21.0.0","stream-browserify":"^3.0.0","tmp":"0.2.5","ts-loader":"^9.5.2","typescript":"^5.8.3","webpack":"^5.35.0","webpack-cli":"^6.0.1"},"dependencies":{"extend":"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2","rimraf":"^5.0.1"},"homepage":"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"}')},8417:e=>{"use strict";e.exports=JSON.parse('{"name":"google-auth-library","version":"10.5.0","author":"Google Inc.","description":"Google APIs Authentication Client Library for Node.js","engines":{"node":">=18"},"main":"./build/src/index.js","types":"./build/src/index.d.ts","repository":"googleapis/google-auth-library-nodejs.git","keywords":["google","api","google apis","client","client library"],"dependencies":{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11","gaxios":"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0","gtoken":"^8.0.0","jws":"^4.0.0"},"devDependencies":{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0","c8":"^10.0.0","codecov":"^3.0.2","gts":"^6.0.0","is-docker":"^3.0.0","jsdoc":"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1","keypair":"^1.0.4","mocha":"^11.1.0","mv":"^2.1.1","ncp":"^2.0.0","nock":"^14.0.5","null-loader":"^4.0.0","puppeteer":"^24.0.0","sinon":"^21.0.0","ts-loader":"^8.0.0","typescript":"5.8.2","webpack":"^5.21.2","webpack-cli":"^4.0.0"},"files":["build/src","!build/src/**/*.map"],"scripts":{"test":"c8 mocha build/test","clean":"gts clean","prepare":"npm run compile","lint":"gts check --no-inline-config","compile":"tsc -p .","fix":"gts fix","pretest":"npm run compile -- --sourceMap","docs":"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap","webpack":"webpack","browser-test":"karma start","docs-test":"echo \'disabled until linkinator is fixed\'","predocs-test":"npm run docs","prelint":"cd samples; npm link ../; npm install"},"license":"Apache-2.0"}')},99830:e=>{"use strict";e.exports=JSON.parse('{"name":"google-auth-library","version":"10.5.0","author":"Google Inc.","description":"Google APIs Authentication Client Library for Node.js","engines":{"node":">=18"},"main":"./build/src/index.js","types":"./build/src/index.d.ts","repository":"googleapis/google-auth-library-nodejs.git","keywords":["google","api","google apis","client","client library"],"dependencies":{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11","gaxios":"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0","gtoken":"^8.0.0","jws":"^4.0.0"},"devDependencies":{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0","c8":"^10.0.0","codecov":"^3.0.2","gts":"^6.0.0","is-docker":"^3.0.0","jsdoc":"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1","keypair":"^1.0.4","mocha":"^11.1.0","mv":"^2.1.1","ncp":"^2.0.0","nock":"^14.0.5","null-loader":"^4.0.0","puppeteer":"^24.0.0","sinon":"^21.0.0","ts-loader":"^8.0.0","typescript":"5.8.2","webpack":"^5.21.2","webpack-cli":"^4.0.0"},"files":["build/src","!build/src/**/*.map"],"scripts":{"test":"c8 mocha build/test","clean":"gts clean","prepare":"npm run compile","lint":"gts check --no-inline-config","compile":"tsc -p .","fix":"gts fix","pretest":"npm run compile -- --sourceMap","docs":"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap","webpack":"webpack","browser-test":"karma start","docs-test":"echo \'disabled until linkinator is fixed\'","predocs-test":"npm run docs","prelint":"cd samples; npm link ../; npm install"},"license":"Apache-2.0"}')}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,49,509],()=>r(19037));module.exports=n})();