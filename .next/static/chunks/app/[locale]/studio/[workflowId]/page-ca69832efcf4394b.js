(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[856],{4551:function(e,t,a){Promise.resolve().then(a.bind(a,2512))},2512:function(e,t,a){"use strict";a.d(t,{default:function(){return th}});var s,i,r,n,l=a(7437),o=a(2265);(s=r||(r={})).PROMPT_INPUT="PROMPT_INPUT",s.IMAGE_GENERATOR="IMAGE_GENERATOR",s.STORYBOARD_GENERATOR="STORYBOARD_GENERATOR",s.VIDEO_GENERATOR="VIDEO_GENERATOR",s.VIDEO_ANALYZER="VIDEO_ANALYZER",s.IMAGE_EDITOR="IMAGE_EDITOR",s.AUDIO_GENERATOR="AUDIO_GENERATOR",s.SCRIPT_MASTER="SCRIPT_MASTER",(i=n||(n={})).IDLE="IDLE",i.WORKING="WORKING",i.SUCCESS="SUCCESS",i.ERROR="ERROR";var c=a(1106),d=a(7063),u=a(518),x=a(7592),h=a(4392),p=a(2421),m=a(9590),g=a(3541),b=a(9451),f=a(6706),v=a(233),w=a(3014),y=a(3274),j=a(1432),N=a(883),k=a(6044),E=a(9289),R=a(7164),S=a(6569),C=a(36),A=a(8604),T=a(4697),z=a(2513),O=a(4315),M=a(8954),I=a(2990),D=a(7422),Z=a(4863),P=a(3907),_=a(2940),G=a(3146),U=a(933),L=a(5430);let F=e=>{switch(e){case r.IMAGE_GENERATOR:case r.STORYBOARD_GENERATOR:return[{id:"gemini-3-pro-image-preview",label:"Nano Banana Pro"},{id:"gemini-2.5-flash-image",label:"Nano Banana"}];case r.VIDEO_GENERATOR:return[{id:"veo-3.1-fast-generate-preview",label:"Veo 3.1 Fast"},{id:"veo-3.1-generate-preview",label:"Veo 3.1 High Quality"}];case r.SCRIPT_MASTER:case r.PROMPT_INPUT:case r.VIDEO_ANALYZER:case r.AUDIO_GENERATOR:default:return[{id:"gemini-3-pro-preview",label:"Gemini 3 Pro"},{id:"gemini-3-flash-preview",label:"Gemini 3"}]}},V=["4:3","9:16","16:9","21:9"],Y=["9:16","16:9"],W=["720P","1080P","2K"],B=["720P","1080P","4K"],K=[5,10,15],X=[{id:"zoom_in",label:"推镜头",icon:c.Z,prompt:"Slowly zoom in towards the subject."},{id:"zoom_out",label:"拉镜头",icon:d.Z,prompt:"Slowly zoom out from the subject."},{id:"pan_left",label:"左移",icon:u.Z,prompt:"Pan the camera to the left."},{id:"pan_right",label:"右移",icon:x.Z,prompt:"Pan the camera to the right."},{id:"tilt_up",label:"上摇",icon:h.Z,prompt:"Tilt the camera upwards."},{id:"tilt_down",label:"下摇",icon:p.Z,prompt:"Tilt the camera downwards."},{id:"orbital",label:"环绕",icon:m.Z,prompt:"360 degree orbital camera movement around the subject."},{id:"crane",label:"升降",icon:g.Z,prompt:"Vertical crane shot moving upwards."}],H=(0,o.memo)(e=>{var t;let{node:s,onUpdate:i,onAction:d,onDelete:u,onExpand:x,onCrop:h,onNodeMouseDown:m,onPortMouseDown:g,onPortMouseUp:H,onNodeContextMenu:J,onResizeMouseDown:q,isSelected:$,onSelect:Q,onSaveCharacter:ee}=e,et=s.status===n.WORKING,ea=(0,o.useRef)(null),[es,ei]=(0,o.useState)(!1),[er,en]=(0,o.useState)(!1),[el,eo]=(0,o.useState)(s.data.prompt||""),[ec,ed]=(0,o.useState)(!1),eu=(0,o.useCallback)(async()=>{if(el.trim()&&!ec){ed(!0);try{let{expandVisualDescription:e}=await Promise.resolve().then(a.bind(a,4317)),t=await e(el,"gemini-3-flash-preview");eo(t),i(s.id,{prompt:t})}catch(e){console.error("Prompt enhancement failed",e)}finally{ed(!1)}}},[el,ec,i,s.id]),ex=(0,o.useCallback)(e=>{let t=e.target;if(null==t?void 0:t.closest('[data-node-control="true"]')){e.stopPropagation(),null==Q||Q(s.id);return}m(e,s.id)},[s.id,m,Q]),[eh,ep]=(0,o.useState)(!1),[em,eg]=(0,o.useState)(!1),[eb,ef]=(0,o.useState)(!1),[ev,ew]=(0,o.useState)(!1),[ey,ej]=(0,o.useState)(!1),[eN,ek]=(0,o.useState)(!1),eE=eh||em||eb||ev||ey||eN,eR=(0,o.useRef)(null),eS=(0,o.useCallback)(e=>{e.stopPropagation()},[]);(0,o.useEffect)(()=>{eo(s.data.prompt||"")},[s.data.prompt]);let eC=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image",a=e.target.files;if(a&&0!==a.length){if("sourceScript"===t){let t=a[0],r=new FileReader;r.onload=e=>{var t;let a=null===(t=e.target)||void 0===t?void 0:t.result;i(s.id,{displayResult:a})},r.readAsText(t),e.target.value="";return}if(s.type===r.IMAGE_GENERATOR&&"I2I"===s.data.imageMode||s.type===r.VIDEO_GENERATOR&&"T2V"!==s.data.videoMode){let e=[...s.data.images||[]];for(let t=0;t<a.length;t++){let s=a[t],i=new FileReader,r=await new Promise(e=>{i.onload=t=>{var a;return e(null===(a=t.target)||void 0===a?void 0:a.result)},i.readAsDataURL(s)});e.push(r)}i(s.id,{images:e.slice(0,5),image:e[0]})}else{let e=a[0],t=new FileReader;t.onload=e=>{var t;let a=null===(t=e.target)||void 0===t?void 0:t.result,r=new Image;r.onload=()=>{let e=r.naturalWidth/r.naturalHeight;i(s.id,{image:a,images:[a]},{width:420,height:Math.max(380,420/e)})},r.src=a},t.readAsDataURL(e)}e.target.value=""}},eA=e=>{e.preventDefault();let t=e.dataTransfer.getData("assetType"),a=e.dataTransfer.getData("assetSrc");if(a){if(s.type===r.IMAGE_GENERATOR){if("I2I"===s.data.imageMode){let e=s.data.images||[];e.includes(a)||i(s.id,{images:[...e,a].slice(0,5),image:a})}else i(s.id,{image:a,images:[a]})}else if(s.type===r.VIDEO_GENERATOR){if("image"===t){if("T2V"===(s.data.videoMode||"T2V"))i(s.id,{videoMode:"I2V",image:a,images:[a]});else if("FIRST_LAST_FRAME"===s.data.generationMode)i(s.id,{lastFrameImage:a});else{let e=s.data.images||[];i(s.id,{images:[...e,a].slice(0,3),image:a})}}else"video"===t&&i(s.id,{videoUri:a})}}},eT=e=>{let t;let a="png";if(s.type===r.VIDEO_GENERATOR?(t=s.data.videoUri,a="mp4"):(t=s.data.image,a="png"),!t)return;let i=document.createElement("a");i.href=t,i.download="".concat(s.title||"asset").concat(e?"_".concat(e):"",".").concat(a),document.body.appendChild(i),i.click(),document.body.removeChild(i),ek(!1)},ez=()=>{let e=s.data.scriptMode||"CREATE",t=s.data.remixedScript,a=s.data.displayResult;return(0,l.jsxs)("div",{className:"w-full h-full p-4 flex flex-col gap-3",children:[(0,l.jsx)("div",{className:"flex bg-black/40 p-1 rounded-xl border border-white/5 w-full shrink-0",children:[{id:"CREATE",label:"剧本创作",icon:b.Z},{id:"REMIX",label:"剧本改编",icon:f.Z},{id:"DESCRIBE",label:"视觉导演",icon:v.Z}].map(t=>(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{scriptMode:t.id})},className:"flex-1 flex flex-col items-center gap-1.5 py-2 rounded-lg transition-all ".concat(e===t.id?"bg-[#3a3a3c] text-white shadow-xl ring-1 ring-white/10":"text-slate-500 hover:text-slate-300"),children:[(0,l.jsx)(t.icon,{size:14,className:e===t.id?"text-cyan-400":""}),(0,l.jsx)("span",{className:"text-[9px] font-bold",children:t.label})]},t.id))}),(0,l.jsxs)("div",{className:"flex flex-col gap-2 shrink-0",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between px-1",children:[(0,l.jsx)("span",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest opacity-60",children:"REMIX"===e?"待改编素材":"创作参考"}),(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsxs)("button",{onClick:e=>{var t;e.stopPropagation(),null===(t=eR.current)||void 0===t||t.click()},className:"flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 hover:bg-white/10 text-[9px] font-bold text-slate-400 transition-colors",children:[(0,l.jsx)(w.Z,{size:10})," 注入剧本"]})})]}),(0,l.jsx)("textarea",{className:"flex-1 bg-black/40 rounded-xl text-[11px] text-slate-300 p-3 focus:outline-none resize-none border border-white/5 custom-scrollbar min-h-24",placeholder:"REMIX"===e?"在此粘贴需要改编的小说或剧本内容...":"DESCRIBE"===e?"输入剧本片段或场景描述，生成视觉拍摄方案...":"输入故事想法或主题，生成完整剧本...",value:a||"",onMouseDown:e=>e.stopPropagation(),onChange:e=>i(s.id,{displayResult:e.target.value})})]}),(0,l.jsx)("div",{className:"flex-1 min-h-0 bg-black/30 rounded-2xl border border-white/5 p-4 overflow-y-auto custom-scrollbar flex flex-col ".concat(t||et?"":"items-center justify-center"),onWheel:eS,children:et?(0,l.jsxs)("div",{className:"flex flex-col items-center gap-4 m-auto text-center opacity-50",children:[(0,l.jsx)(y.Z,{className:"animate-spin text-[#ffb400]",size:32}),(0,l.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"正在处理..."})]}):t?(0,l.jsx)("div",{className:"w-full h-full text-xs text-slate-300 whitespace-pre-wrap leading-relaxed animate-in fade-in duration-500 select-text cursor-text",children:t}):(0,l.jsxs)("div",{className:"flex flex-col items-center gap-3 opacity-20 pointer-events-none text-center",children:[(0,l.jsx)(j.Z,{size:48,strokeWidth:1}),(0,l.jsx)("span",{className:"text-[10px] font-bold tracking-widest",children:"等待生成..."})]})}),(0,l.jsx)("input",{type:"file",ref:eR,className:"hidden",accept:".txt,.doc,.docx",onChange:e=>eC(e,"sourceScript")})]})},eO=()=>{let e=s.data.cinematicVersion||"V1",t=!!s.data.image;return(0,l.jsxs)("div",{className:"w-full h-full p-4 flex flex-col gap-4",onDragOver:e=>e.preventDefault(),onDrop:eA,children:[(0,l.jsx)("div",{className:"flex items-center justify-center w-full py-2",children:(0,l.jsx)("div",{className:"flex gap-1 bg-black/40 p-1 rounded-full border border-white/5",children:["V1","V2","V3"].map(t=>(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{cinematicVersion:t})},className:"px-4 py-1 rounded-full text-[10px] font-black transition-all whitespace-nowrap ".concat(e===t?"bg-cyan-500 text-black shadow-lg shadow-cyan-500/20":"text-slate-500 hover:text-slate-300"),children:[t," ","V1"===t?"静态全视角":"V2"===t?"叙事短片序列":"文字故事转分镜"]},t))})}),t?(0,l.jsxs)("div",{className:"flex-1 w-full relative group/media overflow-hidden rounded-2xl border border-white/10 bg-black/20",children:[(0,l.jsx)("img",{src:s.data.image,className:"w-full h-full object-contain"}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{image:void 0})},className:"absolute top-2 right-2 p-1.5 bg-black/60 rounded-full text-white/70 hover:text-red-400 opacity-0 group-hover/media:opacity-100 transition-opacity",children:(0,l.jsx)(N.Z,{size:12})})]}):(0,l.jsxs)("div",{className:"flex-1 w-full relative rounded-2xl border-2 border-dashed border-white/10 bg-white/5 flex flex-col items-center justify-center text-slate-500 gap-3 group/slot hover:border-white/20 transition-all cursor-pointer",onClick:e=>{var t;e.stopPropagation(),null===(t=eR.current)||void 0===t||t.click()},children:[(0,l.jsx)(k.Z,{size:48,strokeWidth:1,className:"opacity-50 group-hover/slot:opacity-80 transition-opacity"}),(0,l.jsx)("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] opacity-50",children:"点击或拖入分镜基准图"})]}),(0,l.jsx)("input",{type:"file",ref:eR,className:"hidden",accept:"image/*",onChange:e=>eC(e)})]})},eM=()=>{let e=!!s.data.image&&s.status===n.SUCCESS,t=s.data.images||[],a=s.data.imageMode||"T2I";return e?(0,l.jsxs)("div",{className:"w-full h-full relative group/media overflow-hidden flex items-center justify-center bg-black",onDragOver:e=>e.preventDefault(),onDrop:eA,children:[(0,l.jsx)("img",{src:s.data.image,className:"w-full h-full object-contain cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("application/inkai-media",JSON.stringify({src:s.data.image,type:"image"})),e.dataTransfer.effectAllowed="copy"},onMouseDown:e=>e.stopPropagation()}),(0,l.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2 opacity-0 group-hover/media:opacity-100 transition-opacity",children:[ee&&(0,l.jsx)("button",{onClick:e=>{e.stopPropagation();let t=prompt("输入角色名称","新角色");t&&ee(t,el,s.data.image)},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-purple-400 shadow-xl",title:"保存为一致性角色",children:(0,l.jsx)(E.Z,{size:14})}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),ek(!eN)},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-cyan-400 shadow-xl",children:(0,l.jsx)(R.Z,{size:14})}),eN&&(0,l.jsx)("div",{className:"absolute top-full right-0 mt-2 w-32 bg-[#1c1c1e] border border-white/10 rounded-xl p-1 shadow-2xl z-50 overflow-hidden animate-in zoom-in-95",children:W.map(e=>(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),eT(e)},className:"w-full text-left px-3 py-2 rounded-lg text-[10px] font-bold text-slate-400 hover:bg-white/5 hover:text-white transition-colors",children:e},e))})]}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{image:void 0,images:void 0})},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-red-400 shadow-xl",children:(0,l.jsx)(N.Z,{size:14})})]})]}):(0,l.jsxs)("div",{className:"w-full h-full p-4 flex flex-col gap-4",onDragOver:e=>e.preventDefault(),onDrop:eA,children:[(0,l.jsx)("div",{className:"flex bg-black/40 p-1 rounded-xl border border-white/5 w-full shrink-0",children:[{id:"T2I",label:"文生图",icon:S.Z},{id:"I2I",label:"图生图",icon:C.Z}].map(e=>(0,l.jsxs)("button",{onClick:t=>{t.stopPropagation(),i(s.id,{imageMode:e.id,images:[],image:void 0})},className:"flex-1 flex flex-col items-center gap-1 py-1.5 rounded-lg transition-all ".concat(a===e.id?"bg-[#3a3a3c] text-white shadow-xl ring-1 ring-white/10":"text-slate-500 hover:text-slate-300"),children:[(0,l.jsx)(e.icon,{size:13,className:a===e.id?"text-cyan-400":""}),(0,l.jsx)("span",{className:"text-[8px] font-black",children:e.label})]},e.id))}),(0,l.jsx)("div",{className:"flex-1 min-h-0 relative",children:"T2I"===a?(0,l.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center opacity-20 gap-3 border border-white/5 rounded-2xl bg-black/20",children:[(0,l.jsx)(A.Z,{size:48,strokeWidth:1}),(0,l.jsx)("span",{className:"text-[10px] font-black tracking-[0.2em] uppercase",children:"Ready to Create"})]}):(0,l.jsxs)("div",{className:"w-full h-full relative rounded-xl border-2 border-dashed transition-all flex flex-col items-center justify-center group/slot overflow-hidden ".concat(t.length>0?"border-cyan-500/30 bg-cyan-500/5":"border-white/10 bg-white/5 hover:border-white/20"),children:[t.length>0?(0,l.jsxs)("div",{className:"w-full h-full flex flex-col p-2 gap-2 overflow-hidden bg-black/20 relative",children:[(0,l.jsx)("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:(0,l.jsx)("img",{src:t[0],className:"max-w-full max-h-full object-contain cursor-grab active:cursor-grabbing",draggable:!0,onMouseDown:e=>e.stopPropagation(),onDragStart:e=>{e.dataTransfer.setData("application/inkai-media",JSON.stringify({src:t[0],type:"image"})),e.dataTransfer.effectAllowed="copy"}})}),"I2I"===a&&(0,l.jsxs)("div",{className:"flex gap-2 overflow-x-auto custom-scrollbar pb-1",children:[t.map((e,a)=>(0,l.jsxs)("div",{className:"w-12 h-12 rounded bg-black/40 border border-white/10 shrink-0 relative group/thumb",children:[(0,l.jsx)("img",{src:e,className:"w-full h-full object-cover rounded cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:t=>{t.dataTransfer.setData("application/inkai-media",JSON.stringify({src:e,type:"image"})),t.dataTransfer.effectAllowed="copy"},onMouseDown:e=>e.stopPropagation()}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{images:t.filter((e,t)=>t!==a)})},className:"absolute -top-1 -right-1 p-0.5 bg-red-500 rounded-full text-white opacity-0 group-hover/thumb:opacity-100 transition-opacity",children:(0,l.jsx)(T.Z,{size:8})})]},a)),(0,l.jsx)("button",{onClick:e=>{var t;e.stopPropagation(),null===(t=eR.current)||void 0===t||t.click()},className:"w-12 h-12 rounded border border-dashed border-white/20 flex items-center justify-center text-slate-500 hover:text-white transition-colors",children:(0,l.jsx)(z.Z,{size:16})})]}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{image:void 0,images:void 0})},className:"absolute top-2 right-2 p-1.5 bg-black/60 rounded-full text-white/70 hover:text-red-400 opacity-0 group-hover/slot:opacity-100 transition-opacity",children:(0,l.jsx)(N.Z,{size:12})})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center gap-3 text-slate-500 cursor-pointer p-10 text-center",onClick:e=>{var t;e.stopPropagation(),null===(t=eR.current)||void 0===t||t.click()},children:[(0,l.jsx)(C.Z,{size:32,strokeWidth:1}),(0,l.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest leading-relaxed",children:"I2I"===a?"点击或拖入多张参考图":"点击或拖入分镜基准图"})]}),(0,l.jsx)("input",{type:"file",ref:eR,className:"hidden",accept:"image/*",multiple:"I2I"===a,onChange:e=>eC(e)})]})})]})},eI=()=>{let e=s.data.videoMode||"T2V",t=s.data.generationMode||"DEFAULT",a=!!s.data.videoUri&&s.status===n.SUCCESS,r=s.data.images||[],o=s.data.lastFrameImage;return a?(0,l.jsxs)("div",{className:"w-full h-full relative group/media overflow-hidden",onDragOver:e=>e.preventDefault(),onDrop:eA,children:[(0,l.jsx)("video",{ref:ea,src:s.data.videoUri,className:"w-full h-full object-cover bg-zinc-900",loop:!0,muted:!1,onMouseEnter:()=>{ea.current&&(ea.current.muted=!1,ea.current.play().catch(()=>{}))},onMouseLeave:()=>{ea.current&&(ea.current.pause(),ea.current.currentTime=0,ea.current.muted=!0)}}),(0,l.jsxs)("div",{className:"absolute top-2 right-2 flex gap-2 opacity-0 group-hover/media:opacity-100 transition-opacity",children:[(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),eT()},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-cyan-400 shadow-xl",title:"下载视频",children:(0,l.jsx)(R.Z,{size:14})}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{videoUri:void 0,videoMetadata:void 0})},className:"p-1.5 bg-black/60 rounded-lg text-white/50 hover:text-red-400",children:(0,l.jsx)(N.Z,{size:14})})]})]}):(0,l.jsxs)("div",{className:"w-full h-full p-4 flex flex-col gap-3",onDragOver:e=>e.preventDefault(),onDrop:eA,children:[(0,l.jsx)("div",{className:"flex bg-black/40 p-1 rounded-xl border border-white/5 w-full shrink-0",children:[{id:"T2V",label:"文生视频",icon:O.Z},{id:"I2V",label:"图生视频",icon:M.Z},{id:"DIRECTOR",label:"导演模式",icon:I.Z}].map(t=>(0,l.jsxs)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{videoMode:t.id,images:[],image:void 0,generationMode:"DEFAULT"})},className:"flex-1 flex flex-col items-center gap-1 py-1.5 rounded-lg transition-all ".concat(e===t.id?"bg-[#3a3a3c] text-white shadow-xl ring-1 ring-white/10":"text-slate-500 hover:text-slate-300"),children:[(0,l.jsx)(t.icon,{size:13,className:e===t.id?"text-purple-400":""}),(0,l.jsx)("span",{className:"text-[8px] font-black",children:t.label})]},t.id))}),"DIRECTOR"===e&&(0,l.jsx)("div",{className:"flex bg-black/40 p-0.5 rounded-lg border border-white/5 w-full overflow-x-auto custom-scrollbar shrink-0",children:[{id:"CONTINUE",label:"视频延展",icon:f.Z},{id:"FIRST_LAST_FRAME",label:"首尾帧",icon:D.Z},{id:"CUT",label:"分镜抽取",icon:Z.Z},{id:"CHARACTER_REF",label:"角色迁移",icon:E.Z}].map(e=>(0,l.jsxs)("button",{onClick:t=>{t.stopPropagation(),i(s.id,{generationMode:e.id})},className:"flex-1 flex items-center justify-center gap-1.5 py-1 px-2 rounded transition-all whitespace-nowrap ".concat(t===e.id?"bg-purple-500/20 text-purple-200":"text-slate-500 hover:text-slate-300"),children:[(0,l.jsx)(e.icon,{size:10}),(0,l.jsx)("span",{className:"text-[8px] font-bold",children:e.label})]},e.id))}),(0,l.jsx)("div",{className:"flex-1 min-h-0 relative",children:"T2V"===e?(0,l.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center opacity-20 gap-3 border border-white/5 rounded-2xl bg-black/20",children:[(0,l.jsx)(M.Z,{size:48,strokeWidth:1}),(0,l.jsx)("span",{className:"text-[10px] font-black tracking-[0.2em] uppercase",children:"Cinema Ready"})]}):(0,l.jsxs)("div",{className:"flex-1 min-h-0 flex gap-2 h-full",children:[(0,l.jsx)("div",{className:"flex-1 relative rounded-xl border-2 border-dashed transition-all flex flex-col items-center justify-center group/slot overflow-hidden ".concat(r.length>0?"border-purple-500/30 bg-purple-500/5":"border-white/10 bg-white/5 hover:border-white/20"),children:r.length>0?(0,l.jsxs)("div",{className:"w-full h-full flex flex-col p-2 gap-2 overflow-hidden bg-black/20 relative",children:[(0,l.jsx)("div",{className:"flex-1 min-h-0 flex items-center justify-center",children:(0,l.jsx)("img",{src:r[0],className:"max-w-full max-h-full object-contain",onMouseDown:e=>e.stopPropagation()})}),(0,l.jsxs)("div",{className:"flex gap-2 overflow-x-auto custom-scrollbar pb-1",children:[r.map((e,t)=>(0,l.jsxs)("div",{className:"w-10 h-10 rounded bg-black/40 border border-white/10 shrink-0 relative group/thumb",children:[(0,l.jsx)("img",{src:e,className:"w-full h-full object-cover rounded",onMouseDown:e=>e.stopPropagation()}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{images:r.filter((e,a)=>a!==t)})},className:"absolute -top-1 -right-1 p-0.5 bg-red-500 rounded-full text-white opacity-0 group-hover/thumb:opacity-100 transition-opacity",children:(0,l.jsx)(T.Z,{size:8})})]},t)),r.length<3&&(0,l.jsx)("button",{onClick:e=>{var t;e.stopPropagation(),null===(t=eR.current)||void 0===t||t.click()},className:"w-10 h-10 rounded border border-dashed border-white/20 flex items-center justify-center text-slate-500 hover:text-white transition-colors",children:(0,l.jsx)(z.Z,{size:14})})]}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{images:[],image:void 0})},className:"absolute top-2 right-2 p-1.5 bg-black/60 rounded-full text-white/70 hover:text-red-400 opacity-0 group-hover/slot:opacity-100 transition-opacity",children:(0,l.jsx)(N.Z,{size:12})})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center gap-1 text-slate-500 cursor-pointer text-center px-4",onClick:e=>{var t;e.stopPropagation(),null===(t=eR.current)||void 0===t||t.click()},children:[(0,l.jsx)(C.Z,{size:20}),(0,l.jsx)("span",{className:"text-[8px] font-black uppercase",children:"FIRST_LAST_FRAME"===t?"起始帧":"参考图 (1-3)"})]})}),"FIRST_LAST_FRAME"===t&&(0,l.jsx)("div",{className:"flex-1 relative rounded-xl border-2 border-dashed transition-all flex flex-col items-center justify-center group/slot2 overflow-hidden ".concat(o?"border-cyan-500/30 bg-cyan-500/5":"border-white/10 bg-white/5 hover:border-white/20"),children:o?(0,l.jsxs)("div",{className:"relative w-full h-full group/vpreview2 flex items-center justify-center bg-black",children:[(0,l.jsx)("img",{src:o,className:"w-full h-full object-contain",onMouseDown:e=>e.stopPropagation()}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),i(s.id,{lastFrameImage:void 0})},className:"absolute top-2 right-2 p-1 bg-black/60 rounded-full text-white/50 hover:text-red-400 opacity-0 group-hover/vpreview2:opacity-100 transition-opacity",children:(0,l.jsx)(T.Z,{size:10})}),(0,l.jsx)("div",{className:"absolute bottom-1 left-1 px-1 bg-black/60 rounded text-[8px] font-bold text-cyan-400 uppercase",children:"END"})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center gap-1 text-slate-500 cursor-pointer",onClick:e=>{e.stopPropagation();let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async e=>{let t=e.target.files[0];if(t){let e=new FileReader;e.onload=e=>{var t;return i(s.id,{lastFrameImage:null===(t=e.target)||void 0===t?void 0:t.result})},e.readAsDataURL(t)}},t.click()},children:[(0,l.jsx)(C.Z,{size:20}),(0,l.jsx)("span",{className:"text-[8px] font-black uppercase",children:"结束帧"})]})})]})}),(0,l.jsx)("input",{type:"file",ref:eR,className:"hidden",accept:"image/*",multiple:"T2V"!==e,onChange:e=>eC(e)})]})},eD=F(s.type),eZ=(null===(t=eD.find(e=>e.id===s.data.model))||void 0===t?void 0:t.label)||"选择模型",eP=s.data.aspectRatio||"16:9",e_=s.data.resolution||(s.type===r.IMAGE_GENERATOR||s.type===r.STORYBOARD_GENERATOR?"1080P":"720P"),eG=s.data.duration||5,eU=s.type===r.VIDEO_GENERATOR?Y:V;return(0,l.jsxs)("div",{className:"absolute rounded-[28px] group ".concat($||es||eE?"z-50 ring-2 ring-cyan-500/50 shadow-[0_0_60px_-10px_rgba(34,211,238,0.4)]":"z-10 ring-1 ring-white/10 hover:ring-white/20"),style:{left:s.x,top:s.y,width:s.width||420,height:s.height||380,background:$?"rgba(28, 28, 30, 0.95)":"rgba(28, 28, 30, 0.75)",transition:"all 0.5s cubic-bezier(0.32, 0.72, 0, 1)",backdropFilter:"blur(32px)"},onMouseDown:ex,onContextMenu:e=>J(e,s.id),onMouseEnter:()=>ei(!0),onMouseLeave:()=>{ei(!1)},onWheel:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"absolute -top-10 left-0 w-full flex items-center justify-between px-1 transition-all duration-300 ".concat($||es||eE?"opacity-100 translate-y-0":"opacity-0 translate-y-2 pointer-events-none"),children:[(0,l.jsx)("div",{className:"flex items-center gap-1.5",children:(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),u(s.id)},className:"p-2 bg-red-500/10 rounded-lg text-red-400 hover:bg-red-500/20 transition-all border border-red-500/20",children:(0,l.jsx)(N.Z,{size:14})})}),(0,l.jsxs)("div",{className:"flex items-center gap-2 px-4 py-1.5 bg-black/60 border border-white/10 rounded-full backdrop-blur-xl shadow-lg",children:[(0,l.jsx)("div",{className:"w-1.5 h-1.5 rounded-full ".concat(et?"bg-[#ffb400] animate-pulse shadow-[0_0_8px_#ffb400]":"bg-green-500")}),(0,l.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-200",children:s.title})]})]}),(0,l.jsx)("div",{className:"absolute -left-3 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border border-white/20 bg-[#1c1c1e] flex items-center justify-center cursor-crosshair z-50 hover:scale-125 transition-transform",onMouseDown:e=>g(e,s.id),onMouseUp:e=>H(e,s.id),children:(0,l.jsx)(z.Z,{size:12,className:"text-white/50"})}),(0,l.jsx)("div",{className:"absolute -right-3 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border border-white/20 bg-[#1c1c1e] flex items-center justify-center cursor-crosshair z-50 hover:scale-125 transition-transform",onMouseDown:e=>g(e,s.id),onMouseUp:e=>H(e,s.id),children:(0,l.jsx)(z.Z,{size:12,className:"text-white/50"})}),(0,l.jsx)("div",{className:"w-full h-full rounded-[28px] overflow-hidden bg-zinc-950/50 shadow-inner",children:(()=>{if(s.type===r.VIDEO_GENERATOR)return eI();if(s.type===r.IMAGE_GENERATOR)return eM();if(s.type===r.STORYBOARD_GENERATOR)return eO();if(s.type===r.SCRIPT_MASTER)return ez();let e=s.data.displayResult||s.data.analysis;return(0,l.jsx)("div",{className:"w-full h-full p-4 flex flex-col",children:(0,l.jsx)("div",{className:"flex-1 bg-black/20 rounded-xl border border-white/5 p-3 overflow-y-auto custom-scrollbar text-xs text-slate-300 whitespace-pre-wrap select-text",onMouseDown:e=>e.stopPropagation(),onWheel:eS,children:et?(0,l.jsx)(y.Z,{className:"animate-spin text-cyan-500 m-auto",size:24}):e||"等待指令..."})})})()}),(0,l.jsx)("div",{className:"absolute top-[96%] left-1/2 -translate-x-1/2 w-[94%] pt-4 z-[9999] flex flex-col items-center transition-all duration-300 ".concat(es||er||$||eE?"opacity-100 translate-y-0 pointer-events-auto":"opacity-0 translate-y-[-10px] pointer-events-none"),onMouseDown:e=>{e.stopPropagation(),null==Q||Q(s.id)},onMouseEnter:()=>ei(!0),"data-node-control":"true",children:(0,l.jsxs)("div",{className:"w-full rounded-[24px] p-2 flex flex-col gap-2 ".concat("bg-[#2c2c2e]/95 backdrop-blur-2xl border border-white/10 shadow-2xl"),children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("textarea",{className:"w-full bg-black/30 rounded-[18px] text-[13px] text-slate-100 p-4 focus:outline-none resize-none min-h-[70px] custom-scrollbar font-medium border border-white/5 focus:border-cyan-500/20 transition-all pr-8",placeholder:s.type===r.SCRIPT_MASTER?"输入剧本需求...":"输入生成指令...",value:el,onMouseDown:e=>e.stopPropagation(),onChange:e=>eo(e.target.value),onFocus:()=>en(!0),onBlur:()=>en(!1)}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),eu()},disabled:ec||!el,className:"absolute right-2 bottom-2 p-1.5 rounded-lg transition-all ".concat(ec?"bg-amber-500/20 text-amber-400":"bg-white/5 text-slate-400 hover:text-amber-400 hover:bg-amber-500/10"," disabled:opacity-30"),title:"AI 润色提示词 (Magic Enhance)",children:ec?(0,l.jsx)(y.Z,{size:12,className:"animate-spin"}):(0,l.jsx)(P.Z,{size:12})})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between px-2 pb-1 relative",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0 flex items-center gap-1.5 overflow-visible py-0.5 flex-wrap",children:[(0,l.jsxs)("div",{className:"relative group/picker",children:[(0,l.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),eg(!1),ef(!1),ew(!1),ep(e=>!e)},className:"px-3 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1.5 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ".concat(eh?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"),children:[eZ,(0,l.jsx)(p.Z,{size:10,className:"opacity-50 transition-transform ".concat(eh?"rotate-180":"")})]}),eh&&(0,l.jsx)("div",{className:"absolute bottom-full left-0 mb-1 w-48 bg-[#18181b] border border-white/10 rounded-xl p-1.5 shadow-2xl z-[10001] flex flex-col gap-0.5",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:eD.length>0?eD.map(e=>(0,l.jsxs)("button",{type:"button",onMouseDown:t=>{t.preventDefault(),t.stopPropagation(),i(s.id,{model:e.id}),ep(!1)},className:"w-full text-left px-3 py-2.5 rounded-lg text-[11px] font-bold transition-all flex items-center justify-between z-[10003] ".concat(s.data.model===e.id?"bg-cyan-500 text-black":"text-slate-300 hover:bg-white/10 hover:text-white"),children:[e.label,s.data.model===e.id&&(0,l.jsx)(_.Z,{size:12})]},e.id)):(0,l.jsx)("div",{className:"p-2 text-[10px] text-slate-500 text-center",children:"无可用模型"})})]}),(s.type===r.IMAGE_GENERATOR||s.type===r.VIDEO_GENERATOR||s.type===r.STORYBOARD_GENERATOR)&&(0,l.jsxs)("div",{className:"relative group/picker",children:[(0,l.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ep(!1),ef(!1),ew(!1),eg(e=>!e)},className:"px-3 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1.5 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ".concat(em?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"),children:[(0,l.jsx)(G.Z,{size:12,className:"text-cyan-400"}),eP]}),em&&(0,l.jsx)("div",{className:"absolute bottom-full left-0 mb-1 w-28 bg-[#18181b] border border-white/10 rounded-xl p-1.5 shadow-2xl z-[10001] flex flex-col gap-0.5",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:eU.map(e=>(0,l.jsx)("button",{type:"button",onMouseDown:t=>{t.preventDefault(),t.stopPropagation(),i(s.id,{aspectRatio:e}),eg(!1)},className:"w-full text-left px-3 py-2 rounded-lg text-[11px] font-bold transition-all z-[10003] ".concat(eP===e?"bg-cyan-500/20 text-cyan-400":"text-slate-300 hover:bg-white/10 hover:text-white"),children:e},e))})]}),(s.type===r.IMAGE_GENERATOR||s.type===r.VIDEO_GENERATOR||s.type===r.STORYBOARD_GENERATOR)&&(0,l.jsxs)("div",{className:"relative group/picker",children:[(0,l.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ep(!1),eg(!1),ew(!1),ef(e=>!e)},className:"px-3 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1.5 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ".concat(eb?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"),children:[(0,l.jsx)(c.Z,{size:12,className:"text-purple-400"}),e_]}),eb&&(0,l.jsx)("div",{className:"absolute bottom-full left-0 mb-1 w-28 bg-[#18181b] border border-white/10 rounded-xl p-1.5 shadow-2xl z-[10001] flex flex-col gap-0.5",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:(s.type===r.IMAGE_GENERATOR||s.type===r.STORYBOARD_GENERATOR?W:B).map(e=>(0,l.jsx)("button",{type:"button",onMouseDown:t=>{t.preventDefault(),t.stopPropagation(),i(s.id,{resolution:e}),ef(!1)},className:"w-full text-left px-3 py-2 rounded-lg text-[11px] font-bold transition-all z-[10003] ".concat(e_===e?"bg-purple-500/20 text-purple-400":"text-slate-300 hover:bg-white/10 hover:text-white"),children:e},e))})]}),s.type===r.VIDEO_GENERATOR&&(0,l.jsxs)("div",{className:"relative group/picker",children:[(0,l.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ep(!1),eg(!1),ef(!1),ew(e=>!e)},className:"px-2.5 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ".concat(ev?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"),children:[(0,l.jsx)(U.Z,{size:10,className:"text-amber-400"}),eG,"s"]}),ev&&(0,l.jsx)("div",{className:"absolute bottom-full left-0 mb-1 w-28 bg-[#18181b] border border-white/10 rounded-xl p-1.5 shadow-2xl z-[10001] flex flex-col gap-0.5",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:K.map(e=>(0,l.jsxs)("button",{type:"button",onMouseDown:t=>{t.preventDefault(),t.stopPropagation(),i(s.id,{duration:e}),ew(!1)},className:"w-full text-left px-3 py-2 rounded-lg text-[11px] font-bold transition-all z-[10003] ".concat(eG===e?"bg-amber-500/20 text-amber-400":"text-slate-300 hover:bg-white/10 hover:text-white"),children:[e,"s"]},e))})]}),s.type===r.VIDEO_GENERATOR&&(0,l.jsxs)("div",{className:"relative group/picker",children:[(0,l.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ep(!1),eg(!1),ef(!1),ew(!1),ej(e=>!e)},className:"px-2.5 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1 transition-all border whitespace-nowrap shadow-sm cursor-pointer select-none relative z-[10002] ".concat(ey?"bg-zinc-600 text-white border-zinc-500":"bg-zinc-800 text-zinc-200 border-zinc-700 hover:bg-zinc-700 hover:text-white"),title:"运镜控制",children:[(0,l.jsx)(v.Z,{size:10,className:"text-emerald-400"}),"运镜"]}),ey&&(0,l.jsx)("div",{className:"absolute bottom-full left-0 mb-1 w-48 bg-[#18181b] border border-white/10 rounded-xl p-2 shadow-2xl z-[10001] grid grid-cols-2 gap-1",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:X.map(e=>(0,l.jsxs)("button",{type:"button",onMouseDown:t=>{t.preventDefault(),t.stopPropagation();let a=el.trim(),r="".concat(a).concat(a?" ":"").concat(e.prompt);eo(r),i(s.id,{prompt:r}),ej(!1)},className:"flex flex-col items-center gap-1 p-2 rounded-lg text-slate-400 hover:bg-white/5 hover:text-white transition-all z-[10003]",children:[(0,l.jsx)(e.icon,{size:14,className:"text-emerald-500/70"}),(0,l.jsx)("span",{className:"text-[9px] font-bold",children:e.label})]},e.id))})]})]}),(0,l.jsx)("button",{type:"button",onMouseDown:e=>{e.stopPropagation(),null==Q||Q(s.id)},onClick:e=>{e.stopPropagation(),d(s.id,el)},disabled:et,className:"flex items-center justify-center px-3 py-1.5 rounded-lg font-black text-[10px] text-white transition-all bg-gradient-to-r from-cyan-500 to-blue-600 shadow-lg shadow-cyan-900/30 hover:scale-105 active:scale-95 disabled:opacity-50 group/render shrink-0 whitespace-nowrap h-[28px] self-end",children:et?(0,l.jsx)(y.Z,{className:"animate-spin",size:14}):(0,l.jsx)(L.Z,{size:14,className:"group-hover/render:fill-white"})})]})]})})]})});var J=a(440),q=a(502),$=a(2022),Q=a(4174),ee=a(2468),et=a(4104),ea=a(9061),es=a(6244),ei=a(2208),er=a(6649),en=a(1568),el=a(9412),eo=a(7390),ec=a(500),ed=a(4258);let eu=e=>{switch(e){case r.PROMPT_INPUT:return"提示工程";case r.IMAGE_GENERATOR:return"图片生成";case r.STORYBOARD_GENERATOR:return"一键分镜";case r.VIDEO_GENERATOR:return"视频生成";case r.AUDIO_GENERATOR:return"灵感音乐";case r.VIDEO_ANALYZER:return"视频分析";case r.IMAGE_EDITOR:return"图像编辑";case r.SCRIPT_MASTER:return"剧本大师";default:return e}},ex=e=>{switch(e){case r.PROMPT_INPUT:return S.Z;case r.IMAGE_GENERATOR:return A.Z;case r.STORYBOARD_GENERATOR:return k.Z;case r.VIDEO_GENERATOR:return I.Z;case r.AUDIO_GENERATOR:return J.Z;case r.VIDEO_ANALYZER:return E.Z;case r.IMAGE_EDITOR:return q.Z;case r.SCRIPT_MASTER:return j.Z;default:return z.Z}},eh=e=>{let{onAddNode:t,onUndo:a,isChatOpen:s,onToggleChat:i,isMultiFrameOpen:n,onToggleMultiFrame:c,isSonicStudioOpen:d,onToggleSonicStudio:u,assetHistory:x,onHistoryItemClick:h,onDeleteAsset:p,workflows:g,selectedWorkflowId:b,onSelectWorkflow:f,onSaveWorkflow:v,onDeleteWorkflow:w,onRenameWorkflow:y,onImportWorkflow:j,characters:k,onAddCharacter:E,onDeleteCharacter:R,onApplyCharacter:S,onOpenSettings:C,onOpenAdmin:A,isReadOnly:M}=e,[I,D]=(0,o.useState)(null),[Z,P]=(0,o.useState)(null),[_,G]=(0,o.useState)(""),[U,F]=(0,o.useState)(!1),V=()=>(0,l.jsx)("div",{className:"px-3 mb-6",children:U?(0,l.jsxs)("div",{className:"w-full p-3 bg-white/5 rounded-2xl border border-white/5 flex items-center justify-between group",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("img",{src:"https://api.dicebear.com/7.x/avataaars/svg?seed=Felix",className:"w-8 h-8 rounded-full bg-indigo-500/20"}),(0,l.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 bg-emerald-500 border-2 border-[#0c0c0e] rounded-full"})]}),(0,l.jsxs)("div",{className:"text-left",children:[(0,l.jsx)("p",{className:"text-[10px] font-black text-white uppercase tracking-widest",children:"Creator #882"}),(0,l.jsxs)("div",{className:"flex items-center gap-1.5 mt-0.5",children:[(0,l.jsx)(L.Z,{size:8,className:"text-amber-400"}),(0,l.jsx)("span",{className:"text-[8px] text-slate-500 font-bold uppercase tracking-widest",children:"Pro Plan • 850 Credits"})]})]})]}),(0,l.jsx)("button",{onClick:()=>F(!1),className:"p-1.5 text-slate-600 hover:text-white opacity-0 group-hover:opacity-100 transition-all",children:(0,l.jsx)(T.Z,{size:14})})]}):(0,l.jsxs)("button",{onClick:()=>F(!0),className:"w-full p-3 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-2xl border border-white/10 shadow-lg hover:scale-[1.02] transition-all group overflow-hidden relative",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"}),(0,l.jsxs)("div",{className:"flex items-center gap-3 relative z-10",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:(0,l.jsx)($.Z,{size:16,className:"text-white"})}),(0,l.jsxs)("div",{className:"text-left",children:[(0,l.jsx)("p",{className:"text-[10px] font-black text-white uppercase tracking-widest",children:"登录 / 注册"}),(0,l.jsx)("p",{className:"text-[8px] text-white/60 font-medium",children:"解锁云端同步与高级功能"})]})]})]})}),Y=(e,t)=>{e.dataTransfer.setData("assetType",t.type),e.dataTransfer.setData("assetSrc",t.src),e.dataTransfer.setData("assetTitle",t.title||"")};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed left-6 top-1/2 -translate-y-1/2 flex flex-col items-center gap-3 p-2 bg-[#1c1c1e]/80 backdrop-blur-3xl border border-white/10 rounded-2xl shadow-2xl z-50 animate-in slide-in-from-left-10 duration-500 ease-[${SPRING}]",children:[{id:"nodes",icon:z.Z,action:()=>D("nodes"===I?null:"nodes")},{id:"workflow",icon:el.Z,action:()=>D("workflow"===I?null:"workflow")},{id:"history",icon:en.Z,action:()=>D("history"===I?null:"history")},{id:"characters",icon:Q.Z,action:()=>D("characters"===I?null:"characters")},{id:"smart_sequence",icon:O.Z,action:c,active:n},{id:"chat",icon:eo.Z,action:i,active:s},{id:"admin",icon:ec.Z,action:A,color:"text-amber-500"},{id:"undo",icon:m.Z,action:a},{id:"settings",icon:ed.Z,action:C}].map(e=>(0,l.jsx)("button",{onClick:e.action,className:"w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-300 hover:scale-110 ".concat(I===e.id||e.active?"bg-white text-black shadow-lg":"hover:bg-white/10 text-slate-400 hover:text-white"),title:e.id.toUpperCase(),children:(0,l.jsx)(e.icon,{size:18})},e.id))}),(0,l.jsx)("div",{className:"fixed left-24 top-1/2 -translate-y-1/2 max-h-[85vh] h-[600px] w-72 bg-[#1c1c1e]/95 backdrop-blur-3xl border border-white/10 rounded-2xl shadow-2xl transition-all duration-500 ease-[".concat("cubic-bezier(0.32, 0.72, 0, 1)","] z-40 flex flex-col overflow-hidden ").concat(I?"translate-x-0 opacity-100":"-translate-x-10 opacity-0 pointer-events-none scale-95"),children:I&&("nodes"===I?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[(0,l.jsx)("button",{onClick:()=>D(null),children:(0,l.jsx)(T.Z,{size:14,className:"text-slate-500 hover:text-white"})}),(0,l.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-white/50",children:"Node Hub"})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar space-y-2",children:[V(),M?(0,l.jsxs)("div",{className:"text-center py-10 px-4",children:[(0,l.jsx)(et.Z,{size:32,className:"mx-auto text-slate-700 mb-2 opacity-20"}),(0,l.jsx)("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:"预览模式下无法添加节点"})]}):[r.PROMPT_INPUT,r.SCRIPT_MASTER,r.IMAGE_GENERATOR,r.STORYBOARD_GENERATOR,r.VIDEO_GENERATOR,r.VIDEO_ANALYZER,r.IMAGE_EDITOR,r.AUDIO_GENERATOR].map(e=>{let a=ex(e);return(0,l.jsxs)("button",{onClick:()=>{t(e),D(null)},className:"w-full text-left p-3 rounded-xl bg-white/5 hover:bg-white/10 flex items-center gap-3 text-sm text-slate-200 transition-all border border-transparent hover:border-white/5 hover:translate-x-1",children:[(0,l.jsx)("div",{className:"p-2 bg-white/5 rounded-lg text-cyan-400 group-hover:bg-cyan-400 group-hover:text-black transition-colors",children:(0,l.jsx)(a,{size:16})}),(0,l.jsx)("span",{className:"font-bold text-xs",children:eu(e)})]},e)})]})]}):"workflow"===I?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[(0,l.jsx)("button",{onClick:()=>D(null),children:(0,l.jsx)(T.Z,{size:14,className:"text-slate-500 hover:text-white"})}),(0,l.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-white/50",children:"Workflows"})]}),(0,l.jsxs)("div",{className:"p-3",children:[V(),(0,l.jsxs)("button",{onClick:()=>{v(),D("workflow")},className:"w-full py-3 bg-cyan-500 hover:bg-cyan-400 text-black rounded-xl font-black text-[11px] uppercase tracking-wider flex items-center justify-center gap-2 transition-all shadow-lg shadow-cyan-500/20 active:scale-95",children:[(0,l.jsx)(ea.Z,{size:14})," 保存当前工作流"]}),(0,l.jsxs)("label",{className:"w-full py-3 mt-2 bg-white/5 hover:bg-white/10 text-slate-300 rounded-xl font-bold text-[11px] uppercase tracking-wider flex items-center justify-center gap-2 transition-all cursor-pointer border border-white/5 hover:border-white/10",children:[(0,l.jsx)(es.Z,{size:14})," 导入工作流 (JSON)",(0,l.jsx)("input",{type:"file",accept:".json",className:"hidden",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let s=new FileReader;s.onload=e=>{try{var t;let a=null===(t=e.target)||void 0===t?void 0:t.result,s=JSON.parse(a);if(!s.id||!s.nodes||!s.connections){alert("无效的工作流文件");return}s.id="imported-".concat(Date.now()),s.title="".concat(s.title," (Imported)"),j(s),D("workflow")}catch(e){alert("文件解析失败")}},s.readAsText(a)}})]})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar space-y-2",children:0===g.length?(0,l.jsxs)("div",{className:"text-center py-10 opacity-30 flex flex-col items-center gap-3",children:[(0,l.jsx)(ei.Z,{size:32,strokeWidth:1}),(0,l.jsx)("p",{className:"text-[10px] font-bold uppercase tracking-[0.2em]",children:"暂无已存工作流"})]}):g.map(e=>(0,l.jsxs)("div",{className:"group relative p-3 rounded-xl border transition-all ".concat(b===e.id?"bg-cyan-500/10 border-cyan-500/30":"bg-white/5 border-transparent hover:border-white/10"),children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>f(e.id),children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-lg bg-black/40 overflow-hidden flex items-center justify-center border border-white/5",children:e.thumbnail?(0,l.jsx)("img",{src:e.thumbnail,className:"w-full h-full object-cover"}):(0,l.jsx)(ei.Z,{size:16,className:"text-slate-600"})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[Z===e.id?(0,l.jsx)("input",{autoFocus:!0,className:"w-full bg-black/40 border border-cyan-500/50 rounded px-1.5 py-0.5 text-xs text-white focus:outline-none",value:_,onChange:e=>G(e.target.value),onBlur:()=>{y(e.id,_),P(null)},onKeyDown:e=>"Enter"===e.key&&e.currentTarget.blur()}):(0,l.jsx)("p",{className:"text-xs font-bold text-slate-200 truncate",children:e.title}),(0,l.jsxs)("p",{className:"text-[9px] text-slate-500 mt-0.5 font-mono uppercase",children:["Nodes: ",e.nodes.length]})]})]}),(0,l.jsxs)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,l.jsx)("button",{onClick:t=>{t.stopPropagation();let a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download="inkai-workflow-".concat(e.title.replace(/\s+/g,"_"),".json"),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)},className:"p-1.5 hover:bg-white/10 rounded text-slate-400 hover:text-white",title:"导出为 JSON",children:(0,l.jsx)(es.Z,{size:12,className:"rotate-180"})}),(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),P(e.id),G(e.title)},className:"p-1.5 hover:bg-white/10 rounded text-slate-400 hover:text-white",children:(0,l.jsx)(er.Z,{size:12})}),(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),w(e.id)},className:"p-1.5 hover:bg-red-500/20 rounded text-slate-400 hover:text-red-400",children:(0,l.jsx)(N.Z,{size:12})})]})]},e.id))})]}):"history"===I?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[(0,l.jsx)("button",{onClick:()=>D(null),children:(0,l.jsx)(T.Z,{size:14,className:"text-slate-500 hover:text-white"})}),(0,l.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-[0.2em] text-white/50",children:"History Assets"})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar space-y-2",children:[V(),0===x.length?(0,l.jsxs)("div",{className:"text-center py-10 opacity-30 flex flex-col items-center gap-3",children:[(0,l.jsx)(en.Z,{size:32,strokeWidth:1}),(0,l.jsx)("p",{className:"text-[10px] font-bold uppercase tracking-[0.2em]",children:"暂无生成记录"})]}):x.map(e=>(0,l.jsxs)("div",{draggable:!0,onDragStart:t=>Y(t,e),className:"group relative p-2 rounded-xl bg-white/5 hover:bg-white/10 border border-transparent hover:border-white/10 transition-all cursor-pointer active:scale-95",onClick:()=>h(e),children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-lg bg-black overflow-hidden flex items-center justify-center border border-white/5",children:"image"===e.type?(0,l.jsx)("img",{src:e.src,className:"w-full h-full object-cover"}):"video"===e.type?(0,l.jsx)("video",{src:e.src,className:"w-full h-full object-cover",muted:!0}):(0,l.jsx)(J.Z,{className:"text-cyan-500",size:16})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"text-[10px] font-bold text-slate-300 truncate pr-6",children:e.title||"Untitled"}),(0,l.jsxs)("p",{className:"text-[9px] text-slate-500 mt-1 uppercase tracking-widest",children:[e.type," • ",new Date(e.timestamp).toLocaleTimeString()]})]})]}),(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),p(e.id)},className:"absolute right-2 top-2 p-1.5 rounded-lg text-slate-600 hover:text-red-400 hover:bg-red-500/10 opacity-0 group-hover:opacity-100 transition-all",children:(0,l.jsx)(N.Z,{size:12})})]},e.id))]})]}):"characters"===I?(0,l.jsxs)("div",{className:"flex flex-col h-full bg-[#0c0c0e]/95 backdrop-blur-xl border-r border-white/5 w-72 animate-in slide-in-from-left duration-300",children:[(0,l.jsxs)("div",{className:"p-4 border-b border-white/5 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(Q.Z,{size:18,className:"text-purple-400"}),(0,l.jsx)("h3",{className:"text-xs font-black uppercase tracking-widest text-white",children:"一致性角色库"})]}),(0,l.jsx)("button",{onClick:()=>D(null),className:"p-1 hover:bg-white/5 rounded-lg text-slate-500",children:(0,l.jsx)(T.Z,{size:16})})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar",children:[V(),0===k.length?(0,l.jsxs)("div",{className:"text-center py-10",children:[(0,l.jsx)(Q.Z,{size:32,className:"mx-auto text-slate-700 mb-2 opacity-20"}),(0,l.jsx)("p",{className:"text-[10px] text-slate-500",children:"尚无角色。从生成结果中保存角色以保持视觉一致性。"})]}):k.map(e=>(0,l.jsxs)("div",{className:"group relative bg-white/5 rounded-xl overflow-hidden border border-white/5 hover:border-purple-500/30 transition-all",children:[(0,l.jsx)("img",{src:e.image,className:"w-full h-32 object-cover opacity-80 group-hover:opacity-100 transition-opacity"}),(0,l.jsxs)("div",{className:"p-3 bg-gradient-to-t from-black/80 to-transparent absolute bottom-0 left-0 right-0",children:[(0,l.jsx)("h4",{className:"text-[11px] font-bold text-white truncate",children:e.name}),(0,l.jsx)("p",{className:"text-[9px] text-slate-400 truncate mt-0.5",children:e.description})]}),(0,l.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,l.jsx)("button",{onClick:()=>S(e),className:"p-1.5 bg-purple-500 text-white rounded-lg shadow-lg hover:scale-105 transition-all",title:"应用到当前创作",children:(0,l.jsx)(ee.Z,{size:12})}),(0,l.jsx)("button",{onClick:()=>R(e.id),className:"p-1.5 bg-black/60 text-red-400 rounded-lg hover:bg-red-500/20 transition-all",children:(0,l.jsx)(N.Z,{size:12})})]})]},e.id))]})]}):null)})]})};var ep=a(6884),em=a(9869),eg=a(1773),eb=a(287),ef=a(4317);let ev=e=>e.split(/(\*\*.*?\*\*)/g).map((e,t)=>{if(e.startsWith("**")&&e.endsWith("**")){let a=e.slice(2,-2);return(0,l.jsx)("span",{className:"text-white font-bold mx-0.5",children:a},t)}return e}),ew=e=>{let t=e.split("\n"),a=[];return t.forEach((e,t)=>{let s="line-".concat(t),i=e.trim();if(!i){a.push((0,l.jsx)("div",{className:"h-2"},s));return}if(e.startsWith("# ")){a.push((0,l.jsx)("h1",{className:"text-base font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 mt-5 mb-3 border-b border-white/10 pb-2",children:e.replace(/^#\s/,"")},s));return}if(e.startsWith("## ")){a.push((0,l.jsxs)("h2",{className:"text-sm font-bold text-white mt-4 mb-2 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"w-1 h-4 bg-cyan-500 rounded-full inline-block"}),e.replace(/^##\s/,"")]},s));return}if(i.startsWith("* ")||i.startsWith("- ")){let e=i.replace(/^[\*\-]\s/,"");a.push((0,l.jsxs)("div",{className:"flex gap-2 ml-1 mb-1.5 items-start group/list",children:[(0,l.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-white/20 mt-[7px] shrink-0 group-hover/list:bg-cyan-400 transition-colors"}),(0,l.jsx)("div",{className:"text-[13px] leading-relaxed text-slate-300 flex-1",children:ev(e)})]},s));return}a.push((0,l.jsx)("div",{className:"text-[13px] leading-relaxed text-slate-300 mb-1",children:ev(e)},s))}),(0,l.jsx)("div",{className:"space-y-0.5 select-text cursor-text",children:a})},ey=e=>{let{isOpen:t,onClose:a}=e,[s,i]=(0,o.useState)([{role:"model",text:"你好！我是您的创意助手。开启“影业级增强”模式，我将以导演视角为您打磨电影感内容。"}]),[r,n]=(0,o.useState)(!1),[c,d]=(0,o.useState)(""),[u,x]=(0,o.useState)(!1),[h,p]=(0,o.useState)(!1),[m,g]=(0,o.useState)(!1),b=(0,o.useRef)(null),f=(0,o.useRef)(null),[v,w]=(0,o.useState)(null);(0,o.useEffect)(()=>{t&&setTimeout(()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.scrollIntoView({behavior:"smooth"})},100)},[s,r,t]);let j=async()=>{if(c.trim()&&!r){d(""),i([...s,{role:"user",text:c}]),n(!0);try{let e=s.map(e=>({role:e.role,parts:[{text:e.text}]})),t=await (0,ef.bE)(e,c,{isThinkingMode:u,isCinematicMode:h,isHelpMeWrite:m});i(e=>[...e,{role:"model",text:t}])}catch(e){i(t=>[...t,{role:"model",text:e.message||"连接错误"}])}finally{n(!1)}}};return(0,l.jsxs)("div",{ref:f,className:"fixed right-6 top-1/2 -translate-y-1/2 h-[85vh] w-[420px] bg-[#1c1c1e]/95 backdrop-blur-3xl rounded-[24px] border border-white/10 shadow-2xl z-40 flex flex-col overflow-hidden ".concat("transition-all duration-500 ease-[cubic-bezier(0.32,0.72,0,1)]"," ").concat(t?"opacity-100 translate-x-0 scale-100":"opacity-0 translate-x-10 scale-95 pointer-events-none"),onMouseDown:e=>e.stopPropagation(),onWheel:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5 backdrop-blur-md z-10 shrink-0",children:[(0,l.jsx)("button",{onClick:a,className:"p-2 hover:bg-white/10 rounded-full text-slate-500 hover:text-white transition-colors group",children:(0,l.jsx)(T.Z,{size:14,className:"group-hover:scale-110 transition-transform"})}),(0,l.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,l.jsxs)("div",{className:"flex flex-col items-end",children:[(0,l.jsx)("span",{className:"text-xs font-bold text-slate-200 tracking-wide",children:"AI 创意助手"}),(0,l.jsx)("span",{className:"text-[10px] text-slate-500 font-medium",children:"影业级大师联调"})]}),(0,l.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-tr from-cyan-500/20 to-blue-500/20 flex items-center justify-center border border-white/10 shadow-inner",children:(0,l.jsx)(P.Z,{size:14,className:"text-cyan-400"})})]})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-5 space-y-6 custom-scrollbar bg-[#0a0a0c]/50",children:[s.map((e,t)=>(0,l.jsx)("div",{className:"flex w-full ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,l.jsxs)("div",{className:"flex flex-col max-w-[92%] gap-1.5 ".concat("user"===e.role?"items-end":"items-start"),children:[(0,l.jsx)("div",{className:"flex items-center gap-2 px-1",children:(0,l.jsx)("span",{className:"text-[10px] font-bold text-cyan-500/80 uppercase tracking-wider",children:"model"===e.role?"InkAI":"You"})}),(0,l.jsx)("div",{className:"group relative transition-all w-full",children:(0,l.jsxs)("div",{className:"relative px-5 py-4 rounded-2xl shadow-sm border select-text cursor-text ".concat("user"===e.role?"bg-[#2c2c2e] border-white/10 text-slate-100 rounded-tr-sm":"bg-[#1c1c1e] border-white/5 text-slate-300 rounded-tl-sm w-full pr-10"),children:["model"===e.role?ew(e.text):(0,l.jsx)("p",{className:"leading-6 text-[13px] whitespace-pre-wrap",children:e.text}),(0,l.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(e.text),w(t),setTimeout(()=>w(null),2e3)},className:"absolute top-2 right-2 p-1.5 rounded-full bg-black/20 hover:bg-black/50 border border-white/5 text-slate-400 opacity-0 group-hover:opacity-100 transition-all hover:text-white hover:scale-110 z-10",children:v===t?(0,l.jsx)("span",{className:"text-[10px] font-bold text-green-400",children:"OK"}):(0,l.jsx)(ep.Z,{size:10})})]})})]})},t)),r&&(0,l.jsx)("div",{className:"flex justify-start w-full animate-in fade-in slide-in-from-bottom-2",children:(0,l.jsxs)("div",{className:"flex flex-col gap-2 max-w-[85%]",children:[(0,l.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider px-1 ".concat(u?"text-indigo-400":"text-cyan-500/80"),children:u?"Deep Thinking":"Thinking"}),(0,l.jsxs)("div",{className:"px-5 py-4 bg-[#1c1c1e] border rounded-2xl rounded-tl-sm flex items-center gap-3 w-fit shadow-lg ".concat(u?"border-indigo-500/30 shadow-indigo-900/20":"border-white/5 shadow-cyan-900/10"),children:[(0,l.jsx)(y.Z,{size:16,className:"animate-spin ".concat(u?"text-indigo-400":"text-cyan-500")}),(0,l.jsx)("span",{className:"text-xs font-medium tracking-wide ".concat(u?"text-indigo-200":"text-slate-400"),children:h?"影业级导演规划中...":"正在思考..."})]})]})}),(0,l.jsx)("div",{ref:b})]}),(0,l.jsxs)("div",{className:"p-4 bg-[#1c1c1e] border-t border-white/5 shrink-0 flex flex-col gap-2",children:[(0,l.jsx)("div",{className:"flex items-center justify-between px-1",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("button",{onClick:()=>{x(!u),p(!1)},className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold transition-all border ".concat(u?"bg-indigo-500/20 text-indigo-300 border-indigo-500/50":"bg-white/5 text-slate-500 border-transparent"),children:[(0,l.jsx)(em.Z,{size:12}),(0,l.jsx)("span",{children:"深度推理"})]}),(0,l.jsxs)("button",{onClick:()=>{p(!h),x(!1)},className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold transition-all border ".concat(h?"bg-amber-500/20 text-amber-300 border-amber-500/50 shadow-[0_0_10px_rgba(245,158,11,0.2)]":"bg-white/5 text-slate-500 border-transparent"),children:[(0,l.jsx)(I.Z,{size:12}),(0,l.jsx)("span",{children:"影业级增强"})]}),(0,l.jsxs)("button",{onClick:()=>{g(!m)},className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold transition-all border ".concat(m?"bg-pink-500/20 text-pink-300 border-pink-500/50":"bg-white/5 text-slate-500 border-transparent"),children:[(0,l.jsx)(eg.Z,{size:12}),(0,l.jsx)("span",{children:"帮我写"})]})]})}),(0,l.jsxs)("div",{className:"relative group/input",children:[(0,l.jsx)("textarea",{className:"w-full bg-black/20 border border-white/10 rounded-[20px] pl-4 pr-12 py-3.5 text-xs text-white placeholder-slate-500 focus:outline-none focus:bg-black/40 focus:border-cyan-500/30 transition-all resize-none custom-scrollbar leading-5",placeholder:h?"输入描述，AI 将以导演视角应用影视工业级 Prompt 指南...":"输入您的想法...",value:c,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),j())},rows:1,style:{minHeight:"48px",maxHeight:"120px"}}),(0,l.jsx)("button",{onClick:j,disabled:!c.trim()||r,className:"absolute right-2 top-2 p-2 rounded-full transition-all duration-300 ".concat(c.trim()&&!r?"bg-cyan-500 text-black hover:bg-cyan-400":"bg-white/5 text-slate-600"),children:(0,l.jsx)(eb.Z,{size:16})})]})]})]})};var ej=a(2738),eN=a(2095);let ek=[{label:"自由",value:null},{label:"16:9",value:16/9},{label:"9:16",value:9/16},{label:"4:3",value:4/3},{label:"3:4",value:3/4},{label:"1:1",value:1}],eE=e=>{var t,a,s;let{imageSrc:i,onConfirm:r,onCancel:n}=e,[c,d]=(0,o.useState)(null),[u,x]=(0,o.useState)(null),h=(0,o.useRef)(null),p=(0,o.useRef)(null),[m,g]=(0,o.useState)({type:"create",startPos:{x:0,y:0},startCrop:null}),b=e=>{if(!h.current)return{x:0,y:0};let t=h.current.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top,rawX:e.clientX,rawY:e.clientY}},f=(e,t,a)=>{let{x:s,y:i,width:r,height:n}=e;return s<0&&(s=0),i<0&&(i=0),r>t&&(r=t),n>a&&(n=a),s+r>t&&(s=t-r),i+n>a&&(i=a-n),{x:s,y:i,width:r,height:n}},v=(e,t,a)=>{e.preventDefault(),e.stopPropagation();let s=b(e),i=c;"create"===t&&d(i={x:s.x,y:s.y,width:0,height:0}),g({type:t,handle:a,startPos:{x:s.x,y:s.y},startCrop:i?{...i}:null})},w=e=>{if(!h.current||!m.startCrop)return;if(0===e.buttons){g(e=>({...e,type:"create"}));return}let t=b(e),a=h.current.width,s=h.current.height,{startPos:i,startCrop:r}=m;if("move"===m.type){let e=t.x-i.x,n=t.y-i.y;d(f({...r,x:r.x+e,y:r.y+n},a,s))}else if("create"===m.type){let e=Math.max(0,Math.min(t.x,a)),i=Math.max(0,Math.min(t.y,s)),n=r.x,l=r.y,o=Math.abs(e-n),c=Math.abs(i-l);u&&(o/c>u?c=o/u:o=c*u);let x=e>=n?1:-1,h=i>=l?1:-1,p=n+(-1===x?-o:0),m=l+(-1===h?-c:0);p<0&&(p=0,u&&(c=o/u)),m<0&&(m=0,u&&(o=c*u)),p+o>a&&(1===x?o=a-p:p=a-o,u&&(c=o/u)),m+c>s&&(1===h?c=s-m:m=s-c,u&&(o=c*u)),d({x:p,y:m,width:o,height:c})}else if("resize"===m.type&&m.handle){let e=0,i=0;switch(m.handle){case"nw":e=r.x+r.width,i=r.y+r.height;break;case"ne":e=r.x,i=r.y+r.height;break;case"sw":e=r.x+r.width,i=r.y;break;case"se":e=r.x,i=r.y}let n=Math.max(0,Math.min(t.x,a)),l=Math.max(0,Math.min(t.y,s)),o=Math.abs(n-e),c=Math.abs(l-i);if(u){c=o/u;let e=m.handle.includes("n")?i-c:i+c;(e<0||e>s)&&(o=(c=Math.abs(l-i))*u)}let x=m.handle.includes("w")?e-o:e,h=m.handle.includes("n")?i-c:i;x<0&&(x=0),h<0&&(h=0),x+o>a&&(o=a-x),h+c>s&&(c=s-h),d({x:x,y:h,width:o,height:c})}},y=()=>{g(e=>({...e,type:"create",startCrop:null}))};return(0,o.useEffect)(()=>(window.addEventListener("mousemove",w),window.addEventListener("mouseup",y),()=>{window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",y)}),[m]),(0,o.useEffect)(()=>{if(c&&u&&c.width>0&&c.height>0){var e,t;let a=c.x+c.width/2,s=c.y+c.height/2,i=c.width,r=i/u;r>((null===(e=h.current)||void 0===e?void 0:e.height)||0)&&(i=(r=(null===(t=h.current)||void 0===t?void 0:t.height)||0)*u);let n=a-i/2,l=s-r/2;h.current&&d(f({x:n,y:l,width:i,height:r},h.current.width,h.current.height))}},[u]),(0,l.jsxs)("div",{className:"fixed inset-0 z-[200] bg-black/90 backdrop-blur-xl flex flex-col items-center justify-center animate-in fade-in duration-300",children:[(0,l.jsxs)("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2",children:[(0,l.jsxs)("div",{className:"bg-[#2c2c2e]/90 backdrop-blur-md px-6 py-2.5 rounded-full border border-white/10 text-slate-300 text-xs font-medium flex items-center gap-2 shadow-2xl",children:[(0,l.jsx)(ej.Z,{size:14,className:"text-cyan-400"}),(0,l.jsx)("span",{children:"局部分镜截取"})]}),(0,l.jsx)("span",{className:"text-[10px] text-slate-500 font-medium",children:"拖拽四角调整 • 按住中间移动"})]}),(0,l.jsxs)("div",{ref:p,className:"relative max-w-[85vw] max-h-[65vh] border border-white/10 shadow-2xl rounded-lg overflow-hidden select-none bg-black/50 group",style:{cursor:"crosshair"},onMouseDown:e=>v(e,"create"),children:[(0,l.jsx)("img",{ref:h,src:i,className:"max-w-full max-h-[65vh] object-contain block opacity-50",draggable:!1}),c&&c.width>0&&(0,l.jsxs)("div",{className:"absolute",style:{left:c.x,top:c.y,width:c.width,height:c.height},children:[(0,l.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,l.jsx)("img",{src:i,className:"absolute max-w-none",style:{width:null===(t=h.current)||void 0===t?void 0:t.width,height:null===(a=h.current)||void 0===a?void 0:a.height,left:-c.x,top:-c.y,opacity:1}})}),(0,l.jsx)("div",{className:"absolute inset-0 shadow-[0_0_0_9999px_rgba(0,0,0,0.7)] pointer-events-none"}),(0,l.jsx)("div",{className:"absolute inset-0 border-2 border-cyan-400 z-10 pointer-events-none",children:(0,l.jsxs)("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 opacity-40",children:[(0,l.jsx)("div",{className:"border-r border-white/50"}),(0,l.jsx)("div",{className:"border-r border-white/50"}),(0,l.jsx)("div",{className:"col-span-3 border-b border-white/50 -mt-[33%]"}),(0,l.jsx)("div",{className:"col-span-3 border-b border-white/50 mt-[33%]"})]})}),(0,l.jsx)("div",{className:"absolute inset-0 z-20 cursor-move group/move",onMouseDown:e=>v(e,"move"),children:(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover/move:opacity-100 transition-opacity duration-200",children:(0,l.jsx)("div",{className:"bg-black/50 p-2 rounded-full backdrop-blur-sm",children:(0,l.jsx)(eN.Z,{size:16,className:"text-white"})})})}),["nw","ne","sw","se"].map(e=>(0,l.jsx)("div",{className:"\n                            absolute w-4 h-4 bg-white border-2 border-cyan-500 rounded-full z-30 shadow-sm\n                            hover:scale-125 transition-transform\n                        ",style:{cursor:"".concat(e,"-resize"),left:e.includes("w")?-8:"auto",right:e.includes("e")?-8:"auto",top:e.includes("n")?-8:"auto",bottom:e.includes("s")?-8:"auto"},onMouseDown:t=>v(t,"resize",e)},e)),(0,l.jsxs)("div",{className:"absolute -top-7 left-0 flex gap-2 z-20 pointer-events-none",children:[(0,l.jsxs)("div",{className:"bg-cyan-500 text-black text-[9px] font-bold px-1.5 py-0.5 rounded-sm shadow-md",children:[Math.round(c.width)," \xd7 ",Math.round(c.height)]}),u&&(0,l.jsx)("div",{className:"bg-black/60 text-cyan-400 border border-cyan-500/30 text-[9px] font-bold px-1.5 py-0.5 rounded-sm shadow-md",children:null===(s=ek.find(e=>e.value===u))||void 0===s?void 0:s.label})]})]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center gap-6 mt-8 w-full max-w-2xl px-4",children:[(0,l.jsx)("div",{className:"flex items-center gap-2 p-1 bg-[#1c1c1e] border border-white/10 rounded-xl shadow-lg overflow-x-auto custom-scrollbar max-w-full",children:ek.map(e=>(0,l.jsx)("button",{onClick:()=>x(e.value),className:"\n                        relative px-4 py-2 rounded-lg text-xs font-bold transition-all whitespace-nowrap\n                        ".concat(u===e.value?"bg-cyan-500 text-black shadow-md scale-105 z-10":"text-slate-400 hover:text-white hover:bg-white/5","\n                    "),children:e.label},e.label))}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)("button",{onClick:n,className:"px-6 py-2.5 rounded-full bg-white/5 hover:bg-white/10 text-white text-xs font-medium transition-colors border border-white/5",children:"取消"}),(0,l.jsxs)("button",{onClick:()=>{if(!h.current||!c||0===c.width){r(i);return}let e=document.createElement("canvas"),t=h.current.naturalWidth/h.current.width,a=h.current.naturalHeight/h.current.height;e.width=c.width*t,e.height=c.height*a;let s=e.getContext("2d");s&&(s.drawImage(h.current,c.x*t,c.y*a,c.width*t,c.height*a,0,0,c.width*t,c.height*a),r(e.toDataURL("image/png")))},disabled:!c||0===c.width,className:"\n                    px-8 py-2.5 rounded-full text-xs font-bold shadow-lg transition-all flex items-center gap-2\n                    ".concat(c&&0!==c.width?"bg-cyan-500 hover:bg-cyan-400 text-black hover:scale-105 shadow-cyan-500/20":"bg-white/5 text-slate-500 cursor-not-allowed","\n                "),children:[(0,l.jsx)(ee.Z,{size:14})," 确认裁剪"]})]})]})]})};var eR=a(8094),eS=a(4207),eC=a(8095),eA=a(4501),eT=a(9348),ez=a(3751),eO=a(5931);let eM=["#000000","#ffffff","#ff3b30","#ff9500","#ffcc00","#4cd964","#5ac8fa","#007aff","#5856d6","#ff2d55","#8e8e93"],eI=e=>{let{onClose:t,onGenerate:a}=e,s=(0,o.useRef)(null),[i,r]=(0,o.useState)(!1),[n,c]=(0,o.useState)("brush"),[d,u]=(0,o.useState)("#000000"),[x,h]=(0,o.useState)(5),[m,g]=(0,o.useState)(30),[b,f]=(0,o.useState)([]),[v,w]=(0,o.useState)(null),j=(0,o.useRef)(null),[k,E]=(0,o.useState)("video"),[S,C]=(0,o.useState)(""),[z,O]=(0,o.useState)(!1),[M,I]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=s.current;if(!e)return;let t=window.devicePixelRatio||1,a=e.getBoundingClientRect();e.width=a.width*t,e.height=a.height*t;let i=e.getContext("2d");i&&(i.scale(t,t),i.clearRect(0,0,a.width,a.height),i.lineCap="round",i.lineJoin="round",G())},[]);let[D,Z]=(0,o.useState)([]),P=()=>{if(b.length<=1)return;let e=s.current,t=null==e?void 0:e.getContext("2d");if(e&&t){let a=t.getImageData(0,0,e.width,e.height);Z(e=>[...e,a])}let a=[...b];a.pop();let i=a[a.length-1];f(a),e&&t&&i&&t.putImageData(i,0,0)},_=()=>{if(0===D.length)return;let e=[...D],t=e.pop();Z(e);let a=s.current,i=null==a?void 0:a.getContext("2d");a&&i&&t&&(i.putImageData(t,0,0),f(e=>[...e,t]))},G=()=>{let e=s.current,t=null==e?void 0:e.getContext("2d");if(e&&t){let a=t.getImageData(0,0,e.width,e.height);f(e=>[...e.slice(-10),a]),Z([])}},U=e=>{let t=s.current;if(!t)return{x:0,y:0};let a=t.getBoundingClientRect(),i="touches"in e?e.touches[0].clientX:e.clientX,r="touches"in e?e.touches[0].clientY:e.clientY;return{x:i-a.left,y:r-a.top}},L=e=>{var t;r(!0);let{x:a,y:i}=U(e),l=null===(t=s.current)||void 0===t?void 0:t.getContext("2d");l&&(l.beginPath(),l.moveTo(a,i),"eraser"===n?(l.globalCompositeOperation="destination-out",l.lineWidth=m):(l.globalCompositeOperation="source-over",l.strokeStyle=d,l.lineWidth=x))},F=e=>{var t;if(!i)return;let{x:a,y:r}=U(e),n=null===(t=s.current)||void 0===t?void 0:t.getContext("2d");n&&(n.lineTo(a,r),n.stroke())},V=()=>{if(i){var e;r(!1);let t=null===(e=s.current)||void 0===e?void 0:e.getContext("2d");null==t||t.closePath(),t&&(t.globalCompositeOperation="source-over"),G()}};(0,o.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&"z"===e.key&&(e.preventDefault(),P()),(e.ctrlKey||e.metaKey)&&("y"===e.key||e.shiftKey&&"Z"===e.key)&&(e.preventDefault(),_())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[b,D]);let Y=()=>{let e=s.current;if(!e)return"";let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let a=t.getContext("2d");if(!a)return"";if(a.fillStyle="#ffffff",a.fillRect(0,0,t.width,t.height),v){let e=Math.min(t.width/v.width,t.height/v.height),s=v.width*e,i=v.height*e,r=(t.width-s)/2,n=(t.height-i)/2;a.drawImage(v,r,n,s,i)}return a.drawImage(e,0,0),t.toDataURL("image/png")},W=async()=>{if(S.trim()&&!z){O(!0);try{if("pose"===k){let e="\n                Generate a simple, high-contrast black line art sketch on a white background.\n                Subject: ".concat(S,".\n                Style: Minimalist stick figure or outline drawing, clear lines, no shading.\n                "),t=(await (0,ef.oE)(e,"gemini-2.5-flash-image",[],{aspectRatio:"16:9",count:1}))[0],a=new Image;a.crossOrigin="anonymous",a.onload=()=>{let e=s.current,t=null==e?void 0:e.getContext("2d");if(e&&t){t.globalCompositeOperation="source-over";let s=Math.min(e.width/a.width,e.height/a.height),i=a.width*s,r=a.height*s,n=(e.width-i)/2,l=(e.height-r)/2;t.drawImage(a,n,l,i,r),G(),O(!1)}},a.onerror=()=>{throw Error("Failed to load generated pose image")},a.src=t}else{let e=Y();if("video"===k){let t=await (0,ef.wo)(S,"veo-3.1-fast-generate-preview",{aspectRatio:"16:9"},e);a("video",t.uri,S)}else{let t=await (0,ef.oE)(S,"gemini-2.5-flash-image",[e],{aspectRatio:"16:9",count:1});a("image",t[0],S)}t()}}catch(e){console.error(e),alert("生成失败，请重试"),O(!1)}}};return(0,l.jsxs)("div",{className:"fixed inset-0 z-[100] bg-[#0a0a0c] flex flex-col animate-in fade-in duration-300",children:[(0,l.jsxs)("div",{className:"h-14 border-b border-white/10 flex items-center justify-between px-6 bg-[#1c1c1e]",children:[(0,l.jsx)("button",{onClick:t,className:"absolute left-6 p-2 rounded-full bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:(0,l.jsx)(T.Z,{size:16})}),(0,l.jsx)("div",{className:"flex-1 flex justify-center",children:(0,l.jsx)("div",{className:"flex bg-black/30 p-1 rounded-lg",children:[{id:"video",label:"涂鸦生视频",icon:eR.Z},{id:"image",label:"涂鸦生图",icon:A.Z},{id:"pose",label:"姿势生成器 (Pose)",icon:eS.Z}].map(e=>(0,l.jsxs)("button",{onClick:()=>E(e.id),className:"\n                                    flex items-center gap-2 px-6 py-1.5 rounded-md text-xs font-bold transition-all\n                                    ".concat(k===e.id?"bg-white/10 text-white shadow-sm":"text-slate-500 hover:text-slate-300","\n                                "),children:[(0,l.jsx)(e.icon,{size:12}),e.label]},e.id))})})]}),(0,l.jsxs)("div",{className:"flex-1 relative bg-[#121214] flex items-center justify-center p-8 overflow-hidden",children:[(0,l.jsxs)("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 z-20 flex items-center gap-2 p-1.5 bg-[#2c2c2e]/90 backdrop-blur-xl border border-white/10 rounded-full shadow-2xl",children:[(0,l.jsx)("button",{onClick:()=>c("brush"),className:"p-2.5 rounded-full transition-colors ".concat("brush"===n?"bg-cyan-500 text-black":"text-slate-400 hover:text-white hover:bg-white/5"),title:"画笔",children:(0,l.jsx)(q.Z,{size:16})}),(0,l.jsx)("button",{onClick:()=>c("eraser"),className:"p-2.5 rounded-full transition-colors ".concat("eraser"===n?"bg-cyan-500 text-black":"text-slate-400 hover:text-white hover:bg-white/5"),title:"橡皮擦",children:(0,l.jsx)(eC.Z,{size:16})}),(0,l.jsx)("div",{className:"w-px h-6 bg-white/10 mx-1"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("button",{onClick:()=>I(!M),className:"p-2.5 rounded-full transition-colors text-slate-400 hover:text-white hover:bg-white/5 relative",title:"调色板",children:[(0,l.jsx)(eA.Z,{size:16,style:{color:"brush"===n?d:void 0}}),(0,l.jsx)("div",{className:"absolute bottom-1 right-1 w-2 h-2 rounded-full border border-[#2c2c2e]",style:{backgroundColor:d}})]}),M&&(0,l.jsx)("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-3 p-3 bg-[#1c1c1e] border border-white/10 rounded-xl shadow-xl grid grid-cols-4 gap-2 w-48 z-30",children:eM.map(e=>(0,l.jsx)("button",{onClick:()=>{u(e),c("brush"),I(!1)},className:"w-8 h-8 rounded-full border-2 ".concat(d===e?"border-white":"border-transparent hover:scale-110"),style:{backgroundColor:e}},e))})]}),(0,l.jsx)("div",{className:"w-px h-6 bg-white/10 mx-1"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-black/20 rounded-full border border-white/5",children:[(0,l.jsx)("span",{className:"text-[10px] font-bold text-slate-500 uppercase",children:"Size"}),(0,l.jsx)("input",{type:"range",min:"1",max:"50",step:"1",value:"eraser"===n?m:x,onChange:e=>{let t=parseInt(e.target.value);"eraser"===n?g(t):h(t)},className:"w-20 h-1 bg-white/10 rounded-full appearance-none [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-cyan-500 cursor-pointer"}),(0,l.jsx)("span",{className:"text-[10px] font-mono text-slate-400 min-w-[20px]",children:"eraser"===n?m:x})]}),(0,l.jsx)("div",{className:"w-px h-6 bg-white/10 mx-1"}),(0,l.jsx)("button",{onClick:P,disabled:b.length<=1,className:"p-2.5 rounded-full transition-colors ".concat(b.length<=1?"opacity-20 cursor-not-allowed":"text-slate-400 hover:text-white hover:bg-white/5"),title:"撤销 (Ctrl+Z)",children:(0,l.jsx)(eT.Z,{size:16})}),(0,l.jsx)("button",{onClick:_,disabled:0===D.length,className:"p-2.5 rounded-full transition-colors ".concat(0===D.length?"opacity-20 cursor-not-allowed":"text-slate-400 hover:text-white hover:bg-white/5"),title:"重做 (Ctrl+Y)",children:(0,l.jsx)(ez.Z,{size:16})}),(0,l.jsx)("button",{onClick:()=>{let e=s.current,t=null==e?void 0:e.getContext("2d");e&&t&&(t.clearRect(0,0,e.width,e.height),G())},className:"p-2.5 rounded-full text-red-400 hover:bg-red-500/10",title:"清空画布",children:(0,l.jsx)(N.Z,{size:16})})]}),(0,l.jsxs)("div",{className:"relative shadow-2xl rounded-lg overflow-hidden border border-white/5 bg-[#ffffff] select-none",style:{aspectRatio:"16/9",height:"100%",maxHeight:"800px"},children:[v&&(0,l.jsx)("img",{src:v.src,className:"absolute inset-0 w-full h-full object-contain pointer-events-none opacity-50",alt:"Reference"}),(0,l.jsx)("canvas",{ref:s,className:"absolute inset-0 w-full h-full cursor-crosshair touch-none",onMouseDown:L,onMouseMove:F,onMouseUp:V,onMouseLeave:V,onTouchStart:L,onTouchMove:F,onTouchEnd:V})]})]}),(0,l.jsxs)("div",{className:"h-20 bg-[#1c1c1e] border-t border-white/10 flex items-center px-8 gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mr-4",children:[(0,l.jsxs)("div",{className:"relative p-2 rounded-lg bg-white/5 text-slate-400 hover:text-white border border-white/5 cursor-pointer hover:bg-white/10 transition-colors",onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},title:"导入底图",children:[(0,l.jsx)(eO.Z,{size:16}),(0,l.jsx)("input",{type:"file",ref:j,className:"hidden",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){let e=new FileReader;e.onload=e=>{var t;let a=new Image;a.onload=()=>w(a),a.src=null===(t=e.target)||void 0===t?void 0:t.result},e.readAsDataURL(a)}}})]}),(0,l.jsx)("button",{onClick:()=>{if(s.current){let e=document.createElement("a");e.href=Y(),e.download="sketch.png",e.click()}},className:"p-2 rounded-lg bg-white/5 text-slate-400 hover:text-white border border-white/5",title:"下载当前画布",children:(0,l.jsx)(R.Z,{size:16})})]}),(0,l.jsx)("div",{className:"flex-1 relative",children:(0,l.jsx)("input",{type:"text",value:S,onChange:e=>C(e.target.value),placeholder:"pose"===k?"描述姿势 (e.g. A stick figure running fast)...":"描述画面内容 (e.g. Milk splash around the bottle)...",className:"w-full h-11 bg-black/30 border border-white/10 rounded-xl px-4 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 transition-colors",onKeyDown:e=>"Enter"===e.key&&W()})}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("div",{className:"h-11 px-4 flex items-center gap-2 bg-black/30 border border-white/10 rounded-xl text-xs text-slate-300 font-medium",children:[(0,l.jsx)("span",{children:"pose"===k?"Gemini 2.5 (Pose)":"video"===k?"Veo 3.1 Fast":"Gemini 2.5"}),(0,l.jsx)(p.Z,{size:12,className:"text-slate-500"})]}),(0,l.jsx)("div",{className:"w-px h-6 bg-white/10 mx-2"}),(0,l.jsxs)("button",{onClick:W,disabled:z||!S.trim(),className:"\n                            h-11 px-6 rounded-xl flex items-center gap-2 font-bold text-sm transition-all\n                            ".concat(z||!S.trim()?"bg-white/5 text-slate-500 cursor-not-allowed":"pose"===k?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white hover:scale-105":"bg-gradient-to-r from-cyan-600 to-blue-600 text-white hover:scale-105","\n                        "),children:[z?(0,l.jsx)(y.Z,{className:"animate-spin",size:16}):(0,l.jsx)(eg.Z,{size:16}),(0,l.jsx)("span",{children:"pose"===k?"生成姿势":"生成作品"})]})]})]})]})};var eD=a(4841),eZ=a(8537),eP=a(1322),e_=a(1976),eG=a(4504);let eU="cubic-bezier(0.32, 0.72, 0, 1)",eL=e=>{let{isOpen:t,onClose:a,onGenerate:s,onGenerateAudio:i,onGenerateSegment:r,onConnectStart:n}=e,[u,x]=(0,o.useState)([]),[h,p]=(0,o.useState)(null),[m,g]=(0,o.useState)(null),[b,v]=(0,o.useState)(null),[w,j]=(0,o.useState)(!1),[k,E]=(0,o.useState)(!1),S=(0,o.useRef)(null),C=(0,o.useRef)(null),[A,O]=(0,o.useState)([]),[M,I]=(0,o.useState)(0),[Z,P]=(0,o.useState)(null),[_,G]=(0,o.useState)(!1),[L,F]=(0,o.useState)(!1),[V,Y]=(0,o.useState)(null),[W,B]=(0,o.useState)({current:0,total:0}),[K,X]=(0,o.useState)(null),[H,J]=(0,o.useState)(""),[q,$]=(0,o.useState)(3),Q=(0,o.useRef)(null),ee=(0,o.useRef)(null),et=(0,o.useRef)(null),ea=u.reduce((e,t,a)=>a<u.length-1?e+t.transition.duration:e,0);(0,o.useEffect)(()=>{let e=e=>{K&&et.current&&!et.current.contains(e.target)&&!e.target.closest("button[data-link-btn]")&&ed()};return window.addEventListener("mousedown",e),()=>window.removeEventListener("mousedown",e)},[K,H,q]);let es=async()=>{if(!(u.length<2)&&!_){G(!0),B({current:0,total:u.length-1}),O([]),I(0),j(!1);try{let e=await s(u,(e,t)=>{B({current:e,total:t})});Array.isArray(e)?O(e):O([e]),setTimeout(()=>{S.current&&S.current.play().then(()=>j(!0)).catch(()=>{})},100)}catch(e){console.error("Generation failed",e),alert("视频生成失败: ".concat(e.message||"未知错误"))}finally{G(!1),B({current:0,total:0})}}},ei=async()=>{if(!(u.length<2)&&!L&&i){F(!0);try{let e=u.map(e=>e.transition.prompt).filter(Boolean).join(". ")||"Cinematic sequence",t=await i("Soundtrack for a video: ".concat(e,". Mood: Cinematic, Ambient, Flowing."));P(t)}catch(e){console.error("Audio generation failed",e),alert("音频生成失败")}finally{F(!1)}}},er=()=>{var e,t;S.current&&0!==A.length&&(w?(S.current.pause(),null===(e=C.current)||void 0===e||e.pause(),j(!1)):(S.current.play(),null===(t=C.current)||void 0===t||t.play(),j(!0)))};(0,o.useEffect)(()=>{0===M&&w&&C.current&&(C.current.currentTime=0,C.current.play())},[M,w]);let en=(e,t)=>{p(t),e.dataTransfer.effectAllowed="move";let a=new Image;a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",e.dataTransfer.setDragImage(a,0,0)},el=(e,t)=>{if(e.preventDefault(),null!==h&&h!==t){g(t);let e=[...u],[a]=e.splice(h,1);e.splice(t,0,a),x(e),p(t)}},eo=e=>{var t;e.preventDefault(),p(null),g(null);let a=e.dataTransfer.getData("application/inkai-media");if(a)try{let e=JSON.parse(a);if("image"===e.type&&e.src){let t={id:"seq-".concat(Date.now(),"-").concat(Math.random()),src:e.src,transition:{duration:3,prompt:""}};x(e=>[...e,t].slice(0,10));return}}catch(e){console.error("Failed to parse internal drag data",e)}if((null===(t=e.dataTransfer.files)||void 0===t?void 0:t.length)>0){let t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));t.length>0&&Promise.all(t.map(e=>new Promise(t=>{let a=new FileReader;a.onload=e=>{var a;return t({id:"seq-".concat(Date.now(),"-").concat(Math.random()),src:null===(a=e.target)||void 0===a?void 0:a.result,transition:{duration:3,prompt:""}})},a.readAsDataURL(e)}))).then(e=>{x(t=>[...t,...e].slice(0,10))})}},ec=(e,t)=>{K===e?ed():(ed(),X(e),J(t.prompt),$(t.duration))},ed=()=>{K&&(x(e=>e.map(e=>e.id===K?{...e,transition:{prompt:H,duration:q}}:e)),X(null))};if(!t)return null;let eu=async()=>{if(r&&!(M>=u.length-1)){Y(M),j(!1);try{let e=u[M],t=u[M+1],a=await r(e,t);O(e=>{let t=[...e];return t[M]=a,t}),S.current&&(S.current.currentTime=0,S.current.play(),j(!0))}catch(e){console.error("Segment regeneration failed",e),alert("片段重绘失败: ".concat(e.message||"未知错误"))}finally{Y(null)}}};return(0,l.jsxs)(l.Fragment,{children:[k&&(0,l.jsx)("div",{className:"fixed inset-0 z-[90] bg-black/80 backdrop-blur-sm animate-in fade-in duration-300",onClick:()=>E(!1),children:(0,l.jsx)("button",{className:"absolute top-6 right-6 p-3 bg-white/10 hover:bg-white/20 rounded-full text-white/70 hover:text-white transition-all z-[110]",onClick:e=>{e.stopPropagation(),E(!1)},children:(0,l.jsx)(T.Z,{size:24})})}),(0,l.jsxs)("div",{ref:ee,className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-[80] flex flex-col items-center gap-2 transition-all duration-500 ease-[".concat(eU,"] animate-in slide-in-from-bottom-20 fade-in"),children:[(0,l.jsxs)("div",{className:"relative group/player mb-2",children:[!k&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{onMouseDown:e=>null==n?void 0:n(e,"input"),className:"absolute -left-8 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border border-white/20 bg-[#1c1c1e] flex items-center justify-center opacity-0 group-hover/player:opacity-100 hover:scale-125 transition-all cursor-crosshair z-30",title:"Connect Input",children:(0,l.jsx)(z.Z,{size:12,className:"text-white/50"})}),(0,l.jsx)("div",{onMouseDown:e=>null==n?void 0:n(e,"output"),className:"absolute -right-8 top-1/2 -translate-y-1/2 w-6 h-6 rounded-full border border-white/20 bg-[#1c1c1e] flex items-center justify-center opacity-0 group-hover/player:opacity-100 hover:scale-125 transition-all cursor-crosshair z-30",title:"Connect Output",children:(0,l.jsx)(z.Z,{size:12,className:"text-white/50"})})]}),(0,l.jsxs)("div",{className:"\n            relative bg-black border border-white/10 shadow-2xl overflow-hidden flex items-center justify-center transition-all duration-500 ease-[".concat(eU,"]\n            ").concat(k?"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[50vw] h-[28.125vw] max-w-[90vw] max-h-[80vh] z-[100] rounded-2xl shadow-[0_0_100px_rgba(0,0,0,0.8)]":"w-[360px] h-[202px] rounded-xl","\n        "),children:[(0,l.jsxs)("div",{className:"absolute top-3 left-3 flex gap-2 z-20 transition-opacity duration-200 ".concat(_?"opacity-0":"opacity-0 hover:opacity-100 group-hover/player:opacity-100"),children:[(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),E(!k)},className:"p-2 bg-black/60 backdrop-blur-md rounded-lg text-white/70 hover:text-white border border-white/10 hover:scale-105 transition-all",title:k?"退出全屏":"放大预览",children:k?(0,l.jsx)(d.Z,{size:16}):(0,l.jsx)(c.Z,{size:16})}),A.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("a",{href:A[M],download:"sunstudio_seq_".concat(Date.now(),"_part").concat(M+1,".mp4"),onClick:e=>e.stopPropagation(),className:"p-2 bg-black/60 backdrop-blur-md rounded-lg text-white/70 hover:text-white border border-white/10 hover:scale-105 transition-all",title:"下载当前片段",target:"_blank",rel:"noopener noreferrer",children:(0,l.jsx)(R.Z,{size:16})}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation();let t=u[M];t&&ec(t.id,t.transition)},className:"p-2 bg-black/60 backdrop-blur-md rounded-lg text-white/70 hover:text-white border border-white/10 hover:scale-105 transition-all",title:"微调并重绘当前片段",children:V===M?(0,l.jsx)(y.Z,{size:16,className:"animate-spin"}):(0,l.jsx)(f.Z,{size:16})})]})]}),_?(0,l.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,l.jsx)(y.Z,{size:32,className:"animate-spin text-cyan-500"}),(0,l.jsx)("span",{className:"text-[10px] font-bold text-slate-400 tracking-widest uppercase animate-pulse",children:W.total>0?"正在生成片段 ".concat(W.current," / ").concat(W.total,"..."):"正在生成智能补帧..."}),W.total>1&&(0,l.jsx)("div",{className:"w-24 h-1 bg-white/10 rounded-full overflow-hidden mt-1",children:(0,l.jsx)("div",{className:"h-full bg-cyan-500 transition-all duration-500",style:{width:"".concat(W.current/W.total*100,"%")}})})]}):A.length>0?(0,l.jsxs)("div",{className:"relative w-full h-full group/video",onClick:er,children:[Z&&(0,l.jsx)("audio",{ref:C,src:Z,loop:!0}),(0,l.jsx)("video",{ref:S,src:A[M],className:"w-full h-full object-contain bg-black",playsInline:!0,crossOrigin:"anonymous",onEnded:()=>{if(M<A.length-1)I(e=>e+1),setTimeout(()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.play()},50);else{var e;j(!1),I(0),null===(e=C.current)||void 0===e||e.pause()}},onError:e=>{console.error("Video playback error",e)}}),!w&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-[1px]",children:(0,l.jsx)(eR.Z,{size:48,className:"text-white/80 fill-white/20"})}),A.length>1&&(0,l.jsx)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-1 pointer-events-none",children:A.map((e,t)=>(0,l.jsx)("div",{className:"h-1 rounded-full transition-all ".concat(t===M?"w-6 bg-cyan-500":"w-2 bg-white/30")},t))})]}):u.length>0?(0,l.jsxs)("div",{className:"relative w-full h-full",children:[(0,l.jsx)("img",{src:null!==b&&u[b]?u[b].src:u[0].src,className:"w-full h-full object-contain opacity-80"}),(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,l.jsx)("button",{onClick:er,disabled:0===A.length,className:"w-14 h-14 rounded-full flex items-center justify-center transition-all backdrop-blur-md group/play\n                                ".concat(A.length>0?"bg-cyan-500/20 hover:bg-cyan-500/40 border border-cyan-500/50 shadow-[0_0_20px_rgba(6,182,212,0.3)]":"bg-white/5 border border-white/10 cursor-default opacity-50","\n                             "),children:w?(0,l.jsx)(eD.Z,{size:24,className:"text-white"}):(0,l.jsx)(eR.Z,{size:24,className:"text-white ml-1",fill:A.length>0?"currentColor":"none"})})}),(0,l.jsxs)("div",{className:"absolute top-2 right-2 px-2 py-1 bg-black/50 backdrop-blur rounded text-[9px] text-slate-300 font-mono border border-white/5 pointer-events-none",children:[ea,"s • ",u.length," Frames"]})]}):(0,l.jsxs)("div",{className:"flex flex-col items-center text-slate-600 gap-2 select-none",children:[(0,l.jsx)(eZ.Z,{size:32,strokeWidth:1}),(0,l.jsx)("span",{className:"text-[10px] font-medium tracking-wider",children:"智能多帧预览"})]})]})]}),(0,l.jsxs)("div",{className:"w-full h-6 bg-[#1c1c1e]/80 backdrop-blur-md rounded-t-lg border-t border-x border-white/5 relative overflow-hidden flex cursor-crosshair group/strip",style:{width:"min(90vw, 820px)"},onMouseMove:e=>{let t=e.currentTarget.getBoundingClientRect();v(Math.min(u.length-1,Math.floor((e.clientX-t.left)/t.width*u.length)))},onMouseLeave:()=>v(null),children:[u.map((e,t)=>(0,l.jsx)("div",{className:"flex-1 h-full relative border-r border-white/5 last:border-0 overflow-hidden",children:(0,l.jsx)("img",{src:e.src,className:"w-full h-full object-cover opacity-30 grayscale group-hover/strip:opacity-50 transition-opacity"})},e.id)),null!==b&&u.length>0&&(0,l.jsx)("div",{className:"absolute top-0 bottom-0 bg-cyan-500/20 border-x border-cyan-500/50 pointer-events-none transition-all duration-75 ease-out",style:{left:"".concat(b/u.length*100,"%"),width:"".concat(100/u.length,"%")}})]}),(0,l.jsxs)("div",{className:"bg-[#0a0a0c]/95 backdrop-blur-2xl border border-white/10 rounded-b-2xl rounded-t-sm shadow-[0_20px_60px_rgba(0,0,0,0.6)] p-4 flex items-center gap-4 relative z-10",style:{width:"min(90vw, 820px)"},children:[(0,l.jsx)("button",{onClick:a,className:"absolute -top-3 left-0 -translate-y-full p-2 text-slate-400 hover:text-white bg-black/50 backdrop-blur rounded-full border border-white/10 transition-colors",children:(0,l.jsx)(T.Z,{size:14})}),(0,l.jsxs)("div",{className:"flex-1 flex items-center gap-2 overflow-x-auto custom-scrollbar pb-1 min-h-[80px]",children:[u.map((e,t)=>(0,l.jsxs)(o.Fragment,{children:[(0,l.jsxs)("div",{className:"\n                                        relative w-[72px] h-[72px] shrink-0 rounded-lg overflow-hidden border transition-all duration-300 ease-out group select-none\n                                        ".concat(h===t?"opacity-30 scale-90 grayscale":"border-white/10 hover:border-white/30 bg-white/5","\n                                        ").concat(m===t?"translate-x-2":"","\n                                    "),onDragOver:e=>el(e,t),onDrop:eo,children:[(0,l.jsx)("img",{src:e.src,className:"w-full h-full object-cover pointer-events-none"}),(0,l.jsx)("div",{className:"absolute top-0.5 right-0.5 w-4 h-4 bg-black/60 rounded-full flex items-center justify-center text-[8px] font-bold text-white/80 pointer-events-none",children:t+1}),(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),x(t=>t.filter(t=>t.id!==e.id))},className:"absolute top-0.5 left-0.5 w-4 h-4 rounded-full flex items-center justify-center bg-black/60 hover:bg-red-500 text-white/70 hover:text-white transition-colors opacity-0 group-hover:opacity-100 z-20",children:(0,l.jsx)(T.Z,{size:10,strokeWidth:3})}),(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-grab active:cursor-grabbing bg-black/20 backdrop-blur-[1px]",draggable:!0,onDragStart:e=>en(e,t),children:(0,l.jsx)("div",{className:"w-8 h-8 rounded-full bg-black/50 flex items-center justify-center border border-white/20 text-white/80 hover:scale-110 transition-transform",children:(0,l.jsx)(eP.Z,{size:16})})})]}),t<u.length-1&&(0,l.jsxs)("div",{className:"relative flex flex-col items-center justify-center w-6 shrink-0 z-10",children:[(0,l.jsx)("div",{className:"h-[2px] w-full bg-white/10 absolute top-1/2 -translate-y-1/2 -z-10"}),(0,l.jsx)("button",{"data-link-btn":!0,onClick:()=>ec(e.id,e.transition),className:"\n                                                w-5 h-5 rounded-full flex items-center justify-center transition-all hover:scale-110 border\n                                                ".concat(e.transition.prompt?"bg-cyan-500 border-cyan-400 text-black shadow-[0_0_10px_rgba(6,182,212,0.5)]":"bg-[#2c2c2e] border-white/20 text-slate-500 hover:text-white hover:border-white","\n                                            "),children:(0,l.jsx)(D.Z,{size:10,strokeWidth:2.5})}),(0,l.jsxs)("span",{className:"text-[8px] text-slate-500 mt-1 font-mono tracking-tighter",children:[e.transition.duration,"s"]})]})]},e.id)),u.length<10&&(0,l.jsxs)("div",{className:"w-[72px] h-[72px] shrink-0 rounded-lg border border-dashed border-white/10 hover:border-white/30 bg-white/5 hover:bg-white/10 flex flex-col items-center justify-center gap-1 cursor-pointer transition-all group active:scale-95",onClick:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.click()},onDragOver:e=>e.preventDefault(),onDrop:eo,children:[(0,l.jsx)(z.Z,{size:18,className:"text-slate-500 group-hover:text-white transition-colors"}),(0,l.jsx)("span",{className:"text-[9px] text-slate-500 font-medium",children:"Add"})]}),(0,l.jsx)("input",{type:"file",ref:Q,className:"hidden",accept:"image/*",multiple:!0,onChange:e=>{e.target.files&&e.target.files.length>0&&Promise.all(Array.from(e.target.files).map(e=>new Promise(t=>{let a=new FileReader;a.onload=e=>{var a;return t({id:"seq-".concat(Date.now(),"-").concat(Math.random()),src:null===(a=e.target)||void 0===a?void 0:a.result,transition:{duration:3,prompt:""}})},a.readAsDataURL(e)}))).then(e=>x(t=>[...t,...e].slice(0,10))),e.target.value=""}})]}),(0,l.jsxs)("div",{className:"pl-4 border-l border-white/10 flex flex-col gap-2 shrink-0",children:[(0,l.jsx)("button",{onClick:()=>x([]),className:"p-2 rounded-lg bg-white/5 hover:bg-red-500/20 text-slate-400 hover:text-red-400 transition-colors",title:"全部清空",children:(0,l.jsx)(N.Z,{size:14})}),(0,l.jsx)("button",{onClick:es,disabled:u.length<2||_,className:"\n                                w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-lg\n                                ".concat(u.length>=2&&!_?"bg-gradient-to-br from-cyan-500 to-blue-600 text-white hover:scale-110 hover:shadow-cyan-500/30":"bg-white/10 text-slate-600 cursor-not-allowed","\n                            "),title:"生成视频",children:_?(0,l.jsx)(y.Z,{size:18,className:"animate-spin"}):(0,l.jsx)(e_.Z,{size:18,strokeWidth:3})}),(0,l.jsx)("button",{onClick:ei,disabled:0===A.length||L,className:"\n                                w-10 h-10 rounded-full flex items-center justify-center transition-all shadow-lg\n                                ".concat(A.length>0&&!L?Z?"bg-purple-500/20 text-purple-400 border border-purple-500/50":"bg-white/5 hover:bg-purple-500/20 text-slate-400 hover:text-purple-400":"bg-white/5 text-slate-600 cursor-not-allowed opacity-50","\n                            "),title:Z?"重新生成配乐":"生成智能配乐",children:L?(0,l.jsx)(y.Z,{size:16,className:"animate-spin"}):(0,l.jsx)(eG.Z,{size:16})})]})]}),K&&(0,l.jsxs)("div",{ref:et,className:"absolute bottom-[130px] z-[100] w-[240px] aspect-[9/16] bg-[#18181b] border border-white/10 rounded-2xl shadow-[0_20px_60px_rgba(0,0,0,0.9)] flex flex-col animate-in slide-in-from-bottom-4 zoom-in-95 duration-300 overflow-hidden",style:{left:"50%",transform:"translateX(-50%)"},children:[(0,l.jsxs)("div",{className:"px-4 py-4 border-b border-white/5 bg-white/5 flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-xs font-bold text-slate-200 tracking-wide",children:"运镜描述"}),(0,l.jsx)("button",{onClick:()=>ed(),className:"text-slate-500 hover:text-white",children:(0,l.jsx)(T.Z,{size:12})})]}),(0,l.jsx)("div",{className:"flex-1 p-4",children:(0,l.jsx)("textarea",{className:"w-full h-full bg-[#09090b] border border-white/10 rounded-xl p-3 text-xs text-slate-200 placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 resize-none leading-relaxed custom-scrollbar shadow-inner",placeholder:"描述镜头之间的转换...",value:H,onChange:e=>J(e.target.value),autoFocus:!0})}),(0,l.jsxs)("div",{className:"p-4 pt-0 flex flex-col gap-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 bg-[#09090b] border border-white/10 rounded-xl px-3 py-2",children:[(0,l.jsx)(U.Z,{size:12,className:"text-slate-500 shrink-0"}),(0,l.jsx)("input",{type:"range",min:"1",max:"6",step:"0.5",value:q,onChange:e=>$(parseFloat(e.target.value)),className:"flex-1 h-1 bg-white/10 rounded-full appearance-none [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3 [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-cyan-500 cursor-pointer"}),(0,l.jsxs)("span",{className:"text-[10px] font-mono text-slate-300 min-w-[24px] text-right",children:[q,"s"]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:ed,className:"flex-1 py-2.5 bg-white text-black hover:bg-slate-200 rounded-xl text-xs font-bold transition-colors shadow-lg",children:"保存设置"}),A.length>0&&A[u.findIndex(e=>e.id===K)]&&(0,l.jsx)("button",{onClick:()=>{ed();let e=u.findIndex(e=>e.id===K);-1!==e&&(I(e),setTimeout(eu,50))},className:"px-3 py-2.5 bg-cyan-500 hover:bg-cyan-400 text-black rounded-xl text-xs font-bold transition-colors shadow-lg shadow-cyan-500/20",title:"保存并重绘此片段",children:(0,l.jsx)(f.Z,{size:14})})]})]}),(0,l.jsx)("div",{className:"absolute bottom-[-5px] left-1/2 -translate-x-1/2 w-3 h-3 bg-[#18181b] border-r border-b border-white/10 rotate-45 pointer-events-none"})]})]})]})};var eF=a(7573),eV=a(2023),eY=a(7583),eW=a(8184),eB=a(769),eK=a(2092),eX=a(8733),eH=a(8785);let eJ=[{label:"深沉叙述 (Narrator)",desc:"Deep, resonant male voice, slow pacing, storytelling style.",gender:"Male"},{label:"活力解说 (Energetic)",desc:"High energy, fast paced, enthusiastic YouTuber style.",gender:"Any"},{label:"知性新闻 (News)",desc:"Professional, articulate, neutral tone, broadcast standard.",gender:"Female"},{label:"动漫少女 (Anime)",desc:'High pitched, cute, expressive, "kawaii" aesthetic.',gender:"Female"},{label:"电影旁白 (Epic)",desc:"Gravelly, dramatic, movie trailer voice, intense.",gender:"Male"},{label:"慈祥长者 (Elder)",desc:"Warm, shaky, wise, slow speaking grandmother/grandfather.",gender:"Any"}],eq=[{label:"默认 (Neutral)",value:"neutral"},{label:"开心 (Happy)",value:"cheerful and excited"},{label:"悲伤 (Sad)",value:"melancholic and tearful"},{label:"愤怒 (Angry)",value:"furious and shouting"},{label:"耳语 (Whisper)",value:"whispering quietly"},{label:"恐惧 (Scared)",value:"trembling and fearful"}],e$=["from-pink-500 to-rose-500","from-cyan-500 to-blue-500","from-purple-500 to-indigo-500","from-emerald-500 to-teal-500","from-orange-500 to-amber-500","from-slate-700 to-slate-900"],eQ=async(e,t)=>{let a=atob(e),s=a.length,i=new Uint8Array(s);for(let e=0;e<s;e++)i[e]=a.charCodeAt(e);let r=new Int16Array(i.buffer),n=new Float32Array(r.length);for(let e=0;e<r.length;e++)n[e]=r[e]/32768;let l=t.createBuffer(1,n.length,24e3);return l.copyToChannel(n,0),l},e0=e=>{let t=new Int16Array(e.length);for(let a=0;a<e.length;a++){let s=Math.max(-1,Math.min(1,e[a]));t[a]=s<0?32768*s:32767*s}return t},e1=e=>{let t="",a=new Uint8Array(e),s=a.byteLength;for(let e=0;e<s;e++)t+=String.fromCharCode(a[e]);return btoa(t)},e2=e=>{let{isOpen:t,onClose:a,history:s,onGenerate:i,onSaveToAssets:r}=e,[n,c]=(0,o.useState)("factory"),[d,u]=(0,o.useState)([]),[x,h]=(0,o.useState)(!1),p=(0,o.useRef)(null),m=(0,o.useRef)(null),g=(0,o.useRef)(null),b=(0,o.useRef)(null),f=(0,o.useRef)(null),[v,w]=(0,o.useState)(null),[j,k]=(0,o.useState)(!1),[E,S]=(0,o.useState)(.8),[C,A]=(0,o.useState)(0),[z,O]=(0,o.useState)(0),M=(0,o.useRef)(null),I=(0,o.useRef)(null),D=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(j&&p.current&&M.current){if(!m.current){let e=new(window.AudioContext||window.webkitAudioContext);m.current=e;let t=e.createAnalyser();t.fftSize=256,b.current=t;let a=e.createMediaElementSource(M.current);g.current=a,a.connect(t),t.connect(e.destination)}let e=m.current,t=b.current;"suspended"===e.state&&e.resume();let a=()=>{let e;let s=p.current;if(!s)return;let i=s.getContext("2d");if(!i)return;let r=t.frequencyBinCount,n=new Uint8Array(r);t.getByteFrequencyData(n),i.clearRect(0,0,s.width,s.height);let l=s.width/r*2.5,o=0;for(let t=0;t<r;t++){e=n[t]/2;let a=i.createLinearGradient(0,s.height,0,0);a.addColorStop(0,"#06b6d4"),a.addColorStop(1,"#8b5cf6"),i.fillStyle=a,i.fillRect(o,s.height-e,l,e),o+=l+1}f.current=requestAnimationFrame(a)};return a(),()=>{f.current&&cancelAnimationFrame(f.current)}}},[j,v]);let[Z,P]=(0,o.useState)(""),[_,G]=(0,o.useState)(null),[U,L]=(0,o.useState)(eq[0]),[F,V]=(0,o.useState)(null),[Y,W]=(0,o.useState)(null),[B,K]=(0,o.useState)(!1),[X,H]=(0,o.useState)(null),[q,Q]=(0,o.useState)(null),[ee,et]=(0,o.useState)(""),[ea,ei]=(0,o.useState)(!1),[er,en]=(0,o.useState)(!1),[el,eo]=(0,o.useState)("Ready"),[ec,ed]=(0,o.useState)(null),eu=(0,o.useRef)(0),ex=(0,o.useRef)(null),eh=(0,o.useRef)(null),ep=(0,o.useRef)(null);(0,o.useEffect)(()=>{v&&M.current&&(M.current.src=v.src,M.current.play().then(()=>k(!0)).catch(()=>{}))},[v]);let em=()=>{M.current&&(A(M.current.currentTime),O(M.current.duration||0))},eb=async()=>{if(Z.trim()&&!B){K(!0);try{let e=await (0,ef.gW)(Z,F||void 0,{persona:_,emotion:U});i(e,Z,0),w({id:"temp-".concat(Date.now()),src:e,title:Z.substring(0,30)+(Z.length>30?"...":""),timestamp:Date.now()})}catch(e){console.error(e),alert("生成失败，请重试")}finally{K(!1)}}},ev=async()=>{if(X&&!ea){ei(!0);try{let e=await (0,ef.KR)(X);et(e)}catch(e){console.error(e),alert("转录失败")}finally{ei(!1)}}},ew=async()=>{try{eo("Connecting...");let e=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});ed(e),eu.current=0;let t=await (0,ef.jL)(async t=>{"suspended"===e.state&&await e.resume();let a=await eQ(t,e),s=e.createBufferSource();s.buffer=a,s.connect(e.destination);let i=e.currentTime,r=Math.max(i,eu.current);s.start(r),eu.current=r+a.duration},()=>ey());ex.current=t;let a=await navigator.mediaDevices.getUserMedia({audio:!0});ep.current=a;let s=e.createMediaStreamSource(a),i=e.createScriptProcessor(4096,1,1);eh.current=i,i.onaudioprocess=e=>{let a=e.inputBuffer.getChannelData(0),s=e0(a),i=e1(s.buffer);t.sendRealtimeInput({media:{mimeType:"audio/pcm;rate=16000",data:i}})},s.connect(i),i.connect(e.destination);let r=e.createGain();r.gain.value=0,i.connect(r),r.connect(e.destination),eo("Connected & Listening"),en(!0)}catch(e){console.error("Live Error",e),eo("Error Connecting"),ey()}},ey=()=>{ex.current&&(ex.current=null),eh.current&&(eh.current.disconnect(),eh.current=null),ep.current&&(ep.current.getTracks().forEach(e=>e.stop()),ep.current=null),ec&&(ec.close(),ed(null)),en(!1),eo("Ready")},ej=e=>{let t=e.charCodeAt(e.length-1)%e$.length;return e$[t]};return(0,l.jsxs)("div",{className:"fixed inset-0 z-[100] transition-all duration-500 ease-[cubic-bezier(0.32,0.72,0,1)] bg-[#0a0a0c] overflow-hidden flex ".concat(t?"opacity-100 scale-100 translate-x-0":"opacity-0 scale-95 -translate-x-10 pointer-events-none"),style:{transformOrigin:"left center"},children:[(0,l.jsx)("div",{className:"absolute top-[-20%] right-[-10%] w-[600px] h-[600px] rounded-full bg-cyan-900/10 blur-[120px] pointer-events-none"}),(0,l.jsx)("div",{className:"absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] rounded-full bg-purple-900/10 blur-[100px] pointer-events-none"}),(0,l.jsxs)("div",{className:"w-64 h-full border-r border-white/5 bg-[#121214] flex flex-col z-10",children:[(0,l.jsxs)("div",{className:"h-16 flex items-center px-6 border-b border-white/5 gap-3",children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-purple-900/20",children:(0,l.jsx)(eF.Z,{size:16,className:"text-white"})}),(0,l.jsx)("span",{className:"text-sm font-bold tracking-wide text-white",children:"Audio Hub"})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 p-4",children:[(0,l.jsxs)("button",{onClick:()=>c("factory"),className:"flex items-center gap-3 px-3 py-2.5 rounded-xl text-xs font-bold transition-all ".concat("factory"===n?"bg-white/10 text-white shadow-md":"text-slate-400 hover:bg-white/5 hover:text-white"),children:[(0,l.jsx)(J.Z,{size:16})," 声音工厂 (Voice Factory)"]}),(0,l.jsxs)("button",{onClick:()=>c("transcribe"),className:"flex items-center gap-3 px-3 py-2.5 rounded-xl text-xs font-bold transition-all ".concat("transcribe"===n?"bg-white/10 text-white shadow-md":"text-slate-400 hover:bg-white/5 hover:text-white"),children:[(0,l.jsx)(eV.Z,{size:16})," 语音转文字 (Transcriber)"]}),(0,l.jsxs)("button",{onClick:()=>c("live"),className:"flex items-center gap-3 px-3 py-2.5 rounded-xl text-xs font-bold transition-all ".concat("live"===n?"bg-white/10 text-white shadow-md":"text-slate-400 hover:bg-white/5 hover:text-white"),children:[(0,l.jsx)(eY.Z,{size:16})," 实时对话 (Live Chat)"]}),(0,l.jsxs)("button",{onClick:()=>h(!x),className:"flex items-center gap-3 px-3 py-2.5 rounded-xl text-xs font-bold transition-all ".concat(x?"bg-cyan-500/20 text-cyan-400":"text-slate-400 hover:bg-white/5 hover:text-white"),children:[(0,l.jsx)(eS.Z,{size:16})," 多轨混音器 (Multi-track)"]})]}),(0,l.jsxs)("div",{className:"mt-auto p-4 border-t border-white/5",children:[(0,l.jsx)("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2",children:"历史记录"}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-1 h-48",children:0===s.length?(0,l.jsx)("div",{className:"text-xs text-slate-600 text-center py-4",children:"暂无历史"}):s.map(e=>(0,l.jsxs)("div",{onClick:()=>w(e),className:"group flex items-center gap-2 p-2 rounded-lg cursor-pointer transition-all ".concat((null==v?void 0:v.id)===e.id?"bg-white/10":"hover:bg-white/5"),children:[(0,l.jsx)("div",{className:"w-6 h-6 rounded bg-gradient-to-br ".concat(ej(e.id)," flex items-center justify-center shrink-0"),children:(0,l.jsx)(J.Z,{size:10,className:"text-white/70"})}),(0,l.jsx)("span",{className:"text-xs truncate ".concat((null==v?void 0:v.id)===e.id?"text-cyan-400":"text-slate-400"),children:e.title})]},e.id))})]})]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col relative z-0",children:[(0,l.jsx)("div",{className:"absolute top-6 left-6 flex items-center gap-4 z-20",children:(0,l.jsx)("button",{onClick:a,className:"p-2 rounded-full bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:(0,l.jsx)(T.Z,{size:20})})}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-8 pb-32",children:(0,l.jsxs)("div",{className:"max-w-5xl mx-auto flex flex-col gap-8",children:["factory"===n&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"space-y-1 pl-12",children:[" ",(0,l.jsxs)("h1",{className:"text-3xl font-black text-white tracking-tight",children:["声音工厂 ",(0,l.jsx)("span",{className:"text-slate-500 font-light ml-2 text-xl",children:"Voice Factory"})]}),(0,l.jsx)("p",{className:"text-slate-400 text-sm",children:"Create realistic voiceovers, clone voices, and generate emotional speech."})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"lg:col-span-1 flex flex-col gap-6",children:[(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("h2",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[(0,l.jsx)(eW.Z,{size:12})," 声音克隆 (参考音频)"]}),(0,l.jsxs)("div",{className:"relative h-32 rounded-xl border border-dashed transition-all flex flex-col items-center justify-center gap-2 cursor-pointer group overflow-hidden ".concat(F?"border-cyan-500/50 bg-cyan-500/5":"border-white/10 hover:border-white/30 bg-white/5 hover:bg-white/10"),onClick:()=>{var e;return null===(e=I.current)||void 0===e?void 0:e.click()},children:[(0,l.jsx)("input",{type:"file",ref:I,className:"hidden",accept:"audio/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){W(a.name);let e=new FileReader;e.onload=e=>{var t;return V(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(a)}}}),F?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-full bg-cyan-500/20 flex items-center justify-center text-cyan-400",children:(0,l.jsx)(eB.Z,{size:20})}),(0,l.jsx)("span",{className:"text-xs font-medium text-cyan-200 truncate max-w-[80%]",children:Y}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),V(null),W(null)},className:"absolute top-2 right-2 p-1.5 rounded-full bg-black/40 hover:bg-red-500/80 text-white/50 hover:text-white transition-colors",children:(0,l.jsx)(T.Z,{size:10})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(J.Z,{size:24,className:"text-slate-500 group-hover:text-cyan-400 transition-colors"}),(0,l.jsx)("span",{className:"text-xs text-slate-500 group-hover:text-slate-300",children:"点击上传参考音频"}),(0,l.jsx)("span",{className:"text-[9px] text-slate-600 text-center px-4",children:"AI 将模仿此声音朗读文本 (Approximate)"})]})]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("h2",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[(0,l.jsx)(eK.Z,{size:12})," 情感基调"]}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:eq.map(e=>(0,l.jsx)("button",{onClick:()=>L(e),className:"px-3 py-2 rounded-lg text-xs font-medium text-left transition-all ".concat(U.value===e.value?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"bg-white/5 text-slate-400 hover:bg-white/10 border border-transparent"),children:e.label},e.value))})]})]}),(0,l.jsxs)("div",{className:"lg:col-span-2 flex flex-col gap-6",children:[(0,l.jsxs)("div",{className:"relative group flex-1",children:[(0,l.jsx)("div",{className:"absolute -inset-1 bg-gradient-to-r from-cyan-500/10 to-purple-500/10 rounded-2xl blur opacity-0 group-hover:opacity-100 transition duration-500"}),(0,l.jsxs)("div",{className:"relative bg-[#1c1c1e] border border-white/10 rounded-2xl p-5 shadow-2xl flex flex-col h-full min-h-[240px]",children:[(0,l.jsx)("textarea",{className:"w-full flex-1 bg-transparent text-lg text-slate-200 placeholder-slate-600 focus:outline-none resize-none font-medium leading-relaxed",placeholder:"在此输入您想生成的语音文本...",value:Z,onChange:e=>P(e.target.value)}),(0,l.jsxs)("div",{className:"flex justify-between items-center mt-4 pt-4 border-t border-white/5",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[_&&(0,l.jsxs)("div",{className:"px-2 py-1 bg-purple-500/20 border border-purple-500/30 rounded text-[10px] text-purple-300 flex items-center gap-1",children:[(0,l.jsx)($.Z,{size:10})," ",_.label]}),F&&(0,l.jsxs)("div",{className:"px-2 py-1 bg-cyan-500/20 border border-cyan-500/30 rounded text-[10px] text-cyan-300 flex items-center gap-1",children:[(0,l.jsx)(eB.Z,{size:10})," Custom Clone"]})]}),(0,l.jsxs)("button",{onClick:eb,disabled:!Z.trim()||B,className:"px-6 py-2.5 rounded-xl font-bold text-sm shadow-lg transition-all flex items-center gap-2 ".concat(!Z.trim()||B?"bg-white/5 text-slate-500 cursor-not-allowed":"bg-gradient-to-r from-cyan-500 to-blue-600 text-white hover:scale-105 hover:shadow-cyan-500/25"),children:[B?(0,l.jsx)(y.Z,{size:16,className:"animate-spin"}):(0,l.jsx)(eg.Z,{size:16}),B?"合成中...":"生成语音"]})]})]})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("h2",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[(0,l.jsx)($.Z,{size:12})," 声音画像 (Personas)"]}),(0,l.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:eJ.map(e=>(0,l.jsxs)("button",{onClick:()=>{G(e),V(null),W(null)},className:"p-3 rounded-xl border text-left transition-all group ".concat((null==_?void 0:_.label)===e.label?"bg-purple-500/10 border-purple-500/50":"bg-white/5 border-white/5 hover:border-white/20 hover:bg-white/10"),children:[(0,l.jsx)("div",{className:"flex justify-between items-start mb-1",children:(0,l.jsx)("span",{className:"text-xs font-bold ".concat((null==_?void 0:_.label)===e.label?"text-purple-400":"text-slate-300"),children:e.label})}),(0,l.jsx)("p",{className:"text-[9px] text-slate-500 leading-relaxed line-clamp-2",children:e.desc})]},e.label))})]})]})]})]}),"transcribe"===n&&(0,l.jsxs)("div",{className:"flex flex-col gap-6 animate-in fade-in slide-in-from-bottom-4 duration-300 pl-12",children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("h1",{className:"text-3xl font-black text-white tracking-tight",children:["语音转文字 ",(0,l.jsx)("span",{className:"text-slate-500 font-light ml-2 text-xl",children:"Transcriber"})]}),(0,l.jsx)("p",{className:"text-slate-400 text-sm",children:"Accurately transcribe audio files into text using Gemini 2.5."})]}),(0,l.jsxs)("div",{className:"relative h-40 rounded-2xl border-2 border-dashed flex flex-col items-center justify-center gap-4 cursor-pointer transition-all hover:bg-white/5 ".concat(X?"border-cyan-500/30 bg-cyan-500/5":"border-white/10"),onClick:()=>{var e;return null===(e=D.current)||void 0===e?void 0:e.click()},children:[(0,l.jsx)("input",{type:"file",ref:D,className:"hidden",accept:"audio/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){Q(a.name);let e=new FileReader;e.onload=e=>{var t;return H(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(a)}}}),X?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eB.Z,{size:48,className:"text-cyan-400"}),(0,l.jsx)("span",{className:"text-sm font-medium text-cyan-200",children:q}),(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),H(null)},className:"absolute top-4 right-4 p-2 bg-black/40 hover:bg-red-500/20 text-white/50 hover:text-red-400 rounded-full",children:(0,l.jsx)(T.Z,{size:16})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eW.Z,{size:48,className:"text-slate-600"}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("span",{className:"text-sm font-bold text-slate-400",children:"点击上传音频文件"}),(0,l.jsx)("p",{className:"text-xs text-slate-600 mt-1",children:"支持 MP3, WAV, M4A, AAC"})]})]})]}),(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsxs)("button",{onClick:ev,disabled:!X||ea,className:"px-8 py-3 rounded-full font-bold text-sm shadow-lg transition-all flex items-center gap-2 ".concat(!X||ea?"bg-white/5 text-slate-500 cursor-not-allowed":"bg-cyan-500 text-black hover:scale-105"),children:[ea?(0,l.jsx)(y.Z,{size:18,className:"animate-spin"}):(0,l.jsx)(eV.Z,{size:18}),ea?"转录中...":"开始转录"]})}),ee&&(0,l.jsxs)("div",{className:"bg-[#1c1c1e] border border-white/10 rounded-2xl p-6 relative",children:[(0,l.jsx)("button",{onClick:()=>navigator.clipboard.writeText(ee),className:"absolute top-4 right-4 p-2 text-slate-500 hover:text-white bg-black/20 hover:bg-black/40 rounded-lg transition-colors",title:"复制",children:(0,l.jsx)(eV.Z,{size:14})}),(0,l.jsx)("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4",children:"转录结果"}),(0,l.jsx)("p",{className:"text-sm text-slate-300 leading-relaxed whitespace-pre-wrap",children:ee})]})]}),"live"===n&&(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center gap-10 py-10 animate-in fade-in slide-in-from-bottom-4 duration-300 pl-12",children:[(0,l.jsxs)("div",{className:"space-y-2 text-center",children:[(0,l.jsxs)("h1",{className:"text-3xl font-black text-white tracking-tight",children:["实时语音对话 ",(0,l.jsx)("span",{className:"text-slate-500 font-light ml-2 text-xl",children:"Live"})]}),(0,l.jsx)("p",{className:"text-slate-400 text-sm",children:"Bidirectional real-time conversation with Gemini 2.0 Flash Exp."})]}),(0,l.jsxs)("div",{className:"relative w-64 h-64 flex items-center justify-center",children:[er&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-cyan-500/20 rounded-full animate-ping opacity-20",style:{animationDuration:"2s"}}),(0,l.jsx)("div",{className:"absolute inset-4 bg-purple-500/20 rounded-full animate-ping opacity-20",style:{animationDuration:"3s",animationDelay:"0.5s"}})]}),(0,l.jsxs)("div",{className:"relative z-10 w-48 h-48 rounded-full flex flex-col items-center justify-center transition-all duration-500 border-4 ".concat(er?"bg-gradient-to-br from-cyan-900/50 to-purple-900/50 border-cyan-500 shadow-[0_0_50px_rgba(6,182,212,0.3)]":"bg-[#1c1c1e] border-white/10"),children:[(0,l.jsx)(eS.Z,{size:48,className:er?"text-cyan-400 animate-pulse":"text-slate-600"}),(0,l.jsx)("span",{className:"text-xs font-bold mt-4 uppercase tracking-widest ".concat(er?"text-cyan-200":"text-slate-600"),children:el})]})]}),(0,l.jsxs)("button",{onClick:()=>{er?ey():ew()},className:"px-10 py-4 rounded-full font-bold text-base shadow-xl transition-all flex items-center gap-3 hover:scale-105 active:scale-95 ".concat(er?"bg-red-500/20 text-red-400 border border-red-500/50 hover:bg-red-500 hover:text-white":"bg-cyan-500 text-black hover:bg-cyan-400"),children:[er?(0,l.jsx)(T.Z,{size:20}):(0,l.jsx)(J.Z,{size:20}),er?"结束对话":"开始对话"]}),(0,l.jsx)("p",{className:"text-[10px] text-slate-500 max-w-sm text-center",children:"Uses Gemini Live API (WebSocket). Please allow microphone access. Ensure you are in a quiet environment for best results."})]}),x&&(0,l.jsxs)("div",{className:"bg-[#121214] border border-white/10 rounded-2xl p-6 shadow-2xl animate-in fade-in slide-in-from-right-10 duration-500",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(eS.Z,{size:18,className:"text-cyan-400"}),(0,l.jsx)("h2",{className:"text-sm font-black uppercase tracking-widest text-white",children:"多轨混音器 (Mixer)"})]}),(0,l.jsx)("button",{onClick:()=>h(!1),className:"text-slate-500 hover:text-white",children:(0,l.jsx)(T.Z,{size:18})})]}),(0,l.jsx)("div",{className:"space-y-4",children:0===d.length?(0,l.jsx)("div",{className:"py-10 text-center border border-dashed border-white/5 rounded-xl",children:(0,l.jsx)("p",{className:"text-[10px] text-slate-600 uppercase font-bold tracking-widest",children:"从历史记录中拖入音频以混音"})}):d.map((e,t)=>(0,l.jsxs)("div",{className:"bg-white/5 p-4 rounded-xl flex items-center gap-4 border border-white/5",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br ".concat(ej(e.id)," flex items-center justify-center shrink-0"),children:(0,l.jsx)(J.Z,{size:16,className:"text-white/70"})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"text-[11px] font-bold text-white truncate",children:e.title}),(0,l.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[(0,l.jsx)(eX.Z,{size:12,className:"text-slate-500"}),(0,l.jsx)("input",{type:"range",className:"flex-1 h-1 bg-white/10 rounded-full appearance-none accent-cyan-500"})]})]}),(0,l.jsx)("button",{onClick:()=>u(e=>e.filter((e,a)=>a!==t)),className:"p-2 text-slate-600 hover:text-red-400",children:(0,l.jsx)(N.Z,{size:16})})]},t))})]})]})}),("factory"===n||v&&"live"!==n)&&(0,l.jsxs)("div",{className:"h-24 bg-[#121214]/90 backdrop-blur-xl border-t border-white/10 flex items-center px-8 gap-8 relative z-20",children:[(0,l.jsxs)("div",{className:"w-64 flex items-center gap-4",children:[(0,l.jsxs)("div",{className:"w-14 h-14 rounded-lg bg-gradient-to-br ".concat(v?ej(v.id):"from-slate-700 to-slate-800"," shadow-lg flex items-center justify-center relative overflow-hidden group/cover"),children:[v?(0,l.jsx)(J.Z,{size:24,className:"text-white/80"}):(0,l.jsx)(eH.Z,{size:24,className:"text-slate-500"}),(0,l.jsx)("canvas",{ref:p,className:"absolute inset-0 w-full h-full opacity-40",width:56,height:56})]}),(0,l.jsxs)("div",{className:"flex flex-col min-w-0",children:[(0,l.jsx)("span",{className:"text-sm font-bold text-white truncate",children:(null==v?void 0:v.title)||"Ready to speak"}),(0,l.jsx)("span",{className:"text-xs text-slate-500",children:"Voice Factory AI"})]})]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col items-center gap-2 max-w-2xl mx-auto",children:[(0,l.jsx)("div",{className:"flex items-center gap-6",children:(0,l.jsx)("button",{onClick:()=>{M.current&&v&&(j?(M.current.pause(),k(!1)):(M.current.play(),k(!0)))},disabled:!v,className:"w-10 h-10 rounded-full flex items-center justify-center transition-all ".concat(v?"bg-white text-black hover:scale-110":"bg-white/10 text-slate-600"),children:j?(0,l.jsx)(eD.Z,{size:20,fill:"currentColor"}):(0,l.jsx)(eR.Z,{size:20,fill:"currentColor",className:"ml-0.5"})})}),(0,l.jsxs)("div",{className:"w-full flex items-center gap-3 text-[10px] font-mono text-slate-500",children:[(0,l.jsxs)("span",{children:[Math.floor(C/60),":",Math.floor(C%60).toString().padStart(2,"0")]}),(0,l.jsx)("div",{className:"flex-1 h-1 bg-white/10 rounded-full relative overflow-hidden group/bar cursor-pointer",children:(0,l.jsx)("div",{className:"absolute top-0 left-0 h-full bg-cyan-500 rounded-full",style:{width:"".concat(C/(z||1)*100,"%")}})}),(0,l.jsxs)("span",{children:[Math.floor(z/60),":",Math.floor(z%60).toString().padStart(2,"0")]})]})]}),(0,l.jsxs)("div",{className:"w-64 flex items-center justify-end gap-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 group/vol",children:[(0,l.jsx)(eX.Z,{size:16,className:"text-slate-400"}),(0,l.jsx)("div",{className:"w-16 h-1 bg-white/10 rounded-full relative cursor-pointer",children:(0,l.jsx)("div",{className:"absolute top-0 left-0 h-full bg-slate-400 group-hover/vol:bg-white rounded-full",style:{width:"".concat(100*E,"%")}})})]}),(0,l.jsx)("button",{onClick:()=>v&&(null==r?void 0:r({...v,type:"audio"})),className:"p-2 rounded-lg bg-white/5 hover:bg-purple-500/20 text-slate-400 hover:text-purple-400 transition-all",title:"保存到素材库",children:(0,l.jsx)(es.Z,{size:18})}),(0,l.jsx)("button",{className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white transition-colors",children:(0,l.jsx)(R.Z,{size:18})})]}),(0,l.jsx)("audio",{ref:M,onTimeUpdate:em,onEnded:()=>k(!1),onLoadedMetadata:em})]})]})]})};var e5=a(5489),e4=a(3787),e3=a(4436);let e6=e=>{let{isOpen:t,onClose:s}=e,[i,r]=(0,o.useState)(""),[n,c]=(0,o.useState)(""),[d,u]=(0,o.useState)(""),[x,h]=(0,o.useState)(""),[p,m]=(0,o.useState)(""),[g,b]=(0,o.useState)(""),[f,v]=(0,o.useState)(!1),[w,y]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=async()=>{let e=localStorage.getItem("pollo_api_key")||"",t=localStorage.getItem("jimeng_api_key")||"",a=localStorage.getItem("mj_api_key")||"",s=localStorage.getItem("openai_api_key")||"",i=localStorage.getItem("openai_base_url")||"https://api.openai.com/v1",n=localStorage.getItem("inkai_api_key")||"";r(e),c(t),u(a),h(s),m(i),b(n),window.aistudio?v(await window.aistudio.hasSelectedApiKey()):v(!!n)};t&&e()},[t]);let j=async()=>{if(confirm("确定要清除所有生成的媒体缓存吗？这将释放本地存储空间，但会导致已生成的图片/视频无法查看。"))try{let{del:e}=await a.e(759).then(a.bind(a,3759));await e("assets"),alert("媒体缓存已清理 (需刷新页面生效)"),window.location.reload()}catch(e){alert("清理失败")}},k=async()=>{window.aistudio&&(await window.aistudio.openSelectKey(),v(!0))};return t?(0,l.jsx)("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center animate-in fade-in duration-200",onClick:s,children:(0,l.jsxs)("div",{className:"w-[540px] bg-[#1c1c1e] border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200 flex flex-col max-h-[90vh]",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"p-4 border-b border-white/5 flex justify-between items-center bg-white/5",children:[(0,l.jsx)("button",{onClick:s,className:"text-slate-500 hover:text-white transition-colors",children:(0,l.jsx)(T.Z,{size:18})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"p-1.5 bg-slate-700/50 rounded-lg",children:(0,l.jsx)(e5.Z,{size:16,className:"text-white"})}),(0,l.jsx)("span",{className:"text-sm font-bold text-white",children:"API 全局配置 (Settings)"})]})]}),(0,l.jsxs)("div",{className:"p-6 space-y-8 overflow-y-auto custom-scrollbar flex-1",children:[(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(P.Z,{size:16,className:"text-cyan-400"}),(0,l.jsx)("label",{className:"text-xs font-bold text-white uppercase tracking-wider",children:"Google Gemini API"})]}),(0,l.jsx)("div",{className:"px-2 py-0.5 rounded-full text-[9px] font-bold uppercase ".concat(f?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-amber-500/20 text-amber-400 border border-amber-500/30"),children:f?"已激活 (Active)":"未配置 (Not Set)"})]}),(0,l.jsxs)("button",{onClick:k,className:"w-full flex items-center justify-center gap-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl py-4 transition-all group ".concat(window.aistudio?"":"hidden"),children:[(0,l.jsx)(L.Z,{size:18,className:"text-cyan-400 group-hover:scale-110 transition-transform"}),(0,l.jsx)("span",{className:"text-sm font-bold text-slate-200",children:"选择或更新 Gemini API Key"})]}),(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)("span",{className:"text-[10px] font-bold text-slate-500 uppercase ml-1",children:"Google Gemini API Key (手动配置)"}),(0,l.jsx)("input",{type:"password",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 transition-colors font-mono",placeholder:"在此粘贴您的 Key (AIzaSy...)",value:g,onChange:e=>b(e.target.value)})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,l.jsxs)("p",{className:"text-[11px] text-slate-400 leading-relaxed",children:["激活 ",(0,l.jsx)("strong",{children:"Gemini 3 Pro"})," (文本/推理), ",(0,l.jsx)("strong",{children:"Nano Banana Pro"})," (高质量生图) 以及 ",(0,l.jsx)("strong",{children:"Veo 3.1"})," (电影级视频) 核心模型。"]}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("a",{href:"https://ai.google.dev/gemini-api/docs/billing",target:"_blank",rel:"noreferrer",className:"text-[10px] text-cyan-500 hover:underline flex items-center gap-1",children:["查看计费文档 ",(0,l.jsx)(e4.Z,{size:10})]}),(0,l.jsx)("span",{className:"text-[10px] text-slate-600",children:"|"}),(0,l.jsx)("span",{className:"text-[10px] text-slate-500 italic",children:"需要绑定付款账户以使用 Veo 模型"})]})]})]}),(0,l.jsx)("div",{className:"h-px bg-white/5 w-full"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(et.Z,{size:16,className:"text-purple-400"}),(0,l.jsx)("label",{className:"text-xs font-bold text-slate-200 uppercase tracking-wider",children:"数据管理 (Data Management)"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,l.jsxs)("button",{onClick:()=>{try{let e=localStorage.getItem("inkai-storage-workflows");if(!e){alert("没有可导出的工作流");return}let t=JSON.parse(e);if(!Array.isArray(t)||0===t.length){alert("没有可导出的工作流");return}let a={version:"1.0",timestamp:Date.now(),workflows:t},s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),i=URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download="inkai-backup-all-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}catch(e){console.error(e),alert("导出失败")}},className:"flex flex-col items-center justify-center gap-2 p-4 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-purple-500/30 rounded-xl transition-all group",children:[(0,l.jsx)(es.Z,{size:20,className:"text-slate-400 group-hover:text-purple-400"}),(0,l.jsx)("span",{className:"text-xs font-bold text-slate-300",children:"备份所有工作流"})]}),(0,l.jsxs)("button",{onClick:j,className:"flex flex-col items-center justify-center gap-2 p-4 bg-white/5 hover:bg-red-500/10 border border-white/10 hover:border-red-500/30 rounded-xl transition-all group",children:[(0,l.jsx)(N.Z,{size:20,className:"text-slate-400 group-hover:text-red-400"}),(0,l.jsx)("span",{className:"text-xs font-bold text-slate-300 group-hover:text-red-400",children:"清理媒体缓存"})]})]}),(0,l.jsx)("p",{className:"text-[11px] text-slate-500",children:"您的数据默认存储在浏览器本地 (IndexedDB)。定期备份可防止意外丢失；清理缓存可释放磁盘空间。"})]}),(0,l.jsx)("div",{className:"h-px bg-white/5 w-full"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(eY.Z,{size:16,className:"text-emerald-400"}),(0,l.jsx)("label",{className:"text-xs font-bold text-slate-200 uppercase tracking-wider",children:"OpenAI (ChatGPT) 配置"})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsx)("span",{className:"text-[10px] font-bold text-slate-500 uppercase ml-1",children:"API Key"}),(0,l.jsx)("input",{type:"password",autoComplete:"off",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-emerald-500/50 transition-colors font-mono",placeholder:"sk-...",value:x,onChange:e=>h(e.target.value)})]}),(0,l.jsxs)("div",{className:"space-y-1.5",children:[(0,l.jsxs)("span",{className:"text-[10px] font-bold text-slate-500 uppercase ml-1 flex items-center gap-1",children:[(0,l.jsx)(e3.Z,{size:10})," Base URL (Optional Proxy)"]}),(0,l.jsx)("input",{type:"text",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-emerald-500/50 transition-colors font-mono",placeholder:"https://api.openai.com/v1",value:p,onChange:e=>m(e.target.value)})]})]}),(0,l.jsxs)("p",{className:"text-[11px] text-slate-500",children:["用于助手面板中的 ",(0,l.jsx)("strong",{children:"GPT-4o / o1"})," 模型调用，支持自定义代理。"]})]}),(0,l.jsx)("div",{className:"h-px bg-white/5 w-full"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Pollo.ai API Key (Wan 2.5)"}),(0,l.jsxs)("a",{href:"https://pollo.ai/dashboard/api-keys",target:"_blank",rel:"noreferrer",className:"flex items-center gap-1 text-[10px] text-cyan-400 hover:text-cyan-300 transition-colors",children:[(0,l.jsx)("span",{children:"获取 Key"}),(0,l.jsx)(e4.Z,{size:10})]})]}),(0,l.jsx)("input",{type:"password",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 transition-colors font-mono",placeholder:"粘贴您的 Pollo API Key...",value:i,onChange:e=>r(e.target.value)}),(0,l.jsxs)("p",{className:"text-[11px] text-slate-500",children:["用于激活 ",(0,l.jsx)("strong",{children:"Wan 2.1 / 2.5"})," 视频生成模型。"]})]}),(0,l.jsx)("div",{className:"h-px bg-white/5 w-full"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"即梦 (Jimeng) API Key"}),(0,l.jsx)("input",{type:"password",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 transition-colors font-mono",placeholder:"粘贴您的 Jimeng API Key...",value:n,onChange:e=>c(e.target.value)}),(0,l.jsxs)("p",{className:"text-[11px] text-slate-500",children:["用于激活 ",(0,l.jsx)("strong",{children:"即梦 (Jimeng 2.1)"})," 图像生成模型。"]})]}),(0,l.jsx)("div",{className:"h-px bg-white/5 w-full"}),(0,l.jsxs)("div",{className:"space-y-4 pb-4",children:[(0,l.jsx)("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Midjourney API Key"}),(0,l.jsx)("input",{type:"password",className:"w-full bg-black/30 border border-white/10 rounded-xl py-2.5 px-4 text-sm text-white placeholder-slate-600 focus:outline-none focus:border-cyan-500/50 transition-colors font-mono",placeholder:"粘贴您的 Midjourney API Key...",value:d,onChange:e=>u(e.target.value)}),(0,l.jsxs)("p",{className:"text-[11px] text-slate-500",children:["用于激活 ",(0,l.jsx)("strong",{children:"Midjourney V7.0"})," 图像生成模型。"]})]})]}),(0,l.jsx)("div",{className:"p-4 border-t border-white/5 bg-[#121214] flex justify-end",children:(0,l.jsx)("button",{onClick:()=>{localStorage.setItem("pollo_api_key",i.trim()),localStorage.setItem("jimeng_api_key",n.trim()),localStorage.setItem("mj_api_key",d.trim()),localStorage.setItem("openai_api_key",x.trim()),localStorage.setItem("openai_base_url",p.trim()),localStorage.setItem("inkai_api_key",g.trim()),y(!0),setTimeout(()=>y(!1),2e3),setTimeout(s,500)},className:"px-8 py-2.5 rounded-xl text-xs font-bold transition-all ".concat(w?"bg-green-500 text-white":"bg-white text-black hover:bg-cyan-400 active:scale-95"),children:w?"已保存 (Saved)":"保存配置 (Save Changes)"})})]})}):null};var e8=a(1240),e9=a(338),e7=a(6143),te=a(7589),tt=a(8711);let ta=e=>{let{isOpen:t,onClose:a}=e,[s,i]=(0,o.useState)("overview");return t?(0,l.jsxs)("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 md:p-12",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-xl",onClick:a}),(0,l.jsxs)("div",{className:"relative w-full max-w-6xl h-full bg-[#0c0c0e] border border-white/10 rounded-[32px] shadow-2xl overflow-hidden flex flex-col animate-in zoom-in-95 duration-300",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between px-8 py-6 border-b border-white/5 bg-white/[0.02]",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-2xl bg-cyan-500/10 border border-cyan-500/20 flex items-center justify-center text-cyan-400",children:(0,l.jsx)(ec.Z,{size:24})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h2",{className:"text-xl font-black text-white tracking-tight",children:["商用管理后台 ",(0,l.jsx)("span",{className:"text-[10px] font-bold text-cyan-500 ml-2 bg-cyan-500/10 px-2 py-0.5 rounded-full",children:"PROTOTYPE"})]}),(0,l.jsx)("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-[0.2em] mt-0.5",children:"Admin Management Dashboard"})]})]}),(0,l.jsx)("button",{onClick:a,className:"p-3 hover:bg-white/5 rounded-2xl text-slate-500 transition-colors",children:(0,l.jsx)(T.Z,{size:24})})]}),(0,l.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,l.jsx)("div",{className:"w-48 border-r border-white/5 bg-black/20 p-4 space-y-2",children:[{id:"overview",label:"运行概览",icon:tt.Z},{id:"tasks",label:"任务监控",icon:eS.Z},{id:"models",label:"模型管理",icon:e7.Z},{id:"users",label:"用户管理",icon:e8.Z}].map(e=>(0,l.jsxs)("button",{onClick:()=>i(e.id),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-xs font-bold transition-all ".concat(s===e.id?"bg-cyan-500 text-black shadow-lg shadow-cyan-500/20":"text-slate-400 hover:bg-white/5 hover:text-white"),children:[(0,l.jsx)(e.icon,{size:16}),e.label]},e.id))}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar",children:["overview"===s&&(0,l.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{label:"今日生成任务",value:"1,284",change:"+12.5%",icon:eS.Z,color:"text-cyan-400"},{label:"活跃用户 (DAU)",value:"452",change:"+8.2%",icon:e8.Z,color:"text-purple-400"},{label:"API 成功率",value:"99.4%",change:"+0.1%",icon:_.Z,color:"text-emerald-400"},{label:"创意点数消耗",value:"85.2k",change:"+15.4%",icon:L.Z,color:"text-amber-400"}].map((e,t)=>(0,l.jsxs)("div",{className:"bg-white/5 border border-white/5 rounded-2xl p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)(e.icon,{size:18,className:e.color}),(0,l.jsxs)("span",{className:"text-[10px] font-bold text-emerald-400 flex items-center gap-0.5",children:[(0,l.jsx)(e9.Z,{size:10})," ",e.change]})]}),(0,l.jsx)("div",{className:"text-2xl font-black text-white",children:e.value}),(0,l.jsx)("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1",children:e.label})]},t))}),(0,l.jsxs)("div",{className:"bg-white/5 border border-white/5 rounded-2xl overflow-hidden",children:[(0,l.jsxs)("div",{className:"p-4 border-b border-white/5 flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-xs font-black uppercase tracking-widest text-white",children:"实时任务监控"}),(0,l.jsx)("button",{className:"text-[10px] font-bold text-cyan-400 hover:text-cyan-300",children:"查看全部"})]}),(0,l.jsx)("div",{className:"p-0",children:(0,l.jsxs)("table",{className:"w-full text-[11px] text-left",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-white/[0.02] text-slate-500 font-bold uppercase tracking-wider",children:[(0,l.jsx)("th",{className:"px-4 py-3",children:"任务 ID"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"用户"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"类型"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"状态"}),(0,l.jsx)("th",{className:"px-4 py-3",children:"耗时"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-white/5",children:[{id:"TASK-9281",user:"user_291..",type:"Video Gen",status:"Running",time:"45s",statusColor:"text-cyan-400"},{id:"TASK-9280",user:"user_882..",type:"Image Gen",status:"Success",time:"12s",statusColor:"text-emerald-400"},{id:"TASK-9279",user:"user_102..",type:"Audio Gen",status:"Pending",time:"-",statusColor:"text-amber-400"},{id:"TASK-9278",user:"user_441..",type:"Storyboard",status:"Success",time:"8s",statusColor:"text-emerald-400"}].map((e,t)=>(0,l.jsxs)("tr",{className:"hover:bg-white/[0.02] transition-colors",children:[(0,l.jsx)("td",{className:"px-4 py-3 font-mono text-slate-400",children:e.id}),(0,l.jsx)("td",{className:"px-4 py-3 text-slate-300",children:e.user}),(0,l.jsx)("td",{className:"px-4 py-3 text-slate-300",children:e.type}),(0,l.jsx)("td",{className:"px-4 py-3 font-bold ".concat(e.statusColor),children:e.status}),(0,l.jsx)("td",{className:"px-4 py-3 text-slate-500",children:e.time})]},t))})]})})]})]}),"models"===s&&(0,l.jsx)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{className:"bg-white/5 border border-white/5 rounded-2xl p-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,l.jsx)(e7.Z,{size:20,className:"text-cyan-400"}),(0,l.jsx)("h3",{className:"text-sm font-black uppercase tracking-widest text-white",children:"模型路由策略"})]}),(0,l.jsx)("div",{className:"space-y-4",children:[{name:"Gemini 3 Pro",status:"Optimal",load:"42%",active:!0},{name:"Gemini 3 Flash",status:"High Load",load:"88%",active:!0},{name:"Veo 3.1 Video",status:"Optimal",load:"15%",active:!0},{name:"Imagen 3 (Legacy)",status:"Deprecated",load:"0%",active:!1}].map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-black/20 rounded-xl border border-white/5",children:[(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("span",{className:"text-xs font-bold text-white",children:e.name}),(0,l.jsx)("span",{className:"text-[9px] font-bold uppercase tracking-wider ".concat(e.active?"text-emerald-500":"text-slate-500"),children:e.status})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col items-end",children:[(0,l.jsx)("span",{className:"text-[10px] text-slate-500 font-bold uppercase",children:"Load"}),(0,l.jsx)("span",{className:"text-xs font-mono text-slate-300",children:e.load})]}),(0,l.jsx)("div",{className:"w-10 h-5 rounded-full relative transition-colors ".concat(e.active?"bg-cyan-500/20":"bg-white/10"),children:(0,l.jsx)("div",{className:"absolute top-1 w-3 h-3 rounded-full transition-all ".concat(e.active?"bg-cyan-400 right-1":"bg-slate-500 left-1")})})]})]},t))})]}),(0,l.jsxs)("div",{className:"bg-white/5 border border-white/5 rounded-2xl p-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,l.jsx)(te.Z,{size:20,className:"text-purple-400"}),(0,l.jsx)("h3",{className:"text-sm font-black uppercase tracking-widest text-white",children:"API 密钥健康度"})]}),(0,l.jsx)("div",{className:"space-y-4",children:[{id:"PROD-KEY-01",type:"Primary",quota:"85%",health:"Excellent"},{id:"PROD-KEY-02",type:"Backup",quota:"12%",health:"Excellent"},{id:"DEV-KEY-01",type:"Sandbox",quota:"98%",health:"Warning"}].map((e,t)=>(0,l.jsxs)("div",{className:"p-3 bg-black/20 rounded-xl border border-white/5 space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-[10px] font-mono text-slate-400",children:e.id}),(0,l.jsx)("span",{className:"px-2 py-0.5 bg-white/5 rounded text-[8px] font-black text-slate-500 uppercase",children:e.type})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"flex-1 h-1 bg-white/10 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full bg-purple-500",style:{width:e.quota}})}),(0,l.jsx)("span",{className:"text-[10px] font-bold text-slate-300",children:e.quota})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between pt-1",children:[(0,l.jsx)("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest",children:"Health"}),(0,l.jsx)("span",{className:"text-[9px] font-bold uppercase ".concat("Excellent"===e.health?"text-emerald-500":"text-amber-500"),children:e.health})]})]},t))})]})]})}),"tasks"===s&&(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full opacity-20",children:[(0,l.jsx)(eS.Z,{size:48,className:"mb-4"}),(0,l.jsx)("p",{className:"text-sm font-black uppercase tracking-widest",children:"任务详情模块开发中..."})]}),"users"===s&&(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full opacity-20",children:[(0,l.jsx)(e8.Z,{size:48,className:"mb-4"}),(0,l.jsx)("p",{className:"text-sm font-black uppercase tracking-widest",children:"用户管理模块开发中..."})]})]})]}),(0,l.jsxs)("div",{className:"px-8 py-4 border-t border-white/5 bg-black/40 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,l.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"})," 系统在线"]}),(0,l.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,l.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500"})," 区域: 华北-北京"]})]}),(0,l.jsx)("div",{className:"text-[10px] font-bold text-slate-600",children:"InkAI v1.2.0-commercial-beta"})]})]})]}):null},ts=(e,t)=>"image"===t?e.find(e=>{var t;return e.data.croppedFrame||e.data.image||(null===(t=e.data.images)||void 0===t?void 0:t.length)}):e.find(e=>e.data.videoUri||e.data.videoMetadata),ti=e=>{let t=[];return e.forEach(e=>{e.data.images&&e.data.images.length>0?t=[...t,...e.data.images]:e.data.image?t.push(e.data.image):e.data.croppedFrame&&t.push(e.data.croppedFrame)}),Array.from(new Set(t))},tr=async(e,t,a)=>{let s=e.data.videoMode||"T2V",i=e.data.generationMode||"DEFAULT";ts(t,"image");let r=ts(t,"video"),n=ti(t),l=e.data.images||(e.data.image?[e.data.image]:[]),o={finalPrompt:a,videoInput:e.data.videoMetadata||(null==r?void 0:r.data.videoMetadata)||null,inputImageForGeneration:null,referenceImages:void 0,lastFrameImage:e.data.lastFrameImage||null,generationMode:i};if("T2V"===s)return o;let c=[...l,...n].slice(0,3);if(("I2V"===s||"DIRECTOR"===s)&&(c.length>1&&"FIRST_LAST_FRAME"!==i?o.referenceImages=c:c.length>0&&(o.inputImageForGeneration=c[0])),"DIRECTOR"===s)switch(i){case"CONTINUE":if(!o.videoInput&&(null==r?void 0:r.data.videoUri))try{let e=r.data.videoUri;e.startsWith("http")&&(e=await (0,ef.d4)(e)),o.inputImageForGeneration=await (0,ef.X_)(e)}catch(e){console.warn("Frame extraction failed",e)}break;case"FIRST_LAST_FRAME":c.length>0&&(o.inputImageForGeneration=c[0])}return o};var tn=a(6999),tl=a(4129);let to="cubic-bezier(0.32, 0.72, 0, 1)",tc=e=>{switch(e){case r.PROMPT_INPUT:return"提示工程";case r.IMAGE_GENERATOR:return"图片生成";case r.STORYBOARD_GENERATOR:return"一键分镜";case r.VIDEO_GENERATOR:return"视频生成";case r.AUDIO_GENERATOR:return"灵感音乐";case r.VIDEO_ANALYZER:return"视频分析";case r.IMAGE_EDITOR:return"图像编辑";case r.SCRIPT_MASTER:return"剧本大师";default:return e}},td=e=>e.height?e.height:["PROMPT_INPUT","VIDEO_ANALYZER","IMAGE_EDITOR","SCRIPT_MASTER","STORYBOARD_GENERATOR"].includes(e.type)?380:e.type===r.AUDIO_GENERATOR?200:380,tu=e=>{let t=e.height||td(e),a=e.width||420;return{x:e.x,y:e.y,width:a,height:t,r:e.x+a,b:e.y+t}},tx=e=>{var t,a;let{media:s,onClose:i}=e,[r,n]=(0,o.useState)(!1),[c,d]=(0,o.useState)(0),[h,p]=(0,o.useState)(null);(0,o.useEffect)(()=>{s?(requestAnimationFrame(()=>n(!0)),d(s.initialIndex||0)):n(!1)},[s]);let m=(0,o.useCallback)(()=>{n(!1),setTimeout(i,400)},[i]);if((0,o.useEffect)(()=>{if(!s)return;let e=s.images?s.images[c]:s.src;if("video"===s.type&&!(e&&e.startsWith("data:image"))){if(e.startsWith("blob:")||e.startsWith("data:")){p(e);return}let t=!0;return fetch(e).then(e=>e.blob()).then(e=>{t&&p(URL.createObjectURL(new Blob([e],{type:"video/mp4"})))}),()=>{t=!1}}p(null)},[s,c]),!s)return null;let g=s.images?s.images[c]:s.src,b="video"===s.type&&!(g&&g.startsWith("data:image"));return(0,l.jsxs)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center transition-all duration-500 ease-[".concat(to,"] ").concat(r?"bg-black/90 backdrop-blur-xl":"bg-transparent pointer-events-none opacity-0"),onClick:m,children:[(0,l.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center p-8 transition-all duration-500 ease-[".concat(to,"] ").concat(r?"scale-100 opacity-100":"scale-90 opacity-0"),onClick:e=>e.stopPropagation(),children:[(null===(t=s.images)||void 0===t?void 0:t.length)>1&&(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),d(e=>(e-1+s.images.length)%s.images.length)},className:"absolute left-8 p-3 bg-white/10 rounded-full text-white",children:(0,l.jsx)(u.Z,{size:32})}),(0,l.jsx)("div",{className:"relative max-w-full max-h-full",children:b?h&&(0,l.jsx)("video",{src:h,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl",controls:!0,autoPlay:!0},h):(0,l.jsx)("img",{src:g,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl"},g)}),(null===(a=s.images)||void 0===a?void 0:a.length)>1&&(0,l.jsx)("button",{onClick:e=>{e.stopPropagation(),d(e=>(e+1)%s.images.length)},className:"absolute right-8 p-3 bg-white/10 rounded-full text-white",children:(0,l.jsx)(x.Z,{size:32})})]}),(0,l.jsx)("button",{onClick:m,className:"absolute top-6 left-6 p-3 bg-white/10 rounded-full text-white",children:(0,l.jsx)(T.Z,{size:24})})]})};function th(e){let{workflowId:t}=e,[a,s]=(0,o.useState)([]),[i,c]=(0,o.useState)([]),[d,u]=(0,o.useState)([]),[x,h]=(0,o.useState)(!1),[p,m]=(0,o.useState)(t),[g,b]=(0,o.useState)(!1),[f,v]=(0,o.useState)(!1),[w,y]=(0,o.useState)(!1),[R,S]=(0,o.useState)(!1),[C,T]=(0,o.useState)(!1),[z,O]=(0,o.useState)(!1),[M,D]=(0,o.useState)(!1),[Z,_]=(0,o.useState)([]),[G,U]=(0,o.useState)([]),[L,F]=(0,o.useState)([]),[V,Y]=(0,o.useState)([]),[W,B]=(0,o.useState)(-1),[K,X]=(0,o.useState)(1),[J,$]=(0,o.useState)({x:0,y:0}),[Q,ee]=(0,o.useState)(!1),et=(0,o.useRef)({x:0,y:0}),[ea,es]=(0,o.useState)([]),[ei,er]=(0,o.useState)(null),[en,el]=(0,o.useState)([]),[eo,ec]=(0,o.useState)(null),[ed,eu]=(0,o.useState)(null),[ex,ep]=(0,o.useState)(null),[em,eg]=(0,o.useState)(null),[eb,ev]=(0,o.useState)(null),[ew,ej]=(0,o.useState)(null),[eN,ek]=(0,o.useState)(null),[eR,eS]=(0,o.useState)(null),[eC,eA]=(0,o.useState)(null),[eT,ez]=(0,o.useState)(null),[eO,eM]=(0,o.useState)(!1),[eD,eZ]=(0,o.useState)(null),eP=(0,o.useRef)(Z),e_=(0,o.useRef)(G),eU=(0,o.useRef)(L),eF=(0,o.useRef)(V),eV=(0,o.useRef)(W),eY=(0,o.useRef)(eT),eW=(0,o.useRef)(null),eB=(0,o.useRef)(null),eK=(0,o.useRef)(null);(0,o.useEffect)(()=>{eP.current=Z,e_.current=G,eU.current=L,eF.current=V,eV.current=W,eY.current=eT},[Z,G,L,V,W,eT]),(0,o.useEffect)(()=>{(async()=>{"true"===new URLSearchParams(window.location.search).get("share")&&D(!0);try{let e=await (0,tn.m)("assets");e&&u(e);let a=await (0,tn.m)("characters");a&&c(a);let i=await (0,tn.m)("workflows");if(i){s(i);let e=i.find(e=>e.id===t);e&&(_(e.nodes),U(e.connections),F(e.groups))}let r=await (0,tn.m)("nodes");!t&&r&&_(r)}catch(e){}finally{b(!0)}})()},[t]),(0,o.useEffect)(()=>{if(g){if(t){var e,r;let i={id:t,title:(null===(e=a.find(e=>e.id===t))||void 0===e?void 0:e.title)||"Untitled",thumbnail:(null===(r=Z.find(e=>e.data.image))||void 0===r?void 0:r.data.image)||"",nodes:Z,connections:G,groups:L},n=a.map(e=>e.id===t?i:e);n.find(e=>e.id===t)||n.push(i),s(n),(0,tn.R)("workflows",n)}(0,tn.R)("assets",d),(0,tn.R)("characters",i)}},[Z,G,L,g,t,i]);let eX=(0,o.useCallback)(()=>{let e={nodes:JSON.parse(JSON.stringify(eP.current)),connections:JSON.parse(JSON.stringify(e_.current)),groups:JSON.parse(JSON.stringify(eU.current))},t=eF.current.slice(0,eV.current+1);t.push(e),t.length>50&&t.shift(),Y(t),B(t.length-1)},[]),eH=(0,o.useCallback)(()=>{let e=eV.current;if(e>0){let t=eF.current[e-1];_(t.nodes),U(t.connections),F(t.groups),B(e-1)}},[]),eJ=(0,o.useCallback)(e=>{0!==e.length&&(eX(),_(t=>t.filter(t=>!e.includes(t.id)).map(t=>({...t,inputs:t.inputs.filter(t=>!e.includes(t))}))),U(t=>t.filter(t=>!e.includes(t.from)&&!e.includes(t.to))),es([]))},[eX]),eq=(0,o.useCallback)(e=>{0!==e.length&&(eX(),U(t=>t.filter(t=>!e.includes("".concat(t.from,"-").concat(t.to)))),_(t=>t.map(t=>{let a=e.filter(e=>e.endsWith("-".concat(t.id)));if(a.length>0){let e=a.map(e=>e.split("-")[0]);return{...t,inputs:t.inputs.filter(t=>!e.includes(t))}}return t})),el([]))},[eX]),e$=(0,o.useCallback)(e=>{eX(),F(t=>t.filter(t=>t.id!==e)),ei===e&&er(null)},[eX,ei]),eQ=(0,o.useCallback)((e,t,a,s)=>{if(e===r.IMAGE_EDITOR){v(!0);return}eX();let i="gemini-3-pro-preview";e===r.IMAGE_GENERATOR||e===r.STORYBOARD_GENERATOR?i="gemini-3-pro-image-preview":e===r.VIDEO_GENERATOR&&(i="veo-3.1-fast-generate-preview");let l={model:i,aspectRatio:"16:9",scriptMode:e===r.SCRIPT_MASTER?"CREATE":void 0,cinematicVersion:e===r.STORYBOARD_GENERATOR?"V1":void 0,...s},o=void 0!==t?t:(-J.x+window.innerWidth/2)/K-210,c=void 0!==a?a:(-J.y+window.innerHeight/2)/K-180,d={id:"n-".concat(Date.now(),"-").concat(Math.floor(1e3*Math.random())),type:e,x:isNaN(o)?100:o,y:isNaN(c)?100:c,width:420,title:tc(e),status:n.IDLE,data:l,inputs:[]};_(e=>[...e,d])},[J,K,eX]),e0=(0,o.useCallback)((e,t,a)=>{u(s=>s.find(e=>e.src===t)?s:[{id:"a-".concat(Date.now()),type:e,src:t,title:a,timestamp:Date.now()},...s])},[]),e1=(0,o.useCallback)((e,t,a,s)=>{_(i=>i.map(i=>{if(i.id===e){let e={...i,data:{...i.data,...t},title:s||i.title};return a&&(a.width&&(e.width=a.width),a.height&&(e.height=a.height)),t.image&&e0("image",t.image,e.title),t.videoUri&&e0("video",t.videoUri,e.title),t.audioUri&&e0("audio",t.audioUri,e.title),e}return i}))},[e0]),e5=(0,o.useCallback)(async(e,t)=>{let a=eP.current.find(t=>t.id===e);if(a){e1(e,{error:void 0}),_(t=>t.map(t=>t.id===e?{...t,status:n.WORKING}:t));try{var s,i;let l=a.inputs.map(e=>eP.current.find(t=>t.id===e)).filter(Boolean),o=l.map(e=>e.data.remixedScript||e.data.displayResult||e.data.analysis||e.data.prompt).filter(e=>e&&e.trim().length>0),c=l.map(e=>e.data.croppedFrame||e.data.image).filter(Boolean),d=t||a.data.prompt||"",u=o.join("\n\n");if(a.type===r.SCRIPT_MASTER){let t=a.data.scriptMode||"CREATE",i="";if("CREATE"===t){let e=a.data.displayResult||u;i=await (0,ef.wj)(e,d,a.data.model)}else if("REMIX"===t){let e=a.data.displayResult||u,t=a.data.videoUri||(null===(s=l.find(e=>e.data.videoUri))||void 0===s?void 0:s.data.videoUri),r="";if(t){let e=t;t.startsWith("http")&&(e=await (0,ef.d4)(e)),r=await (0,ef.iO)(e,"提取该视频的动作逻辑、视觉风格和人设特征。","gemini-3-flash-preview")}i=await (0,ef.Ms)(e,r,d,a.data.model)}else i=await (0,ef.expandVisualDescription)(d||u,a.data.model);e1(e,{remixedScript:i})}else if(a.type===r.STORYBOARD_GENERATOR){let t=a.data.prompt||u,s=a.data.image||c[0],i=a.data.cinematicVersion||"V1";if(!t&&!s)throw Error("缺少 Prompt、剧本输入或参考图");let l=await (0,ef.CN)(t||"Analyze this image",i,s);if(l.length>0){eX();let t=[],s=[],i=a.x+500,o=a.y;l.forEach((e,l)=>{let c=l%3,d=Math.floor(l/3),u="n-story-".concat(Date.now(),"-").concat(l);t.push({id:u,type:r.IMAGE_GENERATOR,x:i+460*c,y:o+420*d,width:420,title:"分镜 ".concat(l+1),status:n.IDLE,data:{prompt:e,model:"gemini-3-pro-image-preview",aspectRatio:a.data.aspectRatio||"16:9",autoStart:!0},inputs:[a.id]}),s.push({from:a.id,to:u})}),F(e=>[...e,{id:"g-story-".concat(Date.now()),title:"导演分镜组",x:i-40,y:o-40,width:1380,height:420*Math.ceil(l.length/3)}]),_(e=>[...e,...t]),U(e=>[...e,...s]),e1(e,{status:n.SUCCESS});return}}else if(a.type===r.IMAGE_GENERATOR){let t=[...c];a.data.image&&!t.includes(a.data.image)&&t.push(a.data.image);let s=await (0,ef.oE)(d||u,a.data.model,t,{aspectRatio:a.data.aspectRatio,resolution:a.data.resolution});e1(e,{image:s[0],images:s})}else if(a.type===r.VIDEO_GENERATOR){let t=await tr(a,l,d||u),s=await (0,ef.wo)(t.finalPrompt,a.data.model,{aspectRatio:a.data.aspectRatio,resolution:a.data.resolution,duration:a.data.duration},t.inputImageForGeneration,t.videoInput,t.referenceImages,t.lastFrameImage);e1(e,{videoUri:s.uri,videoMetadata:s.videoMetadata})}else if(a.type===r.AUDIO_GENERATOR){let t=await (0,ef.gW)(d||u);e1(e,{audioUri:t})}else if(a.type===r.PROMPT_INPUT){let t=await (0,ef.bE)([],d||u,{isThinkingMode:!0,model:a.data.model});e1(e,{displayResult:t})}else if(a.type===r.VIDEO_ANALYZER){let t=a.data.videoUri||(null===(i=l.find(e=>e.data.videoUri))||void 0===i?void 0:i.data.videoUri);if(!t)throw Error("无视频");let s=t;t.startsWith("http")&&(s=await (0,ef.d4)(t));let r=await (0,ef.iO)(s,d||"分析视频内容",a.data.model);e1(e,{analysis:r})}_(t=>t.map(t=>t.id===e?{...t,status:n.SUCCESS}:t))}catch(t){e1(e,{error:t.message}),_(t=>t.map(t=>t.id===e?{...t,status:n.ERROR}:t))}}},[e1,eX]),e4=(0,o.useCallback)(e=>{let t=L.find(t=>t.id===e);if(!t)return;eX();let a=Z.filter(e=>{let a=tu(e);return a.x+a.width/2>t.x&&a.x+a.width/2<t.x+t.width&&a.y+160>t.y&&a.y+160<t.y+t.height});if(0===a.length)return;a.sort((e,t)=>{let a=e.title||"",s=t.title||"",i=a.match(/分镜\s*(\d+)/),r=s.match(/分镜\s*(\d+)/);if(i&&r)return parseInt(i[1])-parseInt(r[1]);let n=parseInt(e.id.split("-")[2]||"0"),l=parseInt(t.id.split("-")[2]||"0");return n!==l?n-l:e.y-t.y||e.x-t.x});let s=t.x+40,i=t.y+60,r=[...Z];a.forEach((e,t)=>{let a=r.findIndex(t=>t.id===e.id);-1!==a&&(r[a]={...r[a],x:s+t%3*460,y:i+420*Math.floor(t/3)})});let n=Math.ceil(a.length/3),l=Math.max(t.height,420*n+80);_(r),F(t=>t.map(t=>t.id===e?{...t,height:l}:t))},[Z,L,eX]),e3=(0,o.useRef)(new Set);(0,o.useEffect)(()=>{let e=Z.filter(e=>e.status===n.IDLE&&e.data.autoStart&&!e3.current.has(e.id));e.length>0&&e.forEach(e=>{e3.current.add(e.id),setTimeout(()=>{e1(e.id,{autoStart:!1}),e5(e.id)},0)})},[Z,e5,e1]);let e8=(0,o.useCallback)(e=>{eW.current||(eW.current=requestAnimationFrame(()=>{if(eW.current=null,Q){let t=e.clientX-et.current.x,a=e.clientY-et.current.y;$(e=>({x:e.x+t,y:e.y+a})),et.current={x:e.clientX,y:e.clientY}}if(eZ(t=>{if(t){let a={...t,endX:e.clientX,endY:e.clientY},s=Math.min(a.startX,a.endX),i=Math.min(a.startY,a.endY),r=Math.max(a.startX,a.endX),n=Math.max(a.startY,a.endY),l=eP.current.filter(e=>{let t=tu(e),a=t.x*K+J.x,l=t.y*K+J.y,o=t.width*K,c=t.height*K;return a<r&&a+o>s&&l<n&&l+c>i}).map(e=>e.id);return(l.length>0||ea.length>0)&&es(l),a}return null}),ed&&eB.current){let{startX:t,startY:a,mouseStartX:s,mouseStartY:i,otherSelectedNodes:r}=eB.current,n=(e.clientX-s)/K,l=(e.clientY-i)/K;_(e=>e.map(e=>{if(e.id===ed)return{...e,x:t+n,y:a+l};let s=null==r?void 0:r.find(t=>t.id===e.id);return s?{...e,x:s.startX+n,y:s.startY+l}:e}))}if(eK.current){let{id:t,startX:a,startY:s,mouseStartX:i,mouseStartY:r,childNodes:n}=eK.current,l=(e.clientX-i)/K,o=(e.clientY-r)/K;F(e=>e.map(e=>e.id===t?{...e,x:a+l,y:s+o}:e)),n.length>0&&_(e=>e.map(e=>{let t=n.find(t=>t.id===e.id);return t?{...e,x:t.startX+l,y:t.startY+o}:e}))}}))},[Q,ed,K]),e9=(0,o.useCallback)(()=>{eW.current&&cancelAnimationFrame(eW.current),eW.current=null,(ed||eK.current)&&eX(),eZ(e=>{if(e){let t=Math.min(e.startX,e.endX),a=Math.min(e.startY,e.endY),s=Math.max(e.startX,e.endX),i=Math.max(e.startY,e.endY);_(e=>{let r=e.filter(e=>{let r=tu(e),n=r.x*K+J.x,l=r.y*K+J.y,o=r.width*K,c=r.height*K;return n<s&&n+o>t&&l<i&&l+c>a}).map(e=>e.id);return r.length>0&&es(e=>r),e})}return null}),ee(!1),eu(null),eB.current=null,eK.current=null},[eX,ed,K,J]);return(0,o.useEffect)(()=>(window.addEventListener("mousemove",e8),window.addEventListener("mouseup",e9),()=>{window.removeEventListener("mousemove",e8),window.removeEventListener("mouseup",e9)}),[e8,e9]),(0,o.useEffect)(()=>{let e=e=>{"Space"!==e.code||e.repeat||e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||eM(!0),("Delete"===e.key||"Backspace"===e.key)&&!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)&&(ea.length>0&&eJ(ea),ei&&e$(ei),en.length>0&&eq(en))},t=e=>{"Space"===e.code&&(eM(!1),ee(!1))};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[ea,ei,en,eJ,e$,eq]),(0,l.jsx)("div",{className:"w-screen h-screen overflow-hidden bg-[#0a0a0c]",children:(0,l.jsxs)("div",{className:"w-full h-full relative ".concat(Q?"cursor-grabbing":eO?"cursor-grab":"cursor-default"),onMouseDown:e=>{ew&&ej(null),er(null),0!==e.button||e.shiftKey||(eO?(ee(!0),et.current={x:e.clientX,y:e.clientY}):(eZ({startX:e.clientX,startY:e.clientY,endX:e.clientX,endY:e.clientY}),e.metaKey||e.ctrlKey||es([])))},onContextMenu:e=>{e.preventDefault(),M||ej({visible:!0,x:e.clientX,y:e.clientY})},onWheel:e=>{e.preventDefault();let t=Math.min(Math.max(.2,K+-(.001*e.deltaY)),3),a=e.clientX,s=e.clientY,i=(a-J.x)/K,r=(s-J.y)/K;X(t),$({x:a-i*t,y:s-r*t})},children:[(0,l.jsx)("div",{className:"absolute inset-0 noise-bg opacity-[0.03]"}),(0,l.jsx)("div",{className:"absolute top-8 left-12 z-50 pointer-events-none opacity-20",children:(0,l.jsx)("h1",{className:"text-4xl font-black italic tracking-tighter text-white pr-2",children:"InkAI"})}),M&&(0,l.jsx)("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 z-[100] animate-in slide-in-from-top duration-500",children:(0,l.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2 bg-purple-500/20 backdrop-blur-3xl border border-purple-500/30 rounded-full shadow-2xl",children:[(0,l.jsx)(E.Z,{size:16,className:"text-purple-400 animate-pulse"}),(0,l.jsx)("span",{className:"text-xs font-black text-purple-200 uppercase tracking-widest",children:"只读预览模式 (Shared View)"})]})}),0===Z.length&&(0,l.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-40 transition-all duration-1000 animate-in fade-in slide-in-from-bottom-12",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center mb-16 select-none",children:[(0,l.jsx)("h1",{className:"text-8xl md:text-[140px] font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-b from-white via-zinc-200 to-zinc-600 drop-shadow-[0_10px_30px_rgba(0,0,0,0.5)] py-8 pl-8 pr-24 italic text-center leading-tight",children:"InkAI"}),(0,l.jsx)("p",{className:"text-zinc-500 text-sm font-bold tracking-[0.4em] uppercase mt-[-20px] opacity-40",children:"Turning ideas into reality"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 max-w-6xl px-6 w-full",children:[(0,l.jsx)("div",{onClick:()=>eQ(r.IMAGE_GENERATOR),className:"group relative h-48 bg-[#121214]/60 backdrop-blur-2xl border border-white/5 hover:border-cyan-500/30 rounded-3xl p-6 cursor-pointer transition-all duration-500 hover:-translate-y-2 overflow-hidden shadow-2xl",children:(0,l.jsxs)("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-cyan-500/10 border border-cyan-500/20 flex items-center justify-center text-cyan-400",children:(0,l.jsx)(A.Z,{size:18})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-bold text-white mb-1",children:"图片生成"}),(0,l.jsx)("p",{className:"text-[11px] text-zinc-500 font-medium leading-relaxed",children:"生成高精细节的视觉原画"})]})]})}),(0,l.jsx)("div",{onClick:()=>eQ(r.VIDEO_GENERATOR),className:"group relative h-48 bg-[#121214]/60 backdrop-blur-2xl border border-white/5 hover:border-purple-500/30 rounded-3xl p-6 cursor-pointer transition-all duration-500 hover:-translate-y-2 overflow-hidden shadow-2xl",children:(0,l.jsxs)("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-purple-500/10 border border-purple-500/20 flex items-center justify-center text-purple-400",children:(0,l.jsx)(I.Z,{size:18})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-bold text-white mb-1",children:"视频生成"}),(0,l.jsx)("p",{className:"text-[11px] text-zinc-500 font-medium leading-relaxed",children:"打造电影级动态镜头"})]})]})}),(0,l.jsx)("div",{onClick:()=>eQ(r.SCRIPT_MASTER),className:"group relative h-48 bg-[#121214]/60 backdrop-blur-2xl border border-white/5 hover:border-amber-500/30 rounded-3xl p-6 cursor-pointer transition-all duration-500 hover:-translate-y-2 overflow-hidden shadow-2xl",children:(0,l.jsxs)("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-2xl bg-amber-500/10 border border-amber-500/20 flex items-center justify-center text-amber-400",children:(0,l.jsx)(j.Z,{size:18})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-xl font-bold text-white mb-1",children:"剧本大师"}),(0,l.jsx)("p",{className:"text-[11px] text-zinc-500 font-medium leading-relaxed",children:"创作、重构与灵感扩写"})]})]})})]})]}),eD&&(0,l.jsx)("div",{className:"absolute border border-cyan-500/50 bg-cyan-500/10 pointer-events-none z-[100]",style:{left:Math.min(eD.startX,eD.endX),top:Math.min(eD.startY,eD.endY),width:Math.abs(eD.endX-eD.startX),height:Math.abs(eD.endY-eD.startY)}}),(null==ew?void 0:ew.visible)&&(0,l.jsx)("div",{className:"fixed z-[200] bg-[#1c1c1e] border border-white/10 rounded-xl shadow-2xl p-1.5 min-w-[160px] animate-in zoom-in-95 duration-100",style:{left:ew.x,top:ew.y},onMouseDown:e=>e.stopPropagation(),children:[{id:r.PROMPT_INPUT,label:"提示工程 (Prompt)",icon:P.Z},{id:r.SCRIPT_MASTER,label:"剧本大师 (Script)",icon:j.Z},{id:r.IMAGE_GENERATOR,label:"图片生成 (Image)",icon:A.Z},{id:r.STORYBOARD_GENERATOR,label:"一键分镜 (Storyboard)",icon:k.Z},{id:r.VIDEO_GENERATOR,label:"视频生成 (Video)",icon:I.Z},{id:r.VIDEO_ANALYZER,label:"视频分析 (Analyze)",icon:E.Z},{id:r.IMAGE_EDITOR,label:"图像编辑 (Editor)",icon:q.Z},{id:r.AUDIO_GENERATOR,label:"灵感音乐 (Audio)",icon:eG.Z}].map(e=>(0,l.jsxs)("button",{onClick:()=>{let t=(ew.x-J.x)/K,a=(ew.y-J.y)/K;eQ(e.id,t,a),ej(null)},className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg text-xs text-slate-300 hover:bg-white/10 hover:text-white transition-colors",children:[(0,l.jsx)(e.icon,{size:14,className:"text-slate-500"}),(0,l.jsx)("span",{children:e.label})]},e.id))}),(0,l.jsxs)("div",{style:{transform:"translate(".concat(J.x,"px, ").concat(J.y,"px) scale(").concat(K,")"),width:"100%",height:"100%",transformOrigin:"0 0"},children:[L.map(e=>(0,l.jsx)("div",{className:"group/groupbox absolute rounded-[32px] border transition-all ".concat(ei===e.id?"border-cyan-500/30 bg-cyan-500/5":"border-white/10 bg-white/5"),style:{left:e.x,top:e.y,width:e.width,height:e.height},onMouseDown:t=>{if(eO)return;t.stopPropagation(),er(e.id);let a=Z.filter(t=>{let a=tu(t);return a.x+a.width/2>e.x&&a.x+a.width/2<e.x+e.width&&a.y+160>e.y&&a.y+160<e.y+e.height}).map(e=>({id:e.id,startX:e.x,startY:e.y}));eK.current={id:e.id,startX:e.x,startY:e.y,mouseStartX:t.clientX,mouseStartY:t.clientY,childNodes:a}},children:(0,l.jsxs)("div",{className:"absolute -top-10 left-0 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-xs font-bold text-white/40 uppercase tracking-widest px-4 py-1 rounded-full bg-white/5 border border-white/5",children:e.title}),(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),e4(e.id)},className:"p-1 rounded-full bg-cyan-500/20 text-cyan-400 opacity-0 group-hover/groupbox:opacity-100 transition-opacity hover:bg-cyan-500/30",title:"自动排列整齐",children:(0,l.jsx)(tl.Z,{size:12})}),(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),e$(e.id)},className:"p-1 rounded-full bg-red-500/20 text-red-400 opacity-0 group-hover/groupbox:opacity-100 transition-opacity hover:bg-red-500/30",children:(0,l.jsx)(N.Z,{size:12})})]})},e.id)),(0,l.jsx)("svg",{className:"absolute inset-0 overflow-visible pointer-events-none",children:G.map(e=>{let t=Z.find(t=>t.id===e.from),a=Z.find(t=>t.id===e.to);if(!t||!a)return null;let s=t.height||td(t),i=a.height||td(a),r=t.x+(t.width||420)+3,n=t.y+s/2,o=a.x-3,c=a.y+i/2,d="".concat(e.from,"-").concat(e.to),u=en.includes(d),x=eo===d;return(0,l.jsxs)("g",{onMouseEnter:()=>ec(d),onMouseLeave:()=>ec(null),children:[(0,l.jsx)("path",{d:"M ".concat(r," ").concat(n," C ").concat(r+(o-r)*.5," ").concat(n," ").concat(o-(o-r)*.5," ").concat(c," ").concat(o," ").concat(c),stroke:"transparent",strokeWidth:"20",fill:"none",className:"pointer-events-auto cursor-pointer",onClick:e=>{e.stopPropagation(),el([d]),es([]),er(null)}}),(0,l.jsx)("path",{d:"M ".concat(r," ").concat(n," C ").concat(r+(o-r)*.5," ").concat(n," ").concat(o-(o-r)*.5," ").concat(c," ").concat(o," ").concat(c),stroke:u?"#22d3ee":x?"rgba(34,211,238,0.6)":"rgba(34,211,238,0.3)",strokeWidth:u?"4":x?"4":"3",fill:"none",className:"pointer-events-none transition-all duration-200",style:{filter:u||x?"drop-shadow(0 0 4px rgba(34,211,238,0.5))":"none"}})]},d)})}),Z.map(e=>(0,l.jsx)(H,{node:e,onUpdate:e1,onAction:e5,onDelete:e=>eJ([e]),onExpand:ek,onCrop:(e,t)=>{eS(e),eA(t)},onSelect:e=>es([e]),onSaveCharacter:(e,t,a)=>{let s={id:"char-".concat(Date.now()),name:e,description:t,image:a,createdAt:Date.now()};c(e=>[s,...e])},onNodeMouseDown:(e,t)=>{if(eO)return;e.stopPropagation();let a=ea.includes(t),s=[t];e.metaKey||e.ctrlKey||e.shiftKey?s=a?ea.filter(e=>e!==t):[...ea,t]:a&&(s=ea),es(s),er(null),el([]);let i=Z.find(e=>e.id===t);if(i){let a=Z.filter(e=>s.includes(e.id)&&e.id!==t).map(e=>({id:e.id,startX:e.x,startY:e.y}));eB.current={id:t,startX:i.x,startY:i.y,mouseStartX:e.clientX,mouseStartY:e.clientY,otherSelectedNodes:a},eu(t)}},onPortMouseDown:(e,t)=>{eO||(e.stopPropagation(),ez({id:t,x:e.clientX,y:e.clientY}))},onPortMouseUp:(e,t)=>{e.stopPropagation();let a=eY.current;a&&a.id!==t&&(U(e=>[...e,{from:a.id,to:t}]),_(e=>e.map(e=>e.id===t?{...e,inputs:[...e.inputs,a.id]}:e))),ez(null)},onNodeContextMenu:(e,t)=>{e.preventDefault(),e.stopPropagation(),ej({visible:!0,x:e.clientX,y:e.clientY,id:t})},onResizeMouseDown:(e,t,a,s)=>{eO||(e.stopPropagation(),ep(t),eg({width:a,height:s}),ev({x:e.clientX,y:e.clientY}))},isSelected:ea.includes(e.id)},e.id))]}),(0,l.jsx)(eh,{onAddNode:eQ,onUndo:eH,isChatOpen:x,onToggleChat:()=>h(!x),isMultiFrameOpen:w,onToggleMultiFrame:()=>y(!w),assetHistory:d,onHistoryItemClick:e=>eQ("image"===e.type?r.IMAGE_GENERATOR:r.VIDEO_GENERATOR,void 0,void 0,"image"===e.type?{image:e.src}:{videoUri:e.src}),onDeleteAsset:e=>u(t=>t.filter(t=>t.id!==e)),workflows:a,selectedWorkflowId:p,onSelectWorkflow:e=>{let t=a.find(t=>t.id===e);t&&(_(JSON.parse(JSON.stringify(t.nodes))),U(JSON.parse(JSON.stringify(t.connections))),F(JSON.parse(JSON.stringify(t.groups))),m(e))},onSaveWorkflow:()=>{var e;let t={id:"wf-".concat(Date.now()),title:"工作流 ".concat(new Date().toLocaleDateString()),thumbnail:(null===(e=Z.find(e=>e.data.image))||void 0===e?void 0:e.data.image)||"",nodes:JSON.parse(JSON.stringify(Z)),connections:JSON.parse(JSON.stringify(G)),groups:JSON.parse(JSON.stringify(L))};s(e=>[t,...e])},onDeleteWorkflow:e=>s(t=>t.filter(t=>t.id!==e)),onRenameWorkflow:(e,t)=>s(a=>a.map(a=>a.id===e?{...a,title:t}:a)),onImportWorkflow:e=>{s(t=>[e,...t]),m(e.id),_(e.nodes),U(e.connections),F(e.groups||[])},characters:i,onAddCharacter:e=>c(t=>[e,...t]),onDeleteCharacter:e=>c(t=>t.filter(t=>t.id!==e)),onApplyCharacter:e=>{1===ea.length?e1(ea[0],{images:[e.image],prompt:e.description}):eQ(r.IMAGE_GENERATOR,void 0,void 0,{imageMode:"I2I",images:[e.image],prompt:e.description})},onOpenSettings:()=>T(!0),onOpenAdmin:()=>O(!0),isReadOnly:M}),(0,l.jsx)(tx,{media:eN,onClose:()=>ek(null)}),(0,l.jsx)(e6,{isOpen:C,onClose:()=>T(!1)}),(0,l.jsx)(ta,{isOpen:z,onClose:()=>O(!1)}),(0,l.jsx)(ey,{isOpen:x,onClose:()=>h(!1)}),eR&&eC&&(0,l.jsx)(eE,{imageSrc:eC,onCancel:()=>{eS(null),eA(null)},onConfirm:e=>{e1(eR,{croppedFrame:e}),eS(null),eA(null)}}),f&&(0,l.jsx)(eI,{onClose:()=>v(!1),onGenerate:(e,t,a)=>{eQ("image"===e?r.IMAGE_GENERATOR:r.VIDEO_GENERATOR,void 0,void 0,"image"===e?{image:t,prompt:a}:{videoUri:t,prompt:a})}}),(0,l.jsx)(eL,{isOpen:w,onClose:()=>y(!1),onGenerateAudio:async e=>await (0,ef.gW)(e),onGenerate:async(e,t)=>await (0,ef.MH)(e,"veo-3.1-fast-generate-preview",{aspectRatio:"16:9"},t),onGenerateSegment:async(e,t)=>{var a;let s=e.transition.prompt||"Maintain strict visual continuity and smooth motion between frames.",i=e.transition.duration||3,r=await (0,ef.wo)(s,"veo-3.1-fast-generate-preview",{aspectRatio:"16:9",duration:i},e.src,void 0,void 0,t.src);if(null==r?void 0:r.uri)return r.uri;if(null==r?void 0:null===(a=r.videoMetadata)||void 0===a?void 0:a.uri)return r.videoMetadata.uri;throw Error("Segment generation failed")}}),(0,l.jsx)(e2,{isOpen:R,onClose:()=>S(!1),history:d.filter(e=>"audio"===e.type),onGenerate:(e,t)=>e0("audio",e,t),onSaveToAssets:e=>u(t=>[e,...t])})]})})}},4317:function(e,t,a){"use strict";a.d(t,{Ms:function(){return k},iO:function(){return j},jL:function(){return z},wj:function(){return N},expandVisualDescription:function(){return E},X_:function(){return C},gW:function(){return A},oE:function(){return y},wo:function(){return v},MH:function(){return w},CN:function(){return f},bE:function(){return R},KR:function(){return T},d4:function(){return S}});var s=a(954);a(4590);var i=a(8064),r=(0,i.$)("10ee66149d7292c70664a2b6fcd7f7a70d2c3076"),n=(0,i.$)("eb151d3fd857512271a65ce58cdee5f0c1e7b492"),l=(0,i.$)("339fcfd5065a4751c35774d5057596578758eddb"),o=(0,i.$)("fce521ad3c90b3e771b86791ccd823b072aac3aa"),c=(0,i.$)("dccf7eab92aa7700d0bfbb18afb2b6f9bff04cb8"),d=(0,i.$)("1d6c83ceea59af419a9339e920af96f843ae4931"),u=(0,i.$)("a78d6bd7ccacd86d81fd5dfaacb074eca54b8ecd"),x=(0,i.$)("6e4f4bd43c5cc2f1c37851bff4349970904bddc6");let h=()=>localStorage.getItem("inkai_api_key"),p=()=>{let e=h()||"PLACEHOLDER_API_KEY";return e?new s.fA({apiKey:e}):null},m=e=>new Promise(t=>setTimeout(t,e)),g=e=>{if(!e)return"";let t=e.split(",");return t.length>1?t[1]:t[0]},b=e=>{let t=e.match(/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+);base64,/);return t?t[1]:"image/png"},f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"V1",a=arguments.length>2?arguments[2]:void 0,s=p();if(!s)return await n(e,t,a);let i="";i="V1"===t?'\n        <instruction> Analyze the entire composition of the input image. Identify ALL key subjects present (whether it\'s a single person, a group/couple, a vehicle, or a specific object) and their spatial relationship/interaction.\n        Generate a cohesive 3x3 grid "Cinematic Contact Sheet" featuring 9 distinct camera shots of exactly these subjects in the same environment.\n        You must adapt the standard cinematic shot types to fit the content (e.g., if a group, keep the group together; if an object, frame the whole object):\n        Row 1 (Establishing Context):\n        1.Extreme Long Shot (ELS): The subject(s) are seen small within the vast environment.\n        2.Long Shot (LS): The complete subject(s) or group is visible from top to bottom (head to toe / wheels to roof).\n        3.Medium Long Shot (American/3-4): Framed from knees up (for people) or a 3/4 view (for objects).\n        Row 2 (The Core Coverage): 4. Medium Shot (MS): Framed from the waist up (or the central core of the object). Focus on interaction/action. 5. Medium Close-Up (MCU): Framed from chest up. Intimate framing of the main subject(s). 6. Close-Up (CU): Tight framing on the face(s) or the "front" of the object.\n        Row 3 (Details & Angles): 7. Extreme Close-Up (ECU): Macro detail focusing intensely on a key feature (eyes, hands, logo, texture). 8. Low Angle Shot (Worm\'s Eye): Looking up at the subject(s) from the ground (imposing/heroic). 9. High Angle Shot (Bird\'s Eye): Looking down on the subject(s) from above.\n        Ensure strict consistency: The same people/objects, same clothes, and same lighting across all 9 panels. The depth of field should shift realistically (bokeh in close-ups). </instruction>\n        A professional 3x3 cinematic storyboard grid containing 9 panels.\n        The grid showcases the specific subject/scene from the input image in a comprehensive range of focal lengths.\n        Top Row: Wide environmental shot, Full view, 3/4 cut.\n        Middle Row: Waist-up view, Chest-up view, Face/Front close-up.\n        Bottom Row: Macro detail, Low Angle, High Angle.\n        All frames feature photorealistic textures, consistent cinematic color grading, and correct framing for the specific number of subjects or objects analyzed.\n        \n        OUTPUT REQUIREMENT: Return exactly a JSON array containing 9 strings, where each string describes one of the 9 panels defined above.\n        ':"V2"===t?"\n        <role> You are an award-winning trailer director + cinematographer + storyboard artist. Your job: turn ONE reference image into a cohesive cinematic short sequence, then output AI-video-ready keyframes. </role>\n        <input> User provides: one reference image (image). </input>\n        <non-negotiable rules - continuity & truthfulness>\n        1.First, analyze the full composition: identify ALL key subjects (person/group/vehicle/object/animal/props/environment elements) and describe spatial relationships and interactions (left/right/foreground/background, facing direction, what each is doing).\n        2.Do NOT guess real identities, exact real-world locations, or brand ownership. Stick to visible facts. Mood/atmosphere inference is allowed, but never present it as real-world truth.\n        3.Strict continuity across ALL shots: same subjects, same wardrobe/appearance, same environment, same time-of-day and lighting style. Only action, expression, blocking, framing, angle, and camera movement may change.\n        4.Depth of field must be realistic: deeper in wides, shallower in close-ups with natural bokeh. Keep ONE consistent cinematic color grade across the entire sequence.\n        5.Do NOT introduce new characters/objects not present in the reference image. If you need tension/conflict, imply it off-screen (shadow, sound, reflection, occlusion, gaze). </non-negotiable rules - continuity & truthfulness>\n        <goal> Expand the image into a 10–20 second cinematic clip with a clear theme and emotional progression (setup → build → turn → payoff). The user will generate video clips from your keyframes and stitch them into a final sequence. </goal>\n        <step 1 - scene breakdown> Output (with clear subheadings):\n        Subjects: list each key subject (A/B/C…), describe visible traits (wardrobe/material/form), relative positions, facing direction, action/state, and any interaction.\n        Environment & Lighting: interior/exterior, spatial layout, background elements, ground/walls/materials, light direction & quality (hard/soft; key/fill/rim), implied time-of-day, 3–8 vibe keywords.\n        Visual Anchors: list 3–6 visual traits that must stay constant across all shots (palette, signature prop, key light source, weather/fog/rain, grain/texture, background markers). </step 1 - scene breakdown>\n        <step 2 - theme & story> From the image, propose:\n        Theme: one sentence.\n        Logline: one restrained trailer-style sentence grounded in what the image can support.\n        Emotional Arc: 4 beats (setup/build/turn/payoff), one line each. </step 2 - theme & story>\n        <step 3 - cinematic approach> Choose and explain your filmmaking approach (must include):\n        Shot progression strategy: how you move from wide to close (or reverse) to serve the beats\n        Camera movement plan: push/pull/pan/dolly/track/orbit/handheld micro-shake/gimbal—and WHY\n        Lens & exposure suggestions: focal length range (18/24/35/50/85mm etc.), DoF tendency (shallow/medium/deep), shutter “feel” (cinematic vs documentary)\n        Light & color: contrast, key tones, material rendering priorities, optional grain (must match the reference style) </step 3 - cinematic approach>\n        <step 4 - keyframes for AI video (primary deliverable)> Output a Keyframe List: default 9–12 frames (later assembled into ONE master grid). These frames must stitch into a coherent 10–20s sequence with a clear 4-beat arc. Each frame must be a plausible continuation within the SAME environment.\n        Use this exact format per frame:\n        [KF# | suggested duration (sec) | shot type (ELS/LS/MLS/MS/MCU/CU/ECU/Low/Worm’s-eye/High/Bird’s-eye/Insert)]\n        Composition: subject placement, foreground/mid/background, leading lines, gaze direction\n        Action/beat: what visibly happens (simple, executable)\n        Camera: height, angle, movement (e.g., slow 5% push-in / 1m lateral move / subtle handheld)\n        Lens/DoF: focal length (mm), DoF (shallow/medium/deep), focus target\n        Lighting & grade: keep consistent; call out highlight/shadow emphasis\n        Sound/atmos (optional): one line (wind, city hum, footsteps, metal creak) to support editing rhythm\n        Hard requirements:\n        Must include: 1 environment-establishing wide, 1 intimate close-up, 1 extreme detail ECU, and 1 power-angle shot (low or high).\n        Ensure edit-motivated continuity between shots (eyeline match, action continuation, consistent screen direction / axis). </step 4 - keyframes for AI video>\n        \n        OUTPUT REQUIREMENT: Based on the Keyframe List generated in Step 4, return exactly a JSON array containing 9 strings. Each string should be a full, detailed image prompt for one keyframe, incorporating all the visual anchors and continuity details to ensure character consistency.\n        ":"V3"===t?"\n        STORY-TO-STORYBOARD META-PROMPT\n        IMPORTANT: Do not create the image, create the detailed prompt for the image.\n        The image prompt must make reference to the story and reference image provided by user, the prompt must follow exactly the details of the image prompt\n        When the user provides a short story synopsis, follow these steps:\n        Analyze the synopsis and identify:\n        The main subject(s) (person, pair, group, creature, vehicle, object)\n        Their appearance and defining traits\n        The environment and tone\n        The emotional or narrative beat\n        Lighting/mood implied by the story\n        Create a full 3\xd73 cinematic storyboard grid with 9 distinct shots of the same subject(s) in the same environment, using consistent wardrobe, lighting, and atmosphere.\n        \n        OUTPUT FORMAT\n        Cinematic 3\xd73 Storyboard Prompt\n        Story Synopsis (interpreted):\n        <one-sentence interpretation of the user’s synopsis>\n        Create a professional 3\xd73 cinematic storyboard grid featuring the same subject(s) from the synopsis in the same environment.\n        Maintain total consistency in appearance, clothing, lighting, mood, and environmental details.\n        Each panel represents a distinct camera shot following cinematic conventions.\n        Row 1 — Establishing Context\n        Extreme Long Shot (ELS):\n        Full environment revealed, subject(s) small in frame. Match the story’s setting, lighting, and mood.\n        Long Shot (LS):\n        Entire subject(s) visible head-to-toe (or full object/vehicle), standing naturally within the environment.\n        Medium Long Shot (MLS / 3-4 / American Shot):\n        Subject(s) framed from knees up (or 3/4 angle for objects), showing stance, posture, and core emotion.\n        Row 2 — Core Coverage\n        Medium Shot (MS):\n        Waist-up framing. Capture the key action, attitude, or emotional beat implied by the story.\n        Medium Close-Up (MCU):\n        Chest-up. Focus on emotion, expression, micro-interaction, or narrative tension.\n        Close-Up (CU):\n        Tight shot of the face (or front detail of an object). Cinematic depth of field, emotional clarity.\n        Row 3 — Details & Angles\n        Extreme Close-Up (ECU):\n        Macro detail: eyes, hands, symbolic object, texture, or a key story element.\n        Low Angle Shot (Worm’s Eye):\n        Camera looking up at the subject(s) from below. Dramatic, heroic, or imposing based on the story’s tone.\n        High Angle Shot (Bird’s Eye):\n        Camera looking down from above. Spatial clarity, vulnerability, or overview of action.\n        Global Requirements\n        Same subject from image prompt(s) in all 9 frames\n        Same clothing, hairstyle, props, weapons, or accessories\n        Same lighting conditions and color grading\n        Consistent environment and weather\n        Correct realism and cinematic depth of field per shot\n        Photorealistic textures\n        Cinematic camera behavior and focal-length accuracy\n\n        Example of How This Works with a Synopsis\n        User input:\n        “A lone desert scout tracks a signal across a ruined canyon at sunset.”\n        Output (shortened example):\n        Story Synopsis: A lone desert scout navigates a canyon wasteland at sunset while tracking a mysterious signal.\n        ELS: small figure against vast ruined canyon\n        LS: scout silhouetted in sunset light\n        MLS: knees-up shot with gear visible\n        MS: waist-up, scanning horizon\n        MCU: chest-up, focused expression\n        CU: dust-covered face, tracking device glow\n        ECU: close-up of the device display\n        Low Angle: heroic stance on canyon ridge\n        High Angle: scout from above, canyon below\n\n        OUTPUT REQUIREMENT: Return exactly a JSON array containing 9 strings. Each string must be the detailed visual description for one of the 9 frames (ELS, LS, MLS, MS, MCU, CU, ECU, Low Angle, High Angle), fully incorporating the character and environment details from the input story and reference image.\n        ":"\n        STORY-TO-STORYBOARD META-PROMPT. Create a full 3\xd73 cinematic storyboard grid with 9 distinct shots.\n        OUTPUT REQUIREMENT: Return exactly a JSON array containing 9 strings.\n        ";let r=[];a&&r.push({inlineData:{data:g(a),mimeType:"image/png"}}),r.push({text:'REFERENCE MATERIAL: """'.concat(e,'"""\n\nSYSTEM INSTRUCTION:\n').concat(i)});try{let t=((await s.models.generateContent({model:"gemini-3-pro-preview",contents:{parts:r},config:{responseMimeType:"application/json"}})).text||"").replace(/```json|```/g,"").trim(),a=JSON.parse(t);return Array.isArray(a)?a.slice(0,9):[e]}catch(e){return[]}},v=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0,n=arguments.length>6?arguments[6]:void 0,o=p();if(!o){let o=await l(e,t,a,s,i,r,n);return o&&o.uri?{...o,uri:"/api/proxy-file?uri=".concat(encodeURIComponent(o.uri))}:o}let c={numberOfVideos:1,aspectRatio:a.aspectRatio||"16:9",resolution:a.resolution||"720p",duration:a.duration?"".concat(a.duration,"s"):void 0},d={prompt:e||"Cinematic video with professional lighting."};s&&(d.image={imageBytes:g(s),mimeType:b(s)}),n&&(c.lastFrame={imageBytes:g(n),mimeType:b(n)}),i&&(d.video=i);try{var u,x,f;let e=await o.models.generateVideos({model:t||"veo-3.1-fast-generate-preview",...d,config:c});for(;!e.done;)await m(5e3),e=await o.operations.getVideosOperation({operation:e});if(e.error)throw Error(e.error.message);let a=null===(f=e.response)||void 0===f?void 0:null===(x=f.generatedVideos)||void 0===x?void 0:null===(u=x[0])||void 0===u?void 0:u.video;if(!a||!a.uri)throw Error("Video generation failed: No video returned");let s=a.uri||a.videoUri;if(!s)throw Error("No video URI in response");let i=h(),r=s;if(i){let e=r.includes("?")?"&":"?";r+="".concat(e,"key=").concat(i)}return{uri:"/api/proxy-file?uri=".concat(encodeURIComponent(r)),videoMetadata:a}}catch(e){throw e}},w=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;if(e.length<2)throw Error("At least 2 frames required for sequence generation");let i=[],r=e.length-1;for(let l=0;l<r;l++){let o=e[l],c=e[l+1];s&&s(l+1,r);let d=o.transition.prompt||"Maintain strict visual continuity and smooth motion between frames.",u=o.transition.duration||3;console.log("Generating segment ".concat(l+1,"/").concat(r,": ").concat(d," (").concat(u,"s)"));try{let e=await v(d,t,{...a,duration:u},o.src,void 0,void 0,c.src);if(e&&e.uri)i.push(e.uri);else{var n;if(console.error("Segment ".concat(l+1," generation failed: No URI returned"),e),null==e?void 0:null===(n=e.videoMetadata)||void 0===n?void 0:n.uri)i.push(e.videoMetadata.uri);else throw Error("Segment ".concat(l+1," failed to generate: No video returned"))}}catch(e){throw console.error("Error generating segment ".concat(l+1,":"),e),e}}return i},y=async function(e,t){var a,s,i,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=p();if(!c)return await o(e,t,n,l);let d=t||"gemini-3-pro-image-preview",u=n.map(e=>({inlineData:{data:g(e),mimeType:"image/png"}}));u.push({text:e});let x=await c.models.generateContent({model:d,contents:{parts:u},config:{imageConfig:{aspectRatio:l.aspectRatio||"1:1",imageSize:l.resolution||"1K"}}}),h=[];if(null===(i=x.candidates)||void 0===i?void 0:null===(s=i[0])||void 0===s?void 0:null===(a=s.content)||void 0===a?void 0:a.parts)for(let e of x.candidates[0].content.parts)(null===(r=e.inlineData)||void 0===r?void 0:r.data)&&h.push("data:".concat(e.inlineData.mimeType||"image/png",";base64,").concat(e.inlineData.data));return h},j=async(e,t,a)=>{var s;let i=p();if(!i)throw Error("Video Analysis requires a configured API Key in Settings.");let r=(null===(s=e.match(/^data:(video\/\w+);base64,/))||void 0===s?void 0:s[1])||"video/mp4";return(await i.models.generateContent({model:a||"gemini-3-flash-preview",contents:{parts:[{inlineData:{mimeType:r,data:g(e)}},{text:t}]}})).text||"分析失败"},N=async(e,t,a)=>{let s=p();if(!s)return await c(e,t);let i='\n    Role: Professional Screenwriter & World Builder.\n    Task: Create a comprehensive script package based on the user\'s story idea/theme.\n    \n    Input Story/Theme: """'.concat(e,'"""\n    User Requirements: """').concat(t,'"""\n    \n    Output Format (Strictly follow this structure):\n    1. **World View & Setting**: Describe the rules, atmosphere, time period, and location.\n    2. **Core Values & Themes**: The central message or philosophical conflict.\n    3. **Character Profiles**:\n       - Name, Age, Role\n       - Personality & Backstory\n       - Visual Features (for casting/generation)\n    4. **Scene Breakdown**:\n       - Write key scenes in standard screenplay format (Slugline, Action, Dialogue).\n       - Ensure scenes are descriptive enough to be split into individual storyboard shots later.\n    \n    Tone: Professional, cinematic, and ready for production.\n    '),r=a||"gemini-3-pro-preview",n=r.includes("pro");return(await s.models.generateContent({model:r,contents:i,config:n?{thinkingConfig:{thinkingBudget:16e3}}:void 0})).text||"生成失败"},k=async(e,t,a,s)=>{let i=p();if(!i)return await d(e,t,a);let r='\n    Role: Expert Script Doctor & Adaptation Specialist.\n    Task: Analyze the input text (novel/script) and rewrite/adapt it based on instructions.\n    \n    Input Text: """'.concat(e,'"""\n    ').concat(t?'Reference Video Analysis: """'.concat(t,'"""'):"",'\n    User Instructions: """').concat(a,'"""\n    \n    Process:\n    1. **Analyze**: Understand the narrative arc, pacing, character motivations, and subtext of the input.\n    2. **Adapt/Rewrite**: Rewrite the content into a polished Shooting Script format.\n    3. **Visual Optimization**: Enhance visual descriptions in the Action lines to aid future visual generation.\n    \n    Output:\n    - Provide the adapted script in standard format.\n    - If requested, include notes on why specific changes were made (e.g., "Compressed dialogue for better pacing").\n    '),n=s||"gemini-3-pro-preview",l=n.includes("pro");return(await i.models.generateContent({model:n,contents:r,config:l?{thinkingConfig:{thinkingBudget:32e3}}:void 0})).text||"改编失败"},E=async(e,t)=>{let a=p();if(!a)return await u(e);let s='\n    Role: Visionary Visual Director & Cinematographer.\n    Task: Translate the script/scene description into a precise, high-fidelity visual prompt optimized for AI image generation.\n    \n    Input Script/Scene: """'.concat(e,'"""\n    \n    Output Format:\n    Please provide a cohesive, descriptive paragraph that integrates the following elements naturally:\n    \n    1. **Subject & Action**: What is happening, who is there.\n    2. **Camera Language**: Shot type (Wide, Close-up), Angle (Low, High), Movement.\n    3. **Lighting & Atmosphere**: Time of day, light source, mood (Cinematic, Ethereal, Gritty).\n    4. **Art Direction**: Style (Photorealistic, Cyberpunk, Oil Painting), Color Palette.\n    \n    IMPORTANT: \n    - Output ONLY the final prompt text. \n    - Do not use markdown headers or bullet points. \n    - Write it as a single, rich, descriptive block of text that I can directly paste into an image generator.\n    ');return(await a.models.generateContent({model:t||"gemini-3-pro-preview",contents:s})).text||"视觉渲染失败"},R=async(e,t,a)=>{let s=p();if(!s)throw Error("Chat requires a configured API Key in Settings.");let i=(null==a?void 0:a.model)||((null==a?void 0:a.isThinkingMode)?"gemini-3-pro-preview":"gemini-3-flash-preview"),r=i.includes("pro"),n=s.chats.create({model:i,config:{systemInstruction:"You are InkAI, a helpful multimedia expert.",...r&&(null==a?void 0:a.isThinkingMode)?{thinkingConfig:{thinkingBudget:16e3}}:{}},history:e});return(await n.sendMessage({message:t})).text||""},S=async e=>{try{let t=await fetch(e),a=await t.blob();return new Promise((e,t)=>{let s=new FileReader;s.onload=t=>e(s.result),s.onerror=t,s.readAsDataURL(a)})}catch(e){return""}},C=e=>new Promise((t,a)=>{let s=document.createElement("video");s.crossOrigin="anonymous",s.src=e,s.muted=!0,s.onloadedmetadata=()=>{s.currentTime=Math.max(0,s.duration-.1)},s.onseeked=()=>{try{let e=document.createElement("canvas");e.width=s.videoWidth,e.height=s.videoHeight;let i=e.getContext("2d");i?(i.drawImage(s,0,0,e.width,e.height),t(e.toDataURL("image/png"))):a(Error("Canvas failed"))}catch(e){a(e)}finally{s.remove()}},s.onerror=()=>{a(Error("Video load failed")),s.remove()}}),A=async function(e,t){var a,i,r,n,l,o;let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=p();if(!d)return await x(e,t,c);let u=await d.models.generateContent({model:"gemini-2.5-flash-preview-tts",contents:[{parts:[{text:e}]}],config:{responseModalities:[s.mM.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Puck"}}}}});return"data:audio/pcm;base64,".concat(null===(o=u.candidates)||void 0===o?void 0:null===(l=o[0])||void 0===l?void 0:null===(n=l.content)||void 0===n?void 0:null===(r=n.parts)||void 0===r?void 0:null===(i=r[0])||void 0===i?void 0:null===(a=i.inlineData)||void 0===a?void 0:a.data)},T=async e=>{var t;let a=p();return a?(await a.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:g(e),mimeType:(null===(t=e.match(/^data:([^;]+);base64,/))||void 0===t?void 0:t[1])||"audio/mp3"}},{text:"Transcribe the audio."}]}})).text||"":await r(e)},z=async(e,t)=>{let a=p();if(!a)throw Error("Live Session requires a configured API Key in Settings.");return a.live.connect({model:"gemini-2.5-flash-native-audio-preview-12-2025",callbacks:{onopen:()=>console.debug("Live session started"),onmessage:async t=>{var a,s,i,r,n;let l=null===(n=t.serverContent)||void 0===n?void 0:null===(r=n.modelTurn)||void 0===r?void 0:null===(i=r.parts)||void 0===i?void 0:null===(s=i[0])||void 0===s?void 0:null===(a=s.inlineData)||void 0===a?void 0:a.data;l&&e(l)},onclose:e=>t(),onerror:e=>{console.error("Live session error:",e),t()}},config:{responseModalities:[s.mM.AUDIO]}})}},6999:function(e,t,a){"use strict";a.d(t,{R:function(){return r},m:function(){return n}});let s="app_data",i=()=>new Promise((e,t)=>{let a=indexedDB.open("inkai_db",1);a.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(s)||t.createObjectStore(s)},a.onsuccess=t=>{e(t.target.result)},a.onerror=e=>{t(e.target.error)}}),r=async(e,t)=>{let a=await i();return new Promise((i,r)=>{let n=a.transaction(s,"readwrite");n.objectStore(s).put(t,e),n.oncomplete=()=>i(),n.onerror=()=>r(n.error)})},n=async e=>{let t=await i();return new Promise((a,i)=>{let r=t.transaction(s,"readonly").objectStore(s).get(e);r.onsuccess=()=>{a(r.result)},r.onerror=()=>{i(r.error)}})}}},function(e){e.O(0,[19,182,971,23,744],function(){return e(e.s=4551)}),_N_E=e.O()}]);